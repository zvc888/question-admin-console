(function(){UEDITOR_CONFIG=window.UEDITOR_CONFIG||{};var baidu=window.baidu||{};window.baidu=baidu;window.UE=baidu.editor=window.UE||{};UE.plugins={};UE.commands={};UE.instants={};UE.I18N={};UE._customizeUI={};UE.version="1.4.3";UE.promptAlert=function(){};UE.showFormulaDialogue=function(){};var dom=UE.dom={};var browser=UE.browser=function(){var e=navigator.userAgent.toLowerCase(),t=window.opera,i={ie:/(msie\s|trident.*rv:)([\w.]+)/.test(e),opera:!!t&&t.version,webkit:e.indexOf(" applewebkit/")>-1,mac:e.indexOf("macintosh")>-1,quirks:document.compatMode=="BackCompat"};i.gecko=navigator.product=="Gecko"&&!i.webkit&&!i.opera&&!i.ie;var n=0;if(i.ie){var r=e.match(/(?:msie\s([\w.]+))/);var o=e.match(/(?:trident.*rv:([\w.]+))/);if(r&&o&&r[1]&&o[1]){n=Math.max(r[1]*1,o[1]*1)}else if(r&&r[1]){n=r[1]*1}else if(o&&o[1]){n=o[1]*1}else{n=0}i.ie11Compat=document.documentMode==11;i.ie9Compat=document.documentMode==9;i.ie8=!!document.documentMode;i.ie8Compat=document.documentMode==8;i.ie7Compat=n==7&&!document.documentMode||document.documentMode==7;i.ie6Compat=n<7||i.quirks;i.ie9above=n>8;i.ie9below=n<9;i.ie11above=n>10;i.ie11below=n<11}if(i.gecko){var a=e.match(/rv:([\d\.]+)/);if(a){a=a[1].split(".");n=a[0]*1e4+(a[1]||0)*100+(a[2]||0)*1}}if(/chrome\/(\d+\.\d)/i.test(e)){i.chrome=+RegExp["$1"]}if(/(\d+\.\d)?(?:\.\d)?\s+safari\/?(\d+\.\d+)?/i.test(e)&&!/chrome/i.test(e)){i.safari=+(RegExp["$1"]||RegExp["$2"])}if(i.opera)n=parseFloat(t.version());if(i.webkit)n=parseFloat(e.match(/ applewebkit\/(\d+)/)[1]);i.version=n;i.isCompatible=!i.mobile&&(i.ie&&n>=6||i.gecko&&n>=10801||i.opera&&n>=9.5||i.air&&n>=1||i.webkit&&n>=522||false);return i}();var ie=browser.ie,webkit=browser.webkit,gecko=browser.gecko,opera=browser.opera;var utils=UE.utils={each:function(e,t,i){if(e==null)return;if(e.length===+e.length){for(var n=0,r=e.length;n<r;n++){if(t.call(i,e[n],n,e)===false)return false}}else{for(var o in e){if(e.hasOwnProperty(o)){if(t.call(i,e[o],o,e)===false)return false}}}},makeInstance:function(e){var t=new Function;t.prototype=e;e=new t;t.prototype=null;return e},extend:function(e,t,i){if(t){for(var n in t){if(!i||!e.hasOwnProperty(n)){e[n]=t[n]}}}return e},extend2:function(e){var t=arguments;for(var i=1;i<t.length;i++){var n=t[i];for(var r in n){if(!e.hasOwnProperty(r)){e[r]=n[r]}}}return e},inherits:function(e,t){var i=e.prototype,n=utils.makeInstance(t.prototype);utils.extend(n,i,true);e.prototype=n;return n.constructor=e},bind:function(e,t){return function(){return e.apply(t,arguments)}},defer:function(e,t,i){var n;return function(){if(i){clearTimeout(n)}n=setTimeout(e,t)}},indexOf:function(e,i,n){var r=-1;n=this.isNumber(n)?n:0;this.each(e,function(e,t){if(t>=n&&e===i){r=t;return false}});return r},removeItem:function(e,t){for(var i=0,n=e.length;i<n;i++){if(e[i]===t){e.splice(i,1);i--}}},trim:function(e){return e.replace(/(^[ \t\n\r]+)|([ \t\n\r]+$)/g,"")},listToMap:function(e){if(!e)return{};e=utils.isArray(e)?e:e.split(",");for(var t=0,i,n={};i=e[t++];){n[i.toUpperCase()]=n[i]=1}return n},unhtml:function(e,t){return e?e.replace(t||/[&<">'](?:(amp|lt|quot|gt|#39|nbsp|#\d+);)?/g,function(e,t){if(t){return e}else{return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}}):""},unhtmlForUrl:function(e,t){return e?e.replace(t||/[<">']/g,function(e){return{"<":"&lt;","&":"&amp;",'"':"&quot;",">":"&gt;","'":"&#39;"}[e]}):""},html:function(e){return e?e.replace(/&((g|l|quo)t|amp|#39|nbsp);/g,function(e){return{"&lt;":"<","&amp;":"&","&quot;":'"',"&gt;":">","&#39;":"'","&nbsp;":" "}[e]}):""},cssStyleToDomStyle:function(){var e=document.createElement("div").style,t={float:e.cssFloat!=undefined?"cssFloat":e.styleFloat!=undefined?"styleFloat":"float"};return function(e){return t[e]||(t[e]=e.toLowerCase().replace(/-./g,function(e){return e.charAt(1).toUpperCase()}))}}(),loadFile:function(){var s=[];function l(e,t){try{for(var i=0,n;n=s[i++];){if(n.doc===e&&n.url==(t.src||t.href)){return n}}}catch(e){return null}}return function(t,i,e){var n=l(t,i);if(n){if(n.ready){e&&e()}else{n.funs.push(e)}return}s.push({doc:t,url:i.src||i.href,funs:[e]});if(!t.body){var r=[];for(var o in i){if(o=="tag")continue;r.push(o+'="'+i[o]+'"')}t.write("<"+i.tag+" "+r.join(" ")+" ></"+i.tag+">");return}if(i.id&&t.getElementById(i.id)){return}var a=t.createElement(i.tag);delete i.tag;for(var o in i){a.setAttribute(o,i[o])}a.onload=a.onreadystatechange=function(){if(!this.readyState||/loaded|complete/.test(this.readyState)){n=l(t,i);if(n.funs.length>0){n.ready=1;for(var e;e=n.funs.pop();){e()}}a.onload=a.onreadystatechange=null}};a.onerror=function(){throw Error("The load "+(i.href||i.src)+" fails,check the url settings of file ueditor.config.js ")};t.getElementsByTagName("head")[0].appendChild(a)}}(),isEmptyObject:function(e){if(e==null)return true;if(this.isArray(e)||this.isString(e))return e.length===0;for(var t in e)if(e.hasOwnProperty(t))return false;return true},fixColor:function(e,t){if(/color/i.test(e)&&/rgba?/.test(t)){var i=t.split(",");if(i.length>3)return"";t="#";for(var n=0,r;r=i[n++];){r=parseInt(r.replace(/[^\d]/gi,""),10).toString(16);t+=r.length==1?"0"+r:r}t=t.toUpperCase()}return t},optCss:function(e){var r,o,t;e=e.replace(/(padding|margin|border)\-([^:]+):([^;]+);?/gi,function(e,t,i,n){if(n.split(" ").length==1){switch(t){case"padding":!r&&(r={});r[i]=n;return"";case"margin":!o&&(o={});o[i]=n;return"";case"border":return n=="initial"?"":e}}return e});function i(e,t){if(!e){return""}var i=e.top,n=e.bottom,r=e.left,o=e.right,a="";if(!i||!r||!n||!o){for(var s in e){a+=";"+t+"-"+s+":"+e[s]+";"}}else{a+=";"+t+":"+(i==n&&n==r&&r==o?i:i==n&&r==o?i+" "+r:r==o?i+" "+r+" "+n:i+" "+o+" "+n+" "+r)+";"}return a}e+=i(r,"padding")+i(o,"margin");return e.replace(/^[ \n\r\t;]*|[ \n\r\t]*$/,"").replace(/;([ \n\r\t]+)|\1;/g,";").replace(/(&((l|g)t|quot|#39))?;{2,}/g,function(e,t){return t?t+";;":";"})},clone:function(e,t){var i;t=t||{};for(var n in e){if(e.hasOwnProperty(n)){i=e[n];if(typeof i=="object"){t[n]=utils.isArray(i)?[]:{};utils.clone(e[n],t[n])}else{t[n]=i}}}return t},transUnitToPx:function(n){if(!/(pt|cm)/.test(n)){return n}var r;n.replace(/([\d.]+)(\w+)/,function(e,t,i){n=t;r=i});switch(r){case"cm":n=parseFloat(n)*25;break;case"pt":n=Math.round(parseFloat(n)*96/72)}return n+(n?"px":"")},domReady:function(){var n=[];function r(e){e.isReady=true;for(var t;t=n.pop();t()){}}return function(e,t){t=t||window;var i=t.document;e&&n.push(e);if(i.readyState==="complete"){r(i)}else{i.isReady&&r(i);if(browser.ie&&browser.version!=11){(function(){if(i.isReady)return;try{i.documentElement.doScroll("left")}catch(e){setTimeout(arguments.callee,0);return}r(i)})();t.attachEvent("onload",function(){r(i)})}else{i.addEventListener("DOMContentLoaded",function(){i.removeEventListener("DOMContentLoaded",arguments.callee,false);r(i)},false);t.addEventListener("load",function(){r(i)},false)}}}}(),cssRule:browser.ie&&browser.version!=11?function(e,t,i){var n,r;if(t===undefined||t&&t.nodeType&&t.nodeType==9){i=t&&t.nodeType&&t.nodeType==9?t:i||document;n=i.indexList||(i.indexList={});r=n[e];if(r!==undefined){return i.styleSheets[r].cssText}return undefined}i=i||document;n=i.indexList||(i.indexList={});r=n[e];if(t===""){if(r!==undefined){i.styleSheets[r].cssText="";delete n[e];return true}return false}if(r!==undefined){sheetStyle=i.styleSheets[r]}else{sheetStyle=i.createStyleSheet("",r=i.styleSheets.length);n[e]=r}sheetStyle.cssText=t}:function(e,t,i){var n,r;if(t===undefined||t&&t.nodeType&&t.nodeType==9){i=t&&t.nodeType&&t.nodeType==9?t:i||document;r=i.getElementById(e);return r?r.innerHTML:undefined}i=i||document;r=i.getElementById(e);if(t===""){if(r){r.parentNode.removeChild(r);return true}return false}if(r){r.innerHTML=t}else{r=i.createElement("style");r.id=e;r.innerHTML=t;i.getElementsByTagName("head")[0].appendChild(r)}},sort:function(e,t){t=t||function(e,t){return e.localeCompare(t)};for(var i=0,n=e.length;i<n;i++){for(var r=i,o=e.length;r<o;r++){if(t(e[i],e[r])>0){var a=e[i];e[i]=e[r];e[r]=a}}}return e},serializeParam:function(e){var t=[];for(var i in e){if(i=="method"||i=="timeout"||i=="async")continue;if(!((typeof e[i]).toLowerCase()=="function"||(typeof e[i]).toLowerCase()=="object")){t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))}else if(utils.isArray(e[i])){for(var n=0;n<e[i].length;n++){t.push(encodeURIComponent(i)+"[]="+encodeURIComponent(e[i][n]))}}}return t.join("&")},formatUrl:function(e){var t=e.replace(/&&/g,"&");t=t.replace(/\?&/g,"?");t=t.replace(/&$/g,"");t=t.replace(/&#/g,"#");t=t.replace(/&+/g,"&");return t},isCrossDomainUrl:function(e){var t=document.createElement("a");t.href=e;if(browser.ie){t.href=t.href}return!(t.protocol==location.protocol&&t.hostname==location.hostname&&(t.port==location.port||t.port=="80"&&location.port==""||t.port==""&&location.port=="80"))},clearEmptyAttrs:function(e){for(var t in e){if(e[t]===""){delete e[t]}}return e},str2json:function(e){if(!utils.isString(e))return null;if(window.JSON){return JSON.parse(e)}else{return new Function("return "+utils.trim(e||""))()}},json2str:function(){if(window.JSON){return JSON.stringify}else{var i={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){if(/["\\\x00-\x1f]/.test(e)){e=e.replace(/["\\\x00-\x1f]/g,function(e){var t=i[e];if(t){return t}t=e.charCodeAt();return"\\u00"+Math.floor(t/16).toString(16)+(t%16).toString(16)})}return'"'+e+'"'}function s(e){var t=["["],i=e.length,n,r,o;for(r=0;r<i;r++){o=e[r];switch(typeof o){case"undefined":case"function":case"unknown":break;default:if(n){t.push(",")}t.push(utils.json2str(o));n=1}}t.push("]");return t.join("")}function t(e){return e<10?"0"+e:e}function l(e){return'"'+e.getFullYear()+"-"+t(e.getMonth()+1)+"-"+t(e.getDate())+"T"+t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())+'"'}return function(e){switch(typeof e){case"undefined":return"undefined";case"number":return isFinite(e)?String(e):"null";case"string":return a(e);case"boolean":return String(e);default:if(e===null){return"null"}else if(utils.isArray(e)){return s(e)}else if(utils.isDate(e)){return l(e)}else{var t=["{"],i=utils.json2str,n,r;for(var o in e){if(Object.prototype.hasOwnProperty.call(e,o)){r=e[o];switch(typeof r){case"undefined":case"unknown":case"function":break;default:if(n){t.push(",")}n=1;t.push(i(o)+":"+i(r))}}}t.push("}");return t.join("")}}}}}()};utils.each(["String","Function","Array","Number","RegExp","Object","Date"],function(t){UE.utils["is"+t]=function(e){return Object.prototype.toString.apply(e)=="[object "+t+"]"}});var EventBase=UE.EventBase=function(){};EventBase.prototype={addListener:function(e,t){e=utils.trim(e).split(/\s+/);for(var i=0,n;n=e[i++];){getListener(this,n,true).push(t)}},on:function(e,t){return this.addListener(e,t)},off:function(e,t){return this.removeListener(e,t)},trigger:function(){return this.fireEvent.apply(this,arguments)},removeListener:function(e,t){e=utils.trim(e).split(/\s+/);for(var i=0,n;n=e[i++];){utils.removeItem(getListener(this,n)||[],t)}},fireEvent:function(){var e=arguments[0];e=utils.trim(e).split(" ");for(var t=0,i;i=e[t++];){var n=getListener(this,i),r,o,a;if(n){a=n.length;while(a--){if(!n[a])continue;o=n[a].apply(this,arguments);if(o===true){return o}if(o!==undefined){r=o}}}if(o=this["on"+i.toLowerCase()]){r=o.apply(this,arguments)}}return r}};function getListener(e,t,i){var n;t=t.toLowerCase();return(n=e.__allListeners||i&&(e.__allListeners={}))&&(n[t]||i&&(n[t]=[]))}var dtd=dom.dtd=function(){function e(e){for(var t in e){e[t.toUpperCase()]=e[t]}return e}var t=utils.extend2;var i=e({isindex:1,fieldset:1}),n=e({input:1,button:1,select:1,textarea:1,label:1}),r=t(e({a:1}),n),o=t({iframe:1},r),a=e({hr:1,ul:1,menu:1,div:1,blockquote:1,noscript:1,table:1,center:1,address:1,dir:1,pre:1,h5:1,dl:1,h4:1,noframes:1,h6:1,ol:1,h1:1,h3:1,h2:1}),s=e({ins:1,del:1,script:1,style:1}),l=t(e({b:1,acronym:1,bdo:1,var:1,"#":1,abbr:1,code:1,br:1,i:1,cite:1,kbd:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,dfn:1,span:1}),s),d=t(e({sub:1,img:1,embed:1,object:1,sup:1,basefont:1,map:1,applet:1,font:1,big:1,small:1}),l),u=t(e({p:1}),d),c=t(e({iframe:1}),d,n),f=e({img:1,embed:1,noscript:1,br:1,kbd:1,center:1,button:1,basefont:1,h5:1,h4:1,samp:1,h6:1,ol:1,h1:1,h3:1,h2:1,form:1,font:1,"#":1,select:1,menu:1,ins:1,abbr:1,label:1,code:1,table:1,script:1,cite:1,input:1,iframe:1,strong:1,textarea:1,noframes:1,big:1,small:1,span:1,hr:1,sub:1,bdo:1,var:1,div:1,object:1,sup:1,strike:1,dir:1,map:1,dl:1,applet:1,del:1,isindex:1,fieldset:1,ul:1,b:1,acronym:1,a:1,blockquote:1,i:1,u:1,s:1,tt:1,address:1,q:1,pre:1,p:1,em:1,dfn:1}),m=t(e({a:0}),c),h=e({tr:1}),p=e({"#":1}),g=t(e({param:1}),f),v=t(e({form:1}),i,o,a,u),b=e({li:1,ol:1,ul:1}),y=e({style:1,script:1}),C=e({base:1,link:1,meta:1,title:1}),w=t(C,y),N=e({head:1,body:1}),x=e({html:1});var U=e({address:1,blockquote:1,center:1,dir:1,div:1,dl:1,fieldset:1,form:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,hr:1,isindex:1,menu:1,noframes:1,ol:1,p:1,pre:1,table:1,ul:1}),E=e({area:1,base:1,basefont:1,br:1,col:1,command:1,dialog:1,embed:1,hr:1,img:1,input:1,isindex:1,keygen:1,link:1,meta:1,param:1,source:1,track:1,wbr:1});return e({$nonBodyContent:t(x,N,C),$block:U,$inline:m,$inlineWithA:t(e({a:1}),m),$body:t(e({script:1,style:1}),U),$cdata:e({script:1,style:1}),$empty:E,$nonChild:e({iframe:1,textarea:1}),$listItem:e({dd:1,dt:1,li:1}),$list:e({ul:1,ol:1,dl:1}),$isNotEmpty:e({table:1,ul:1,ol:1,dl:1,iframe:1,area:1,base:1,col:1,hr:1,img:1,embed:1,input:1,link:1,meta:1,param:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1}),$removeEmpty:e({a:1,abbr:1,acronym:1,address:1,b:1,bdo:1,big:1,cite:1,code:1,del:1,dfn:1,em:1,font:1,i:1,ins:1,label:1,kbd:1,q:1,s:1,samp:1,small:1,span:1,strike:1,strong:1,sub:1,sup:1,tt:1,u:1,var:1}),$removeEmptyBlock:e({p:1,div:1}),$tableContent:e({caption:1,col:1,colgroup:1,tbody:1,td:1,tfoot:1,th:1,thead:1,tr:1,table:1}),$notTransContent:e({pre:1,script:1,style:1,textarea:1}),html:N,head:w,style:p,script:p,body:v,base:{},link:{},meta:{},title:p,col:{},tr:e({td:1,th:1}),img:{},embed:{},colgroup:e({thead:1,col:1,tbody:1,tr:1,tfoot:1}),noscript:v,td:v,br:{},th:v,center:v,kbd:m,button:t(u,a),basefont:{},h5:m,h4:m,samp:m,h6:m,ol:b,h1:m,h3:m,option:p,h2:m,form:t(i,o,a,u),select:e({optgroup:1,option:1}),font:m,ins:m,menu:b,abbr:m,label:m,table:e({thead:1,col:1,tbody:1,tr:1,colgroup:1,caption:1,tfoot:1}),code:m,tfoot:h,cite:m,li:v,input:{},iframe:v,strong:m,textarea:p,noframes:v,big:m,small:m,span:e({"#":1,br:1,b:1,strong:1,u:1,i:1,em:1,sub:1,sup:1,strike:1,span:1}),hr:m,dt:m,sub:m,optgroup:e({option:1}),param:{},bdo:m,var:m,div:v,object:g,sup:m,dd:v,strike:m,area:{},dir:b,map:t(e({area:1,form:1,p:1}),i,s,a),applet:g,dl:e({dt:1,dd:1}),del:m,isindex:{},fieldset:t(e({legend:1}),f),thead:h,ul:b,acronym:m,b:m,a:t(e({a:1}),c),blockquote:t(e({td:1,tr:1,tbody:1,li:1}),v),caption:m,i:m,u:m,tbody:h,s:m,address:t(o,u),tt:m,legend:m,q:m,pre:t(l,r),p:t(e({a:1}),m),em:m,dfn:m})}();function getDomNode(e,t,i,n,r,o){var a=n&&e[t],s;!a&&(a=e[i]);while(!a&&(s=(s||e).parentNode)){if(s.tagName=="BODY"||o&&!o(s)){return null}a=s[i]}if(a&&r&&!r(a)){return getDomNode(a,t,i,false,r)}return a}var attrFix=ie&&browser.version<9?{tabindex:"tabIndex",readonly:"readOnly",for:"htmlFor",class:"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder"}:{tabindex:"tabIndex",readonly:"readOnly"},styleBlock=utils.listToMap(["-webkit-box","-moz-box","block","list-item","table","table-row-group","table-header-group","table-footer-group","table-row","table-column-group","table-column","table-cell","table-caption"]);var domUtils=dom.domUtils={NODE_ELEMENT:1,NODE_DOCUMENT:9,NODE_TEXT:3,NODE_COMMENT:8,NODE_DOCUMENT_FRAGMENT:11,POSITION_IDENTICAL:0,POSITION_DISCONNECTED:1,POSITION_FOLLOWING:2,POSITION_PRECEDING:4,POSITION_IS_CONTAINED:8,POSITION_CONTAINS:16,fillChar:ie&&browser.version=="6"?"\ufeff":"​",keys:{8:1,46:1,16:1,17:1,18:1,37:1,38:1,39:1,40:1,13:1},getPosition:function(e,t){if(e===t){return 0}var i,n=[e],r=[t];i=e;while(i=i.parentNode){if(i===t){return 10}n.push(i)}i=t;while(i=i.parentNode){if(i===e){return 20}r.push(i)}n.reverse();r.reverse();if(n[0]!==r[0]){return 1}var o=-1;while(o++,n[o]===r[o]){}e=n[o];t=r[o];while(e=e.nextSibling){if(e===t){return 4}}return 2},getNodeIndex:function(e,t){var i=e,n=0;while(i=i.previousSibling){if(t&&i.nodeType==3){if(i.nodeType!=i.nextSibling.nodeType){n++}continue}n++}return n},inDoc:function(e,t){return domUtils.getPosition(e,t)==10},findParent:function(e,t,i){if(e&&!domUtils.isBody(e)){e=i?e:e.parentNode;while(e){if(!t||t(e)||domUtils.isBody(e)){return t&&!t(e)&&domUtils.isBody(e)?null:e}e=e.parentNode}}return null},findParentByTagName:function(e,t,i,n){t=utils.listToMap(utils.isArray(t)?t:[t]);return domUtils.findParent(e,function(e){return t[e.tagName]&&!(n&&n(e))},i)},findParents:function(e,t,i,n){var r=t&&(i&&i(e)||!i)?[e]:[];while(e=domUtils.findParent(e,i)){r.push(e)}return n?r:r.reverse()},insertAfter:function(e,t){return e.nextSibling?e.parentNode.insertBefore(t,e.nextSibling):e.parentNode.appendChild(t)},remove:function(e,t){var i=e.parentNode,n;if(i){if(t&&e.hasChildNodes()){while(n=e.firstChild){i.insertBefore(n,e)}}i.removeChild(e)}return e},getNextDomNode:function(e,t,i,n){return getDomNode(e,"firstChild","nextSibling",t,i,n)},getPreDomNode:function(e,t,i,n){return getDomNode(e,"lastChild","previousSibling",t,i,n)},isBookmarkNode:function(e){return e.nodeType==1&&e.id&&/^_baidu_bookmark_/i.test(e.id)},getWindow:function(e){var t=e.ownerDocument||e;return t.defaultView||t.parentWindow},getCommonAncestor:function(e,t){if(e===t)return e;var i=[e],n=[t],r=e,o=-1;while(r=r.parentNode){if(r===t){return r}i.push(r)}r=t;while(r=r.parentNode){if(r===e)return r;n.push(r)}i.reverse();n.reverse();while(o++,i[o]===n[o]){}return o==0?null:i[o-1]},clearEmptySibling:function(e,t,i){function n(e,t){var i;while(e&&!domUtils.isBookmarkNode(e)&&(domUtils.isEmptyInlineElement(e)||!new RegExp("[^\t\n\r"+domUtils.fillChar+"]").test(e.nodeValue))){i=e[t];domUtils.remove(e);e=i}}!t&&n(e.nextSibling,"nextSibling");!i&&n(e.previousSibling,"previousSibling")},split:function(e,t){var i=e.ownerDocument;if(browser.ie&&t==e.nodeValue.length){var n=i.createTextNode("");return domUtils.insertAfter(e,n)}var r=e.splitText(t);if(browser.ie8){var o=i.createTextNode("");domUtils.insertAfter(r,o);domUtils.remove(o)}return r},isWhitespace:function(e){return!new RegExp("[^ \t\n\r"+domUtils.fillChar+"]").test(e.nodeValue)},getXY:function(e){var t=0,i=0;while(e.offsetParent){i+=e.offsetTop;t+=e.offsetLeft;e=e.offsetParent}return{x:t,y:i}},on:function(e,t,i){var n=utils.isArray(t)?t:utils.trim(t).split(/\s+/),r=n.length;if(r)while(r--){t=n[r];if(e.addEventListener){e.addEventListener(t,i,false)}else{if(!i._d){i._d={els:[]}}var o=t+i.toString(),a=utils.indexOf(i._d.els,e);if(!i._d[o]||a==-1){if(a==-1){i._d.els.push(e)}if(!i._d[o]){i._d[o]=function(e){return i.call(e.srcElement,e||window.event)}}e.attachEvent("on"+t,i._d[o])}}}e=null},un:function(e,t,i){var n=utils.isArray(t)?t:utils.trim(t).split(/\s+/),r=n.length;if(r)while(r--){t=n[r];if(e.removeEventListener){e.removeEventListener(t,i,false)}else{var o=t+i.toString();try{e.detachEvent("on"+t,i._d?i._d[o]:i)}catch(e){}if(i._d&&i._d[o]){var a=utils.indexOf(i._d.els,e);if(a!=-1){i._d.els.splice(a,1)}i._d.els.length==0&&delete i._d[o]}}}},isSameElement:function(e,t){if(e.tagName!=t.tagName){return false}var i=e.attributes,n=t.attributes;if(!ie&&i.length!=n.length){return false}var r,o,a=0,s=0;for(var l=0;r=i[l++];){if(r.nodeName=="style"){if(r.specified){a++}if(domUtils.isSameStyle(e,t)){continue}else{return false}}if(ie){if(r.specified){a++;o=n.getNamedItem(r.nodeName)}else{continue}}else{o=t.attributes[r.nodeName]}if(!o.specified||r.nodeValue!=o.nodeValue){return false}}if(ie){for(l=0;o=n[l++];){if(o.specified){s++}}if(a!=s){return false}}return true},isSameStyle:function(e,t){var i=e.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":"),n=t.style.cssText.replace(/( ?; ?)/g,";").replace(/( ?: ?)/g,":");if(browser.opera){i=e.style;n=t.style;if(i.length!=n.length)return false;for(var r in i){if(/^(\d+|csstext)$/i.test(r)){continue}if(i[r]!=n[r]){return false}}return true}if(!i||!n){return i==n}i=i.split(";");n=n.split(";");if(i.length!=n.length){return false}for(var o=0,a;a=i[o++];){if(utils.indexOf(n,a)==-1){return false}}return true},isBlockElm:function(e){return e.nodeType==1&&(dtd.$block[e.tagName]||styleBlock[domUtils.getComputedStyle(e,"display")])&&!dtd.$nonChild[e.tagName]},isBody:function(e){return e&&e.nodeType==1&&e.tagName.toLowerCase()=="body"},breakParent:function(e,t){var i,n=e,r=e,o,a;do{n=n.parentNode;if(o){i=n.cloneNode(false);i.appendChild(o);o=i;i=n.cloneNode(false);i.appendChild(a);a=i}else{o=n.cloneNode(false);a=o.cloneNode(false)}while(i=r.previousSibling){o.insertBefore(i,o.firstChild)}while(i=r.nextSibling){a.appendChild(i)}r=n}while(t!==n);i=t.parentNode;i.insertBefore(o,t);i.insertBefore(a,t);i.insertBefore(e,a);domUtils.remove(t);return e},isEmptyInlineElement:function(e){if(e.nodeType!=1||!dtd.$removeEmpty[e.tagName]){return 0}e=e.firstChild;while(e){if(domUtils.isBookmarkNode(e)){return 0}if(e.nodeType==1&&!domUtils.isEmptyInlineElement(e)||e.nodeType==3&&!domUtils.isWhitespace(e)){return 0}e=e.nextSibling}return 1},trimWhiteTextNode:function(i){function e(e){var t;while((t=i[e])&&t.nodeType==3&&domUtils.isWhitespace(t)){i.removeChild(t)}}e("firstChild");e("lastChild")},mergeChild:function(e,t,i){var n=domUtils.getElementsByTagName(e,e.tagName.toLowerCase());for(var r=0,o;o=n[r++];){if(!o.parentNode||domUtils.isBookmarkNode(o)){continue}if(o.tagName.toLowerCase()=="span"){if(e===o.parentNode){domUtils.trimWhiteTextNode(e);if(e.childNodes.length==1){e.style.cssText=o.style.cssText+";"+e.style.cssText;domUtils.remove(o,true);continue}}o.style.cssText=e.style.cssText+";"+o.style.cssText;if(i){var a=i.style;if(a){a=a.split(";");for(var s=0,l;l=a[s++];){o.style[utils.cssStyleToDomStyle(l.split(":")[0])]=l.split(":")[1]}}}if(domUtils.isSameStyle(o,e)){domUtils.remove(o,true)}continue}if(domUtils.isSameElement(e,o)){domUtils.remove(o,true)}}},getElementsByTagName:function(e,t,i){if(i&&utils.isString(i)){var n=i;i=function(e){return domUtils.hasClass(e,n)}}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");var r=[];for(var o=0,a;a=t[o++];){var s=e.getElementsByTagName(a);for(var l=0,d;d=s[l++];){if(!i||i(d))r.push(d)}}return r},mergeToParent:function(e){var t=e.parentNode;while(t&&dtd.$removeEmpty[t.tagName]){if(t.tagName==e.tagName||t.tagName=="A"){domUtils.trimWhiteTextNode(t);if(t.tagName=="SPAN"&&!domUtils.isSameStyle(t,e)||t.tagName=="A"&&e.tagName=="SPAN"){if(t.childNodes.length>1||t!==e.parentNode){e.style.cssText=t.style.cssText+";"+e.style.cssText;t=t.parentNode;continue}else{t.style.cssText+=";"+e.style.cssText;if(t.tagName=="A"){t.style.textDecoration="underline"}}}if(t.tagName!="A"){t===e.parentNode&&domUtils.remove(e,true);break}}t=t.parentNode}},mergeSibling:function(e,t,i){function n(e,t,i){var n;if((n=i[e])&&!domUtils.isBookmarkNode(n)&&n.nodeType==1&&domUtils.isSameElement(i,n)){while(n.firstChild){if(t=="firstChild"){i.insertBefore(n.lastChild,i.firstChild)}else{i.appendChild(n.firstChild)}}domUtils.remove(n)}}!t&&n("previousSibling","firstChild",e);!i&&n("nextSibling","lastChild",e)},unSelectable:ie&&browser.ie9below||browser.opera?function(e){e.onselectstart=function(){return false};e.onclick=e.onkeyup=e.onkeydown=function(){return false};e.unselectable="on";e.setAttribute("unselectable","on");for(var t=0,i;i=e.all[t++];){switch(i.tagName.toLowerCase()){case"iframe":case"textarea":case"input":case"select":break;default:i.unselectable="on";e.setAttribute("unselectable","on")}}}:function(e){e.style.MozUserSelect=e.style.webkitUserSelect=e.style.msUserSelect=e.style.KhtmlUserSelect="none"},removeAttributes:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n;n=t[i++];){n=attrFix[n]||n;switch(n){case"className":e[n]="";break;case"style":e.style.cssText="";var r=e.getAttributeNode("style");!browser.ie&&r&&e.removeAttributeNode(r)}e.removeAttribute(n)}},createElement:function(e,t,i){return domUtils.setAttributes(e.createElement(t),i)},setAttributes:function(e,t){for(var i in t){if(t.hasOwnProperty(i)){var n=t[i];switch(i){case"class":e.className=n;break;case"style":e.style.cssText=e.style.cssText+";"+n;break;case"innerHTML":e[i]=n;break;case"value":e.value=n;break;default:e.setAttribute(attrFix[i]||i,n)}}}return e},getComputedStyle:function(e,t){var i="width height top left";if(i.indexOf(t)>-1){return e["offset"+t.replace(/^\w/,function(e){return e.toUpperCase()})]+"px"}if(e.nodeType==3){e=e.parentNode}if(browser.ie&&browser.version<9&&t=="font-size"&&!e.style.fontSize&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]){var n=e.ownerDocument.createElement("span");n.style.cssText="padding:0;border:0;font-family:simsun;";n.innerHTML=".";e.appendChild(n);var r=n.offsetHeight;e.removeChild(n);n=null;return r+"px"}try{var o=domUtils.getStyle(e,t)||(window.getComputedStyle?domUtils.getWindow(e).getComputedStyle(e,"").getPropertyValue(t):(e.currentStyle||e.style)[utils.cssStyleToDomStyle(t)])}catch(e){return""}return utils.transUnitToPx(utils.fixColor(t,o))},removeClasses:function(e,t){t=utils.isArray(t)?t:utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){r=r.replace(new RegExp("\\b"+n+"\\b"),"")}r=utils.trim(r).replace(/[ ]{2,}/g," ");if(r){e.className=r}else{domUtils.removeAttributes(e,["class"])}},addClass:function(e,t){if(!e)return;t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){if(!new RegExp("\\b"+n+"\\b").test(r)){r+=" "+n}}e.className=utils.trim(r)},hasClass:function(e,t){if(utils.isRegExp(t)){return t.test(e.className)}t=utils.trim(t).replace(/[ ]{2,}/g," ").split(" ");for(var i=0,n,r=e.className;n=t[i++];){if(!new RegExp("\\b"+n+"\\b","i").test(r)){return false}}return i-1==t.length},preventDefault:function(e){e.preventDefault?e.preventDefault():e.returnValue=false},removeStyle:function(e,t){if(browser.ie){if(t=="color"){t="(^|;)"+t}e.style.cssText=e.style.cssText.replace(new RegExp(t+"[^:]*:[^;]+;?","ig"),"")}else{if(e.style.removeProperty){e.style.removeProperty(t)}else{e.style.removeAttribute(utils.cssStyleToDomStyle(t))}}if(!e.style.cssText){domUtils.removeAttributes(e,["style"])}},getStyle:function(e,t){var i=e.style[utils.cssStyleToDomStyle(t)];return utils.fixColor(t,i)},setStyle:function(e,t,i){e.style[utils.cssStyleToDomStyle(t)]=i;if(!utils.trim(e.style.cssText)){this.removeAttributes(e,"style")}},setStyles:function(e,t){for(var i in t){if(t.hasOwnProperty(i)){domUtils.setStyle(e,i,t[i])}}},removeDirtyAttr:function(e){for(var t=0,i,n=e.getElementsByTagName("*");i=n[t++];){i.removeAttribute("_moz_dirty")}e.removeAttribute("_moz_dirty")},getChildCount:function(e,t){var i=0,n=e.firstChild;t=t||function(){return 1};while(n){if(t(n)){i++}n=n.nextSibling}return i},isEmptyNode:function(e){return!e.firstChild||domUtils.getChildCount(e,function(e){return!domUtils.isBr(e)&&!domUtils.isBookmarkNode(e)&&!domUtils.isWhitespace(e)})==0},clearSelectedArr:function(e){var t;while(t=e.pop()){domUtils.removeAttributes(t,["class"])}},scrollToView:function(e,i,t){var n=function(){var e=i.document,t=e.compatMode=="CSS1Compat";return{width:(t?e.documentElement.clientWidth:e.body.clientWidth)||0,height:(t?e.documentElement.clientHeight:e.body.clientHeight)||0}},r=function(e){if("pageXOffset"in e){return{x:e.pageXOffset||0,y:e.pageYOffset||0}}else{var t=e.document;return{x:t.documentElement.scrollLeft||t.body.scrollLeft||0,y:t.documentElement.scrollTop||t.body.scrollTop||0}}};var o=n().height,a=o*-1+t;a+=e.offsetHeight||0;var s=domUtils.getXY(e);a+=s.y;var l=r(i).y;if(a>l||a<l-o){i.scrollTo(0,a+(a<0?-20:20))}},isBr:function(e){return e.nodeType==1&&e.tagName=="BR"},isFillChar:function(e,t){if(e.nodeType!=3)return false;var i=e.nodeValue;if(t){return new RegExp("^"+domUtils.fillChar).test(i)}return!i.replace(new RegExp(domUtils.fillChar,"g"),"").length},isStartInblock:function(e){var t=e.cloneRange(),i=0,n=t.startContainer,r;if(n.nodeType==1&&n.childNodes[t.startOffset]){n=n.childNodes[t.startOffset];var o=n.previousSibling;while(o&&domUtils.isFillChar(o)){n=o;o=o.previousSibling}}if(this.isFillChar(n,true)&&t.startOffset==1){t.setStartBefore(n);n=t.startContainer}while(n&&domUtils.isFillChar(n)){r=n;n=n.previousSibling}if(r){t.setStartBefore(r);n=t.startContainer}if(n.nodeType==1&&domUtils.isEmptyNode(n)&&t.startOffset==1){t.setStart(n,0).collapse(true)}while(!t.startOffset){n=t.startContainer;if(domUtils.isBlockElm(n)||domUtils.isBody(n)){i=1;break}var o=t.startContainer.previousSibling,a;if(!o){t.setStartBefore(t.startContainer)}else{while(o&&domUtils.isFillChar(o)){a=o;o=o.previousSibling}if(a){t.setStartBefore(a)}else{t.setStartBefore(t.startContainer)}}}return i&&!domUtils.isBody(t.startContainer)?1:0},isEmptyBlock:function(e,t){if(e.nodeType!=1)return 0;t=t||new RegExp("[  \t\r\n"+domUtils.fillChar+"]","g");if(e[browser.ie?"innerText":"textContent"].replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty){if(e.getElementsByTagName(i).length){return 0}}return 1},setViewportOffset:function(e,t){var i=parseInt(e.style.left)|0;var n=parseInt(e.style.top)|0;var r=e.getBoundingClientRect();var o=t.left-r.left;var a=t.top-r.top;if(o){e.style.left=i+o+"px"}if(a){e.style.top=n+a+"px"}},fillNode:function(e,t){var i=browser.ie?e.createTextNode(domUtils.fillChar):e.createElement("br");t.innerHTML="";t.appendChild(i)},moveChild:function(e,t,i){while(e.firstChild){if(i&&t.firstChild){t.insertBefore(e.lastChild,t.firstChild)}else{t.appendChild(e.firstChild)}}},hasNoAttributes:function(e){return browser.ie?/^<\w+\s*?>/.test(e.outerHTML):e.attributes.length==0},isCustomeNode:function(e){return e.nodeType==1&&e.getAttribute("_ue_custom_node_")},isTagNode:function(e,t){return e.nodeType==1&&new RegExp("\\b"+e.tagName+"\\b","i").test(t)},filterNodeList:function(e,t,i){var n=[];if(!utils.isFunction(t)){var r=t;t=function(e){return utils.indexOf(utils.isArray(r)?r:r.split(" "),e.tagName.toLowerCase())!=-1}}utils.each(e,function(e){t(e)&&n.push(e)});return n.length==0?null:n.length==1||!i?n[0]:n},isInNodeEndBoundary:function(e,t){var i=e.startContainer;if(i.nodeType==3&&e.startOffset!=i.nodeValue.length){return 0}if(i.nodeType==1&&e.startOffset!=i.childNodes.length){return 0}while(i!==t){if(i.nextSibling){return 0}i=i.parentNode}return 1},isBoundaryNode:function(e,t){var i;while(!domUtils.isBody(e)){i=e;e=e.parentNode;if(i!==e[t]){return false}}return true},fillHtml:browser.ie11below?"&nbsp;":"<br/>"};var fillCharReg=new RegExp(domUtils.fillChar,"g");(function(){var r=0,u=domUtils.fillChar,c;function o(e){e.collapsed=e.startContainer&&e.endContainer&&e.startContainer===e.endContainer&&e.startOffset==e.endOffset}function a(e){return!e.collapsed&&e.startContainer.nodeType==1&&e.startContainer===e.endContainer&&e.endOffset-e.startOffset==1}function i(e,t,i,n){if(t.nodeType==1&&(dtd.$empty[t.tagName]||dtd.$nonChild[t.tagName])){i=domUtils.getNodeIndex(t)+(e?0:1);t=t.parentNode}if(e){n.startContainer=t;n.startOffset=i;if(!n.endContainer){n.collapse(true)}}else{n.endContainer=t;n.endOffset=i;if(!n.startContainer){n.collapse(false)}}o(n);return n}function t(e,t){var i=e.startContainer,n=e.endContainer,r=e.startOffset,o=e.endOffset,a=e.document,s=a.createDocumentFragment(),l,d;if(i.nodeType==1){i=i.childNodes[r]||(l=i.appendChild(a.createTextNode("")))}if(n.nodeType==1){n=n.childNodes[o]||(d=n.appendChild(a.createTextNode("")))}if(i===n&&i.nodeType==3){s.appendChild(a.createTextNode(i.substringData(r,o-r)));if(t){i.deleteData(r,o-r);e.collapse(true)}return s}var u,c,f=s,m=domUtils.findParents(i,true),h=domUtils.findParents(n,true);for(var p=0;m[p]==h[p];){p++}for(var g=p,v;v=m[g];g++){u=v.nextSibling;if(v==i){if(!l){if(e.startContainer.nodeType==3){f.appendChild(a.createTextNode(i.nodeValue.slice(r)));if(t){i.deleteData(r,i.nodeValue.length-r)}}else{f.appendChild(!t?i.cloneNode(true):i)}}}else{c=v.cloneNode(false);f.appendChild(c)}while(u){if(u===n||u===h[g]){break}v=u.nextSibling;f.appendChild(!t?u.cloneNode(true):u);u=v}f=c}f=s;if(!m[p]){f.appendChild(m[p-1].cloneNode(false));f=f.firstChild}for(var g=p,b;b=h[g];g++){u=b.previousSibling;if(b==n){if(!d&&e.endContainer.nodeType==3){f.appendChild(a.createTextNode(n.substringData(0,o)));if(t){n.deleteData(0,o)}}}else{c=b.cloneNode(false);f.appendChild(c)}if(g!=p||!m[p]){while(u){if(u===i){break}b=u.previousSibling;f.insertBefore(!t?u.cloneNode(true):u,f.firstChild);u=b}}f=c}if(t){e.setStartBefore(!h[p]?h[p-1]:!m[p]?m[p-1]:h[p]).collapse(true)}l&&domUtils.remove(l);d&&domUtils.remove(d);return s}var n=dom.Range=function(e){var t=this;t.startContainer=t.startOffset=t.endContainer=t.endOffset=null;t.document=e;t.collapsed=true};function f(e,t){try{if(c&&domUtils.inDoc(c,e)){if(!c.nodeValue.replace(fillCharReg,"").length){var i=c.parentNode;domUtils.remove(c);while(i&&domUtils.isEmptyInlineElement(i)&&(browser.safari?!(domUtils.getPosition(i,t)&domUtils.POSITION_CONTAINS):!i.contains(t))){c=i.parentNode;domUtils.remove(i);i=c}}else{c.nodeValue=c.nodeValue.replace(fillCharReg,"")}}}catch(e){}}function m(e,t){var i;e=e[t];while(e&&domUtils.isFillChar(e)){i=e[t];domUtils.remove(e);e=i}}n.prototype={cloneContents:function(){return this.collapsed?null:t(this,0)},deleteContents:function(){var e;if(!this.collapsed){t(this,1)}if(browser.webkit){e=this.startContainer;if(e.nodeType==3&&!e.nodeValue.length){this.setStartBefore(e).collapse(true);domUtils.remove(e)}}return this},extractContents:function(){return this.collapsed?null:t(this,2)},setStart:function(e,t){return i(true,e,t,this)},setEnd:function(e,t){return i(false,e,t,this)},setStartAfter:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e)+1)},setStartBefore:function(e){return this.setStart(e.parentNode,domUtils.getNodeIndex(e))},setEndAfter:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e)+1)},setEndBefore:function(e){return this.setEnd(e.parentNode,domUtils.getNodeIndex(e))},setStartAtFirst:function(e){return this.setStart(e,0)},setStartAtLast:function(e){return this.setStart(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},setEndAtFirst:function(e){return this.setEnd(e,0)},setEndAtLast:function(e){return this.setEnd(e,e.nodeType==3?e.nodeValue.length:e.childNodes.length)},selectNode:function(e){return this.setStartBefore(e).setEndAfter(e)},selectNodeContents:function(e){return this.setStart(e,0).setEndAtLast(e)},cloneRange:function(){var e=this;return new n(e.document).setStart(e.startContainer,e.startOffset).setEnd(e.endContainer,e.endOffset)},collapse:function(e){var t=this;if(e){t.endContainer=t.startContainer;t.endOffset=t.startOffset}else{t.startContainer=t.endContainer;t.startOffset=t.endOffset}t.collapsed=true;return t},shrinkBoundary:function(e){var t=this,i,n=t.collapsed;function r(e){return e.nodeType==1&&!domUtils.isBookmarkNode(e)&&!dtd.$empty[e.tagName]&&!dtd.$nonChild[e.tagName]}while(t.startContainer.nodeType==1&&(i=t.startContainer.childNodes[t.startOffset])&&r(i)){t.setStart(i,0)}if(n){return t.collapse(true)}if(!e){while(t.endContainer.nodeType==1&&t.endOffset>0&&(i=t.endContainer.childNodes[t.endOffset-1])&&r(i)){t.setEnd(i,i.childNodes.length)}}return t},getCommonAncestor:function(e,t){var i=this,n=i.startContainer,r=i.endContainer;if(n===r){if(e&&a(this)){n=n.childNodes[i.startOffset];if(n.nodeType==1)return n}return t&&n.nodeType==3?n.parentNode:n}return domUtils.getCommonAncestor(n,r)},trimBoundary:function(e){this.txtToElmBoundary();var t=this.startContainer,i=this.startOffset,n=this.collapsed,r=this.endContainer;if(t.nodeType==3){if(i==0){this.setStartBefore(t)}else{if(i>=t.nodeValue.length){this.setStartAfter(t)}else{var o=domUtils.split(t,i);if(t===r){this.setEnd(o,this.endOffset-i)}else if(t.parentNode===r){this.endOffset+=1}this.setStartBefore(o)}}if(n){return this.collapse(true)}}if(!e){i=this.endOffset;r=this.endContainer;if(r.nodeType==3){if(i==0){this.setEndBefore(r)}else{i<r.nodeValue.length&&domUtils.split(r,i);this.setEndAfter(r)}}}return this},txtToElmBoundary:function(e){function t(e,t){var i=e[t+"Container"],n=e[t+"Offset"];if(i.nodeType==3){if(!n){e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"Before"](i)}else if(n>=i.nodeValue.length){e["set"+t.replace(/(\w)/,function(e){return e.toUpperCase()})+"After"](i)}}}if(e||!this.collapsed){t(this,"start");t(this,"end")}return this},insertNode:function(e){var t=e,i=1;if(e.nodeType==11){t=e.firstChild;i=e.childNodes.length}this.trimBoundary(true);var n=this.startContainer,r=this.startOffset;var o=n.childNodes[r];if(o){n.insertBefore(e,o)}else{n.appendChild(e)}if(t.parentNode===this.endContainer){this.endOffset=this.endOffset+i}return this.setStartBefore(t)},setCursor:function(e,t){return this.collapse(!e).select(t)},createBookmark:function(e,t){var i,n=this.document.createElement("span");n.style.cssText="display:none;line-height:0px;";n.appendChild(this.document.createTextNode("‍"));n.id="_baidu_bookmark_start_"+(t?"":r++);if(!this.collapsed){i=n.cloneNode(true);i.id="_baidu_bookmark_end_"+(t?"":r++)}this.insertNode(n);if(i){this.collapse().insertNode(i).setEndBefore(i)}this.setStartAfter(n);return{start:e?n.id:n,end:i?e?i.id:i:null,id:e}},moveToBookmark:function(e){var t=e.id?this.document.getElementById(e.start):e.start,i=e.end&&e.id?this.document.getElementById(e.end):e.end;this.setStartBefore(t);domUtils.remove(t);if(i){this.setEndBefore(i);domUtils.remove(i)}else{this.collapse(true)}return this},enlarge:function(e,t){var i=domUtils.isBody,n,r,o=this.document.createTextNode("");if(e){r=this.startContainer;if(r.nodeType==1){if(r.childNodes[this.startOffset]){n=r=r.childNodes[this.startOffset]}else{r.appendChild(o);n=r=o}}else{n=r}while(1){if(domUtils.isBlockElm(r)){r=n;while((n=r.previousSibling)&&!domUtils.isBlockElm(n)){r=n}this.setStartBefore(r);break}n=r;r=r.parentNode}r=this.endContainer;if(r.nodeType==1){if(n=r.childNodes[this.endOffset]){r.insertBefore(o,n)}else{r.appendChild(o)}n=r=o}else{n=r}while(1){if(domUtils.isBlockElm(r)){r=n;while((n=r.nextSibling)&&!domUtils.isBlockElm(n)){r=n}this.setEndAfter(r);break}n=r;r=r.parentNode}if(o.parentNode===this.endContainer){this.endOffset--}domUtils.remove(o)}if(!this.collapsed){while(this.startOffset==0){if(t&&t(this.startContainer)){break}if(i(this.startContainer)){break}this.setStartBefore(this.startContainer)}while(this.endOffset==(this.endContainer.nodeType==1?this.endContainer.childNodes.length:this.endContainer.nodeValue.length)){if(t&&t(this.endContainer)){break}if(i(this.endContainer)){break}this.setEndAfter(this.endContainer)}}return this},enlargeToBlockElm:function(e){while(!domUtils.isBlockElm(this.startContainer)){this.setStartBefore(this.startContainer)}if(!e){while(!domUtils.isBlockElm(this.endContainer)){this.setEndAfter(this.endContainer)}}return this},adjustmentBoundary:function(){if(!this.collapsed){while(!domUtils.isBody(this.startContainer)&&this.startOffset==this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length&&this.startContainer[this.startContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setStartAfter(this.startContainer)}while(!domUtils.isBody(this.endContainer)&&!this.endOffset&&this.endContainer[this.endContainer.nodeType==3?"nodeValue":"childNodes"].length){this.setEndBefore(this.endContainer)}}return this},applyInlineStyle:function(t,e,i){if(this.collapsed)return this;this.trimBoundary().enlarge(false,function(e){return e.nodeType==1&&domUtils.isBlockElm(e)}).adjustmentBoundary();var n=this.createBookmark(),r=n.end,o=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},a=domUtils.getNextDomNode(n.start,false,o),s,l,d=this.cloneRange();while(a&&domUtils.getPosition(a,r)&domUtils.POSITION_PRECEDING){if(a.nodeType==3||dtd[t][a.tagName]){d.setStartBefore(a);s=a;while(s&&(s.nodeType==3||dtd[t][s.tagName])&&s!==r){l=s;s=domUtils.getNextDomNode(s,s.nodeType==1,null,function(e){return dtd[t][e.tagName]})}var u=d.setEndAfter(l).extractContents(),c;if(i&&i.length>0){var f,m;m=f=i[0].cloneNode(false);for(var h=1,p;p=i[h++];){f.appendChild(p.cloneNode(false));f=f.firstChild}c=f}else{c=d.document.createElement(t)}if(e){domUtils.setAttributes(c,e)}c.appendChild(u);d.insertNode(i?m:c);var g;if(t=="span"&&e.style&&/text\-decoration/.test(e.style)&&(g=domUtils.findParentByTagName(c,"a",true))){domUtils.setAttributes(g,e);domUtils.remove(c,true);c=g}else{domUtils.mergeSibling(c);domUtils.clearEmptySibling(c)}domUtils.mergeChild(c,e);a=domUtils.getNextDomNode(c,false,o);domUtils.mergeToParent(c);if(s===r){break}}else{a=domUtils.getNextDomNode(a,true,o)}}return this.moveToBookmark(n)},removeInlineStyle:function(e){if(this.collapsed)return this;e=utils.isArray(e)?e:[e];this.shrinkBoundary().adjustmentBoundary();var t=this.startContainer,i=this.endContainer;while(1){if(t.nodeType==1){if(utils.indexOf(e,t.tagName.toLowerCase())>-1){break}if(t.tagName.toLowerCase()=="body"){t=null;break}}t=t.parentNode}while(1){if(i.nodeType==1){if(utils.indexOf(e,i.tagName.toLowerCase())>-1){break}if(i.tagName.toLowerCase()=="body"){i=null;break}}i=i.parentNode}var n=this.createBookmark(),r,o;if(t){o=this.cloneRange().setEndBefore(n.start).setStartBefore(t);r=o.extractContents();o.insertNode(r);domUtils.clearEmptySibling(t,true);t.parentNode.insertBefore(n.start,t)}if(i){o=this.cloneRange().setStartAfter(n.end).setEndAfter(i);r=o.extractContents();o.insertNode(r);domUtils.clearEmptySibling(i,false,true);i.parentNode.insertBefore(n.end,i.nextSibling)}var a=domUtils.getNextDomNode(n.start,false,function(e){return e.nodeType==1}),s;while(a&&a!==n.end){s=domUtils.getNextDomNode(a,true,function(e){return e.nodeType==1});if(utils.indexOf(e,a.tagName.toLowerCase())>-1){domUtils.remove(a,true)}a=s}return this.moveToBookmark(n)},getClosedNode:function(){var e;if(!this.collapsed){var t=this.cloneRange().adjustmentBoundary().shrinkBoundary();if(a(t)){var i=t.startContainer.childNodes[t.startOffset];if(i&&i.nodeType==1&&(dtd.$empty[i.tagName]||dtd.$nonChild[i.tagName])){e=i}}}return e},select:browser.ie?function(e,t){var i;if(!this.collapsed)this.shrinkBoundary();var n=this.getClosedNode();if(n&&!t){try{i=this.document.body.createControlRange();i.addElement(n);i.select()}catch(e){}return this}var r=this.createBookmark(),o=r.start,a;i=this.document.body.createTextRange();i.moveToElementText(o);i.moveStart("character",1);if(!this.collapsed){var s=this.document.body.createTextRange();a=r.end;s.moveToElementText(a);i.setEndPoint("EndToEnd",s)}else{if(!e&&this.startContainer.nodeType!=3){var l=this.document.createTextNode(u),d=this.document.createElement("span");d.appendChild(this.document.createTextNode(u));o.parentNode.insertBefore(d,o);o.parentNode.insertBefore(l,o);f(this.document,l);c=l;m(d,"previousSibling");m(o,"nextSibling");i.moveStart("character",-1);i.collapse(true)}}this.moveToBookmark(r);d&&domUtils.remove(d);try{i.select()}catch(e){}return this}:function(e){function t(n){function e(e,t,i){if(e.nodeType==3&&e.nodeValue.length<t){n[i+"Offset"]=e.nodeValue.length}}e(n.startContainer,n.startOffset,"start");e(n.endContainer,n.endOffset,"end")}var i=domUtils.getWindow(this.document),n=i.getSelection(),r;browser.gecko?this.document.body.focus():i.focus();if(n){n.removeAllRanges();if(this.collapsed&&!e){var o=this.startContainer,a=o;if(o.nodeType==1){a=o.childNodes[this.startOffset]}if(!(o.nodeType==3&&this.startOffset)&&(a?!a.previousSibling||a.previousSibling.nodeType!=3:!o.lastChild||o.lastChild.nodeType!=3)){r=this.document.createTextNode(u);this.insertNode(r);f(this.document,r);m(r,"previousSibling");m(r,"nextSibling");c=r;this.setStart(r,browser.webkit?1:0).collapse(true)}}var s=this.document.createRange();if(this.collapsed&&browser.opera&&this.startContainer.nodeType==1){var a=this.startContainer.childNodes[this.startOffset];if(!a){a=this.startContainer.lastChild;if(a&&domUtils.isBr(a)){this.setStartBefore(a).collapse(true)}}else{while(a&&domUtils.isBlockElm(a)){if(a.nodeType==1&&a.childNodes[0]){a=a.childNodes[0]}else{break}}a&&this.setStartBefore(a).collapse(true)}}t(this);s.setStart(this.startContainer,this.startOffset);s.setEnd(this.endContainer,this.endOffset);n.addRange(s)}return this},scrollToView:function(e,t){e=e?window:domUtils.getWindow(this.document);var i=this,n=i.document.createElement("span");n.innerHTML="&nbsp;";i.cloneRange().insertNode(n);domUtils.scrollToView(n,e,t);domUtils.remove(n);return i},inFillChar:function(){var e=this.startContainer;if(this.collapsed&&e.nodeType==3&&e.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"").length+1==e.nodeValue.length){return true}return false},createAddress:function(e,d){var t={},u=this;function i(e){var t=e?u.startContainer:u.endContainer;var i=domUtils.findParents(t,true,function(e){return!domUtils.isBody(e)}),n=[];for(var r=0,o;o=i[r++];){n.push(domUtils.getNodeIndex(o,d))}var a=0;if(d){if(t.nodeType==3){var s=t.previousSibling;while(s&&s.nodeType==3){a+=s.nodeValue.replace(fillCharReg,"").length;s=s.previousSibling}a+=e?u.startOffset:u.endOffset}else{t=t.childNodes[e?u.startOffset:u.endOffset];if(t){a=domUtils.getNodeIndex(t,d)}else{t=e?u.startContainer:u.endContainer;var l=t.firstChild;while(l){if(domUtils.isFillChar(l)){l=l.nextSibling;continue}a++;if(l.nodeType==3){while(l&&l.nodeType==3){l=l.nextSibling}}else{l=l.nextSibling}}}}}else{a=e?domUtils.isFillChar(t)?0:u.startOffset:u.endOffset}if(a<0){a=0}n.push(a);return n}t.startAddress=i(true);if(!e){t.endAddress=u.collapsed?[].concat(t.startAddress):i()}return t},moveToAddress:function(e,t){var l=this;function i(e,t){var i=l.document.body,n,r;for(var o=0,a,s=e.length;o<s;o++){a=e[o];n=i;i=i.childNodes[a];if(!i){r=a;break}}if(t){if(i){l.setStartBefore(i)}else{l.setStart(n,r)}}else{if(i){l.setEndBefore(i)}else{l.setEnd(n,r)}}}i(e.startAddress,true);!t&&e.endAddress&&i(e.endAddress);return l},equals:function(e){for(var t in this){if(this.hasOwnProperty(t)){if(this[t]!==e[t])return false}}return true},traversal:function(e,t){if(this.collapsed)return this;var i=this.createBookmark(),n=i.end,r=domUtils.getNextDomNode(i.start,false,t);while(r&&r!==n&&domUtils.getPosition(r,n)&domUtils.POSITION_PRECEDING){var o=domUtils.getNextDomNode(r,false,t);e(r);r=o}return this.moveToBookmark(i)}}})();(function(){function n(e,t){var i=domUtils.getNodeIndex;e=e.duplicate();e.collapse(t);var n=e.parentElement();if(!n.hasChildNodes()){return{container:n,offset:0}}var r=n.children,o,a=e.duplicate(),s=0,l=r.length-1,d=-1,u;while(s<=l){d=Math.floor((s+l)/2);o=r[d];a.moveToElementText(o);var c=a.compareEndPoints("StartToStart",e);if(c>0){l=d-1}else if(c<0){s=d+1}else{return{container:n,offset:i(o)}}}if(d==-1){a.moveToElementText(n);a.setEndPoint("StartToStart",e);u=a.text.replace(/(\r\n|\r)/g,"\n").length;r=n.childNodes;if(!u){o=r[r.length-1];return{container:o,offset:o.nodeValue.length}}var f=r.length;while(u>0){u-=r[--f].nodeValue.length}return{container:r[f],offset:-u}}a.collapse(c>0);a.setEndPoint(c>0?"StartToStart":"EndToStart",e);u=a.text.replace(/(\r\n|\r)/g,"\n").length;if(!u){return dtd.$empty[o.tagName]||dtd.$nonChild[o.tagName]?{container:n,offset:i(o)+(c>0?0:1)}:{container:o,offset:c>0?0:o.childNodes.length}}while(u>0){try{var m=o;o=o[c>0?"previousSibling":"nextSibling"];u-=o.nodeValue.length}catch(e){return{container:n,offset:i(m)}}}return{container:o,offset:c>0?-u:o.nodeValue.length+u}}function s(e,t){if(e.item){t.selectNode(e.item(0))}else{var i=n(e,true);t.setStart(i.container,i.offset);if(e.compareEndPoints("StartToEnd",e)!=0){i=n(e,false);t.setEnd(i.container,i.offset)}}return t}function r(e){var t;try{t=e.getNative().createRange()}catch(e){return null}var i=t.item?t.item(0):t.parentElement();if((i.ownerDocument||i)===e.document){return t}return null}var e=dom.Selection=function(e){var t=this,i;t.document=e;if(browser.ie9below){i=domUtils.getWindow(e).frameElement;domUtils.on(i,"beforedeactivate",function(){t._bakIERange=t.getIERange()});domUtils.on(i,"activate",function(){try{if(!r(t)&&t._bakIERange){t._bakIERange.select()}}catch(e){}t._bakIERange=null})}i=e=null};e.prototype={rangeInBody:function(e,t){var i=browser.ie9below||t?e.item?e.item():e.parentElement():e.startContainer;return i===this.document.body||domUtils.inDoc(i,this.document)},getNative:function(){var e=this.document;try{return!e?null:browser.ie9below?e.selection:domUtils.getWindow(e).getSelection()}catch(e){return null}},getIERange:function(){var e=r(this);if(!e){if(this._bakIERange){return this._bakIERange}}return e},cache:function(){this.clear();this._cachedRange=this.getRange();this._cachedStartElement=this.getStart();this._cachedStartElementPath=this.getStartElementPath()},getStartElementPath:function(){if(this._cachedStartElementPath){return this._cachedStartElementPath}var e=this.getStart();if(e){return domUtils.findParents(e,true,null,true)}return[]},clear:function(){this._cachedStartElementPath=this._cachedRange=this._cachedStartElement=null},isFocus:function(){try{if(browser.ie9below){var e=r(this);return!!(e&&this.rangeInBody(e))}else{return!!this.getNative().rangeCount}}catch(e){return false}},getRange:function(){var n=this;function t(e){var t=n.document.body.firstChild,i=e.collapsed;while(t&&t.firstChild){e.setStart(t,0);t=t.firstChild}if(!e.startContainer){e.setStart(n.document.body,0)}if(i){e.collapse(true)}}if(n._cachedRange!=null){return this._cachedRange}var i=new baidu.editor.dom.Range(n.document);if(browser.ie9below){var e=n.getIERange();if(e){try{s(e,i)}catch(e){t(i)}}else{t(i)}}else{var r=n.getNative();if(r&&r.rangeCount){var o=r.getRangeAt(0);var a=r.getRangeAt(r.rangeCount-1);i.setStart(o.startContainer,o.startOffset).setEnd(a.endContainer,a.endOffset);if(i.collapsed&&domUtils.isBody(i.startContainer)&&!i.startOffset){t(i)}}else{if(this._bakRange&&domUtils.inDoc(this._bakRange.startContainer,this.document)){return this._bakRange}t(i)}}return this._bakRange=i},getStart:function(){if(this._cachedStartElement){return this._cachedStartElement}var e=browser.ie9below?this.getIERange():this.getRange(),t,i,n,r;if(browser.ie9below){if(!e){return this.document.body.firstChild}if(e.item){return e.item(0)}t=e.duplicate();t.text.length>0&&t.moveStart("character",1);t.collapse(1);i=t.parentElement();r=n=e.parentElement();while(n=n.parentNode){if(n==i){i=r;break}}}else{e.shrinkBoundary();i=e.startContainer;if(i.nodeType==1&&i.hasChildNodes()){i=i.childNodes[Math.min(i.childNodes.length-1,e.startOffset)]}if(i.nodeType==3){return i.parentNode}}return i},getText:function(){var e,t;if(this.isFocus()&&(e=this.getNative())){t=browser.ie9below?e.createRange():e.getRangeAt(0);return browser.ie9below?t.text:t.toString()}return""},clearRange:function(){this.getNative()[browser.ie9below?"empty":"removeAllRanges"]()}}})();(function(){var i=0,s;function u(e,t){var i;if(t.textarea){if(utils.isString(t.textarea)){for(var n=0,r,o=domUtils.getElementsByTagName(e,"textarea");r=o[n++];){if(r.id=="ueditor_textarea_"+t.options.textarea){i=r;break}}}else{i=t.textarea}}if(!i){e.appendChild(i=domUtils.createElement(document,"textarea",{name:t.options.textarea,id:"ueditor_textarea_"+t.options.textarea,style:"display:none"}));t.textarea=i}!i.getAttribute("name")&&i.setAttribute("name",t.options.textarea);i.value=t.hasContents()?t.options.allHtmlEnabled?t.getAllHtml():t.getContent(null,null,true):""}function e(e){for(var t in UE.plugins){UE.plugins[t].call(e)}}function n(e){for(var t in e){return t}}function r(e){e.langIsReady=true;e.fireEvent("langReady")}var o=UE.Editor=function(e){var t=this;t.uid=i++;EventBase.call(t);t.commands={};t.options=utils.extend(utils.clone(e||{}),UEDITOR_CONFIG,true);t.shortcutkeys={};t.inputRules=[];t.outputRules=[];t.setOpt(o.defaultOptions(t));t.loadServerConfig();if(!utils.isEmptyObject(UE.I18N)){t.options.lang=n(UE.I18N);UE.plugin.load(t);r(t)}else{utils.loadFile(document,{src:t.options.langPath+t.options.lang+"/"+t.options.lang+".js",tag:"script",type:"text/javascript",defer:"defer"},function(){UE.plugin.load(t);r(t)})}UE.instants["ueditorInstant"+t.uid]=t};o.prototype={registerCommand:function(e,t){this.commands[e]=t},ready:function(e){var t=this;if(e){t.isReady?e.apply(t):t.addListener("ready",e)}},setOpt:function(e,t){var i={};if(utils.isString(e)){i[e]=t}else{i=e}utils.extend(this.options,i,true)},getOpt:function(e){return this.options[e]},destroy:function(){var e=this;e.fireEvent("destroy");var t=e.container.parentNode;var i=e.textarea;if(!i){i=document.createElement("textarea");t.parentNode.insertBefore(i,t)}else{i.style.display=""}i.style.width=e.iframe.offsetWidth+"px";i.style.height=e.iframe.offsetHeight+"px";i.value=e.getContent();i.id=e.key;t.innerHTML="";domUtils.remove(t);var n=e.key;for(var r in e){if(e.hasOwnProperty(r)){delete this[r]}}UE.delEditor(n)},render:function(t){var e=this,i=e.options,n=function(e){return parseInt(domUtils.getComputedStyle(t,e))};if(utils.isString(t)){t=document.getElementById(t)}if(t){if(i.initialFrameWidth){i.minFrameWidth=i.initialFrameWidth}else{i.minFrameWidth=i.initialFrameWidth=t.offsetWidth}if(i.initialFrameHeight){i.minFrameHeight=i.initialFrameHeight}else{i.initialFrameHeight=i.minFrameHeight=t.offsetHeight}t.style.width=/%$/.test(i.initialFrameWidth)?"100%":i.initialFrameWidth-n("padding-left")-n("padding-right")+"px";t.style.height=/%$/.test(i.initialFrameHeight)?"100%":i.initialFrameHeight-n("padding-top")-n("padding-bottom")+"px";t.style.zIndex=i.zIndex;var r=(ie&&browser.version<9?"":"<!DOCTYPE html>")+"<html xmlns='http://www.w3.org/1999/xhtml' class='view' ><head>"+"<style type='text/css'>"+".view{padding:0;word-wrap:break-word;cursor:text;height:90%;}\n"+"body{margin:8px;font-family:sans-serif;font-size:16px;}"+"p{margin:5px 0;}</style>"+(i.iframeCssUrl?"<link rel='stylesheet' type='text/css' href='"+utils.unhtml(i.iframeCssUrl)+"'/>":"")+(i.initialStyle?"<style>"+i.initialStyle+"</style>":"")+"</head><body class='view' ></body>"+"<script type='text/javascript' "+(ie?"defer='defer'":"")+" id='_initialScript'>"+"setTimeout(function(){editor = window.parent.UE.instants['ueditorInstant"+e.uid+"'];editor._setup(document);},0);"+"var _tmpScript = document.getElementById('_initialScript');_tmpScript.parentNode.removeChild(_tmpScript);<\/script></html>";t.appendChild(domUtils.createElement(document,"iframe",{id:"ueditor_"+e.uid,width:"100%",height:"100%",frameborder:"0",src:"javascript:void(function(){document.open();"+(i.customDomain&&document.domain!=location.hostname?'document.domain="'+document.domain+'";':"")+'document.write("'+r+'");document.close();}())'}));t.style.overflow="hidden";setTimeout(function(){if(/%$/.test(i.initialFrameWidth)){i.minFrameWidth=i.initialFrameWidth=t.offsetWidth}if(/%$/.test(i.initialFrameHeight)){i.minFrameHeight=i.initialFrameHeight=t.offsetHeight;t.style.height=i.initialFrameHeight+"px"}})}},_setup:function(e){var t=this,i=t.options;if(ie){e.body.disabled=true;e.body.contentEditable=true;e.body.disabled=false}else{e.body.contentEditable=true}e.body.spellcheck=false;t.document=e;t.window=e.defaultView||e.parentWindow;t.iframe=t.window.frameElement;t.body=e.body;t.selection=new dom.Selection(e);var n;if(browser.gecko&&(n=this.selection.getNative())){n.removeAllRanges()}this._initEvents();for(var r=this.iframe.parentNode;!domUtils.isBody(r);r=r.parentNode){if(r.tagName=="FORM"){t.form=r;if(t.options.autoSyncData){domUtils.on(t.window,"blur",function(){u(r,t)})}else{domUtils.on(r,"submit",function(){u(this,t)})}break}}if(i.initialContent){if(i.autoClearinitialContent){var o=t.execCommand;t.execCommand=function(){t.fireEvent("firstBeforeExecCommand");return o.apply(t,arguments)};this._setDefaultContent(i.initialContent)}else this.setContent(i.initialContent,false,true)}if(domUtils.isEmptyNode(t.body)){t.body.innerHTML='<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>"}if(i.focus){setTimeout(function(){t.focus(t.options.focusInEnd);!t.options.autoClearinitialContent&&t._selectionChange()},0)}if(!t.container){t.container=this.iframe.parentNode}if(i.fullscreen&&t.ui){t.ui.setFullScreen(true)}try{t.document.execCommand("2D-position",false,false)}catch(e){}try{t.document.execCommand("enableInlineTableEditing",false,false)}catch(e){}try{t.document.execCommand("enableObjectResizing",false,false)}catch(e){}t._bindshortcutKeys();t.isReady=1;t.fireEvent("ready");i.onready&&i.onready.call(t);if(!browser.ie9below){domUtils.on(t.window,["blur","focus"],function(e){if(e.type=="blur"){t._bakRange=t.selection.getRange();try{t._bakNativeRange=t.selection.getNative().getRangeAt(0);t.selection.getNative().removeAllRanges()}catch(e){t._bakNativeRange=null}}else{try{t._bakRange&&t._bakRange.select()}catch(e){}}})}if(browser.gecko&&browser.version<=10902){t.body.contentEditable=false;setTimeout(function(){t.body.contentEditable=true},100);setInterval(function(){t.body.style.height=t.iframe.offsetHeight-20+"px"},100)}!i.isShow&&t.setHide();i.readonly&&t.setDisabled()},sync:function(e){var t=this,i=e?document.getElementById(e):domUtils.findParent(t.iframe.parentNode,function(e){return e.tagName=="FORM"},true);i&&u(i,t)},setHeight:function(e,t){if(e!==parseInt(this.iframe.parentNode.style.height)){this.iframe.parentNode.style.height=e+"px"}!t&&(this.options.minFrameHeight=this.options.initialFrameHeight=e);this.body.style.height=e+"px";!t&&this.trigger("setHeight")},addshortcutkey:function(e,t){var i={};if(t){i[e]=t}else{i=e}utils.extend(this.shortcutkeys,i)},_bindshortcutKeys:function(){var d=this,u=this.shortcutkeys;d.addListener("keydown",function(e,t){var i=t.keyCode||t.which;for(var n in u){var r=u[n].split(",");for(var o=0,a;a=r[o++];){a=a.split(":");var s=a[0],l=a[1];if(/^(ctrl)(\+shift)?\+(\d+)$/.test(s.toLowerCase())||/^(\d+)$/.test(s)){if((RegExp.$1=="ctrl"?t.ctrlKey||t.metaKey:0)&&(RegExp.$2!=""?t[RegExp.$2.slice(1)+"Key"]:1)&&i==RegExp.$3||i==RegExp.$1){if(d.queryCommandState(n,l)!=-1)d.execCommand(n,l);domUtils.preventDefault(t)}}}}})},getContent:function(e,t,i,n,r){var o=this;if(e&&utils.isFunction(e)){t=e;e=""}if(t?!t():!this.hasContents()){return""}o.fireEvent("beforegetcontent");var a=UE.htmlparser(o.body.innerHTML,n);o.filterOutputRule(a);o.fireEvent("aftergetcontent",e,a);return a.toHtml(r)},getAllHtml:function(){var e=this,t=[],i="";e.fireEvent("getAllHtml",t);if(browser.ie&&browser.version>8){var n="";utils.each(e.document.styleSheets,function(e){n+=e.href?'<link rel="stylesheet" type="text/css" href="'+e.href+'" />':"<style>"+e.cssText+"</style>"});utils.each(e.document.getElementsByTagName("script"),function(e){n+=e.outerHTML})}return"<html><head>"+(e.options.charset?'<meta http-equiv="Content-Type" content="text/html; charset='+e.options.charset+'"/>':"")+(n||e.document.getElementsByTagName("head")[0].innerHTML)+t.join("\n")+"</head>"+"<body "+(ie&&browser.version<9?'class="view"':"")+">"+e.getContent(null,null,true)+"</body></html>"},getPlainTxt:function(){var e=new RegExp(domUtils.fillChar,"g"),t=this.body.innerHTML.replace(/[\n\r]/g,"");t=t.replace(/<(p|div)[^>]*>(<br\/?>|&nbsp;)<\/\1>/gi,"\n").replace(/<br\/?>/gi,"\n").replace(/<[^>/]+>/g,"").replace(/(\n)?<\/([^>]+)>/g,function(e,t,i){return dtd.$block[i]?"\n":t?t:""});return t.replace(e,"").replace(/\u00a0/g," ").replace(/&nbsp;/g," ")},getContentTxt:function(){var e=new RegExp(domUtils.fillChar,"g");return this.body[browser.ie?"innerText":"textContent"].replace(e,"").replace(/\u00a0/g," ")},setContent:function(e,t,i){var n=this;n.fireEvent("beforesetcontent",e);var r=UE.htmlparser(e);n.filterInputRule(r);e=r.toHtml();n.body.innerHTML=(t?n.body.innerHTML:"")+e;function o(e){return e.tagName=="DIV"&&e.getAttribute("cdata_tag")}if(n.options.enterTag=="p"){var a=this.body.firstChild,s;if(!a||a.nodeType==1&&(dtd.$cdata[a.tagName]||o(a)||domUtils.isCustomeNode(a))&&a===this.body.lastChild){this.body.innerHTML='<p class="ueditor-p">'+(browser.ie?"&nbsp;":"<br/>")+"</p>"+this.body.innerHTML}else{var l=n.document.createElement("p");l.className="ueditor-p";while(a){while(a&&(a.nodeType==3||a.nodeType==1&&dtd.p[a.tagName]&&!dtd.$cdata[a.tagName])){s=a.nextSibling;l.appendChild(a);a=s}if(l.firstChild){if(!a){n.body.appendChild(l);break}else{a.parentNode.insertBefore(l,a);l=n.document.createElement("p");l.className="ueditor-p"}}a=a.nextSibling}}}n.fireEvent("aftersetcontent");n.fireEvent("contentchange");!i&&n._selectionChange();n._bakRange=n._bakIERange=n._bakNativeRange=null;var d;if(browser.gecko&&(d=this.selection.getNative())){d.removeAllRanges()}if(n.options.autoSyncData){n.form&&u(n.form,n)}},focus:function(e){try{var t=this,i=t.selection.getRange();if(e){var n=t.body.lastChild;if(n&&n.nodeType==1&&!dtd.$empty[n.tagName]){if(domUtils.isEmptyBlock(n)){i.setStartAtFirst(n)}else{i.setStartAtLast(n)}i.collapse(true)}i.setCursor(true)}else{if(!i.collapsed&&domUtils.isBody(i.startContainer)&&i.startOffset==0){var n=t.body.firstChild;if(n&&n.nodeType==1&&!dtd.$empty[n.tagName]){i.setStartAtFirst(n).collapse(true)}}i.select(true)}this.fireEvent("focus selectionchange")}catch(e){}},isFocus:function(){return this.selection.isFocus()},blur:function(){var e=this.selection.getNative();if(e.empty&&browser.ie){var t=document.body.createTextRange();t.moveToElementText(document.body);t.collapse(true);t.select();e.empty()}else{e.removeAllRanges()}},_initEvents:function(){var t=this,e=t.document,i=t.window;t._proxyDomEvent=utils.bind(t._proxyDomEvent,t);domUtils.on(e,["click","contextmenu","mousedown","keydown","keyup","keypress","mouseup","mouseover","mouseout","selectstart"],t._proxyDomEvent);domUtils.on(i,["focus","blur"],t._proxyDomEvent);domUtils.on(t.body,"drop",function(e){if(browser.gecko&&e.stopPropagation){e.stopPropagation()}t.fireEvent("contentchange")});domUtils.on(e,["mouseup","keydown"],function(e){if(e.type=="keydown"&&(e.ctrlKey||e.metaKey||e.shiftKey||e.altKey)){return}if(e.button==2)return;t._selectionChange(250,e)})},_proxyDomEvent:function(e){if(this.fireEvent("before"+e.type.replace(/^on/,"").toLowerCase())===false){return false}if(this.fireEvent(e.type.replace(/^on/,""),e)===false){return false}return this.fireEvent("after"+e.type.replace(/^on/,"").toLowerCase())},_selectionChange:function(e,i){var n=this;var r=false;var o,a;if(browser.ie&&browser.version<9&&i&&i.type=="mouseup"){var t=this.selection.getRange();if(!t.collapsed){r=true;o=i.clientX;a=i.clientY}}clearTimeout(s);s=setTimeout(function(){if(!n.selection||!n.selection.getNative()){return}var t;if(r&&n.selection.getNative().type=="None"){t=n.document.body.createTextRange();try{t.moveToPoint(o,a)}catch(e){t=null}}var e;if(t){e=n.selection.getIERange;n.selection.getIERange=function(){return t}}n.selection.cache();if(e){n.selection.getIERange=e}if(n.selection._cachedRange&&n.selection._cachedStartElement){n.fireEvent("beforeselectionchange");n.fireEvent("selectionchange",!!i);n.fireEvent("afterselectionchange");n.selection.clear()}},e||50)},_callCmdFn:function(e,t){var i=t[0].toLowerCase(),n,r;n=this.commands[i]||UE.commands[i];r=n&&n[e];if((!n||!r)&&e=="queryCommandState"){return 0}else if(r){return r.apply(this,t)}},execCommand:function(e){e=e.toLowerCase();var t=this,i,n=t.commands[e]||UE.commands[e];if(!n||!n.execCommand){return null}if(!n.notNeedUndo&&!t.__hasEnterExecCommand){t.__hasEnterExecCommand=true;if(t.queryCommandState.apply(t,arguments)!=-1){t.fireEvent("saveScene");t.fireEvent.apply(t,["beforeexeccommand",e].concat(arguments));i=this._callCmdFn("execCommand",arguments);t.fireEvent.apply(t,["afterexeccommand",e].concat(arguments));t.fireEvent("saveScene")}t.__hasEnterExecCommand=false}else{i=this._callCmdFn("execCommand",arguments);!t.__hasEnterExecCommand&&!n.ignoreContentChange&&!t._ignoreContentChange&&t.fireEvent("contentchange")}!t.__hasEnterExecCommand&&!n.ignoreContentChange&&!t._ignoreContentChange&&t._selectionChange();return i},queryCommandState:function(e){return this._callCmdFn("queryCommandState",arguments)},queryCommandValue:function(e){return this._callCmdFn("queryCommandValue",arguments)},hasContents:function(e){if(e){for(var t=0,i;i=e[t++];){if(this.document.getElementsByTagName(i).length>0){return true}}}if(!domUtils.isEmptyBlock(this.body)){return true}e=["div"];for(t=0;i=e[t++];){var n=domUtils.getElementsByTagName(this.document,i);for(var r=0,o;o=n[r++];){if(domUtils.isCustomeNode(o)){return true}}}return false},reset:function(){this.fireEvent("reset")},setEnabled:function(){var t=this,i;if(t.body.contentEditable=="false"){t.body.contentEditable=true;i=t.selection.getRange();try{i.moveToBookmark(t.lastBk);delete t.lastBk}catch(e){i.setStartAtFirst(t.body).collapse(true)}i.select(true);if(t.bkqueryCommandState){t.queryCommandState=t.bkqueryCommandState;delete t.bkqueryCommandState}if(t.bkqueryCommandValue){t.queryCommandValue=t.bkqueryCommandValue;delete t.bkqueryCommandValue}t.fireEvent("selectionchange")}},enable:function(){return this.setEnabled()},setDisabled:function(t){var i=this;t=t?utils.isArray(t)?t:[t]:[];if(i.body.contentEditable=="true"){if(!i.lastBk){i.lastBk=i.selection.getRange().createBookmark(true)}i.body.contentEditable=false;i.bkqueryCommandState=i.queryCommandState;i.bkqueryCommandValue=i.queryCommandValue;i.queryCommandState=function(e){if(utils.indexOf(t,e)!=-1){return i.bkqueryCommandState.apply(i,arguments)}return-1};i.queryCommandValue=function(e){if(utils.indexOf(t,e)!=-1){return i.bkqueryCommandValue.apply(i,arguments)}return null};i.fireEvent("selectionchange")}},disable:function(e){return this.setDisabled(e)},_setDefaultContent:function(){function i(){var e=this;if(e.document.getElementById("initContent")){e.body.innerHTML='<p class="ueditor-p">'+(ie?"":"<br/>")+"</p>";e.removeListener("firstBeforeExecCommand focus",i);setTimeout(function(){e.focus();e._selectionChange()},0)}}return function(e){var t=this;t.body.innerHTML='<p id="initContent">'+e+"</p>";t.addListener("firstBeforeExecCommand focus",i)}}(),setShow:function(){var t=this,i=t.selection.getRange();if(t.container.style.display=="none"){try{i.moveToBookmark(t.lastBk);delete t.lastBk}catch(e){i.setStartAtFirst(t.body).collapse(true)}setTimeout(function(){i.select(true)},100);t.container.style.display=""}},show:function(){return this.setShow()},setHide:function(){var e=this;if(!e.lastBk){e.lastBk=e.selection.getRange().createBookmark(true)}e.container.style.display="none"},hide:function(){return this.setHide()},getLang:function(e){var t=UE.I18N["zh-cn"];if(!t){throw Error("not import language file")}e=(e||"").split(".");for(var i=0,n;n=e[i++];){t=t[n];if(!t)break}return t},getContentLength:function(e,t){var i=this.getContent(false,false,true).length;if(e){t=(t||[]).concat(["hr","img","iframe"]);i=this.getContentTxt().replace(/[\t\r\n]+/g,"").length;for(var n=0,r;r=t[n++];){i+=this.document.getElementsByTagName(r).length}}return i},addInputRule:function(e){this.inputRules.push(e)},filterInputRule:function(e){for(var t=0,i;i=this.inputRules[t++];){i.call(this,e)}},addOutputRule:function(e){this.outputRules.push(e)},filterOutputRule:function(e){for(var t=0,i;i=this.outputRules[t++];){i.call(this,e)}},getActionUrl:function(e){var t=this.getOpt(e)||e,i=this.getOpt("imageUrl"),n=this.getOpt("serverUrl");if(!n&&i){n=i.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2")}if(n){n=n+(n.indexOf("?")==-1?"?":"&")+"action="+(t||"");return utils.formatUrl(n)}else{return""}}};utils.inherits(o,EventBase)})();UE.Editor.defaultOptions=function(e){var t=e.options.UEDITOR_HOME_URL;return{isShow:true,initialContent:"",initialStyle:"",autoClearinitialContent:false,iframeCssUrl:t+"themes/iframe.css",textarea:"editorValue",focus:false,focusInEnd:true,autoClearEmptyNode:true,fullscreen:false,readonly:false,zIndex:9999,imagePopup:true,enterTag:"br",customDomain:false,lang:"zh-cn",langPath:t+"lang/",theme:"default",themePath:t+"themes/",allHtmlEnabled:false,scaleEnabled:false,tableNativeEditInFF:false,autoSyncData:true,fileNameFormat:"{time}{rand:6}"}};(function(){UE.Editor.prototype.loadServerConfig=function(){var me=this;setTimeout(function(){try{me.options.imageUrl&&me.setOpt("serverUrl",me.options.imageUrl.replace(/^(.*[\/]).+([\.].+)$/,"$1controller$2"));var configUrl=me.getActionUrl("config"),isJsonp=false;me._serverConfigLoaded=false;configUrl&&UE.ajax.request(configUrl,{method:"GET",dataType:isJsonp?"jsonp":"",onsuccess:function(r){try{var config=isJsonp?r:eval("("+r.responseText+")");utils.extend(me.options,config);me.fireEvent("serverConfigLoaded");me._serverConfigLoaded=true}catch(e){showErrorMsg(me.getLang("loadconfigFormatError"))}},onerror:function(){showErrorMsg(me.getLang("loadconfigHttpError"))}})}catch(e){showErrorMsg(me.getLang("loadconfigError"))}});function showErrorMsg(e){console&&console.error(e)}};UE.Editor.prototype.isServerConfigLoaded=function(){var e=this;return e._serverConfigLoaded||false};UE.Editor.prototype.afterConfigReady=function(e){if(!e||!utils.isFunction(e))return;var t=this;var i=function(){e.apply(t,arguments);t.removeListener("serverConfigLoaded",i)};if(t.isServerConfigLoaded()){e.call(t,"serverConfigLoaded")}else{t.addListener("serverConfigLoaded",i)}}})();UE.ajax=function(){var t="XMLHttpRequest()";try{new ActiveXObject("Msxml2.XMLHTTP");t="ActiveXObject('Msxml2.XMLHTTP')"}catch(e){try{new ActiveXObject("Microsoft.XMLHTTP");t="ActiveXObject('Microsoft.XMLHTTP')"}catch(e){}}var u=new Function("return new "+t);function p(e){var t=[];for(var i in e){if(i=="method"||i=="timeout"||i=="async"||i=="dataType"||i=="callback")continue;if(e[i]==undefined||e[i]==null)continue;if(!((typeof e[i]).toLowerCase()=="function"||(typeof e[i]).toLowerCase()=="object")){t.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]))}else if(utils.isArray(e[i])){for(var n=0;n<e[i].length;n++){t.push(encodeURIComponent(i)+"[]="+encodeURIComponent(e[i][n]))}}}return t.join("&")}function i(e,t){var i=u(),n=false,r={method:"POST",timeout:5e3,async:true,data:{},onsuccess:function(){},onerror:function(){}};if(typeof e==="object"){t=e;e=t.url}if(!i||!e)return;var o=t?utils.extend(r,t):r;var a=p(o);if(!utils.isEmptyObject(o.data)){a+=(a?"&":"")+p(o.data)}var s=setTimeout(function(){if(i.readyState!=4){n=true;i.abort();clearTimeout(s)}},o.timeout);var l=o.method.toUpperCase();var d=e+(e.indexOf("?")==-1?"?":"&")+(l=="POST"?"":a+"&noCache="+ +new Date);i.open(l,d,o.async);i.onreadystatechange=function(){if(i.readyState==4){if(!n&&i.status==200){o.onsuccess(i)}else{o.onerror(i)}}};i.setRequestHeader("Authorization",sessionStorage.getItem("token"));if(l=="POST"){i.setRequestHeader("Content-Type","application/x-www-form-urlencoded");i.send(a)}else{i.send(null)}}function r(e,t){var i=t.onsuccess||function(){},n=document.createElement("SCRIPT"),r=t||{},o=r["charset"],a=r["jsonp"]||"callback",s,l=r["timeOut"]||0,d,u=new RegExp("(\\?|&)"+a+"=([^&]*)"),c;if(utils.isFunction(i)){s="bd__editor__"+Math.floor(Math.random()*2147483648).toString(36);window[s]=h(0)}else if(utils.isString(i)){s=i}else{if(c=u.exec(e)){s=c[2]}}e=e.replace(u,"$1"+a+"="+s);if(e.search(u)<0){e+=(e.indexOf("?")<0?"?":"&")+a+"="+s}var f=p(t);if(!utils.isEmptyObject(t.data)){f+=(f?"&":"")+p(t.data)}if(f){e=e.replace(/\?/,"?"+f+"&")}n.onerror=h(1);if(l){d=setTimeout(h(1),l)}m(n,e,o);function m(e,t,i){e.setAttribute("type","text/javascript");e.setAttribute("defer","defer");i&&e.setAttribute("charset",i);e.setAttribute("src",t);document.getElementsByTagName("head")[0].appendChild(e)}function h(e){return function(){try{if(e){r.onerror&&r.onerror()}else{try{clearTimeout(d);i.apply(window,arguments)}catch(e){}}}catch(e){r.onerror&&r.onerror.call(window,e)}finally{r.oncomplete&&r.oncomplete.apply(window,arguments);n.parentNode&&n.parentNode.removeChild(n);window[s]=null;try{delete window[s]}catch(e){}}}}}return{request:function(e,t){if(t&&t.dataType=="jsonp"){r(e,t)}else{i(e,t)}},getJSONP:function(e,t,i){var n={data:t,oncomplete:i};r(e,n)}}}();var filterWord=UE.filterWord=function(){function t(e){return/(class="?Mso|style="[^"]*\bmso\-|w:WordDocument|<(v|o):|lang=)/gi.test(e)}function c(e){e=e.replace(/[\d.]+\w+/g,function(e){return utils.transUnitToPx(e)});return e}function i(e){return e.replace(/[\t\r\n]+/g," ").replace(/<!--[\s\S]*?-->/gi,"").replace(/<v:shape [^>]*>[\s\S]*?.<\/v:shape>/gi,function(e){if(browser.opera){return""}try{if(/Bitmap/i.test(e)){return""}var t=e.match(/width:([ \d.]*p[tx])/i)[1],i=e.match(/height:([ \d.]*p[tx])/i)[1],n=e.match(/src=\s*"([^"]*)"/i)[1];return'<img width="'+c(t)+'" height="'+c(i)+'" src="'+n+'" />'}catch(e){return""}}).replace(/<\/?div[^>]*>/g,"").replace(/v:\w+=(["']?)[^'"]+\1/g,"").replace(/<(!|script[^>]*>.*?<\/script(?=[>\s])|\/?(\?xml(:\w+)?|xml|meta|link|style|\w+:\w+)(?=[\s\/>]))[^>]*>/gi,"").replace(/<p [^>]*class="?MsoHeading"?[^>]*>(.*?)<\/p>/gi,"<p class='ueditor-p'><strong>$1</strong></p>").replace(/\s+(class|lang|align)\s*=\s*(['"]?)([\w-]+)\2/gi,function(e,t,i,n){return t=="class"&&n=="MsoListParagraph"?e:""}).replace(/<(font|span)[^>]*>(\s*)<\/\1>/gi,function(e,t,i){return i.replace(/[\t\r\n ]+/g," ")}).replace(/(<[a-z][^>]*)\sstyle=(["'])([^\2]*?)\2/gi,function(e,t,i,n){var r=[],o=n.replace(/^\s+|\s+$/,"").replace(/&#39;/g,"'").replace(/&quot;/gi,"'").replace(/[\d.]+(cm|pt)/g,function(e){return utils.transUnitToPx(e)}).split(/;\s*/g);for(var a=0,s;s=o[a];a++){var l,d,u=s.split(":");if(u.length==2){l=u[0].toLowerCase();d=u[1].toLowerCase();if(/^(background)\w*/.test(l)&&d.replace(/(initial|\s)/g,"").length==0||/^(margin)\w*/.test(l)&&/^0\w+$/.test(d)){continue}switch(l){case"mso-padding-alt":case"mso-padding-top-alt":case"mso-padding-right-alt":case"mso-padding-bottom-alt":case"mso-padding-left-alt":case"mso-margin-alt":case"mso-margin-top-alt":case"mso-margin-right-alt":case"mso-margin-bottom-alt":case"mso-margin-left-alt":case"mso-height":case"mso-width":case"mso-vertical-align-alt":if(!/<table/.test(t))r[a]=l.replace(/^mso-|-alt$/g,"")+":"+c(d);continue;case"horiz-align":r[a]="text-align:"+d;continue;case"vert-align":r[a]="vertical-align:"+d;continue;case"font-color":case"mso-foreground":r[a]="color:"+d;continue;case"mso-background":case"mso-highlight":r[a]="background:"+d;continue;case"mso-default-height":r[a]="min-height:"+c(d);continue;case"mso-default-width":r[a]="min-width:"+c(d);continue;case"mso-padding-between-alt":r[a]="border-collapse:separate;border-spacing:"+c(d);continue;case"text-line-through":if(d=="single"||d=="double"){r[a]="text-decoration:line-through"}continue;case"mso-zero-height":if(d=="yes"){r[a]="display:none"}continue;case"margin":if(!/[1-9]/.test(d)){continue}}if(/^(mso|column|font-emph|lang|layout|line-break|list-image|nav|panose|punct|row|ruby|sep|size|src|tab-|table-border|text-(?:decor|trans)|top-bar|version|vnd|word-break)/.test(l)||/text\-indent|padding|margin/.test(l)&&/\-[\d.]+/.test(d)){continue}r[a]=l+":"+u[1]}}return t+(r.length?' style="'+r.join(";").replace(/;{2,}/g,";")+'"':"")})}return function(e){return t(e)?i(e):e}}();(function(){var r=UE.uNode=function(e){this.type=e.type;this.data=e.data;this.tagName=e.tagName;this.parentNode=e.parentNode;this.attrs=e.attrs||{};this.children=e.children};var d={href:1,src:1,_src:1,_href:1,cdata_data:1};var i={style:1,script:1};var n="    ",o="\n";function u(e,t,i){e.push(o);return t+(i?1:-1)}function c(e,t){for(var i=0;i<t;i++){e.push(n)}}r.createElement=function(e){if(/[<>]/.test(e)){return UE.htmlparser(e).children[0]}else{return new r({type:"element",children:[],tagName:e})}};r.createText=function(e,t){return new UE.uNode({type:"text",data:t?e:utils.unhtml(e||"")})};function f(e,t,i,n){switch(e.type){case"root":for(var r=0,o;o=e.children[r++];){if(i&&o.type=="element"&&!dtd.$inlineWithA[o.tagName]&&r>1){u(t,n,true);c(t,n)}f(o,t,i,n)}break;case"text":a(e,t);break;case"element":s(e,t,i,n);break;case"comment":l(e,t,i)}return t}function a(e,t){if(e.parentNode.tagName=="pre"){t.push(e.data)}else{t.push(i[e.parentNode.tagName]?utils.html(e.data):e.data.replace(/[ ]{2}/g," &nbsp;"))}}function s(e,t,i,n){var r="";if(e.attrs){r=[];var o=e.attrs;for(var a in o){r.push(a+(o[a]!==undefined?'="'+(d[a]?utils.html(o[a]).replace(/["]/g,function(e){return"&quot;"}):utils.unhtml(o[a]))+'"':""))}r=r.join(" ")}t.push("<"+e.tagName+(r?" "+r:"")+(dtd.$empty[e.tagName]?"/":"")+">");if(i&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"){if(e.children&&e.children.length){n=u(t,n,true);c(t,n)}}if(e.children&&e.children.length){for(var s=0,l;l=e.children[s++];){if(i&&l.type=="element"&&!dtd.$inlineWithA[l.tagName]&&s>1){u(t,n);c(t,n)}f(l,t,i,n)}}if(!dtd.$empty[e.tagName]){if(i&&!dtd.$inlineWithA[e.tagName]&&e.tagName!="pre"){if(e.children&&e.children.length){n=u(t,n);c(t,n)}}t.push("</"+e.tagName+">")}}function l(e,t){t.push("\x3c!--"+e.data+"--\x3e")}function m(e,t){var i;if(e.type=="element"&&e.getAttr("id")==t){return e}if(e.children&&e.children.length){for(var n=0,r;r=e.children[n++];){if(i=m(r,t)){return i}}}}function h(e,t,i){if(e.type=="element"&&e.tagName==t){i.push(e)}if(e.children&&e.children.length){for(var n=0,r;r=e.children[n++];){h(r,t,i)}}}function p(e,t){if(e.children&&e.children.length){for(var i=0,n;n=e.children[i];){p(n,t);if(n.parentNode){if(n.children&&n.children.length){t(n)}if(n.parentNode)i++}}}else{t(e)}}r.prototype={toHtml:function(e){var t=[];f(this,t,e,0);return t.join("")},innerHTML:function(e){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(utils.isString(e)){if(this.children){for(var t=0,i;i=this.children[t++];){i.parentNode=null}}this.children=[];var n=UE.htmlparser(e);for(var t=0,i;i=n.children[t++];){this.children.push(i);i.parentNode=this}return this}else{var n=new UE.uNode({type:"root",children:this.children});return n.toHtml()}},innerText:function(e,t){if(this.type!="element"||dtd.$empty[this.tagName]){return this}if(e){if(this.children){for(var i=0,n;n=this.children[i++];){n.parentNode=null}}this.children=[];this.appendChild(r.createText(e,t));return this}else{return this.toHtml().replace(/<[^>]+>/g,"")}},getData:function(){if(this.type=="element")return"";return this.data},firstChild:function(){return this.children?this.children[0]:null},lastChild:function(){return this.children?this.children[this.children.length-1]:null},previousSibling:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t];t++){if(i===this){return t==0?null:e.children[t-1]}}},nextSibling:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t++];){if(i===this){return e.children[t]}}},replaceChild:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i,1,e);t.parentNode=null;e.parentNode=this;return e}}}},appendChild:function(e){if(this.type=="root"||this.type=="element"&&!dtd.$empty[this.tagName]){if(!this.children){this.children=[]}if(e.parentNode){e.parentNode.removeChild(e)}for(var t=0,i;i=this.children[t];t++){if(i===e){this.children.splice(t,1);break}}this.children.push(e);e.parentNode=this;return e}},insertBefore:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i,0,e);e.parentNode=this;return e}}}},insertAfter:function(e,t){if(this.children){if(e.parentNode){e.parentNode.removeChild(e)}for(var i=0,n;n=this.children[i];i++){if(n===t){this.children.splice(i+1,0,e);e.parentNode=this;return e}}}},removeChild:function(e,t){if(this.children){for(var i=0,n;n=this.children[i];i++){if(n===e){this.children.splice(i,1);n.parentNode=null;if(t&&n.children&&n.children.length){for(var r=0,o;o=n.children[r];r++){this.children.splice(i+r,0,o);o.parentNode=this}}return n}}}},getAttr:function(e){return this.attrs&&this.attrs[e.toLowerCase()]},setAttr:function(e,t){if(!e){delete this.attrs;return}if(!this.attrs){this.attrs={}}if(utils.isObject(e)){for(var i in e){if(!e[i]){delete this.attrs[i]}else{this.attrs[i.toLowerCase()]=e[i]}}}else{if(!t){delete this.attrs[e]}else{this.attrs[e.toLowerCase()]=t}}},getIndex:function(){var e=this.parentNode;for(var t=0,i;i=e.children[t];t++){if(i===this){return t}}return-1},getNodeById:function(e){var t;if(this.children&&this.children.length){for(var i=0,n;n=this.children[i++];){if(t=m(n,e)){return t}}}},getNodesByTagName:function(e){e=utils.trim(e).replace(/[ ]{2,}/g," ").split(" ");var n=[],r=this;utils.each(e,function(e){if(r.children&&r.children.length){for(var t=0,i;i=r.children[t++];){h(i,e,n)}}});return n},getStyle:function(e){var t=this.getAttr("style");if(!t){return""}var i=new RegExp("(^|;)\\s*"+e+":([^;]+)","i");var n=t.match(i);if(n&&n[0]){return n[2]}return""},setStyle:function(e,t){function i(e,t){var i=new RegExp("(^|;)\\s*"+e+":([^;]+;?)","gi");n=n.replace(i,"$1");if(t){n=e+":"+utils.unhtml(t)+";"+n}}var n=this.getAttr("style");if(!n){n=""}if(utils.isObject(e)){for(var r in e){i(r,e[r])}}else{i(e,t)}this.setAttr("style",utils.trim(n))},traversal:function(e){if(this.children&&this.children.length){p(this,e)}return this}}})();var htmlparser=UE.htmlparser=function(e,i){var t=/<(?:(?:\/([^>]+)>)|(?:!--([\S|\s]*?)-->)|(?:([^\s\/<>]+)\s*((?:(?:"[^"]*")|(?:'[^']*')|[^"'<>])*)\/?>))/g,d=/([\w\-:.]+)(?:(?:\s*=\s*(?:(?:"([^"]*)")|(?:'([^']*)')|([^\s>]+)))|(?=\s|$))/g;var n={b:1,code:1,i:1,u:1,strike:1,s:1,tt:1,strong:1,q:1,samp:1,em:1,span:1,sub:1,img:1,sup:1,font:1,big:1,small:1,iframe:1,a:1,br:1,pre:1};e=e.replace(new RegExp(domUtils.fillChar,"g"),"");if(!i){e=e.replace(new RegExp("[\\r\\t\\n"+(i?"":" ")+"]*</?(\\w+)\\s*(?:[^>]*)>[\\r\\t\\n"+(i?"":" ")+"]*","g"),function(e,t){if(t&&n[t.toLowerCase()]){return e.replace(/(^[\n\r]+)|([\n\r]+$)/g,"")}return e.replace(new RegExp("^[\\r\\n"+(i?"":" ")+"]+"),"").replace(new RegExp("[\\r\\n"+(i?"":" ")+"]+$"),"")})}var u={href:1,src:1};var c=UE.uNode,f={td:"tr",tr:["tbody","thead","tfoot"],tbody:"table",th:"tr",thead:"table",tfoot:"table",caption:"table",li:["ul","ol"],dt:"dl",dd:"dl",option:"select"},r={ol:"li",ul:"li"};function o(e,t){if(r[e.tagName]){var i=c.createElement(r[e.tagName]);e.appendChild(i);i.appendChild(c.createText(t));e=i}else{e.appendChild(c.createText(t))}}function m(e,t,i){var n;if(n=f[t]){var r=e,o;while(r.type!="root"){if(utils.isArray(n)?utils.indexOf(n,r.tagName)!=-1:n==r.tagName){e=r;o=true;break}r=r.parentNode}if(!o){e=m(e,utils.isArray(n)?n[0]:n)}}var a=new c({parentNode:e,type:"element",tagName:t.toLowerCase(),children:dtd.$empty[t]?null:[]});if(i){var s={},l;while(l=d.exec(i)){s[l[1].toLowerCase()]=u[l[1].toLowerCase()]?l[2]||l[3]||l[4]:utils.unhtml(l[2]||l[3]||l[4])}a.attrs=s}e.children.push(a);return dtd.$empty[t]?e:a}function a(e,t){e.children.push(new c({type:"comment",data:t,parentNode:e}))}var s,l=0,h=0;var p=new c({type:"root",children:[]});var g=p;while(s=t.exec(e)){l=s.index;try{if(l>h){o(g,e.slice(h,l))}if(s[3]){if(dtd.$cdata[g.tagName]){o(g,s[0])}else{g=m(g,s[3].toLowerCase(),s[4])}}else if(s[1]){if(g.type!="root"){if(dtd.$cdata[g.tagName]&&!dtd.$cdata[s[1]]){o(g,s[0])}else{var v=g;while(g.type=="element"&&g.tagName!=s[1].toLowerCase()){g=g.parentNode;if(g.type=="root"){g=v;throw"break"}}g=g.parentNode}}}else if(s[2]){a(g,s[2])}}catch(e){}h=t.lastIndex}if(h<e.length){o(g,e.slice(h))}return p};var filterNode=UE.filterNode=function(){function f(i,e){switch(i.type){case"text":break;case"element":var t;if(t=e[i.tagName]){if(t==="-"){i.parentNode.removeChild(i)}else if(utils.isFunction(t)){var n=i.parentNode,r=i.getIndex();t(i);if(i.parentNode){if(i.children){for(var o=0,a;a=i.children[o];){f(a,e);if(a.parentNode){o++}}}}else{for(var o=r,a;a=n.children[o];){f(a,e);if(a.parentNode){o++}}}}else{var s=t["$"];if(s&&i.attrs){var l={},d;for(var u in s){d=i.getAttr(u);if(u=="style"&&utils.isArray(s[u])){var c=[];utils.each(s[u],function(e){var t;if(t=i.getStyle(e)){c.push(e+":"+t)}});d=c.join(";")}if(d){l[u]=d}}i.attrs=l}if(i.children){for(var o=0,a;a=i.children[o];){f(a,e);if(a.parentNode){o++}}}}}else{if(dtd.$cdata[i.tagName]){i.parentNode.removeChild(i)}else{var n=i.parentNode,r=i.getIndex();i.parentNode.removeChild(i,true);for(var o=r,a;a=n.children[o];){f(a,e);if(a.parentNode){o++}}}}break;case"comment":i.parentNode.removeChild(i)}}return function(e,t){if(utils.isEmptyObject(t)){return e}var i;if(i=t["-"]){utils.each(i.split(" "),function(e){t[e]="-"})}for(var n=0,r;r=e.children[n];){f(r,t);if(r.parentNode){n++}}return e}}();UE.plugin=function(){var r={};return{register:function(e,t,i,n){if(i&&utils.isFunction(i)){n=i;i=null}r[e]={optionName:i||e,execFn:t,afterDisabled:n}},load:function(i){utils.each(r,function(e){var t=e.execFn.call(i);if(i.options[e.optionName]!==false){if(t){utils.each(t,function(e,t){switch(t.toLowerCase()){case"shortcutkey":i.addshortcutkey(e);break;case"bindevents":utils.each(e,function(e,t){i.addListener(t,e)});break;case"bindmultievents":utils.each(utils.isArray(e)?e:[e],function(t){var e=utils.trim(t.type).split(/\s+/);utils.each(e,function(e){i.addListener(e,t.handler)})});break;case"commands":utils.each(e,function(e,t){i.commands[t]=e});break;case"outputrule":i.addOutputRule(e);break;case"inputrule":i.addInputRule(e);break;case"defaultoptions":i.setOpt(e)}})}}else if(e.afterDisabled){e.afterDisabled.call(i)}});utils.each(UE.plugins,function(e){e.call(i)})},run:function(e,t){var i=r[e];if(i){i.exeFn.call(t)}}}}();var keymap=UE.keymap={Backspace:8,Tab:9,Enter:13,Shift:16,Control:17,Alt:18,CapsLock:20,Esc:27,Spacebar:32,PageUp:33,PageDown:34,End:35,Home:36,Left:37,Up:38,Right:39,Down:40,Insert:45,Del:46,NumLock:144,Cmd:91,"=":187,"-":189,b:66,i:73,z:90,y:89,v:86,x:88,s:83,n:78};var LocalStorage=UE.LocalStorage=function(){var i=window.localStorage||e()||null,n="localStorage";return{saveLocalData:function(e,t){if(i&&t){i.setItem(e,t);return true}return false},getLocalData:function(e){if(i){return i.getItem(e)}return null},removeItem:function(e){i&&i.removeItem(e)}};function e(){var i=document.createElement("div");i.style.display="none";if(!i.addBehavior){return null}i.addBehavior("#default#userdata");return{getItem:function(e){var t=null;try{document.body.appendChild(i);i.load(n);t=i.getAttribute(e);document.body.removeChild(i)}catch(e){}return t},setItem:function(e,t){document.body.appendChild(i);i.setAttribute(e,t);i.save(n);document.body.removeChild(i)},removeItem:function(e){document.body.appendChild(i);i.removeAttribute(e);i.save(n);document.body.removeChild(i)}}}}();(function(){var r="ueditor_preference";UE.Editor.prototype.setPreferences=function(e,t){var i={};if(utils.isString(e)){i[e]=t}else{i=e}var n=LocalStorage.getLocalData(r);if(n&&(n=utils.str2json(n))){utils.extend(n,i)}else{n=i}n&&LocalStorage.saveLocalData(r,utils.json2str(n))};UE.Editor.prototype.getPreferences=function(e){var t=LocalStorage.getLocalData(r);if(t&&(t=utils.str2json(t))){return e?t[e]:t}return null};UE.Editor.prototype.removePreferences=function(e){var t=LocalStorage.getLocalData(r);if(t&&(t=utils.str2json(t))){t[e]=undefined;delete t[e]}t&&LocalStorage.saveLocalData(r,utils.json2str(t))}})();UE.plugins["defaultfilter"]=function(){var l=this;l.setOpt({allowDivTransToP:true,disabledTableInTable:true});l.addInputRule(function(e){var o=this.options.allowDivTransToP;var a;function s(e){while(e&&e.type=="element"){if(e.tagName=="td"){return true}e=e.parentNode}return false}e.traversal(function(r){if(r.type=="element"){if(!dtd.$cdata[r.tagName]&&l.options.autoClearEmptyNode&&dtd.$inline[r.tagName]&&!dtd.$empty[r.tagName]&&(!r.attrs||utils.isEmptyObject(r.attrs))){if(!r.firstChild())r.parentNode.removeChild(r);else if(r.tagName=="span"&&(!r.attrs||utils.isEmptyObject(r.attrs))){r.parentNode.removeChild(r,true)}return}switch(r.tagName){case"style":case"script":r.setAttr({cdata_tag:r.tagName,cdata_data:r.innerHTML()||"",_ue_custom_node_:"true"});r.tagName="div";r.innerHTML("");break;case"a":if(a=r.getAttr("href")){r.setAttr("_href",a)}break;case"img":if(a=r.getAttr("src")){if(/^data:/.test(a)){r.parentNode.removeChild(r);break}}r.setAttr("_src",r.getAttr("src"));break;case"span":if(browser.webkit&&(a=r.getStyle("white-space"))){if(/nowrap|normal/.test(a)){r.setStyle("white-space","");if(l.options.autoClearEmptyNode&&utils.isEmptyObject(r.attrs)){r.parentNode.removeChild(r,true)}}}a=r.getAttr("id");if(a&&/^_baidu_bookmark_/i.test(a)){r.parentNode.removeChild(r)}break;case"p":if(a=r.getAttr("align")){r.setAttr("align");r.setStyle("text-align",a)}utils.each(r.children,function(e){if(e.type=="element"&&e.tagName=="p"){var t=e.nextSibling();r.parentNode.insertAfter(e,r);var i=e;while(t){var n=t.nextSibling();r.parentNode.insertAfter(t,i);i=t;t=n}return false}});if(!r.firstChild()){r.innerHTML(browser.ie?"&nbsp;":"<br/>")}break;case"div":if(r.getAttr("cdata_tag")){break}a=r.getAttr("class");if(a&&/^line number\d+/.test(a)){break}if(!o){break}var e,t=UE.uNode.createElement("p");t.className="ueditor-p";while(e=r.firstChild()){if(e.type=="text"||!UE.dom.dtd.$block[e.tagName]){t.appendChild(e)}else{if(t.firstChild()){r.parentNode.insertBefore(t,r);t=UE.uNode.createElement("p");t.className="ueditor-p"}else{r.parentNode.insertBefore(e,r)}}}if(t.firstChild()){r.parentNode.insertBefore(t,r)}r.parentNode.removeChild(r);break;case"dl":r.tagName="ul";break;case"dt":case"dd":r.tagName="li";break;case"li":var i=r.getAttr("class");if(!i||!/list\-/.test(i)){r.setAttr()}var n=r.getNodesByTagName("ol ul");UE.utils.each(n,function(e){r.parentNode.insertAfter(e,r)});break;case"td":case"th":case"caption":if(!r.children||!r.children.length){r.appendChild(browser.ie11below?UE.uNode.createText(" "):UE.uNode.createElement("br"))}break;case"table":if(l.options.disabledTableInTable&&s(r)){r.parentNode.insertBefore(UE.uNode.createText(r.innerText()),r);r.parentNode.removeChild(r)}}}})});l.addOutputRule(function(e){var t;e.traversal(function(e){if(e.type=="element"){if(l.options.autoClearEmptyNode&&dtd.$inline[e.tagName]&&!dtd.$empty[e.tagName]&&(!e.attrs||utils.isEmptyObject(e.attrs))){if(!e.firstChild())e.parentNode.removeChild(e);else if(e.tagName=="span"&&(!e.attrs||utils.isEmptyObject(e.attrs))){e.parentNode.removeChild(e,true)}return}switch(e.tagName){case"div":if(t=e.getAttr("cdata_tag")){e.tagName=t;e.appendChild(UE.uNode.createText(e.getAttr("cdata_data")));e.setAttr({cdata_tag:"",cdata_data:"",_ue_custom_node_:""})}break;case"a":if(t=e.getAttr("_href")){e.setAttr({href:utils.html(t),_href:""})}break;break;case"span":t=e.getAttr("id");if(t&&/^_baidu_bookmark_/i.test(t)){e.parentNode.removeChild(e)}break;case"img":if(t=e.getAttr("_src")){e.setAttr({src:e.getAttr("_src"),_src:""})}}}})})};UE.commands["inserthtml"]={execCommand:function(e,t,i){var n=this,r,o;if(!t){return}if(n.fireEvent("beforeinserthtml",t)===true){return}r=n.selection.getRange();o=r.document.createElement("div");o.style.display="inline";if(!i){var a=UE.htmlparser(t);if(n.options.filterRules){UE.filterNode(a,n.options.filterRules)}n.filterInputRule(a);t=a.toHtml()}o.innerHTML=utils.trim(t);if(!r.collapsed){var s=r.startContainer;if(domUtils.isFillChar(s)){r.setStartBefore(s)}s=r.endContainer;if(domUtils.isFillChar(s)){r.setEndAfter(s)}r.txtToElmBoundary();if(r.endContainer&&r.endContainer.nodeType==1){s=r.endContainer.childNodes[r.endOffset];if(s&&domUtils.isBr(s)){r.setEndAfter(s)}}if(r.startOffset==0){s=r.startContainer;if(domUtils.isBoundaryNode(s,"firstChild")){s=r.endContainer;if(r.endOffset==(s.nodeType==3?s.nodeValue.length:s.childNodes.length)&&domUtils.isBoundaryNode(s,"lastChild")){n.body.innerHTML='<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>";r.setStart(n.body.firstChild,0).collapse(true)}}}!r.collapsed&&r.deleteContents();if(r.startContainer.nodeType==1){var l=r.startContainer.childNodes[r.startOffset],d;if(l&&domUtils.isBlockElm(l)&&(d=l.previousSibling)&&domUtils.isBlockElm(d)){r.setEnd(d,d.childNodes.length).collapse();while(l.firstChild){d.appendChild(l.firstChild)}domUtils.remove(l)}}}var l,u,d,c,f=0,m;if(r.inFillChar()){l=r.startContainer;if(domUtils.isFillChar(l)){r.setStartBefore(l).collapse(true);domUtils.remove(l)}else if(domUtils.isFillChar(l,true)){l.nodeValue=l.nodeValue.replace(fillCharReg,"");r.startOffset--;r.collapsed&&r.collapse(true)}}var h=domUtils.findParentByTagName(r.startContainer,"li",true);if(h){var p,g;while(l=o.firstChild){while(l&&(l.nodeType==3||!domUtils.isBlockElm(l)||l.tagName=="HR")){p=l.nextSibling;r.insertNode(l).collapse();g=l;l=p}if(l){if(/^(ol|ul)$/i.test(l.tagName)){while(l.firstChild){g=l.firstChild;domUtils.insertAfter(h,l.firstChild);h=h.nextSibling}domUtils.remove(l)}else{var v;p=l.nextSibling;v=n.document.createElement("li");domUtils.insertAfter(h,v);v.appendChild(l);g=l;l=p;h=v}}}h=domUtils.findParentByTagName(r.startContainer,"li",true);if(domUtils.isEmptyBlock(h)){domUtils.remove(h)}if(g){r.setStartAfter(g).collapse(true).select(true)}}else{while(l=o.firstChild){if(f){var b=n.document.createElement("p");b.className="ueditor-p";while(l&&(l.nodeType==3||!dtd.$block[l.tagName])){m=l.nextSibling;b.appendChild(l);l=m}if(b.firstChild){l=b}}r.insertNode(l);m=l.nextSibling;if(!f&&l.nodeType==domUtils.NODE_ELEMENT&&domUtils.isBlockElm(l)){u=domUtils.findParent(l,function(e){return domUtils.isBlockElm(e)});if(u&&u.tagName.toLowerCase()!="body"&&!(dtd[u.tagName][l.nodeName]&&l.parentNode===u)){if(!dtd[u.tagName][l.nodeName]){d=u}else{c=l.parentNode;while(c!==u){d=c;c=c.parentNode}}domUtils.breakParent(l,d||c);var d=l.previousSibling;domUtils.trimWhiteTextNode(d);if(!d.childNodes.length){domUtils.remove(d)}if(!browser.ie&&(p=l.nextSibling)&&domUtils.isBlockElm(p)&&p.lastChild&&!domUtils.isBr(p.lastChild)){p.appendChild(n.document.createElement("br"))}f=1}}var p=l.nextSibling;if(!o.firstChild&&p&&domUtils.isBlockElm(p)){r.setStart(p,0).collapse(true);break}r.setEndAfter(l).collapse()}l=r.startContainer;if(m&&domUtils.isBr(m)){domUtils.remove(m)}if(domUtils.isBlockElm(l)&&domUtils.isEmptyNode(l)){if(m=l.nextSibling){domUtils.remove(l);if(m.nodeType==1&&dtd.$block[m.tagName]){r.setStart(m,0).collapse(true).shrinkBoundary()}}else{try{l.innerHTML=browser.ie?domUtils.fillChar:"<br/>"}catch(e){r.setStartBefore(l);domUtils.remove(l)}}}try{r.select(true)}catch(e){}}setTimeout(function(){r=n.selection.getRange();r.scrollToView(n.autoHeightEnabled,n.autoHeightEnabled?domUtils.getXY(n.iframe).y:0);n.fireEvent("afterinserthtml",t)},200)}};UE.plugins["autotypeset"]=function(){this.setOpt({autotypeset:{mergeEmptyline:true,removeClass:true,removeEmptyline:false,textAlign:"left",imageBlockLine:"center",pasteFilter:false,clearFontSize:false,clearFontFamily:false,removeEmptyNode:false,removeTagNames:utils.extend({div:1},dtd.$removeEmpty),indent:false,indentValue:"2em",bdc2sb:false,tobdc:false}});var t=this,g=t.options.autotypeset,v={selectTdClass:1,pagebreak:1,anchorclass:1},b={li:1},i={div:1,p:1,blockquote:1,center:1,h1:1,h2:1,h3:1,h4:1,h5:1,h6:1,span:1},y;if(!g){return}n();function C(e,t){if(!e||e.nodeType==3)return 0;if(domUtils.isBr(e))return 1;if(e&&e.parentNode&&i[e.tagName.toLowerCase()]){if(y&&y.contains(e)||e.getAttribute("pagebreak")){return 0}return t?!domUtils.isEmptyBlock(e):domUtils.isEmptyBlock(e,new RegExp("[\\s"+domUtils.fillChar+"]","g"))}}function w(e){if(!e.style.cssText){domUtils.removeAttributes(e,["style"]);if(e.tagName.toLowerCase()=="span"&&domUtils.hasNoAttributes(e)){domUtils.remove(e,true)}}}function e(e,t){var i=this,n;if(t){if(!g.pasteFilter){return}n=i.document.createElement("div");n.innerHTML=t.html}else{n=i.document.body}var r=domUtils.getElementsByTagName(n,"*");for(var o=0,a;a=r[o++];){if(i.fireEvent("excludeNodeinautotype",a)===true){continue}if(g.clearFontSize&&a.style.fontSize){domUtils.removeStyle(a,"font-size");w(a)}if(g.clearFontFamily&&a.style.fontFamily){domUtils.removeStyle(a,"font-family");w(a)}if(C(a)){if(g.mergeEmptyline){var s=a.nextSibling,l,d=domUtils.isBr(a);while(C(s)){l=s;s=l.nextSibling;if(d&&(!s||s&&!domUtils.isBr(s))){break}domUtils.remove(l)}}if(g.removeEmptyline&&domUtils.inDoc(a,n)&&!b[a.parentNode.tagName.toLowerCase()]){if(domUtils.isBr(a)){s=a.nextSibling;if(s&&!domUtils.isBr(s)){continue}}domUtils.remove(a);continue}}if(C(a,true)&&a.tagName!="SPAN"){if(g.indent){a.style.textIndent=g.indentValue}if(g.textAlign){a.style.textAlign=g.textAlign}}if(g.removeClass&&a.className&&!v[a.className.toLowerCase()]){if(y&&y.contains(a)){continue}domUtils.removeAttributes(a,["class"])}if(g.imageBlockLine&&a.tagName.toLowerCase()=="img"&&!a.getAttribute("emotion")){if(t){var u=a;switch(g.imageBlockLine){case"left":case"right":case"none":var c=u.parentNode,l,f,s;while(dtd.$inline[c.tagName]||c.tagName=="A"){c=c.parentNode}l=c;if(l.tagName=="P"&&domUtils.getStyle(l,"text-align")=="center"){if(!domUtils.isBody(l)&&domUtils.getChildCount(l,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1){f=l.previousSibling;s=l.nextSibling;if(f&&s&&f.nodeType==1&&s.nodeType==1&&f.tagName==s.tagName&&domUtils.isBlockElm(f)){f.appendChild(l.firstChild);while(s.firstChild){f.appendChild(s.firstChild)}domUtils.remove(l);domUtils.remove(s)}else{domUtils.setStyle(l,"text-align","")}}}domUtils.setStyle(u,"float",g.imageBlockLine);break;case"center":if(i.queryCommandValue("imagefloat")!="center"){c=u.parentNode;domUtils.setStyle(u,"float","none");l=u;while(c&&domUtils.getChildCount(c,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1&&(dtd.$inline[c.tagName]||c.tagName=="A")){l=c;c=c.parentNode}var m=i.document.createElement("p");m.className="ueditor-p";domUtils.setAttributes(m,{style:"text-align:center"});l.parentNode.insertBefore(m,l);m.appendChild(l);domUtils.setStyle(l,"float","")}}}else{var h=i.selection.getRange();h.selectNode(a).select();i.execCommand("imagefloat",g.imageBlockLine)}}if(g.removeEmptyNode){if(g.removeTagNames[a.tagName.toLowerCase()]&&domUtils.hasNoAttributes(a)&&domUtils.isEmptyBlock(a)){domUtils.remove(a)}}}if(g.tobdc){var p=UE.htmlparser(n.innerHTML);p.traversal(function(e){if(e.type=="text"){e.data=x(e.data)}});n.innerHTML=p.toHtml()}if(g.bdc2sb){var p=UE.htmlparser(n.innerHTML);p.traversal(function(e){if(e.type=="text"){e.data=N(e.data)}});n.innerHTML=p.toHtml()}if(t){t.html=n.innerHTML}}if(g.pasteFilter){t.addListener("beforepaste",e)}function N(e){var t="";for(var i=0;i<e.length;i++){var n=e.charCodeAt(i);if(n>=65281&&n<=65373){t+=String.fromCharCode(e.charCodeAt(i)-65248)}else if(n==12288){t+=String.fromCharCode(e.charCodeAt(i)-12288+32)}else{t+=e.charAt(i)}}return t}function x(e){e=utils.html(e);var t="";var i="";for(var n=0;n<e.length;n++){if(e.charCodeAt(n)==32){t=t+String.fromCharCode(12288)}else if(e.charCodeAt(n)<127){t=t+String.fromCharCode(e.charCodeAt(n)+65248)}else{t+=e.charAt(n)}}return t}function n(){var e=t.getPreferences("autotypeset");utils.extend(t.options.autotypeset,e)}t.commands["autotypeset"]={execCommand:function(){t.removeListener("beforepaste",e);if(g.pasteFilter){t.addListener("beforepaste",e)}e.call(t)}}};UE.plugin.register("autosubmit",function(){return{shortcutkey:{autosubmit:"ctrl+13"},commands:{autosubmit:{execCommand:function(){var e=this,t=domUtils.findParentByTagName(e.iframe,"form",false);if(t){if(e.fireEvent("beforesubmit")===false){return}e.sync();t.submit()}}}}}});UE.plugin.register("background",function(){var l=this,n="editor_background",i,r=new RegExp("body[\\s]*\\{(.+)\\}","i");function o(e){var n={},t=e.split(";");utils.each(t,function(e){var t=e.indexOf(":"),i=utils.trim(e.substr(0,t)).toLowerCase();i&&(n[i]=utils.trim(e.substr(t+1)||""))});return n}function a(e){if(e){var t=[];for(var i in e){if(e.hasOwnProperty(i)){t.push(i+":"+e[i]+"; ")}}utils.cssRule(n,t.length?"body{"+t.join("")+"}":"",l.document)}else{utils.cssRule(n,"",l.document)}}var e=l.hasContents;l.hasContents=function(){if(l.queryCommandValue("background")){return true}return e.apply(l,arguments)};return{bindEvents:{getAllHtml:function(e,t){var i=this.body,n=domUtils.getComputedStyle(i,"background-image"),r="";if(n.indexOf(l.options.imagePath)>0){r=n.substring(n.indexOf(l.options.imagePath),n.length-1).replace(/"|\(|\)/gi,"")}else{r=n!="none"?n.replace(/url\("?|"?\)/gi,""):""}var o='<style type="text/css">body{';var a={"background-color":domUtils.getComputedStyle(i,"background-color")||"#ffffff","background-image":r?"url("+r+")":"","background-repeat":domUtils.getComputedStyle(i,"background-repeat")||"","background-position":browser.ie?domUtils.getComputedStyle(i,"background-position-x")+" "+domUtils.getComputedStyle(i,"background-position-y"):domUtils.getComputedStyle(i,"background-position"),height:domUtils.getComputedStyle(i,"height")};for(var s in a){if(a.hasOwnProperty(s)){o+=s+":"+a[s]+"; "}}o+="}</style> ";t.push(o)},aftersetcontent:function(){if(i==false)a()}},inputRule:function(e){i=false;utils.each(e.getNodesByTagName("p"),function(e){var t=e.getAttr("data-background");if(t){i=true;a(o(t));e.parentNode.removeChild(e)}})},outputRule:function(e){var t=this,i=(utils.cssRule(n,t.document)||"").replace(/[\n\r]+/g,"").match(r);if(i){e.appendChild(UE.uNode.createElement('<p style="display:none;" data-background="'+utils.trim(i[1].replace(/"/g,"").replace(/[\s]+/g," "))+'"><br/></p>'))}},commands:{background:{execCommand:function(e,t){a(t)},queryCommandValue:function(){var e=this,t=(utils.cssRule(n,e.document)||"").replace(/[\n\r]+/g,"").match(r);return t?o(t[1]):null},notNeedUndo:true}}}});UE.commands["imagefloat"]={execCommand:function(e,t){var i=this,n=i.selection.getRange();if(!n.collapsed){var r=n.getClosedNode();if(r&&r.tagName=="IMG"){switch(t){case"left":case"right":case"none":var o=r.parentNode,a,s,l;while(dtd.$inline[o.tagName]||o.tagName=="A"){o=o.parentNode}a=o;if(a.tagName=="P"&&domUtils.getStyle(a,"text-align")=="center"){if(!domUtils.isBody(a)&&domUtils.getChildCount(a,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1){s=a.previousSibling;l=a.nextSibling;if(s&&l&&s.nodeType==1&&l.nodeType==1&&s.tagName==l.tagName&&domUtils.isBlockElm(s)){s.appendChild(a.firstChild);while(l.firstChild){s.appendChild(l.firstChild)}domUtils.remove(a);domUtils.remove(l)}else{domUtils.setStyle(a,"text-align","")}}n.selectNode(r).select()}domUtils.setStyle(r,"float",t=="none"?"":t);if(t=="none"){domUtils.removeAttributes(r,"align")}break;case"center":if(i.queryCommandValue("imagefloat")!="center"){o=r.parentNode;domUtils.setStyle(r,"float","");domUtils.removeAttributes(r,"align");a=r;while(o&&domUtils.getChildCount(o,function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)})==1&&(dtd.$inline[o.tagName]||o.tagName=="A")){a=o;o=o.parentNode}n.setStartBefore(a).setCursor(false);o=i.document.createElement("div");o.appendChild(a);domUtils.setStyle(a,"float","");i.execCommand("insertHtml",'<p id="_img_parent_tmp" style="text-align:center">'+o.innerHTML+"</p>");a=i.document.getElementById("_img_parent_tmp");a.removeAttribute("id");a=a.firstChild;n.selectNode(a).select();l=a.parentNode.nextSibling;if(l&&domUtils.isEmptyNode(l)){domUtils.remove(l)}}break}}}},queryCommandValue:function(){var e=this.selection.getRange(),t,i;if(e.collapsed){return"none"}t=e.getClosedNode();if(t&&t.nodeType==1&&t.tagName=="IMG"){i=domUtils.getComputedStyle(t,"float")||t.getAttribute("align");if(i=="none"){i=domUtils.getComputedStyle(t.parentNode,"text-align")=="center"?"center":i}return{left:1,right:1,center:1}[i]?i:"none"}return"none"},queryCommandState:function(){var e=this.selection.getRange(),t;if(e.collapsed)return-1;t=e.getClosedNode();if(t&&t.nodeType==1&&t.tagName=="IMG"){return 0}return-1}};UE.commands["insertimage"]={execCommand:function(e,t){t=utils.isArray(t)?t:[t];if(!t.length){return}var i=this,n=i.selection.getRange(),r=n.getClosedNode();if(i.fireEvent("beforeinsertimage",t)===true){return}function o(t){utils.each("width,height,border,hspace,vspace".split(","),function(e){if(t[e]){t[e]=parseInt(t[e],10)||0}});utils.each("src,_src".split(","),function(e){if(t[e]){t[e]=utils.unhtmlForUrl(t[e])}});utils.each("title,alt".split(","),function(e){if(t[e]){t[e]=utils.unhtml(t[e])}})}if(r&&/img/i.test(r.tagName)&&(r.className!="edui-faked-video"||r.className.indexOf("edui-upload-video")!=-1)&&!r.getAttribute("word_img")){var a=t.shift();var s=a["floatStyle"];delete a["floatStyle"];domUtils.setAttributes(r,a);i.execCommand("imagefloat",s);if(t.length>0){n.setStartAfter(r).setCursor(false,true);i.execCommand("insertimage",t)}}else{var l=[],d="",u;u=t[0];if(t.length==1){o(u);d='<img src="'+u.src+'" '+(u._src?' _src="'+u._src+'" ':"")+(u.width?'width="'+u.width+'" ':"")+(u.height?' height="'+u.height+'" ':"")+(u["floatStyle"]=="left"||u["floatStyle"]=="right"?' style="float:'+u["floatStyle"]+';"':"")+(u.title&&u.title!=""?' title="'+u.title+'"':"")+(u.border&&u.border!="0"?' border="'+u.border+'"':"")+(u.alt&&u.alt!=""?' alt="'+u.alt+'"':"")+(u.hspace&&u.hspace!="0"?' hspace = "'+u.hspace+'"':"")+(u.vspace&&u.vspace!="0"?' vspace = "'+u.vspace+'"':"")+"/>";if(u["floatStyle"]=="center"){d='<p style="text-align: center">'+d+"</p>"}l.push(d)}else{for(var c=0;u=t[c++];){o(u);d="<p "+(u["floatStyle"]=="center"?'style="text-align: center" ':"")+'><img src="'+u.src+'" '+(u.width?'width="'+u.width+'" ':"")+(u._src?' _src="'+u._src+'" ':"")+(u.height?' height="'+u.height+'" ':"")+' style="'+(u["floatStyle"]&&u["floatStyle"]!="center"?"float:"+u["floatStyle"]+";":"")+(u.border||"")+'" '+(u.title?' title="'+u.title+'"':"")+" /></p>";l.push(d)}}i.execCommand("insertHtml",l.join(""))}i.fireEvent("afterinsertimage",t)}};UE.plugins["justify"]=function(){var e=this,c=domUtils.isBlockElm,i={left:1,right:1,center:1,justify:1},r=function(e,t){var i=e.createBookmark(),n=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)};e.enlarge(true);var r=e.createBookmark(),o=domUtils.getNextDomNode(r.start,false,n),a=e.cloneRange(),s;while(o&&!(domUtils.getPosition(o,r.end)&domUtils.POSITION_FOLLOWING)){if(o.nodeType==3||!c(o)){a.setStartBefore(o);while(o&&o!==r.end&&!c(o)){s=o;o=domUtils.getNextDomNode(o,false,null,function(e){return!c(e)})}a.setEndAfter(s);var l=a.getCommonAncestor();if(!domUtils.isBody(l)&&c(l)){domUtils.setStyles(l,utils.isString(t)?{"text-align":t}:t);o=l}else{var d=e.document.createElement("p");d.className="ueditor-p";domUtils.setStyles(d,utils.isString(t)?{"text-align":t}:t);var u=a.extractContents();d.appendChild(u);a.insertNode(d);o=d}o=domUtils.getNextDomNode(o,false,n)}else{o=domUtils.getNextDomNode(o,true,n)}}return e.moveToBookmark(r).moveToBookmark(i)};UE.commands["justify"]={execCommand:function(e,t){var i=this.selection.getRange(),n;if(i.collapsed){n=this.document.createTextNode("p");i.insertNode(n)}r(i,t);if(n){i.setStartBefore(n).collapse(true);domUtils.remove(n)}i.select();return true},queryCommandValue:function(){var e=this.selection.getStart(),t=domUtils.getComputedStyle(e,"text-align");return i[t]?t:"left"},queryCommandState:function(){var e=this.selection.getStart(),t=e&&domUtils.findParentByTagName(e,["td","th","caption"],true);return t?-1:0}}};UE.plugins["font"]=function(){var e=this,t={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family",underline:"text-decoration",strikethrough:"text-decoration",fontborder:"border"},d={underline:1,strikethrough:1,fontborder:1},o={forecolor:"color",backcolor:"background-color",fontsize:"font-size",fontfamily:"font-family"};e.setOpt({fontfamily:[{name:"songti",val:"宋体,SimSun"},{name:"yahei",val:"微软雅黑,Microsoft YaHei"},{name:"kaiti",val:"楷体,楷体_GB2312, SimKai"},{name:"heiti",val:"黑体, SimHei"},{name:"lishu",val:"隶书, SimLi"},{name:"andaleMono",val:"andale mono"},{name:"arial",val:"arial, helvetica,sans-serif"},{name:"arialBlack",val:"arial black,avant garde"},{name:"comicSansMs",val:"comic sans ms"},{name:"impact",val:"impact,chicago"},{name:"timesNewRoman",val:"times new roman"}],fontsize:[10,11,12,14,16,18,20,24,36]});function a(e){var t;while(t=e.parentNode){if(t.tagName=="SPAN"&&domUtils.getChildCount(t,function(e){return!domUtils.isBookmarkNode(e)&&!domUtils.isBr(e)})==1){t.style.cssText+=e.style.cssText;domUtils.remove(e,true);e=t}else{break}}}function s(e,t,i){if(o[t]){e.adjustmentBoundary();if(!e.collapsed&&e.startContainer.nodeType==1){var n=e.startContainer.childNodes[e.startOffset];if(n&&domUtils.isTagNode(n,"span")){var r=e.createBookmark();utils.each(domUtils.getElementsByTagName(n,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(t=="backcolor"&&domUtils.getComputedStyle(e,"background-color").toLowerCase()===i){return}domUtils.removeStyle(e,o[t]);if(e.style.cssText.replace(/^\s+$/,"").length==0){domUtils.remove(e,true)}});e.moveToBookmark(r)}}}}function u(e,n,r){var t=e.collapsed,i=e.createBookmark(),o;if(t){o=i.start.parentNode;while(dtd.$inline[o.tagName]){o=o.parentNode}}else{o=domUtils.getCommonAncestor(i.start,i.end)}utils.each(domUtils.getElementsByTagName(o,"span"),function(e){if(!e.parentNode||domUtils.isBookmarkNode(e))return;if(/\s*border\s*:\s*none;?\s*/i.test(e.style.cssText)){if(/^\s*border\s*:\s*none;?\s*$/.test(e.style.cssText)){domUtils.remove(e,true)}else{domUtils.removeStyle(e,"border")}return}if(/border/i.test(e.style.cssText)&&e.parentNode.tagName=="SPAN"&&/border/i.test(e.parentNode.style.cssText)){e.style.cssText=e.style.cssText.replace(/border[^:]*:[^;]+;?/gi,"")}if(!(n=="fontborder"&&r=="none")){var t=e.nextSibling;while(t&&t.nodeType==1&&t.tagName=="SPAN"){if(domUtils.isBookmarkNode(t)&&n=="fontborder"){e.appendChild(t);t=e.nextSibling;continue}if(t.style.cssText==e.style.cssText){domUtils.moveChild(t,e);domUtils.remove(t)}if(e.nextSibling===t)break;t=e.nextSibling}}a(e);if(browser.ie&&browser.version>8){var i=domUtils.findParent(e,function(e){return e.tagName=="SPAN"&&/background-color/.test(e.style.cssText)});if(i&&!/background-color/.test(e.style.cssText)){e.style.backgroundColor=i.style.backgroundColor}}});e.moveToBookmark(i);s(e,n,r)}e.addInputRule(function(e){utils.each(e.getNodesByTagName("u s del font strike"),function(e){if(e.tagName=="font"){var t=[];for(var i in e.attrs){switch(i){case"size":t.push("font-size:"+({1:"10",2:"12",3:"16",4:"18",5:"24",6:"32",7:"48"}[e.attrs[i]]||e.attrs[i])+"px");break;case"color":t.push("color:"+e.attrs[i]);break;case"face":t.push("font-family:"+e.attrs[i]);break;case"style":t.push(e.attrs[i])}}e.attrs={style:t.join(";")}}else{var n=e.tagName=="u"?"underline":"line-through";e.attrs={style:(e.getAttr("style")||"")+"text-decoration:"+n+";"}}e.tagName="span"})});for(var i in t){(function(s,l){UE.commands[s]={execCommand:function(e,t){t=t||(this.queryCommandState(e)?"none":e=="underline"?"underline":e=="fontborder"?"1px solid #000":"line-through");var i=this,n=this.selection.getRange(),r;if(t=="default"){if(n.collapsed){r=i.document.createTextNode("font");n.insertNode(r).select()}i.execCommand("removeFormat","span,a",l);if(r){n.setStartBefore(r).collapse(true);domUtils.remove(r)}u(n,e,t);n.select()}else{if(!n.collapsed){if(d[s]&&i.queryCommandValue(s)){i.execCommand("removeFormat","span,a",l)}n=i.selection.getRange();n.applyInlineStyle("span",{style:l+":"+t});u(n,e,t);n.select()}else{var o=domUtils.findParentByTagName(n.startContainer,"span",true);r=i.document.createTextNode("font");if(o&&!o.children.length&&!o[browser.ie?"innerText":"textContent"].replace(fillCharReg,"").length){n.insertNode(r);if(d[s]){n.selectNode(r).select();i.execCommand("removeFormat","span,a",l,null);o=domUtils.findParentByTagName(r,"span",true);n.setStartBefore(r)}o&&(o.style.cssText+=";"+l+":"+t);n.collapse(true).select()}else{n.insertNode(r);n.selectNode(r).select();o=n.document.createElement("span");if(d[s]){if(domUtils.findParentByTagName(r,"a",true)){n.setStartBefore(r).setCursor();domUtils.remove(r);return}i.execCommand("removeFormat","span,a",l)}o.style.cssText=l+":"+t;r.parentNode.insertBefore(o,r);if(!browser.ie||browser.ie&&browser.version==9){var a=o.parentNode;while(!domUtils.isBlockElm(a)){if(a.tagName=="SPAN"){o.style.cssText=a.style.cssText+";"+o.style.cssText}a=a.parentNode}}if(opera){setTimeout(function(){n.setStart(o,0).collapse(true);u(n,e,t);n.select()})}else{n.setStart(o,0).collapse(true);u(n,e,t);n.select()}}domUtils.remove(r)}}return true},queryCommandValue:function(e){var t=this.selection.getStart();if(e=="underline"||e=="strikethrough"){var i=t,n;while(i&&!domUtils.isBlockElm(i)&&!domUtils.isBody(i)){if(i.nodeType==1){n=domUtils.getComputedStyle(i,l);if(n!="none"){return n}}i=i.parentNode}return"none"}if(e=="fontborder"){var r=t,o;while(r&&dtd.$inline[r.tagName]){if(o=domUtils.getComputedStyle(r,"border")){if(/1px/.test(o)&&/solid/.test(o)){return o}}r=r.parentNode}return""}if(e=="FontSize"){var a=domUtils.getComputedStyle(t,l),r=/^([\d\.]+)(\w+)$/.exec(a);if(r){return Math.floor(r[1])+r[2]}return a}return domUtils.getComputedStyle(t,l)},queryCommandState:function(e){if(!d[e])return 0;var t=this.queryCommandValue(e);if(e=="fontborder"){return/1px/.test(t)&&/solid/.test(t)}else{return e=="underline"?/underline/.test(t):/line\-through/.test(t)}}}})(i,t[i])}};UE.plugins["link"]=function(){function l(e){var t=e.startContainer,i=e.endContainer;if(t=domUtils.findParentByTagName(t,"a",true)){e.setStartBefore(t)}if(i=domUtils.findParentByTagName(i,"a",true)){e.setEndAfter(i)}}UE.commands["unlink"]={execCommand:function(){var e=this.selection.getRange(),t;if(e.collapsed&&!domUtils.findParentByTagName(e.startContainer,"a",true)){return}t=e.createBookmark();l(e);e.removeInlineStyle("a").moveToBookmark(t).select()},queryCommandState:function(){return!this.highlight&&this.queryCommandValue("link")?0:-1}};function n(e,t,i){var n=e.cloneRange(),r=i.queryCommandValue("link");l(e=e.adjustmentBoundary());var o=e.startContainer;if(o.nodeType==1&&r){o=o.childNodes[e.startOffset];if(o&&o.nodeType==1&&o.tagName=="A"&&/^(?:https?|ftp|file)\s*:\s*\/\//.test(o[browser.ie?"innerText":"textContent"])){o[browser.ie?"innerText":"textContent"]=utils.html(t.textValue||t.href)}}if(!n.collapsed||r){e.removeInlineStyle("a");n=e.cloneRange()}if(n.collapsed){var a=e.document.createElement("a"),s="";if(t.textValue){s=utils.html(t.textValue);delete t.textValue}else{s=utils.html(t.href)}domUtils.setAttributes(a,t);o=domUtils.findParentByTagName(n.startContainer,"a",true);if(o&&domUtils.isInNodeEndBoundary(n,o)){e.setStartAfter(o).collapse(true)}a[browser.ie?"innerText":"textContent"]=s;e.insertNode(a).selectNode(a)}else{e.applyInlineStyle("a",t)}}UE.commands["link"]={execCommand:function(e,t){var i;t._href&&(t._href=utils.unhtml(t._href,/[<">]/g));t.href&&(t.href=utils.unhtml(t.href,/[<">]/g));t.textValue&&(t.textValue=utils.unhtml(t.textValue,/[<">]/g));n(i=this.selection.getRange(),t,this);i.collapse().select(true)},queryCommandValue:function(){var e=this.selection.getRange(),t;if(e.collapsed){t=e.startContainer;t=t.nodeType==1?t:t.parentNode;if(t&&(t=domUtils.findParentByTagName(t,"a",true))&&!domUtils.isInNodeEndBoundary(e,t)){return t}}else{e.shrinkBoundary();var i=e.startContainer.nodeType==3||!e.startContainer.childNodes[e.startOffset]?e.startContainer:e.startContainer.childNodes[e.startOffset],n=e.endContainer.nodeType==3||e.endOffset==0?e.endContainer:e.endContainer.childNodes[e.endOffset-1],r=e.getCommonAncestor();t=domUtils.findParentByTagName(r,"a",true);if(!t&&r.nodeType==1){var o=r.getElementsByTagName("a"),a,s;for(var l=0,d;d=o[l++];){a=domUtils.getPosition(d,i),s=domUtils.getPosition(d,n);if((a&domUtils.POSITION_FOLLOWING||a&domUtils.POSITION_CONTAINS)&&(s&domUtils.POSITION_PRECEDING||s&domUtils.POSITION_CONTAINS)){t=d;break}}}return t}},queryCommandState:function(){var e=this.selection.getRange().getClosedNode(),t=e&&(e.className=="edui-faked-video"||e.className.indexOf("edui-upload-video")!=-1);return t?-1:0}}};UE.plugins["insertframe"]=function(){var e=this;function t(){e._iframe&&delete e._iframe}e.addListener("selectionchange",function(){t()})};UE.commands["scrawl"]={queryCommandState:function(){return browser.ie&&browser.version<=8?-1:0}};UE.plugins["removeformat"]=function(){var e=this;e.setOpt({removeFormatTags:"b,big,code,del,dfn,em,font,i,ins,kbd,q,samp,small,span,strike,strong,sub,sup,tt,u,var",removeFormatAttributes:"class,style,lang,width,height,align,hspace,valign"});e.commands["removeformat"]={execCommand:function(e,t,d,i,u){var c=new RegExp("^(?:"+(t||this.options.removeFormatTags).replace(/,/g,"|")+")$","i"),f=d?[]:(i||this.options.removeFormatAttributes).split(","),n=new dom.Range(this.document),m,r,h,p=function(e){return e.nodeType==1};function g(e){if(e.nodeType==3||e.tagName.toLowerCase()!="span"){return 0}if(browser.ie){var t=e.attributes;if(t.length){for(var i=0,n=t.length;i<n;i++){if(t[i].specified){return 0}}return 1}}return!e.attributes.length}function o(e){var t=e.createBookmark();if(e.collapsed){e.enlarge(true)}if(!u){var i=domUtils.findParentByTagName(e.startContainer,"a",true);if(i){e.setStartBefore(i)}i=domUtils.findParentByTagName(e.endContainer,"a",true);if(i){e.setEndAfter(i)}}m=e.createBookmark();a=m.start;while((h=a.parentNode)&&!domUtils.isBlockElm(h)){domUtils.breakParent(a,h);domUtils.clearEmptySibling(a)}if(m.end){a=m.end;while((h=a.parentNode)&&!domUtils.isBlockElm(h)){domUtils.breakParent(a,h);domUtils.clearEmptySibling(a)}var n=domUtils.getNextDomNode(m.start,false,p),r;while(n){if(n==m.end){break}r=domUtils.getNextDomNode(n,true,p);if(!dtd.$empty[n.tagName.toLowerCase()]&&!domUtils.isBookmarkNode(n)){if(c.test(n.tagName)){if(d){domUtils.removeStyle(n,d);if(g(n)&&d!="text-decoration"){domUtils.remove(n,true)}}else{domUtils.remove(n,true)}}else{if(!dtd.$tableContent[n.tagName]&&!dtd.$list[n.tagName]){domUtils.removeAttributes(n,f);if(g(n)){domUtils.remove(n,true)}}}}n=r}}var o=m.start.parentNode;if(domUtils.isBlockElm(o)&&!dtd.$tableContent[o.tagName]&&!dtd.$list[o.tagName]){domUtils.removeAttributes(o,f)}o=m.end.parentNode;if(m.end&&domUtils.isBlockElm(o)&&!dtd.$tableContent[o.tagName]&&!dtd.$list[o.tagName]){domUtils.removeAttributes(o,f)}e.moveToBookmark(m).moveToBookmark(t);var a=e.startContainer,s,l=e.collapsed;while(a.nodeType==1&&domUtils.isEmptyNode(a)&&dtd.$removeEmpty[a.tagName]){s=a.parentNode;e.setStartBefore(a);if(e.startContainer===e.endContainer){e.endOffset--}domUtils.remove(a);a=s}if(!l){a=e.endContainer;while(a.nodeType==1&&domUtils.isEmptyNode(a)&&dtd.$removeEmpty[a.tagName]){s=a.parentNode;e.setEndBefore(a);domUtils.remove(a);a=s}}}n=this.selection.getRange();o(n);n.select()}}};UE.plugins["blockquote"]=function(){var e=this;function y(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),"blockquote")}e.commands["blockquote"]={execCommand:function(e,t){var i=this.selection.getRange(),n=y(this),r=dtd.blockquote,o=i.createBookmark();if(n){var a=i.startContainer,s=domUtils.isBlockElm(a)?a:domUtils.findParent(a,function(e){return domUtils.isBlockElm(e)}),l=i.endContainer,d=domUtils.isBlockElm(l)?l:domUtils.findParent(l,function(e){return domUtils.isBlockElm(e)});s=domUtils.findParentByTagName(s,"li",true)||s;d=domUtils.findParentByTagName(d,"li",true)||d;if(s.tagName=="LI"||s.tagName=="TD"||s===n||domUtils.isBody(s)){domUtils.remove(n,true)}else{domUtils.breakParent(s,n)}if(s!==d){n=domUtils.findParentByTagName(d,"blockquote");if(n){if(d.tagName=="LI"||d.tagName=="TD"||domUtils.isBody(d)){n.parentNode&&domUtils.remove(n,true)}else{domUtils.breakParent(d,n)}}}var u=domUtils.getElementsByTagName(this.document,"blockquote");for(var c=0,f;f=u[c++];){if(!f.childNodes.length){domUtils.remove(f)}else if(domUtils.getPosition(f,s)&domUtils.POSITION_FOLLOWING&&domUtils.getPosition(f,d)&domUtils.POSITION_PRECEDING){domUtils.remove(f,true)}}}else{var m=i.cloneRange(),h=m.startContainer.nodeType==1?m.startContainer:m.startContainer.parentNode,p=h,g=1;while(1){if(domUtils.isBody(h)){if(p!==h){if(i.collapsed){m.selectNode(p);g=0}else{m.setStartBefore(p)}}else{m.setStart(h,0)}break}if(!r[h.tagName]){if(i.collapsed){m.selectNode(p)}else{m.setStartBefore(p)}break}p=h;h=h.parentNode}if(g){p=h=h=m.endContainer.nodeType==1?m.endContainer:m.endContainer.parentNode;while(1){if(domUtils.isBody(h)){if(p!==h){m.setEndAfter(p)}else{m.setEnd(h,h.childNodes.length)}break}if(!r[h.tagName]){m.setEndAfter(p);break}p=h;h=h.parentNode}}h=i.document.createElement("blockquote");domUtils.setAttributes(h,t);h.appendChild(m.extractContents());m.insertNode(h);var v=domUtils.getElementsByTagName(h,"blockquote");for(var c=0,b;b=v[c++];){if(b.parentNode){domUtils.remove(b,true)}}}i.moveToBookmark(o).select()},queryCommandState:function(){return y(this)?1:0}}};UE.commands["touppercase"]=UE.commands["tolowercase"]={execCommand:function(e){var t=this;var i=t.selection.getRange();if(i.collapsed){return i}var n=i.createBookmark(),r=n.end,o=function(e){return!domUtils.isBr(e)&&!domUtils.isWhitespace(e)},a=domUtils.getNextDomNode(n.start,false,o);while(a&&domUtils.getPosition(a,r)&domUtils.POSITION_PRECEDING){if(a.nodeType==3){a.nodeValue=a.nodeValue[e=="touppercase"?"toUpperCase":"toLowerCase"]()}a=domUtils.getNextDomNode(a,true,o);if(a===r){break}}i.moveToBookmark(n).select()}};UE.commands["indent"]={execCommand:function(){var e=this,t=e.queryCommandState("indent")?"0em":e.options.indentValue||"2em";e.execCommand("Paragraph","p",{style:"text-indent:"+t})},queryCommandState:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e&&e.style.textIndent&&parseInt(e.style.textIndent)?1:0}};UE.commands["print"]={execCommand:function(){this.window.print()},notNeedUndo:1};UE.commands["preview"]={execCommand:function(){var e=window.open("","_blank",""),t=e.document;t.open();t.write('<!DOCTYPE html><html><head><meta charset="utf-8"/><script src="'+this.options.UEDITOR_HOME_URL+'ueditor.parse.js"><\/script><script>'+"setTimeout(function(){uParse('div',{rootPath: '"+this.options.UEDITOR_HOME_URL+"'})},300)"+"<\/script></head><body><div>"+this.getContent(null,null,true)+"</div></body></html>");t.close()},notNeedUndo:1};UE.plugins["selectall"]=function(){var e=this;e.commands["selectall"]={execCommand:function(){var e=this,t=e.body,i=e.selection.getRange();i.selectNodeContents(t);if(domUtils.isEmptyBlock(t)){if(browser.opera&&t.firstChild&&t.firstChild.nodeType==1){i.setStartAtFirst(t.firstChild)}i.collapse(true)}i.select(true)},notNeedUndo:1};e.addshortcutkey({selectAll:"ctrl+65"})};UE.plugins["paragraph"]=function(){var e=this,f=domUtils.isBlockElm,m=["TD","LI","PRE"],l=function(e,t,i,n){var r=e.createBookmark(),o=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br"&&!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},a;e.enlarge(true);var s=e.createBookmark(),l=domUtils.getNextDomNode(s.start,false,o),d=e.cloneRange(),u;while(l&&!(domUtils.getPosition(l,s.end)&domUtils.POSITION_FOLLOWING)){if(l.nodeType==3||!f(l)){d.setStartBefore(l);while(l&&l!==s.end&&!f(l)){u=l;l=domUtils.getNextDomNode(l,false,null,function(e){return!f(e)})}d.setEndAfter(u);a=e.document.createElement(t);if(i){domUtils.setAttributes(a,i);if(n&&n=="customstyle"&&i.style){a.style.cssText=i.style}}a.appendChild(d.extractContents());if(domUtils.isEmptyNode(a)){domUtils.fillChar(e.document,a)}d.insertNode(a);var c=a.parentNode;if(f(c)&&!domUtils.isBody(a.parentNode)&&utils.indexOf(m,c.tagName)==-1){if(!(n&&n=="customstyle")){c.getAttribute("dir")&&a.setAttribute("dir",c.getAttribute("dir"));c.style.cssText&&(a.style.cssText=c.style.cssText+";"+a.style.cssText);c.style.textAlign&&!a.style.textAlign&&(a.style.textAlign=c.style.textAlign);c.style.textIndent&&!a.style.textIndent&&(a.style.textIndent=c.style.textIndent);c.style.padding&&!a.style.padding&&(a.style.padding=c.style.padding)}if(i&&/h\d/i.test(c.tagName)&&!/h\d/i.test(a.tagName)){domUtils.setAttributes(c,i);if(n&&n=="customstyle"&&i.style){c.style.cssText=i.style}domUtils.remove(a,true);a=c}else{domUtils.remove(a.parentNode,true)}}if(utils.indexOf(m,c.tagName)!=-1){l=c}else{l=a}l=domUtils.getNextDomNode(l,false,o)}else{l=domUtils.getNextDomNode(l,true,o)}}return e.moveToBookmark(s).moveToBookmark(r)};e.setOpt("paragraph",{p:"",h1:"",h2:"",h3:"",h4:"",h5:"",h6:""});e.commands["paragraph"]={execCommand:function(e,t,i,n){var r=this.selection.getRange();if(r.collapsed){var o=this.document.createTextNode("p");r.insertNode(o);if(browser.ie){var a=o.previousSibling;if(a&&domUtils.isWhitespace(a)){domUtils.remove(a)}a=o.nextSibling;if(a&&domUtils.isWhitespace(a)){domUtils.remove(a)}}}r=l(r,t,i,n);if(o){r.setStartBefore(o).collapse(true);pN=o.parentNode;domUtils.remove(o);if(domUtils.isBlockElm(pN)&&domUtils.isEmptyNode(pN)){domUtils.fillNode(this.document,pN)}}if(browser.gecko&&r.collapsed&&r.startContainer.nodeType==1){var s=r.startContainer.childNodes[r.startOffset];if(s&&s.nodeType==1&&s.tagName.toLowerCase()==t){r.setStart(s,0).collapse(true)}}r.select();return true},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),"p h1 h2 h3 h4 h5 h6");return e?e.tagName.toLowerCase():""}}};(function(){var m=domUtils.isBlockElm,h=function(e){return domUtils.filterNodeList(e.selection.getStartElementPath(),function(e){return e&&e.nodeType==1&&e.getAttribute("dir")})},r=function(e,t,i){var n,r=function(e){return e.nodeType==1?!domUtils.isBookmarkNode(e):!domUtils.isWhitespace(e)},o=h(t);if(o&&e.collapsed){o.setAttribute("dir",i);return e}n=e.createBookmark();e.enlarge(true);var a=e.createBookmark(),s=domUtils.getNextDomNode(a.start,false,r),l=e.cloneRange(),d;while(s&&!(domUtils.getPosition(s,a.end)&domUtils.POSITION_FOLLOWING)){if(s.nodeType==3||!m(s)){l.setStartBefore(s);while(s&&s!==a.end&&!m(s)){d=s;s=domUtils.getNextDomNode(s,false,null,function(e){return!m(e)})}l.setEndAfter(d);var u=l.getCommonAncestor();if(!domUtils.isBody(u)&&m(u)){u.setAttribute("dir",i);s=u}else{var c=e.document.createElement("p");c.setAttribute("dir",i);var f=l.extractContents();c.appendChild(f);l.insertNode(c);s=c}s=domUtils.getNextDomNode(s,false,r)}else{s=domUtils.getNextDomNode(s,true,r)}}return e.moveToBookmark(a).moveToBookmark(n)};UE.commands["directionality"]={execCommand:function(e,t){var i=this.selection.getRange();if(i.collapsed){var n=this.document.createTextNode("d");i.insertNode(n)}r(i,this,t);if(n){i.setStartBefore(n).collapse(true);domUtils.remove(n)}i.select();return true},queryCommandValue:function(){var e=h(this);return e?e.getAttribute("dir"):"ltr"}}})();function generateUUID(){var i=(new Date).getTime();if(window.performance&&typeof window.performance.now==="function"){i+=performance.now()}var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=(i+Math.random()*16)%16|0;i=Math.floor(i/16);return(e=="x"?t:t&3|8).toString(16)});return e}UE.plugins["gapfilling"]=function(){var o=this;o.commands["gapfilling"]={execCommand:function(e){var t=domUtils.getElementsByTagName(o.document,"span","gapfilling-span");var i=generateUUID();var n=t.length+1;var r="gapfilling-span "+i;o.execCommand("inserthtml",'<span class="'+r+'">'+n+"</span>",true);return true}};o.addListener("delkeydown",function(e,t){var i=this.selection.getRange();i.txtToElmBoundary(true);if(domUtils.isStartInblock(i)){var n=i.startContainer;var r=n.previousSibling;if(r&&domUtils.isTagNode(r,"span")){domUtils.remove(r);i.select();domUtils.preventDefault(t);return true}}})};UE.plugins["horizontal"]=function(){var e=this;e.commands["horizontal"]={execCommand:function(e){var t=this;if(t.queryCommandState(e)!==-1){t.execCommand("insertHtml","<hr>");var i=t.selection.getRange(),n=i.startContainer;if(n.nodeType==1&&!n.childNodes[i.startOffset]){var r;if(r=n.childNodes[i.startOffset-1]){if(r.nodeType==1&&r.tagName=="HR"){if(t.options.enterTag=="p"){r=t.document.createElement("p");r.className="ueditor-p";i.insertNode(r);i.setStart(r,0).setCursor()}else{r=t.document.createElement("br");i.insertNode(r);i.setStartBefore(r).setCursor()}}}}return true}},queryCommandState:function(){return domUtils.filterNodeList(this.selection.getStartElementPath(),"table")?-1:0}};e.addListener("delkeydown",function(e,t){var i=this.selection.getRange();i.txtToElmBoundary(true);if(domUtils.isStartInblock(i)){var n=i.startContainer;var r=n.previousSibling;if(r&&domUtils.isTagNode(r,"hr")){domUtils.remove(r);i.select();domUtils.preventDefault(t);return true}}})};UE.commands["time"]=UE.commands["date"]={execCommand:function(e,t){var i=new Date;function n(e,t){var i=("0"+e.getHours()).slice(-2),n=("0"+e.getMinutes()).slice(-2),r=("0"+e.getSeconds()).slice(-2);t=t||"hh:ii:ss";return t.replace(/hh/gi,i).replace(/ii/gi,n).replace(/ss/gi,r)}function r(e,t){var i=("000"+e.getFullYear()).slice(-4),n=i.slice(-2),r=("0"+(e.getMonth()+1)).slice(-2),o=("0"+e.getDate()).slice(-2);t=t||"yyyy-mm-dd";return t.replace(/yyyy/gi,i).replace(/yy/gi,n).replace(/mm/gi,r).replace(/dd/gi,o)}this.execCommand("insertHtml",e=="time"?n(i,t):r(i,t))}};UE.plugins["rowspacing"]=function(){var e=this;e.setOpt({rowspacingtop:["5","10","15","20","25"],rowspacingbottom:["5","10","15","20","25"]});e.commands["rowspacing"]={execCommand:function(e,t,i){this.execCommand("paragraph","p",{style:"margin-"+i+":"+t+"px"});return true},queryCommandValue:function(e,t){var i=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return domUtils.isBlockElm(e)}),n;if(i){n=domUtils.getComputedStyle(i,"margin-"+t).replace(/[^\d]/g,"");return!n?0:n}return 0}}};UE.plugins["lineheight"]=function(){var e=this;e.setOpt({lineheight:["1","1.5","1.75","2","3","4","5"]});e.commands["lineheight"]={execCommand:function(e,t){this.execCommand("paragraph","p",{style:"line-height:"+(t=="1"?"normal":t+"em")});return true},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return domUtils.isBlockElm(e)});if(e){var t=domUtils.getComputedStyle(e,"line-height");return t=="normal"?1:t.replace(/[^\d.]*/gi,"")}}}};UE.plugins["insertcode"]=function(){var c=this;c.ready(function(){utils.cssRule("pre","pre{margin:.5em 0;padding:.4em .6em;border-radius:8px;background:#f8f8f8;}",c.document)});c.setOpt("insertcode",{as3:"ActionScript3",bash:"Bash/Shell",cpp:"C/C++",css:"Css",cf:"CodeFunction","c#":"C#",delphi:"Delphi",diff:"Diff",erlang:"Erlang",groovy:"Groovy",html:"Html",java:"Java",jfx:"JavaFx",js:"Javascript",pl:"Perl",php:"Php",plain:"Plain Text",ps:"PowerShell",python:"Python",ruby:"Ruby",scala:"Scala",sql:"Sql",vb:"Vb",xml:"Xml"});c.commands["insertcode"]={execCommand:function(e,t){var i=this,n=i.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"pre",true);if(r){r.className="brush:"+t+";toolbar:false;"}else{var o="";if(n.collapsed){o=browser.ie&&browser.ie11below?browser.version<=8?"&nbsp;":"":"<br/>"}else{var a=n.extractContents();var s=i.document.createElement("div");s.appendChild(a);utils.each(UE.filterNode(UE.htmlparser(s.innerHTML.replace(/[\r\t]/g,"")),i.options.filterTxtRules).children,function(t){if(browser.ie&&browser.ie11below&&browser.version>8){if(t.type=="element"){if(t.tagName=="br"){o+="\n"}else if(!dtd.$empty[t.tagName]){utils.each(t.children,function(e){if(e.type=="element"){if(e.tagName=="br"){o+="\n"}else if(!dtd.$empty[t.tagName]){o+=e.innerText()}}else{o+=e.data}});if(!/\n$/.test(o)){o+="\n"}}}else{o+=t.data+"\n"}if(!t.nextSibling()&&/\n$/.test(o)){o=o.replace(/\n$/,"")}}else{if(browser.ie&&browser.ie11below){if(t.type=="element"){if(t.tagName=="br"){o+="<br>"}else if(!dtd.$empty[t.tagName]){utils.each(t.children,function(e){if(e.type=="element"){if(e.tagName=="br"){o+="<br>"}else if(!dtd.$empty[t.tagName]){o+=e.innerText()}}else{o+=e.data}});if(!/br>$/.test(o)){o+="<br>"}}}else{o+=t.data+"<br>"}if(!t.nextSibling()&&/<br>$/.test(o)){o=o.replace(/<br>$/,"")}}else{o+=t.type=="element"?dtd.$empty[t.tagName]?"":t.innerText():t.data;if(!/br\/?\s*>$/.test(o)){if(!t.nextSibling())return;o+="<br>"}}}})}i.execCommand("inserthtml",'<pre id="coder"class="brush:'+t+';toolbar:false">'+o+"</pre>",true);r=i.document.getElementById("coder");domUtils.removeAttributes(r,"id");var l=r.previousSibling;if(l&&(l.nodeType==3&&l.nodeValue.length==1&&browser.ie&&browser.version==6||domUtils.isEmptyBlock(l))){domUtils.remove(l)}var n=i.selection.getRange();if(domUtils.isEmptyBlock(r)){n.setStart(r,0).setCursor(false,true)}else{n.selectNodeContents(r).select()}}},queryCommandValue:function(){var e=this.selection.getStartElementPath();var i="";utils.each(e,function(e){if(e.nodeName=="PRE"){var t=e.className.match(/brush:([^;]+)/);i=t&&t[1]?t[1]:"";return false}});return i}};c.addInputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(t){var e=t.getNodesByTagName("br");if(e.length){browser.ie&&browser.ie11below&&browser.version>8&&utils.each(e,function(e){var t=UE.uNode.createText("\n");e.parentNode.insertBefore(t,e);e.parentNode.removeChild(e)});return}if(browser.ie&&browser.ie11below&&browser.version>8)return;var i=t.innerText().split(/\n/);t.innerHTML("");utils.each(i,function(e){if(e.length){t.appendChild(UE.uNode.createText(e))}t.appendChild(UE.uNode.createElement("br"))})})});c.addOutputRule(function(e){utils.each(e.getNodesByTagName("pre"),function(e){var t="";utils.each(e.children,function(e){if(e.type=="text"){t+=e.data.replace(/[ ]/g,"&nbsp;").replace(/\n$/,"")}else{if(e.tagName=="br"){t+="\n"}else{t+=!dtd.$empty[e.tagName]?"":e.innerText()}}});e.innerText(t.replace(/(&nbsp;|\n)+$/,""))})});c.notNeedCodeQuery={help:1,undo:1,redo:1,source:1,print:1,searchreplace:1,fullscreen:1,preview:1,insertparagraph:1,elementpath:1,insertcode:1,inserthtml:1,selectall:1};var e=c.queryCommandState;c.queryCommandState=function(e){var t=this;if(!t.notNeedCodeQuery[e.toLowerCase()]&&t.selection&&t.queryCommandValue("insertcode")){return-1}return UE.Editor.prototype.queryCommandState.apply(this,arguments)};c.addListener("beforeenterkeydown",function(){var e=c.selection.getRange();var t=domUtils.findParentByTagName(e.startContainer,"pre",true);if(t){c.fireEvent("saveScene");if(!e.collapsed){e.deleteContents()}if(!browser.ie||browser.ie9above){var i=c.document.createElement("br"),t;e.insertNode(i).setStartAfter(i).collapse(true);var n=i.nextSibling;if(!n&&(!browser.ie||browser.version>10)){e.insertNode(i.cloneNode(false))}else{e.setStartAfter(i)}t=i.previousSibling;var r;while(t){r=t;t=t.previousSibling;if(!t||t.nodeName=="BR"){t=r;break}}if(t){var o="";while(t&&t.nodeName!="BR"&&new RegExp("^[\\s"+domUtils.fillChar+"]*$").test(t.nodeValue)){o+=t.nodeValue;t=t.nextSibling}if(t.nodeName!="BR"){var a=t.nodeValue.match(new RegExp("^([\\s"+domUtils.fillChar+"]+)"));if(a&&a[1]){o+=a[1]}}if(o){o=c.document.createTextNode(o);e.insertNode(o).setStartAfter(o)}}e.collapse(true).select(true)}else{if(browser.version>8){var s=c.document.createTextNode("\n");var l=e.startContainer;if(e.startOffset==0){var d=l.previousSibling;if(d){e.insertNode(s);var u=c.document.createTextNode(" ");e.setStartAfter(s).insertNode(u).setStart(u,0).collapse(true).select(true)}}else{e.insertNode(s).setStartAfter(s);var u=c.document.createTextNode(" ");l=e.startContainer.childNodes[e.startOffset];if(l&&!/^\n/.test(l.nodeValue)){e.setStartBefore(s)}e.insertNode(u).setStart(u,0).collapse(true).select(true)}}else{var i=c.document.createElement("br");e.insertNode(i);e.insertNode(c.document.createTextNode(domUtils.fillChar));e.setStartAfter(i);t=i.previousSibling;var r;while(t){r=t;t=t.previousSibling;if(!t||t.nodeName=="BR"){t=r;break}}if(t){var o="";while(t&&t.nodeName!="BR"&&new RegExp("^[ "+domUtils.fillChar+"]*$").test(t.nodeValue)){o+=t.nodeValue;t=t.nextSibling}if(t.nodeName!="BR"){var a=t.nodeValue.match(new RegExp("^([ "+domUtils.fillChar+"]+)"));if(a&&a[1]){o+=a[1]}}o=c.document.createTextNode(o);e.insertNode(o).setStartAfter(o)}e.collapse(true).select()}}c.fireEvent("saveScene");return true}});c.addListener("tabkeydown",function(e,t){var i=c.selection.getRange();var n=domUtils.findParentByTagName(i.startContainer,"pre",true);if(n){c.fireEvent("saveScene");if(t.shiftKey){}else{if(!i.collapsed){var r=i.createBookmark();var o=r.start.previousSibling;while(o){if(n.firstChild===o&&!domUtils.isBr(o)){n.insertBefore(c.document.createTextNode("    "),o);break}if(domUtils.isBr(o)){n.insertBefore(c.document.createTextNode("    "),o.nextSibling);break}o=o.previousSibling}var a=r.end;o=r.start.nextSibling;if(n.firstChild===r.start){n.insertBefore(c.document.createTextNode("    "),o.nextSibling)}while(o&&o!==a){if(domUtils.isBr(o)&&o.nextSibling){if(o.nextSibling===a){break}n.insertBefore(c.document.createTextNode("    "),o.nextSibling)}o=o.nextSibling}i.moveToBookmark(r).select()}else{var s=c.document.createTextNode("    ");i.insertNode(s).setStartAfter(s).collapse(true).select(true)}}c.fireEvent("saveScene");return true}});c.addListener("beforeinserthtml",function(e,t){var i=this,n=i.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"pre",true);if(r){if(!n.collapsed){n.deleteContents()}var o="";if(browser.ie&&browser.version>8){utils.each(UE.filterNode(UE.htmlparser(t),i.options.filterTxtRules).children,function(t){if(t.type=="element"){if(t.tagName=="br"){o+="\n"}else if(!dtd.$empty[t.tagName]){utils.each(t.children,function(e){if(e.type=="element"){if(e.tagName=="br"){o+="\n"}else if(!dtd.$empty[t.tagName]){o+=e.innerText()}}else{o+=e.data}});if(!/\n$/.test(o)){o+="\n"}}}else{o+=t.data+"\n"}if(!t.nextSibling()&&/\n$/.test(o)){o=o.replace(/\n$/,"")}});var a=i.document.createTextNode(utils.html(o.replace(/&nbsp;/g," ")));n.insertNode(a).selectNode(a).select()}else{var s=i.document.createDocumentFragment();utils.each(UE.filterNode(UE.htmlparser(t),i.options.filterTxtRules).children,function(t){if(t.type=="element"){if(t.tagName=="br"){s.appendChild(i.document.createElement("br"))}else if(!dtd.$empty[t.tagName]){utils.each(t.children,function(e){if(e.type=="element"){if(e.tagName=="br"){s.appendChild(i.document.createElement("br"))}else if(!dtd.$empty[t.tagName]){s.appendChild(i.document.createTextNode(utils.html(e.innerText().replace(/&nbsp;/g," "))))}}else{s.appendChild(i.document.createTextNode(utils.html(e.data.replace(/&nbsp;/g," "))))}});if(s.lastChild.nodeName!="BR"){s.appendChild(i.document.createElement("br"))}}}else{s.appendChild(i.document.createTextNode(utils.html(t.data.replace(/&nbsp;/g," "))))}if(!t.nextSibling()&&s.lastChild.nodeName=="BR"){s.removeChild(s.lastChild)}});n.insertNode(s).select()}return true}});c.addListener("keydown",function(e,t){var i=this,n=t.keyCode||t.which;if(n==40){var r=i.selection.getRange(),o,a=r.startContainer;if(r.collapsed&&(o=domUtils.findParentByTagName(r.startContainer,"pre",true))&&!o.nextSibling){var s=o.lastChild;while(s&&s.nodeName=="BR"){s=s.previousSibling}if(s===a||r.startContainer===o&&r.startOffset==o.childNodes.length){i.execCommand("insertparagraph");domUtils.preventDefault(t)}}}});c.addListener("delkeydown",function(e,t){var i=this.selection.getRange();i.txtToElmBoundary(true);var n=i.startContainer;if(domUtils.isTagNode(n,"pre")&&i.collapsed&&domUtils.isStartInblock(i)){var r=c.document.createElement("p");r.className="ueditor-p";domUtils.fillNode(c.document,r);n.parentNode.insertBefore(r,n);domUtils.remove(n);i.setStart(r,0).setCursor(false,true);domUtils.preventDefault(t);return true}})};UE.commands["cleardoc"]={execCommand:function(e){var t=this,i=t.options.enterTag,n=t.selection.getRange();if(i=="br"){t.body.innerHTML="<br/>";n.setStart(t.body,0).setCursor()}else{t.body.innerHTML="<p class='ueditor-p'>"+(ie?"":"<br/>")+"</p>";n.setStart(t.body.firstChild,0).setCursor(false,true)}setTimeout(function(){t.fireEvent("clearDoc")},0)}};UE.commands["custombtn"]={execCommand:function(e){var t=this;UE.promptAlert(t)}},UE.commands["complexformulas"]={execCommand:function(e){var t=this;UE.showFormulaDialogue(t)}},UE.plugin.register("anchor",function(){return{bindEvents:{ready:function(){utils.cssRule("anchor",".anchorclass{background: url('"+this.options.themePath+this.options.theme+"/images/anchor.gif') no-repeat scroll left center transparent;cursor: auto;display: inline-block;height: 16px;width: 15px;}",this.document)}},outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){var t;if(t=e.getAttr("anchorname")){e.tagName="a";e.setAttr({anchorname:"",name:t,class:""})}})},inputRule:function(e){utils.each(e.getNodesByTagName("a"),function(e){var t;if((t=e.getAttr("name"))&&!e.getAttr("href")){e.tagName="img";e.setAttr({anchorname:e.getAttr("name"),class:"anchorclass"});e.setAttr("name")}})},commands:{anchor:{execCommand:function(e,t){var i=this.selection.getRange(),n=i.getClosedNode();if(n&&n.getAttribute("anchorname")){if(t){n.setAttribute("anchorname",t)}else{i.setStartBefore(n).setCursor();domUtils.remove(n)}}else{if(t){var r=this.document.createElement("img");i.collapse(true);domUtils.setAttributes(r,{anchorname:t,class:"anchorclass"});i.insertNode(r).setStartAfter(r).setCursor(false,true)}}}}}}});UE.plugins["wordcount"]=function(){var e=this;e.setOpt("wordCount",true);e.addListener("contentchange",function(){e.fireEvent("wordcount")});var r;e.addListener("ready",function(){var n=this;domUtils.on(n.body,"keyup",function(e){var t=e.keyCode||e.which,i={16:1,18:1,20:1,37:1,38:1,39:1,40:1};if(t in i)return;clearTimeout(r);r=setTimeout(function(){n.fireEvent("wordcount")},200)})})};UE.plugins["pagebreak"]=function(){var u=this,c=["td"];u.setOpt("pageBreakTag","_ueditor_page_break_tag_");function f(e){if(domUtils.isEmptyBlock(e)){var t=e.firstChild,i;while(t&&t.nodeType==1&&domUtils.isEmptyBlock(t)){i=t;t=t.firstChild}!i&&(i=e);domUtils.fillNode(u.document,i)}}u.ready(function(){utils.cssRule("pagebreak",".pagebreak{display:block;clear:both !important;cursor:default !important;width: 100% !important;margin:0;}",u.document)});function m(e){return e&&e.nodeType==1&&e.tagName=="HR"&&e.className=="pagebreak"}u.addInputRule(function(e){e.traversal(function(e){if(e.type=="text"&&e.data==u.options.pageBreakTag){var t=UE.uNode.createElement('<hr class="pagebreak" noshade="noshade" size="5" style="-webkit-user-select: none;">');e.parentNode.insertBefore(t,e);e.parentNode.removeChild(e)}})});u.addOutputRule(function(e){utils.each(e.getNodesByTagName("hr"),function(e){if(e.getAttr("class")=="pagebreak"){var t=UE.uNode.createText(u.options.pageBreakTag);e.parentNode.insertBefore(t,e);e.parentNode.removeChild(e)}})});u.commands["pagebreak"]={execCommand:function(){var e=u.selection.getRange(),t=u.document.createElement("hr");domUtils.setAttributes(t,{class:"pagebreak",noshade:"noshade",size:"5"});domUtils.unSelectable(t);var i=domUtils.findParentByTagName(e.startContainer,c,true),n=[],r;console.log(i==true);console.log(i==true);if(i){alert("1");switch(i.tagName){case"TD":r=i.parentNode;if(!r.previousSibling){var o=domUtils.findParentByTagName(r,"table");o.parentNode.insertBefore(t,o);n=domUtils.findParents(t,true)}else{r.parentNode.insertBefore(t,r);n=domUtils.findParents(t)}r=n[1];if(t!==r){domUtils.breakParent(t,r)}u.fireEvent("afteradjusttable",u.document)}}else{alert("2");if(!e.collapsed){e.deleteContents();var a=e.startContainer;while(!domUtils.isBody(a)&&domUtils.isBlockElm(a)&&domUtils.isEmptyNode(a)){e.setStartBefore(a).collapse(true);domUtils.remove(a);a=e.startContainer}}e.insertNode(t);var r=t.parentNode,s;while(!domUtils.isBody(r)){domUtils.breakParent(t,r);s=t.nextSibling;if(s&&domUtils.isEmptyBlock(s)){domUtils.remove(s)}r=t.parentNode}s=t.nextSibling;var l=t.previousSibling;if(m(l)){domUtils.remove(l)}else{l&&f(l)}if(!s){var d=u.document.createElement("p");d.className="ueditor-p";t.parentNode.appendChild(d);domUtils.fillNode(u.document,d);e.setStart(d,0).collapse(true)}else{if(m(s)){domUtils.remove(s)}else{f(s)}e.setEndAfter(t).collapse(false)}e.select(true)}}}};UE.plugin.register("wordimage",function(){var o=this,i=[];return{commands:{wordimage:{execCommand:function(){var e=domUtils.getElementsByTagName(o.body,"img");var t=[];for(var i=0,n;n=e[i++];){var r=n.getAttribute("word_img");r&&t.push(r)}return t},queryCommandState:function(){i=domUtils.getElementsByTagName(o.body,"img");for(var e=0,t;t=i[e++];){if(t.getAttribute("word_img")){return 1}}return-1},notNeedUndo:true}},inputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){var t=e.attrs,i=parseInt(t.width)<128||parseInt(t.height)<43,n=o.options,r=n.UEDITOR_HOME_URL+"themes/default/images/spacer.gif";if(t["src"]&&/^(?:(file:\/+))/.test(t["src"])){e.setAttr({width:t.width,height:t.height,alt:t.alt,word_img:t.src,src:r,style:"background:url("+(i?n.themePath+n.theme+"/images/word.gif":n.langPath+n.lang+"/images/localimage.png")+") no-repeat center center;border:1px solid #ddd"})}})}}});UE.plugins["dragdrop"]=function(){var o=this;o.ready(function(){domUtils.on(this.body,"dragend",function(){var e=o.selection.getRange();var t=e.getClosedNode()||o.selection.getStart();if(t&&t.tagName=="IMG"){var i=t.previousSibling,n;while(n=t.nextSibling){if(n.nodeType==1&&n.tagName=="SPAN"&&!n.firstChild){domUtils.remove(n)}else{break}}if((i&&i.nodeType==1&&!domUtils.isEmptyBlock(i)||!i)&&(!n||n&&!domUtils.isEmptyBlock(n))){if(i&&i.tagName=="P"&&!domUtils.isEmptyBlock(i)){i.appendChild(t);domUtils.moveChild(n,i);domUtils.remove(n)}else if(n&&n.tagName=="P"&&!domUtils.isEmptyBlock(n)){n.insertBefore(t,n.firstChild)}if(i&&i.tagName=="P"&&domUtils.isEmptyBlock(i)){domUtils.remove(i)}if(n&&n.tagName=="P"&&domUtils.isEmptyBlock(n)){domUtils.remove(n)}e.selectNode(t).select();o.fireEvent("saveScene")}}})});o.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(i==13){var n=o.selection.getRange(),r;if(r=domUtils.findParentByTagName(n.startContainer,"p",true)){if(domUtils.getComputedStyle(r,"text-align")=="center"){domUtils.removeStyle(r,"text-align")}}}})};UE.plugins["undo"]=function(){var o;var r=this,a=r.options.maxUndoCount||20,s=r.options.maxInputCount||20,l=new RegExp(domUtils.fillChar+"|</hr>","gi");var d={ol:1,ul:1,table:1,tbody:1,tr:1,body:1};var u=r.options.autoClearEmptyNode;function i(e,t){if(e.length!=t.length)return 0;for(var i=0,n=e.length;i<n;i++){if(e[i]!=t[i])return 0}return 1}function c(e,t){if(e.collapsed!=t.collapsed){return 0}if(!i(e.startAddress,t.startAddress)||!i(e.endAddress,t.endAddress)){return 0}return 1}function e(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.undo=function(){if(this.hasUndo){if(!this.list[this.index-1]&&this.list.length==1){this.reset();return}while(this.list[this.index].content==this.list[this.index-1].content){this.index--;if(this.index==0){return this.restore(0)}}this.restore(--this.index)}};this.redo=function(){if(this.hasRedo){while(this.list[this.index].content==this.list[this.index+1].content){this.index++;if(this.index==this.list.length-1){return this.restore(this.index)}}this.restore(++this.index)}};this.restore=function(){var t=this.editor;var e=this.list[this.index];var i=UE.htmlparser(e.content.replace(l,""));t.options.autoClearEmptyNode=false;t.filterInputRule(i);t.options.autoClearEmptyNode=u;t.document.body.innerHTML=i.toHtml();t.fireEvent("afterscencerestore");if(browser.ie){utils.each(domUtils.getElementsByTagName(t.document,"td th caption p"),function(e){if(domUtils.isEmptyNode(e)){domUtils.fillNode(t.document,e)}})}try{var n=new dom.Range(t.document).moveToAddress(e.address);n.select(d[n.startContainer.nodeName.toLowerCase()])}catch(e){}this.update();this.clearKey();t.fireEvent("reset",true)};this.getScene=function(){var e=this.editor;var t=e.selection.getRange(),i=t.createAddress(false,true);e.fireEvent("beforegetscene");var n=UE.htmlparser(e.body.innerHTML);e.options.autoClearEmptyNode=false;e.filterOutputRule(n);e.options.autoClearEmptyNode=u;var r=n.toHtml();e.fireEvent("aftergetscene");return{address:i,content:r}};this.save=function(e,t){clearTimeout(o);var i=this.getScene(t),n=this.list[this.index];if(n&&n.content!=i.content){r.trigger("contentchange")}if(n&&n.content==i.content&&(e?1:c(n.address,i.address))){return}this.list=this.list.slice(0,this.index+1);this.list.push(i);if(this.list.length>a){this.list.shift()}this.index=this.list.length-1;this.clearKey();this.update()};this.update=function(){this.hasRedo=!!this.list[this.index+1];this.hasUndo=!!this.list[this.index-1]};this.reset=function(){this.list=[];this.index=0;this.hasUndo=false;this.hasRedo=false;this.clearKey()};this.clearKey=function(){m=0;h=null}}r.undoManger=new e;r.undoManger.editor=r;function t(){this.undoManger.save()}r.addListener("saveScene",function(){var e=Array.prototype.splice.call(arguments,1);this.undoManger.save.apply(this.undoManger,e)});r.addListener("reset",function(e,t){if(!t){this.undoManger.reset()}});r.commands["redo"]=r.commands["undo"]={execCommand:function(e){this.undoManger[e]()},queryCommandState:function(e){return this.undoManger["has"+(e.toLowerCase()=="undo"?"Undo":"Redo")]?0:-1},notNeedUndo:1};var f={16:1,17:1,18:1,37:1,38:1,39:1,40:1},m=0,h;var p=false;r.addListener("ready",function(){domUtils.on(this.body,"compositionstart",function(){p=true});domUtils.on(this.body,"compositionend",function(){p=false})});r.addshortcutkey({Undo:"ctrl+90",Redo:"ctrl+89"});var g=true;r.addListener("keydown",function(e,t){var i=this;var n=t.keyCode||t.which;if(!f[n]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(p)return;if(!i.selection.getRange().collapsed){i.undoManger.save(false,true);g=false;return}if(i.undoManger.list.length==0){i.undoManger.save(true)}clearTimeout(o);function r(e){e.undoManger.save(false,true);e.fireEvent("selectionchange")}o=setTimeout(function(){if(p){var e=setInterval(function(){if(!p){r(i);clearInterval(e)}},300);return}r(i)},200);h=n;m++;if(m>=s){r(i)}}});r.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(!f[i]&&!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){if(p)return;if(!g){this.undoManger.save(false,true);g=true}}});r.stopCmdUndo=function(){r.__hasEnterExecCommand=true};r.startCmdUndo=function(){r.__hasEnterExecCommand=false}};UE.plugin.register("copy",function(){var r=this;function e(){ZeroClipboard.config({debug:false,swfPath:r.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.swf"});var e=r.zeroclipboard=new ZeroClipboard;e.on("copy",function(e){var t=e.client,i=r.selection.getRange(),n=document.createElement("div");n.appendChild(i.cloneContents());t.setText(n.innerText||n.textContent);t.setHtml(n.innerHTML);i.select()});e.on("mouseover mouseout",function(e){var t=e.target;if(e.type=="mouseover"){domUtils.addClass(t,"edui-state-hover")}else if(e.type=="mouseout"){domUtils.removeClasses(t,"edui-state-hover")}});e.on("wrongflash noflash",function(){ZeroClipboard.destroy()})}return{bindEvents:{ready:function(){if(!browser.ie){if(window.ZeroClipboard){e()}else{utils.loadFile(document,{src:r.options.UEDITOR_HOME_URL+"third-party/zeroclipboard/ZeroClipboard.js",tag:"script",type:"text/javascript",defer:"defer"},function(){e()})}}}},commands:{copy:{execCommand:function(e){if(!r.document.execCommand("copy")){alert(r.getLang("copymsg"))}}}}}});UE.plugins["paste"]=function(){function t(n){var r=this.document;if(r.getElementById("baidu_pastebin")){return}var o=this.selection.getRange(),a=o.createBookmark(),s=r.createElement("div");s.id="baidu_pastebin";browser.webkit&&s.appendChild(r.createTextNode(domUtils.fillChar+domUtils.fillChar));r.body.appendChild(s);a.start.style.display="";s.style.cssText="position:absolute;width:1px;height:1px;overflow:hidden;left:-1000px;white-space:nowrap;top:"+domUtils.getXY(a.start).y+"px";o.selectNodeContents(s).select(true);setTimeout(function(){if(browser.webkit){for(var e=0,t=r.querySelectorAll("#baidu_pastebin"),i;i=t[e++];){if(domUtils.isEmptyNode(i)){domUtils.remove(i)}else{s=i;break}}}try{s.parentNode.removeChild(s)}catch(e){}o.moveToBookmark(a).select(true);n(s)},0)}var v=this;v.setOpt({retainOnlyLabelPasted:false});var b,y,C;function w(e){return e.replace(/<(\/?)([\w\-]+)([^>]*)>/gi,function(e,t,i,n){i=i.toLowerCase();if({img:1}[i]){return e}n=n.replace(/([\w\-]*?)\s*=\s*(("([^"]*)")|('([^']*)')|([^\s>]+))/gi,function(e,t,i){if({src:1,href:1,name:1}[t.toLowerCase()]){return t+"="+i+" "}return""});if({span:1,div:1}[i]){return""}else{return"<"+t+i+" "+utils.trim(n)+">"}})}function i(e){var t;if(e.firstChild){var i=domUtils.getElementsByTagName(e,"span");for(var n=0,r;r=i[n++];){if(r.id=="_baidu_cut_start"||r.id=="_baidu_cut_end"){domUtils.remove(r)}}if(browser.webkit){var o=e.querySelectorAll("div br");for(var n=0,a;a=o[n++];){var s=a.parentNode;if(s.tagName=="DIV"&&s.childNodes.length==1){s.innerHTML='<p class="ueditor-p"><br/></p>';domUtils.remove(s)}}var l=e.querySelectorAll("#baidu_pastebin");for(var n=0,d;d=l[n++];){var u=v.document.createElement("p");u.className="ueditor-p";d.parentNode.insertBefore(u,d);while(d.firstChild){u.appendChild(d.firstChild)}domUtils.remove(d)}var c=e.querySelectorAll("meta");for(var n=0,f;f=c[n++];){domUtils.remove(f)}var o=e.querySelectorAll("br");for(n=0;f=o[n++];){if(/^apple-/i.test(f.className)){domUtils.remove(f)}}}if(browser.gecko){var m=e.querySelectorAll("[_moz_dirty]");for(n=0;f=m[n++];){f.removeAttribute("_moz_dirty")}}if(!browser.ie){var h=e.querySelectorAll("span.Apple-style-span");for(var n=0,f;f=h[n++];){domUtils.remove(f,true)}}t=e.innerHTML;t=UE.filterWord(t);var p=UE.htmlparser(t);if(v.options.filterRules){UE.filterNode(p,v.options.filterRules)}v.filterInputRule(p);if(browser.webkit){var g=p.lastChild();if(g&&g.type=="element"&&g.tagName=="br"){p.removeChild(g)}utils.each(v.body.querySelectorAll("div"),function(e){if(domUtils.isEmptyBlock(e)){domUtils.remove(e,true)}})}t={html:p.toHtml()};v.fireEvent("beforepaste",t,p);if(!t.html){return}p=UE.htmlparser(t.html,true);if(v.queryCommandState("pasteplain")===1){v.execCommand("insertHtml",UE.filterNode(p,v.options.filterTxtRules).toHtml(),true)}else{UE.filterNode(p,v.options.filterTxtRules);b=p.toHtml();y=t.html;C=v.selection.getRange().createAddress(true);v.execCommand("insertHtml",v.getOpt("retainOnlyLabelPasted")===true?w(y):y,true)}v.fireEvent("afterpaste",t)}}v.addListener("pasteTransfer",function(e,t){if(C&&b&&y&&b!=y){var i=v.selection.getRange();i.moveToAddress(C,true);if(!i.collapsed){while(!domUtils.isBody(i.startContainer)){var n=i.startContainer;if(n.nodeType==1){n=n.childNodes[i.startOffset];if(!n){i.setStartBefore(i.startContainer);continue}var r=n.previousSibling;if(r&&r.nodeType==3&&new RegExp("^[\n\r\t "+domUtils.fillChar+"]*$").test(r.nodeValue)){i.setStartBefore(r)}}if(i.startOffset==0){i.setStartBefore(i.startContainer)}else{break}}while(!domUtils.isBody(i.endContainer)){var o=i.endContainer;if(o.nodeType==1){o=o.childNodes[i.endOffset];if(!o){i.setEndAfter(i.endContainer);continue}var a=o.nextSibling;if(a&&a.nodeType==3&&new RegExp("^[\n\r\t"+domUtils.fillChar+"]*$").test(a.nodeValue)){i.setEndAfter(a)}}if(i.endOffset==i.endContainer[i.endContainer.nodeType==3?"nodeValue":"childNodes"].length){i.setEndAfter(i.endContainer)}else{break}}}i.deleteContents();i.select(true);v.__hasEnterExecCommand=true;var s=y;if(t===2){s=w(s)}else if(t){s=b}v.execCommand("inserthtml",s,true);v.__hasEnterExecCommand=false;var l=v.selection.getRange();while(!domUtils.isBody(l.startContainer)&&!l.startOffset&&l.startContainer[l.startContainer.nodeType==3?"nodeValue":"childNodes"].length){l.setStartBefore(l.startContainer)}var d=l.createAddress(true);C.endAddress=d.startAddress}});v.addListener("ready",function(){domUtils.on(v.body,"cut",function(){var e=v.selection.getRange();if(!e.collapsed&&v.undoManger){v.undoManger.save()}});domUtils.on(v.body,browser.ie||browser.opera?"keydown":"paste",function(e){if((browser.ie||browser.opera)&&(!e.ctrlKey&&!e.metaKey||e.keyCode!="86")){return}t.call(v,function(e){i(e)})})});v.commands["paste"]={execCommand:function(e){if(browser.ie){t.call(v,function(e){i(e)});v.document.execCommand("paste")}else{alert(v.getLang("pastemsg"))}}}};UE.plugins["pasteplain"]=function(){var e=this;e.setOpt({pasteplain:false,filterTxtRules:function(){function e(e){e.tagName="p";e.setStyle()}function t(e){e.parentNode.removeChild(e,true)}return{"-":"script style object iframe embed input select",p:{$:{}},br:{$:{}},div:function(e){var t,i=UE.uNode.createElement("p");i.className="ueditor-p";while(t=e.firstChild()){if(t.type=="text"||!UE.dom.dtd.$block[t.tagName]){i.appendChild(t)}else{if(i.firstChild()){e.parentNode.insertBefore(i,e);i=UE.uNode.createElement("p");i.className="ueditor-p"}else{e.parentNode.insertBefore(t,e)}}}if(i.firstChild()){e.parentNode.insertBefore(i,e)}e.parentNode.removeChild(e)},ol:t,ul:t,dl:t,dt:t,dd:t,li:t,caption:e,th:e,tr:e,h1:e,h2:e,h3:e,h4:e,h5:e,h6:e,td:function(e){var t=!!e.innerText();if(t){e.parentNode.insertAfter(UE.uNode.createText(" &nbsp; &nbsp;"),e)}e.parentNode.removeChild(e,e.innerText())}}}()});var t=e.options.pasteplain;e.commands["pasteplain"]={queryCommandState:function(){return t?1:0},execCommand:function(){t=!t|0},notNeedUndo:1}};UE.plugins["list"]=function(){var C=this,A={TD:1,PRE:1,BLOCKQUOTE:1};var u={cn:"cn-1-",cn1:"cn-2-",cn2:"cn-3-",num:"num-1-",num1:"num-2-",num2:"num-3-",dash:"dash",dot:"dot"};C.setOpt({autoTransWordToList:false,insertorderedlist:{num:"",num1:"",num2:"",cn:"",cn1:"",cn2:"",decimal:"","lower-alpha":"","lower-roman":"","upper-alpha":"","upper-roman":""},insertunorderedlist:{circle:"",disc:"",square:"",dash:"",dot:""},listDefaultPaddingLeft:"30",listiconpath:"http://bs.baidu.com/listicon/",maxListLevel:-1,disablePInList:false});function e(e){var t=[];for(var i in e){t.push(i)}return t}var h={OL:e(C.options.insertorderedlist),UL:e(C.options.insertunorderedlist)};var n=C.options.listiconpath;for(var t in u){if(!C.options.insertorderedlist.hasOwnProperty(t)&&!C.options.insertunorderedlist.hasOwnProperty(t)){delete u[t]}}C.ready(function(){var e=[];for(var t in u){if(t=="dash"||t=="dot"){e.push("li.list-"+u[t]+"{background-image:url("+n+u[t]+".gif)}");e.push("ul.custom_"+t+"{list-style:none;}ul.custom_"+t+" li{background-position:0 3px;background-repeat:no-repeat}")}else{for(var i=0;i<99;i++){e.push("li.list-"+u[t]+i+"{background-image:url("+n+"list-"+u[t]+i+".gif)}")}e.push("ol.custom_"+t+"{list-style:none;}ol.custom_"+t+" li{background-position:0 3px;background-repeat:no-repeat}")}switch(t){case"cn":e.push("li.list-"+t+"-paddingleft-1{padding-left:25px}");e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}");e.push("li.list-"+t+"-paddingleft-3{padding-left:55px}");break;case"cn1":e.push("li.list-"+t+"-paddingleft-1{padding-left:30px}");e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}");e.push("li.list-"+t+"-paddingleft-3{padding-left:55px}");break;case"cn2":e.push("li.list-"+t+"-paddingleft-1{padding-left:40px}");e.push("li.list-"+t+"-paddingleft-2{padding-left:55px}");e.push("li.list-"+t+"-paddingleft-3{padding-left:68px}");break;case"num":case"num1":e.push("li.list-"+t+"-paddingleft-1{padding-left:25px}");break;case"num2":e.push("li.list-"+t+"-paddingleft-1{padding-left:35px}");e.push("li.list-"+t+"-paddingleft-2{padding-left:40px}");break;case"dash":e.push("li.list-"+t+"-paddingleft{padding-left:35px}");break;case"dot":e.push("li.list-"+t+"-paddingleft{padding-left:20px}")}}e.push(".list-paddingleft-1{padding-left:0}");e.push(".list-paddingleft-2{padding-left:"+C.options.listDefaultPaddingLeft+"px}");e.push(".list-paddingleft-3{padding-left:"+C.options.listDefaultPaddingLeft*2+"px}");utils.cssRule("list","ol,ul{margin:0;pading:0;"+(browser.ie?"":"width:95%")+"}li{clear:both;}"+e.join("\n"),C.document)});C.ready(function(){domUtils.on(C.body,"cut",function(){setTimeout(function(){var e=C.selection.getRange(),t;if(!e.collapsed){if(t=domUtils.findParentByTagName(e.startContainer,"li",true)){if(!t.nextSibling&&domUtils.isEmptyBlock(t)){var i=t.parentNode,n;if(n=i.previousSibling){domUtils.remove(i);e.setStartAtLast(n).collapse(true);e.select(true)}else if(n=i.nextSibling){domUtils.remove(i);e.setStartAtFirst(n).collapse(true);e.select(true)}else{var r=C.document.createElement("p");r.className="ueditor-p";domUtils.fillNode(C.document,r);i.parentNode.insertBefore(r,i);domUtils.remove(i);e.setStart(r,0).collapse(true);e.select(true)}}}}})})});function R(e){var t=e.className;if(domUtils.hasClass(e,/custom_/)){return t.match(/custom_(\w+)/)[1]}return domUtils.getStyle(e,"list-style-type")}C.addListener("beforepaste",function(r,e){var t=this,i=t.selection.getRange(),n;var o=UE.htmlparser(e.html,true);if(n=domUtils.findParentByTagName(i.startContainer,"li",true)){var a=n.parentNode,s=a.tagName=="OL"?"ul":"ol";utils.each(o.getNodesByTagName(s),function(e){e.tagName=a.tagName;e.setAttr();if(e.parentNode===o){r=R(a)||(a.tagName=="OL"?"decimal":"disc")}else{var t=e.parentNode.getAttr("class");if(t&&/custom_/.test(t)){r=t.match(/custom_(\w+)/)[1]}else{r=e.parentNode.getStyle("list-style-type")}if(!r){r=a.tagName=="OL"?"decimal":"disc"}}var i=utils.indexOf(h[a.tagName],r);if(e.parentNode!==o)i=i+1==h[a.tagName].length?0:i+1;var n=h[a.tagName][i];if(u[n]){e.setAttr("class","custom_"+n)}else{e.setStyle("list-style-type",n)}})}e.html=o.toHtml()});C.getOpt("disablePInList")===true&&C.addOutputRule(function(e){utils.each(e.getNodesByTagName("li"),function(n){var r=[],o=0;utils.each(n.children,function(e){if(e.tagName=="p"){var t;while(t=e.children.pop()){r.splice(o,0,t);t.parentNode=n;lastNode=t}t=r[r.length-1];if(!t||t.type!="element"||t.tagName!="br"){var i=UE.uNode.createElement("br");i.parentNode=n;r.push(i)}o=r.length}});if(r.length){n.children=r}})});C.addInputRule(function(e){utils.each(e.getNodesByTagName("li"),function(e){var t=UE.uNode.createElement("p");t.className="ueditor-p";for(var i=0,n;n=e.children[i];){if(n.type=="text"||dtd.p[n.tagName]){t.appendChild(n)}else{if(t.firstChild()){e.insertBefore(t,n);t=UE.uNode.createElement("p");t.className="ueditor-p";i=i+2}else{i++}}}if(t.firstChild()&&!t.parentNode||!e.firstChild()){e.appendChild(t)}if(!t.firstChild()){t.innerHTML(browser.ie?"&nbsp;":"<br/>")}var r=e.firstChild();var o=r.lastChild();if(o&&o.type=="text"&&/^\s*$/.test(o.data)){r.removeChild(o)}});if(C.options.autoTransWordToList){var s={num1:/^\d+\)/,decimal:/^\d+\./,"lower-alpha":/^[a-z]+\)/,"upper-alpha":/^[A-Z]+\./,cn:/^[\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+[\u3001]/,cn2:/^\([\u4E00\u4E8C\u4E09\u56DB\u516d\u4e94\u4e03\u516b\u4e5d]+\)/},r={square:"n"};function l(e,t){var i=t.firstChild();if(i&&i.type=="element"&&i.tagName=="span"&&/Wingdings|Symbol/.test(i.getStyle("font-family"))){for(var n in r){if(r[n]==i.data){return n}}return"disc"}for(var n in s){if(s[n].test(e)){return n}}}utils.each(e.getNodesByTagName("p"),function(e){if(e.getAttr("class")!="MsoListParagraph"){return}e.setStyle("margin","");e.setStyle("margin-left","");e.setAttr("class","");function t(e,t,i){if(e.tagName=="ol"){if(browser.ie){var n=t.firstChild();if(n.type=="element"&&n.tagName=="span"&&s[i].test(n.innerText())){t.removeChild(n)}}else{t.innerHTML(t.innerHTML().replace(s[i],""))}}else{t.removeChild(t.firstChild())}var r=UE.uNode.createElement("li");r.appendChild(t);e.appendChild(r)}var i=e,n,r=e;if(e.parentNode.tagName!="li"&&(n=l(e.innerText(),e))){var o=UE.uNode.createElement(C.options.insertorderedlist.hasOwnProperty(n)?"ol":"ul");if(u[n]){o.setAttr("class","custom_"+n)}else{o.setStyle("list-style-type",n)}while(e&&e.parentNode.tagName!="li"&&l(e.innerText(),e)){i=e.nextSibling();if(!i){e.parentNode.insertBefore(o,e)}t(o,e,n);e=i}if(!o.parentNode&&e&&e.parentNode){e.parentNode.insertBefore(o,e)}}var a=r.firstChild();if(a&&a.type=="element"&&a.tagName=="span"&&/^\s*(&nbsp;)+\s*$/.test(a.innerText())){a.parentNode.removeChild(a)}})}});C.addListener("contentchange",function(){a(C.document)});function a(l,d){utils.each(domUtils.getElementsByTagName(l,"ol ul"),function(r){if(!domUtils.inDoc(r,l))return;var e=r.parentNode;if(e.tagName==r.tagName){var t=R(r)||(r.tagName=="OL"?"decimal":"disc"),i=R(e)||(e.tagName=="OL"?"decimal":"disc");if(t==i){var n=utils.indexOf(h[r.tagName],t);n=n+1==h[r.tagName].length?0:n+1;D(r,h[r.tagName][n])}}var o=0,a=2;if(domUtils.hasClass(r,/custom_/)){if(!(/[ou]l/i.test(e.tagName)&&domUtils.hasClass(e,/custom_/))){a=1}}else{if(/[ou]l/i.test(e.tagName)&&domUtils.hasClass(e,/custom_/)){a=3}}var s=domUtils.getStyle(r,"list-style-type");s&&(r.style.cssText="list-style-type:"+s);r.className=utils.trim(r.className.replace(/list-paddingleft-\w+/,""))+" list-paddingleft-"+a;utils.each(domUtils.getElementsByTagName(r,"li"),function(e){e.style.cssText&&(e.style.cssText="");if(!e.firstChild){domUtils.remove(e);return}if(e.parentNode!==r){return}o++;if(domUtils.hasClass(r,/custom_/)){var t=1,i=R(r);if(r.tagName=="OL"){if(i){switch(i){case"cn":case"cn1":case"cn2":if(o>10&&(o%10==0||o>10&&o<20)){t=2}else if(o>20){t=3}break;case"num2":if(o>9){t=2}}}e.className="list-"+u[i]+o+" "+"list-"+i+"-paddingleft-"+t}else{e.className="list-"+u[i]+" "+"list-"+i+"-paddingleft"}}else{e.className=e.className.replace(/list-[\w\-]+/gi,"")}var n=e.getAttribute("class");if(n!==null&&!n.replace(/\s/g,"")){domUtils.removeAttributes(e,"class")}});!d&&L(r,r.tagName.toLowerCase(),R(r)||domUtils.getStyle(r,"list-style-type"),true)})}function L(e,t,i,n){var r=e.nextSibling;if(r&&r.nodeType==1&&r.tagName.toLowerCase()==t&&(R(r)||domUtils.getStyle(r,"list-style-type")||(t=="ol"?"decimal":"disc"))==i){domUtils.moveChild(r,e);if(r.childNodes.length==0){domUtils.remove(r)}}if(r&&domUtils.isFillChar(r)){domUtils.remove(r)}var o=e.previousSibling;if(o&&o.nodeType==1&&o.tagName.toLowerCase()==t&&(R(o)||domUtils.getStyle(o,"list-style-type")||(t=="ol"?"decimal":"disc"))==i){domUtils.moveChild(e,o)}if(o&&domUtils.isFillChar(o)){domUtils.remove(o)}!n&&domUtils.isEmptyBlock(e)&&domUtils.remove(e);if(R(e)){a(e.ownerDocument,true)}}function D(e,t){if(u[t]){e.className="custom_"+t}try{domUtils.setStyle(e,"list-style-type",t)}catch(e){}}function w(e){var t=e.previousSibling;if(t&&domUtils.isEmptyBlock(t)){domUtils.remove(t)}t=e.nextSibling;if(t&&domUtils.isEmptyBlock(t)){domUtils.remove(t)}}C.addListener("keydown",function(e,t){function i(){t.preventDefault?t.preventDefault():t.returnValue=false;C.fireEvent("contentchange");C.undoManger&&C.undoManger.save()}function n(e,t){while(e&&!domUtils.isBody(e)){if(t(e)){return null}if(e.nodeType==1&&/[ou]l/i.test(e.tagName)){return e}e=e.parentNode}return null}var r=t.keyCode||t.which;if(r==13&&!t.shiftKey){var o=C.selection.getRange(),a=domUtils.findParent(o.startContainer,function(e){return domUtils.isBlockElm(e)},true),s=domUtils.findParentByTagName(o.startContainer,"li",true);if(a&&a.tagName!="PRE"&&!s){var l=a.innerHTML.replace(new RegExp(domUtils.fillChar,"g"),"");if(/^\s*1\s*\.[^\d]/.test(l)){a.innerHTML=l.replace(/^\s*1\s*\./,"");o.setStartAtLast(a).collapse(true).select();C.__hasEnterExecCommand=true;C.execCommand("insertorderedlist");C.__hasEnterExecCommand=false}}var d=C.selection.getRange(),u=n(d.startContainer,function(e){return e.tagName=="TABLE"}),c=d.collapsed?u:n(d.endContainer,function(e){return e.tagName=="TABLE"});if(u&&c&&u===c){if(!d.collapsed){u=domUtils.findParentByTagName(d.startContainer,"li",true);c=domUtils.findParentByTagName(d.endContainer,"li",true);if(u&&c&&u===c){d.deleteContents();s=domUtils.findParentByTagName(d.startContainer,"li",true);if(s&&domUtils.isEmptyBlock(s)){y=s.previousSibling;next=s.nextSibling;g=C.document.createElement("p");g.className="ueditor-p";domUtils.fillNode(C.document,g);h=s.parentNode;if(y&&next){d.setStart(next,0).collapse(true).select(true);domUtils.remove(s)}else{if(!y&&!next||!y){h.parentNode.insertBefore(g,h)}else{s.parentNode.parentNode.insertBefore(g,h.nextSibling)}domUtils.remove(s);if(!h.firstChild){domUtils.remove(h)}d.setStart(g,0).setCursor()}i();return}}else{var f=d.cloneRange(),m=f.collapse(false).createBookmark();d.deleteContents();f.moveToBookmark(m);var s=domUtils.findParentByTagName(f.startContainer,"li",true);w(s);f.select();i();return}}s=domUtils.findParentByTagName(d.startContainer,"li",true);if(s){if(domUtils.isEmptyBlock(s)){m=d.createBookmark();var h=s.parentNode;if(s!==h.lastChild){domUtils.breakParent(s,h);w(s)}else{h.parentNode.insertBefore(s,h.nextSibling);if(domUtils.isEmptyNode(h)){domUtils.remove(h)}}if(!dtd.$list[s.parentNode.tagName]){if(!domUtils.isBlockElm(s.firstChild)){g=C.document.createElement("p");g.className="ueditor-p";s.parentNode.insertBefore(g,s);while(s.firstChild){g.appendChild(s.firstChild)}domUtils.remove(s)}else{domUtils.remove(s,true)}}d.moveToBookmark(m).select()}else{var p=s.firstChild;if(!p||!domUtils.isBlockElm(p)){var g=C.document.createElement("p");g.className="ueditor-p";!s.firstChild&&domUtils.fillNode(C.document,g);while(s.firstChild){g.appendChild(s.firstChild)}s.appendChild(g);p=g}var v=C.document.createElement("span");d.insertNode(v);domUtils.breakParent(v,s);var b=v.nextSibling;p=b.firstChild;if(!p){g=C.document.createElement("p");g.className="ueditor-p";domUtils.fillNode(C.document,g);b.appendChild(g);p=g}if(domUtils.isEmptyNode(p)){p.innerHTML="";domUtils.fillNode(C.document,p)}d.setStart(p,0).collapse(true).shrinkBoundary().select();domUtils.remove(v);var y=b.previousSibling;if(y&&domUtils.isEmptyBlock(y)){y.innerHTML='<p class="ueditor-p"></p>';domUtils.fillNode(C.document,y.firstChild)}}i()}}}if(r==8){d=C.selection.getRange();if(d.collapsed&&domUtils.isStartInblock(d)){f=d.cloneRange().trimBoundary();s=domUtils.findParentByTagName(d.startContainer,"li",true);if(s&&domUtils.isStartInblock(f)){u=domUtils.findParentByTagName(d.startContainer,"p",true);if(u&&u!==s.firstChild){var h=domUtils.findParentByTagName(u,["ol","ul"]);domUtils.breakParent(u,h);w(u);C.fireEvent("contentchange");d.setStart(u,0).setCursor(false,true);C.fireEvent("saveScene");domUtils.preventDefault(t);return}if(s&&(y=s.previousSibling)){if(r==46&&s.childNodes.length){return}if(dtd.$list[y.tagName]){y=y.lastChild}C.undoManger&&C.undoManger.save();p=s.firstChild;if(domUtils.isBlockElm(p)){if(domUtils.isEmptyNode(p)){y.appendChild(p);d.setStart(p,0).setCursor(false,true);while(s.firstChild){y.appendChild(s.firstChild)}}else{v=C.document.createElement("span");d.insertNode(v);if(domUtils.isEmptyBlock(y)){y.innerHTML=""}domUtils.moveChild(s,y);d.setStartBefore(v).collapse(true).select(true);domUtils.remove(v)}}else{if(domUtils.isEmptyNode(s)){var g=C.document.createElement("p");g.className="ueditor-p";y.appendChild(g);d.setStart(g,0).setCursor()}else{d.setEnd(y,y.childNodes.length).collapse().select(true);while(s.firstChild){y.appendChild(s.firstChild)}}}domUtils.remove(s);C.fireEvent("contentchange");C.fireEvent("saveScene");domUtils.preventDefault(t);return}if(s&&!s.previousSibling){var h=s.parentNode;var m=d.createBookmark();if(domUtils.isTagNode(h.parentNode,"ol ul")){h.parentNode.insertBefore(s,h);if(domUtils.isEmptyNode(h)){domUtils.remove(h)}}else{while(s.firstChild){h.parentNode.insertBefore(s.firstChild,h)}domUtils.remove(s);if(domUtils.isEmptyNode(h)){domUtils.remove(h)}}d.moveToBookmark(m).setCursor(false,true);C.fireEvent("contentchange");C.fireEvent("saveScene");domUtils.preventDefault(t);return}}}}});C.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(i==8){var n=C.selection.getRange(),r;if(r=domUtils.findParentByTagName(n.startContainer,["ol","ul"],true)){L(r,r.tagName.toLowerCase(),R(r)||domUtils.getComputedStyle(r,"list-style-type"),true)}}});C.addListener("tabkeydown",function(){var e=C.selection.getRange();function t(e){if(C.options.maxListLevel!=-1){var t=e.parentNode,i=0;while(/[ou]l/i.test(t.tagName)){i++;t=t.parentNode}if(i>=C.options.maxListLevel){return true}}}var i=domUtils.findParentByTagName(e.startContainer,"li",true);if(i){var n;if(e.collapsed){if(t(i))return true;var r=i.parentNode,o=C.document.createElement(r.tagName),a=utils.indexOf(h[o.tagName],R(r)||domUtils.getComputedStyle(r,"list-style-type"));a=a+1==h[o.tagName].length?0:a+1;var s=h[o.tagName][a];D(o,s);if(domUtils.isStartInblock(e)){C.fireEvent("saveScene");n=e.createBookmark();r.insertBefore(o,i);o.appendChild(i);L(o,o.tagName.toLowerCase(),s);C.fireEvent("contentchange");e.moveToBookmark(n).select(true);return true}}else{C.fireEvent("saveScene");n=e.createBookmark();for(var l=0,d,u=domUtils.findParents(i),c;c=u[l++];){if(domUtils.isTagNode(c,"ol ul")){d=c;break}}var f=i;if(n.end){while(f&&!(domUtils.getPosition(f,n.end)&domUtils.POSITION_FOLLOWING)){if(t(f)){f=domUtils.getNextDomNode(f,false,null,function(e){return e!==d});continue}var r=f.parentNode,o=C.document.createElement(r.tagName),a=utils.indexOf(h[o.tagName],R(r)||domUtils.getComputedStyle(r,"list-style-type"));var m=a+1==h[o.tagName].length?0:a+1;var s=h[o.tagName][m];D(o,s);r.insertBefore(o,f);while(f&&!(domUtils.getPosition(f,n.end)&domUtils.POSITION_FOLLOWING)){i=f.nextSibling;o.appendChild(f);if(!i||domUtils.isTagNode(i,"ol ul")){if(i){while(i=i.firstChild){if(i.tagName=="LI"){break}}}else{i=domUtils.getNextDomNode(f,false,null,function(e){return e!==d})}break}f=i}L(o,o.tagName.toLowerCase(),s);f=i}}C.fireEvent("contentchange");e.moveToBookmark(n).select();return true}}});function O(e){while(e&&!domUtils.isBody(e)){if(e.nodeName=="TABLE"){return null}if(e.nodeName=="LI"){return e}e=e.parentNode}}C.commands["insertorderedlist"]=C.commands["insertunorderedlist"]={execCommand:function(e,t){if(!t){t=e.toLowerCase()=="insertorderedlist"?"decimal":"disc"}var i=this,n=this.selection.getRange(),r=function(e){return e.nodeType==1?e.tagName.toLowerCase()!="br":!domUtils.isWhitespace(e)},o=e.toLowerCase()=="insertorderedlist"?"ol":"ul",a=i.document.createDocumentFragment();n.adjustmentBoundary().shrinkBoundary();var s=n.createBookmark(true),l=O(i.document.getElementById(s.start)),d=0,u=O(i.document.getElementById(s.end)),c=0,f,m,h,p;if(l||u){l&&(f=l.parentNode);if(!s.end){u=l}u&&(m=u.parentNode);if(f===m){while(l!==u){p=l;l=l.nextSibling;if(!domUtils.isBlockElm(p.firstChild)){var g=i.document.createElement("p");g.className="ueditor-p";while(p.firstChild){g.appendChild(p.firstChild)}p.appendChild(g)}a.appendChild(p)}p=i.document.createElement("span");f.insertBefore(p,u);if(!domUtils.isBlockElm(u.firstChild)){g=i.document.createElement("p");g.className="ueditor-p";while(u.firstChild){g.appendChild(u.firstChild)}u.appendChild(g)}a.appendChild(u);domUtils.breakParent(p,f);if(domUtils.isEmptyNode(p.previousSibling)){domUtils.remove(p.previousSibling)}if(domUtils.isEmptyNode(p.nextSibling)){domUtils.remove(p.nextSibling)}var v=R(f)||domUtils.getComputedStyle(f,"list-style-type")||(e.toLowerCase()=="insertorderedlist"?"decimal":"disc");if(f.tagName.toLowerCase()==o&&v==t){for(var b=0,y,C=i.document.createDocumentFragment();y=a.firstChild;){if(domUtils.isTagNode(y,"ol ul")){C.appendChild(y)}else{while(y.firstChild){C.appendChild(y.firstChild);domUtils.remove(y)}}}p.parentNode.insertBefore(C,p)}else{h=i.document.createElement(o);D(h,t);h.appendChild(a);p.parentNode.insertBefore(h,p)}domUtils.remove(p);h&&L(h,o,t);n.moveToBookmark(s).select();return}if(l){while(l){p=l.nextSibling;if(domUtils.isTagNode(l,"ol ul")){a.appendChild(l)}else{var w=i.document.createDocumentFragment(),N=0;while(l.firstChild){if(domUtils.isBlockElm(l.firstChild)){N=1}w.appendChild(l.firstChild)}if(!N){var x=i.document.createElement("p");x.className="ueditor-p";x.appendChild(w);a.appendChild(x)}else{a.appendChild(w)}domUtils.remove(l)}l=p}f.parentNode.insertBefore(a,f.nextSibling);if(domUtils.isEmptyNode(f)){n.setStartBefore(f);domUtils.remove(f)}else{n.setStartAfter(f)}d=1}if(u&&domUtils.inDoc(m,i.document)){l=m.firstChild;while(l&&l!==u){p=l.nextSibling;if(domUtils.isTagNode(l,"ol ul")){a.appendChild(l)}else{w=i.document.createDocumentFragment();N=0;while(l.firstChild){if(domUtils.isBlockElm(l.firstChild)){N=1}w.appendChild(l.firstChild)}if(!N){x=i.document.createElement("p");x.className="ueditor-p";x.appendChild(w);a.appendChild(x)}else{a.appendChild(w)}domUtils.remove(l)}l=p}var U=domUtils.createElement(i.document,"div",{tmpDiv:1});domUtils.moveChild(u,U);a.appendChild(U);domUtils.remove(u);m.parentNode.insertBefore(a,m);n.setEndBefore(m);if(domUtils.isEmptyNode(m)){domUtils.remove(m)}c=1}}if(!d){n.setStartBefore(i.document.getElementById(s.start))}if(s.end&&!c){n.setEndAfter(i.document.getElementById(s.end))}n.enlarge(true,function(e){return A[e.tagName]});a=i.document.createDocumentFragment();var E=n.createBookmark(),T=domUtils.getNextDomNode(E.start,false,r),S=n.cloneRange(),k,B=domUtils.isBlockElm;while(T&&T!==E.end&&domUtils.getPosition(T,E.end)&domUtils.POSITION_PRECEDING){if(T.nodeType==3||dtd.li[T.tagName]){if(T.nodeType==1&&dtd.$list[T.tagName]){while(T.firstChild){a.appendChild(T.firstChild)}k=domUtils.getNextDomNode(T,false,r);domUtils.remove(T);T=k;continue}k=T;S.setStartBefore(T);while(T&&T!==E.end&&(!B(T)||domUtils.isBookmarkNode(T))){k=T;T=domUtils.getNextDomNode(T,false,null,function(e){return!A[e.tagName]})}if(T&&B(T)){p=domUtils.getNextDomNode(k,false,r);if(p&&domUtils.isBookmarkNode(p)){T=domUtils.getNextDomNode(p,false,r);k=p}}S.setEndAfter(k);T=domUtils.getNextDomNode(k,false,r);var I=n.document.createElement("li");I.appendChild(S.extractContents());if(domUtils.isEmptyNode(I)){var k=n.document.createElement("p");k.className="ueditor-p";while(I.firstChild){k.appendChild(I.firstChild)}I.appendChild(k)}a.appendChild(I)}else{T=domUtils.getNextDomNode(T,true,r)}}n.moveToBookmark(E).collapse(true);h=i.document.createElement(o);D(h,t);h.appendChild(a);n.insertNode(h);L(h,o,t);for(var b=0,y,_=domUtils.getElementsByTagName(h,"div");y=_[b++];){if(y.getAttribute("tmpDiv")){domUtils.remove(y,true)}}n.moveToBookmark(s).select()},queryCommandState:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul";var i=this.selection.getStartElementPath();for(var n=0,r;r=i[n++];){if(r.nodeName=="TABLE"){return 0}if(t==r.nodeName.toLowerCase()){return 1}}return 0},queryCommandValue:function(e){var t=e.toLowerCase()=="insertorderedlist"?"ol":"ul";var i=this.selection.getStartElementPath(),n;for(var r=0,o;o=i[r++];){if(o.nodeName=="TABLE"){n=null;break}if(t==o.nodeName.toLowerCase()){n=o;break}}return n?R(n)||domUtils.getComputedStyle(n,"list-style-type"):null}}};(function(){var n={textarea:function(e,t){var i=t.ownerDocument.createElement("textarea");i.style.cssText="position:absolute;resize:none;width:100%;height:100%;border:0;padding:0;margin:0;overflow-y:auto;";if(browser.ie&&browser.version<8){i.style.width=t.offsetWidth+"px";i.style.height=t.offsetHeight+"px";t.onresize=function(){i.style.width=t.offsetWidth+"px";i.style.height=t.offsetHeight+"px"}}t.appendChild(i);return{setContent:function(e){i.value=e},getContent:function(){return i.value},select:function(){var e;if(browser.ie){e=i.createTextRange();e.collapse(true);e.select()}else{i.setSelectionRange(0,0);i.focus()}},dispose:function(){t.removeChild(i);t.onresize=null;i=null;t=null}}},codemirror:function(e,t){var i=window.CodeMirror(t,{mode:"text/html",tabMode:"indent",lineNumbers:true,lineWrapping:true});var n=i.getWrapperElement();n.style.cssText='position:absolute;left:0;top:0;width:100%;height:100%;font-family:consolas,"Courier new",monospace;font-size:13px;';i.getScrollerElement().style.cssText="position:absolute;left:0;top:0;width:100%;height:100%;";i.refresh();return{getCodeMirror:function(){return i},setContent:function(e){i.setValue(e)},getContent:function(){return i.getValue()},select:function(){i.focus()},dispose:function(){t.removeChild(n);n=null;i=null}}}};UE.plugins["source"]=function(){var o=this;var t=this.options;var a=false;var s;var l;t.sourceEditor=browser.ie?"textarea":t.sourceEditor||"codemirror";o.setOpt({sourceEditorFirst:false});function d(e){return n[t.sourceEditor=="codemirror"&&window.CodeMirror?"codemirror":"textarea"](o,e)}var u;var c,f;o.commands["source"]={execCommand:function(){a=!a;if(a){f=o.selection.getRange().createAddress(false,true);o.undoManger&&o.undoManger.save(true);if(browser.gecko){o.body.contentEditable=false}u=o.iframe.style.cssText;o.iframe.style.cssText+="position:absolute;left:-32768px;top:-32768px;";o.fireEvent("beforegetcontent");var e=UE.htmlparser(o.body.innerHTML);o.filterOutputRule(e);e.traversal(function(e){if(e.type=="element"){switch(e.tagName){case"td":case"th":case"caption":if(e.children&&e.children.length==1){if(e.firstChild().tagName=="br"){e.removeChild(e.firstChild())}};break;case"pre":e.innerText(e.innerText().replace(/&nbsp;/g," "))}}});o.fireEvent("aftergetcontent");var t=e.toHtml(true);s=d(o.iframe.parentNode);s.setContent(t);l=o.setContent;o.setContent=function(e){var t=UE.htmlparser(e);o.filterInputRule(t);e=t.toHtml();s.setContent(e)};setTimeout(function(){s.select();o.addListener("fullscreenchanged",function(){try{s.getCodeMirror().refresh()}catch(e){}})});c=o.getContent;o.getContent=function(){return s.getContent()||'<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>"}}else{o.iframe.style.cssText=u;var i=s.getContent()||'<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>";i=i.replace(new RegExp("[\\r\\t\\n ]*</?(\\w+)\\s*(?:[^>]*)>","g"),function(e,t){if(t&&!dtd.$inlineWithA[t.toLowerCase()]){return e.replace(/(^[\n\r\t ]*)|([\n\r\t ]*$)/g,"")}return e.replace(/(^[\n\r\t]*)|([\n\r\t]*$)/g,"")});o.setContent=l;o.setContent(i);s.dispose();s=null;o.getContent=c;var n=o.body.firstChild;if(!n){o.body.innerHTML='<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>";n=o.body.firstChild}o.undoManger&&o.undoManger.save(true);if(browser.gecko){var r=document.createElement("input");r.style.cssText="position:absolute;left:0;top:-32768px";document.body.appendChild(r);o.body.contentEditable=false;setTimeout(function(){domUtils.setViewportOffset(r,{left:-32768,top:0});r.focus();setTimeout(function(){o.body.contentEditable=true;o.selection.getRange().moveToAddress(f).select(true);domUtils.remove(r)})})}else{try{o.selection.getRange().moveToAddress(f).select(true)}catch(e){}}}this.fireEvent("sourcemodechanged",a)},queryCommandState:function(){return a|0},notNeedUndo:1};var i=o.queryCommandState;o.queryCommandState=function(e){e=e.toLowerCase();if(a){return e in{source:1,fullscreen:1}?1:-1}return i.apply(this,arguments)};if(t.sourceEditor=="codemirror"){o.addListener("ready",function(){utils.loadFile(document,{src:t.codeMirrorJsUrl||t.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.js",tag:"script",type:"text/javascript",defer:"defer"},function(){if(t.sourceEditorFirst){setTimeout(function(){o.execCommand("source")},0)}});utils.loadFile(document,{tag:"link",rel:"stylesheet",type:"text/css",href:t.codeMirrorCssUrl||t.UEDITOR_HOME_URL+"third-party/codemirror/codemirror.css"})})}}})();UE.plugins["enterkey"]=function(){var u,c=this,f=c.options.enterTag;c.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(i==13){var n=c.selection.getRange(),r=n.startContainer,o;if(!browser.ie){if(/h\d/i.test(u)){if(browser.gecko){var a=domUtils.findParentByTagName(r,["h1","h2","h3","h4","h5","h6","blockquote","caption","table"],true);if(!a){c.document.execCommand("formatBlock",false,'<p class="ueditor-p">');o=1}}else{if(r.nodeType==1){var s=c.document.createTextNode(""),l;n.insertNode(s);l=domUtils.findParentByTagName(s,"div",true);if(l){var d=c.document.createElement("p");d.className="ueditor-p";while(l.firstChild){d.appendChild(l.firstChild)}l.parentNode.insertBefore(d,l);domUtils.remove(l);n.setStartBefore(s).setCursor();o=1}domUtils.remove(s)}}if(c.undoManger&&o){c.undoManger.save()}}browser.opera&&n.select()}else{c.fireEvent("saveScene",true,true)}}});c.addListener("keydown",function(e,t){var i=t.keyCode||t.which;if(i==13){if(c.fireEvent("beforeenterkeydown")){domUtils.preventDefault(t);return}c.fireEvent("saveScene",true,true);u="";var n=c.selection.getRange();if(!n.collapsed){var r=n.startContainer,o=n.endContainer,a=domUtils.findParentByTagName(r,"td",true),s=domUtils.findParentByTagName(o,"td",true);if(a&&s&&a!==s||!a&&s||a&&!s){t.preventDefault?t.preventDefault():t.returnValue=false;return}}if(f=="p"){if(!browser.ie){r=domUtils.findParentByTagName(n.startContainer,["ol","ul","p","h1","h2","h3","h4","h5","h6","blockquote","caption"],true);if(!r&&!browser.opera){c.document.execCommand("formatBlock",false,'<p class="ueditor-p">');if(browser.gecko){n=c.selection.getRange();r=domUtils.findParentByTagName(n.startContainer,"p",true);r&&domUtils.removeDirtyAttr(r)}}else{u=r.tagName;r.tagName.toLowerCase()=="p"&&browser.gecko&&domUtils.removeDirtyAttr(r)}}}else{t.preventDefault?t.preventDefault():t.returnValue=false;if(!n.collapsed){n.deleteContents();r=n.startContainer;if(r.nodeType==1&&(r=r.childNodes[n.startOffset])){while(r.nodeType==1){if(dtd.$empty[r.tagName]){n.setStartBefore(r).setCursor();if(c.undoManger){c.undoManger.save()}return false}if(!r.firstChild){var l=n.document.createElement("br");r.appendChild(l);n.setStart(r,0).setCursor();if(c.undoManger){c.undoManger.save()}return false}r=r.firstChild}if(r===n.startContainer.childNodes[n.startOffset]){l=n.document.createElement("br");n.insertNode(l).setCursor()}else{n.setStart(r,0).setCursor()}}else{l=n.document.createElement("br");n.insertNode(l).setStartAfter(l).setCursor()}}else{l=n.document.createElement("br");n.insertNode(l);var d=l.parentNode;if(d.lastChild===l){l.parentNode.insertBefore(l.cloneNode(true),l);n.setStartBefore(l)}else{n.setStartAfter(l)}n.setCursor()}}}})};UE.plugins["keystrokes"]=function(){var y=this;var C=true;y.addListener("keydown",function(e,t){var i=t.keyCode||t.which,n=y.selection.getRange();if(!n.collapsed&&!(t.ctrlKey||t.shiftKey||t.altKey||t.metaKey)&&(i>=65&&i<=90||i>=48&&i<=57||i>=96&&i<=111||{13:1,8:1,46:1}[i])){var r=n.startContainer;if(domUtils.isFillChar(r)){n.setStartBefore(r)}r=n.endContainer;if(domUtils.isFillChar(r)){n.setEndAfter(r)}n.txtToElmBoundary();if(n.endContainer&&n.endContainer.nodeType==1){r=n.endContainer.childNodes[n.endOffset];if(r&&domUtils.isBr(r)){n.setEndAfter(r)}}if(n.startOffset==0){r=n.startContainer;if(domUtils.isBoundaryNode(r,"firstChild")){r=n.endContainer;if(n.endOffset==(r.nodeType==3?r.nodeValue.length:r.childNodes.length)&&domUtils.isBoundaryNode(r,"lastChild")){y.fireEvent("saveScene");y.body.innerHTML='<p class="ueditor-p">'+(browser.ie?"":"<br/>")+"</p>";n.setStart(y.body.firstChild,0).setCursor(false,true);y._selectionChange();return}}}}if(i==keymap.Backspace){n=y.selection.getRange();C=n.collapsed;if(y.fireEvent("delkeydown",t)){return}var o,a;if(n.collapsed&&n.inFillChar()){o=n.startContainer;if(domUtils.isFillChar(o)){n.setStartBefore(o).shrinkBoundary(true).collapse(true);domUtils.remove(o)}else{o.nodeValue=o.nodeValue.replace(new RegExp("^"+domUtils.fillChar),"");n.startOffset--;n.collapse(true).select(true)}}if(o=n.getClosedNode()){y.fireEvent("saveScene");n.setStartBefore(o);domUtils.remove(o);n.setCursor();y.fireEvent("saveScene");domUtils.preventDefault(t);return}if(!browser.ie){o=domUtils.findParentByTagName(n.startContainer,"table",true);a=domUtils.findParentByTagName(n.endContainer,"table",true);if(o&&!a||!o&&a||o!==a){t.preventDefault();return}}}if(i==keymap.Tab){var s={ol:1,ul:1,table:1};if(y.fireEvent("tabkeydown",t)){domUtils.preventDefault(t);return}var l=y.selection.getRange();y.fireEvent("saveScene");for(var d=0,u="",c=y.options.tabSize||4,f=y.options.tabNode||"&nbsp;";d<c;d++){u+=f}var m=y.document.createElement("span");m.innerHTML=u+domUtils.fillChar;if(l.collapsed){l.insertNode(m.cloneNode(true).firstChild).setCursor(true)}else{var h=function(e){return domUtils.isBlockElm(e)&&!s[e.tagName.toLowerCase()]};o=domUtils.findParent(l.startContainer,h,true);a=domUtils.findParent(l.endContainer,h,true);if(o&&a&&o===a){l.deleteContents();l.insertNode(m.cloneNode(true).firstChild).setCursor(true)}else{var p=l.createBookmark();l.enlarge(true);var g=l.createBookmark(),v=domUtils.getNextDomNode(g.start,false,h);while(v&&!(domUtils.getPosition(v,g.end)&domUtils.POSITION_FOLLOWING)){v.insertBefore(m.cloneNode(true).firstChild,v.firstChild);v=domUtils.getNextDomNode(v,false,h)}l.moveToBookmark(g).moveToBookmark(p).select()}}domUtils.preventDefault(t)}if(browser.gecko&&i==46){l=y.selection.getRange();if(l.collapsed){o=l.startContainer;if(domUtils.isEmptyBlock(o)){var b=o.parentNode;while(domUtils.getChildCount(b)==1&&!domUtils.isBody(b)){o=b;b=b.parentNode}if(o===b.lastChild)t.preventDefault();return}}}});y.addListener("keyup",function(e,t){var i=t.keyCode||t.which,n,r=this;if(i==keymap.Backspace){if(r.fireEvent("delkeyup")){return}n=r.selection.getRange();if(n.collapsed){var o,a=["h1","h2","h3","h4","h5","h6"];if(o=domUtils.findParentByTagName(n.startContainer,a,true)){if(domUtils.isEmptyBlock(o)){var s=o.previousSibling;if(s&&s.nodeName!="TABLE"){domUtils.remove(o);n.setStartAtLast(s).setCursor(false,true);return}else{var l=o.nextSibling;if(l&&l.nodeName!="TABLE"){domUtils.remove(o);n.setStartAtFirst(l).setCursor(false,true);return}}}}if(domUtils.isBody(n.startContainer)){var o=domUtils.createElement(r.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});n.insertNode(o).setStart(o,0).setCursor(false,true)}}if(!C&&(n.startContainer.nodeType==3||n.startContainer.nodeType==1&&domUtils.isEmptyBlock(n.startContainer))){if(browser.ie){var d=n.document.createElement("span");n.insertNode(d).setStartBefore(d).collapse(true);n.select();domUtils.remove(d)}else{n.select()}}}})};UE.plugins["fiximgclick"]=function(){var n=false;function d(){this.editor=null;this.resizer=null;this.cover=null;this.doc=document;this.prePos={x:0,y:0};this.startPos={x:0,y:0}}(function(){var o=[[0,0,-1,-1],[0,0,0,-1],[0,0,1,-1],[0,0,-1,0],[0,0,1,0],[0,0,-1,1],[0,0,0,1],[0,0,1,1]];d.prototype={init:function(e){var t=this;t.editor=e;t.startPos=this.prePos={x:0,y:0};t.dragId=-1;var i=[],n=t.cover=document.createElement("div"),r=t.resizer=document.createElement("div");n.id=t.editor.ui.id+"_imagescale_cover";n.style.cssText="position:absolute;display:none;z-index:"+t.editor.options.zIndex+";filter:alpha(opacity=0); opacity:0;background:#CCC;";domUtils.on(n,"mousedown click",function(){t.hide()});for(var o=0;o<8;o++){i.push('<span class="edui-editor-imagescale-hand'+o+'"></span>')}r.id=t.editor.ui.id+"_imagescale";r.className="edui-editor-imagescale";r.innerHTML=i.join("");r.style.cssText+=";display:none;border:1px solid #3b77ff;z-index:"+t.editor.options.zIndex+";";t.editor.ui.getDom().appendChild(n);t.editor.ui.getDom().appendChild(r);t.initStyle();t.initEvents()},initStyle:function(){utils.cssRule("imagescale",".edui-editor-imagescale{display:none;position:absolute;border:1px solid #38B2CE;cursor:hand;-webkit-box-sizing: content-box;-moz-box-sizing: content-box;box-sizing: content-box;}"+".edui-editor-imagescale span{position:absolute;width:6px;height:6px;overflow:hidden;font-size:0px;display:block;background-color:#3C9DD0;}"+".edui-editor-imagescale .edui-editor-imagescale-hand0{cursor:nw-resize;top:0;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand1{cursor:n-resize;top:0;margin-top:-4px;left:50%;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand2{cursor:ne-resize;top:0;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand3{cursor:w-resize;top:50%;margin-top:-4px;left:0;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand4{cursor:e-resize;top:50%;margin-top:-4px;left:100%;margin-left:-3px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand5{cursor:sw-resize;top:100%;margin-top:-3px;left:0;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand6{cursor:s-resize;top:100%;margin-top:-3px;left:50%;margin-left:-4px;}"+".edui-editor-imagescale .edui-editor-imagescale-hand7{cursor:se-resize;top:100%;margin-top:-3px;left:100%;margin-left:-3px;}")},initEvents:function(){var e=this;e.startPos.x=e.startPos.y=0;e.isDraging=false},_eventHandler:function(e){var t=this;switch(e.type){case"mousedown":var i=e.target||e.srcElement,i;if(i.className.indexOf("edui-editor-imagescale-hand")!=-1&&t.dragId==-1){t.dragId=i.className.slice(-1);t.startPos.x=t.prePos.x=e.clientX;t.startPos.y=t.prePos.y=e.clientY;domUtils.on(t.doc,"mousemove",t.proxy(t._eventHandler,t))}break;case"mousemove":if(t.dragId!=-1){t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y});t.prePos.x=e.clientX;t.prePos.y=e.clientY;n=true;t.updateTargetElement()}break;case"mouseup":if(t.dragId!=-1){t.updateContainerStyle(t.dragId,{x:e.clientX-t.prePos.x,y:e.clientY-t.prePos.y});t.updateTargetElement();if(t.target.parentNode)t.attachTo(t.target);t.dragId=-1}domUtils.un(t.doc,"mousemove",t.proxy(t._eventHandler,t));if(n){n=false;t.editor.fireEvent("contentchange")}break;default:break}},updateTargetElement:function(){var e=this;domUtils.setStyles(e.target,{width:e.resizer.style.width,height:e.resizer.style.height});e.target.width=parseInt(e.resizer.style.width);e.target.height=parseInt(e.resizer.style.height);e.attachTo(e.target)},updateContainerStyle:function(e,t){var i=this,n=i.resizer,r;if(o[e][0]!=0){r=parseInt(n.style.left)+t.x;n.style.left=i._validScaledProp("left",r)+"px"}if(o[e][1]!=0){r=parseInt(n.style.top)+t.y;n.style.top=i._validScaledProp("top",r)+"px"}if(o[e][2]!=0){r=n.clientWidth+o[e][2]*t.x;n.style.width=i._validScaledProp("width",r)+"px"}if(o[e][3]!=0){r=n.clientHeight+o[e][3]*t.y;n.style.height=i._validScaledProp("height",r)+"px"}},_validScaledProp:function(e,t){var i=this.resizer,n=document;t=isNaN(t)?0:t;switch(e){case"left":return t<0?0:t+i.clientWidth>n.clientWidth?n.clientWidth-i.clientWidth:t;case"top":return t<0?0:t+i.clientHeight>n.clientHeight?n.clientHeight-i.clientHeight:t;case"width":return t<=0?1:t+i.offsetLeft>n.clientWidth?n.clientWidth-i.offsetLeft:t;case"height":return t<=0?1:t+i.offsetTop>n.clientHeight?n.clientHeight-i.offsetTop:t}},hideCover:function(){this.cover.style.display="none"},showCover:function(){var e=this,t=domUtils.getXY(e.editor.ui.getDom()),i=domUtils.getXY(e.editor.iframe);domUtils.setStyles(e.cover,{width:e.editor.iframe.offsetWidth+"px",height:e.editor.iframe.offsetHeight+"px",top:i.y-t.y+"px",left:i.x-t.x+"px",position:"absolute",display:""})},show:function(e){var t=this;t.resizer.style.display="block";if(e)t.attachTo(e);domUtils.on(this.resizer,"mousedown",t.proxy(t._eventHandler,t));domUtils.on(t.doc,"mouseup",t.proxy(t._eventHandler,t));t.showCover();t.editor.fireEvent("afterscaleshow",t);t.editor.fireEvent("saveScene")},hide:function(){var e=this;e.hideCover();e.resizer.style.display="none";domUtils.un(e.resizer,"mousedown",e.proxy(e._eventHandler,e));domUtils.un(e.doc,"mouseup",e.proxy(e._eventHandler,e));e.editor.fireEvent("afterscalehide",e)},proxy:function(t,i){return function(e){return t.apply(i||this,arguments)}},attachTo:function(e){var t=this,i=t.target=e,n=this.resizer,r=domUtils.getXY(i),o=domUtils.getXY(t.editor.iframe),a=domUtils.getXY(n.parentNode);domUtils.setStyles(n,{width:i.width+"px",height:i.height+"px",left:o.x+r.x-t.editor.document.body.scrollLeft-a.x-parseInt(n.style.borderLeftWidth)+"px",top:o.y+r.y-t.editor.document.body.scrollTop-a.y-parseInt(n.style.borderTopWidth)+"px"})}}})();return function(){var s=this,l;s.setOpt("imageScaleEnabled",true);if(!browser.ie&&s.options.imageScaleEnabled){s.addListener("click",function(e,t){var i=s.selection.getRange(),n=i.getClosedNode();if(n&&n.tagName=="IMG"&&s.body.contentEditable!="false"){if(n.className.indexOf("edui-faked-music")!=-1||n.getAttribute("anchorname")||domUtils.hasClass(n,"loadingclass")||domUtils.hasClass(n,"loaderrorclass")){return}if(!l){l=new d;l.init(s);s.ui.getDom().appendChild(l.resizer);var r=function(e){l.hide();if(l.target)s.selection.getRange().selectNode(l.target).select()},o=function(e){var t=e.target||e.srcElement;if(t&&(t.className===undefined||t.className.indexOf("edui-editor-imagescale")==-1)){r(e)}},a;s.addListener("afterscaleshow",function(e){s.addListener("beforekeydown",r);s.addListener("beforemousedown",o);domUtils.on(document,"keydown",r);domUtils.on(document,"mousedown",o);s.selection.getNative().removeAllRanges()});s.addListener("afterscalehide",function(e){s.removeListener("beforekeydown",r);s.removeListener("beforemousedown",o);domUtils.un(document,"keydown",r);domUtils.un(document,"mousedown",o);var t=l.target;if(t.parentNode){s.selection.getRange().selectNode(t).select()}});domUtils.on(l.resizer,"mousedown",function(e){s.selection.getNative().removeAllRanges();var t=e.target||e.srcElement;if(t&&t.className.indexOf("edui-editor-imagescale-hand")==-1){a=setTimeout(function(){l.hide();if(l.target)s.selection.getRange().selectNode(t).select()},200)}});domUtils.on(l.resizer,"mouseup",function(e){var t=e.target||e.srcElement;if(t&&t.className.indexOf("edui-editor-imagescale-hand")==-1){clearTimeout(a)}})}l.show(n)}else{if(l&&l.resizer.style.display!="none")l.hide()}})}if(browser.webkit){s.addListener("click",function(e,t){if(t.target.tagName=="IMG"&&s.body.contentEditable!="false"){var i=new dom.Range(s.document);i.selectNode(t.target).select()}})}}}();UE.plugin.register("autolink",function(){var e=0;return!browser.ie?{bindEvents:{reset:function(){e=0},keydown:function(e,t){var i=this;var n=t.keyCode||t.which;if(n==32||n==13){var r=i.selection.getNative(),o=r.getRangeAt(0).cloneRange(),a,s;var l=o.startContainer;while(l.nodeType==1&&o.startOffset>0){l=o.startContainer.childNodes[o.startOffset-1];if(!l){break}o.setStart(l,l.nodeType==1?l.childNodes.length:l.nodeValue.length);o.collapse(true);l=o.startContainer}do{if(o.startOffset==0){l=o.startContainer.previousSibling;while(l&&l.nodeType==1){l=l.lastChild}if(!l||domUtils.isFillChar(l)){break}a=l.nodeValue.length}else{l=o.startContainer;a=o.startOffset}o.setStart(l,a-1);s=o.toString().charCodeAt(0)}while(s!=160&&s!=32);if(o.toString().replace(new RegExp(domUtils.fillChar,"g"),"").match(/(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i)){while(o.toString().length){if(/^(?:https?:\/\/|ssh:\/\/|ftp:\/\/|file:\/|www\.)/i.test(o.toString())){break}try{o.setStart(o.startContainer,o.startOffset+1)}catch(e){var l=o.startContainer;while(!(next=l.nextSibling)){if(domUtils.isBody(l)){return}l=l.parentNode}o.setStart(next,0)}}if(domUtils.findParentByTagName(o.startContainer,"a",true)){return}var d=i.document.createElement("a"),u=i.document.createTextNode(" "),c;i.undoManger&&i.undoManger.save();d.appendChild(o.extractContents());d.href=d.innerHTML=d.innerHTML.replace(/<[^>]+>/g,"");c=d.getAttribute("href").replace(new RegExp(domUtils.fillChar,"g"),"");c=/^(?:https?:\/\/)/gi.test(c)?c:"http://"+c;d.setAttribute("_src",utils.html(c));d.href=utils.html(c);o.insertNode(d);d.parentNode.insertBefore(u,d.nextSibling);o.setStart(u,0);o.collapse(true);r.removeAllRanges();r.addRange(o);i.undoManger&&i.undoManger.save()}}}}}:{}},function(){var l={37:1,38:1,39:1,40:1,13:1,32:1};function d(e){if(e.nodeType==3){return null}if(e.nodeName=="A"){return e}var t=e.lastChild;while(t){if(t.nodeName=="A"){return t}if(t.nodeType==3){if(domUtils.isWhitespace(t)){t=t.previousSibling;continue}return null}t=t.lastChild}}browser.ie&&this.addListener("keyup",function(e,t){var i=this,n=t.keyCode;if(l[n]){var r=i.selection.getRange();var o=r.startContainer;if(n==13){while(o&&!domUtils.isBody(o)&&!domUtils.isBlockElm(o)){o=o.parentNode}if(o&&!domUtils.isBody(o)&&o.nodeName=="P"){var a=o.previousSibling;if(a&&a.nodeType==1){var a=d(a);if(a&&!a.getAttribute("_href")){domUtils.remove(a,true)}}}}else if(n==32){if(o.nodeType==3&&/^\s$/.test(o.nodeValue)){o=o.previousSibling;if(o&&o.nodeName=="A"&&!o.getAttribute("_href")){domUtils.remove(o,true)}}}else{o=domUtils.findParentByTagName(o,"a",true);if(o&&!o.getAttribute("_href")){var s=r.createBookmark();domUtils.remove(o,true);r.moveToBookmark(s).select(true)}}}})});UE.plugins["autoheight"]=function(){var i=this;i.autoHeightEnabled=i.options.autoHeightEnabled!==false;if(!i.autoHeightEnabled){return}var n,r=0,o=i.options,a,e;function s(){var t=this;clearTimeout(e);if(l)return;if(!t.queryCommandState||t.queryCommandState&&t.queryCommandState("source")!=1){e=setTimeout(function(){var e=t.body.lastChild;while(e&&e.nodeType!=1){e=e.previousSibling}if(e&&e.nodeType==1){e.style.clear="both";a=Math.max(domUtils.getXY(e).y+e.offsetHeight+25,Math.max(o.minFrameHeight,o.initialFrameHeight));if(a!=r){if(a!==parseInt(t.iframe.parentNode.style.height)){t.iframe.parentNode.style.height=a+"px"}t.body.style.height=a+"px";r=a}domUtils.removeStyle(e,"clear")}},50)}}var l;i.addListener("fullscreenchanged",function(e,t){l=t});i.addListener("destroy",function(){i.removeListener("contentchange afterinserthtml keyup mouseup",s)});i.enableAutoHeight=function(){var e=this;if(!e.autoHeightEnabled){return}var t=e.document;e.autoHeightEnabled=true;n=t.body.style.overflowY;t.body.style.overflowY="hidden";e.addListener("contentchange afterinserthtml keyup mouseup",s);setTimeout(function(){s.call(e)},browser.gecko?100:0);e.fireEvent("autoheightchanged",e.autoHeightEnabled)};i.disableAutoHeight=function(){i.body.style.overflowY=n||"";i.removeListener("contentchange",s);i.removeListener("keyup",s);i.removeListener("mouseup",s);i.autoHeightEnabled=false;i.fireEvent("autoheightchanged",i.autoHeightEnabled)};i.on("setHeight",function(){i.disableAutoHeight()});i.addListener("ready",function(){i.enableAutoHeight();var e;domUtils.on(browser.ie?i.body:i.document,browser.webkit?"dragover":"drop",function(){clearTimeout(e);e=setTimeout(function(){s.call(i)},100)});var t;window.onscroll=function(){if(t===null){t=this.scrollY}else if(this.scrollY==0&&t!=0){if(i.window){i.window.scrollTo(0,0)}t=null}}})};UE.plugins["autofloat"]=function(){var n=this,e=n.getLang();n.setOpt({topOffset:0});var t=n.options.autoFloatEnabled!==false,r=n.options.topOffset;if(!t){return}var i=UE.ui.uiUtils,o=browser.ie&&browser.version<=6,a=browser.quirks;function s(){if(!UE.ui){alert(e.autofloatMsg);return 0}return 1}function l(){var e=document.body.style;e.backgroundImage='url("about:blank")';e.backgroundAttachment="fixed"}var d,u=document.createElement("div"),c,f,m,h=true;function p(){var e=domUtils.getXY(c),t=domUtils.getComputedStyle(c,"position"),i=domUtils.getComputedStyle(c,"left");c.style.width=c.offsetWidth+"px";c.style.zIndex=n.options.zIndex*1+1;c.parentNode.insertBefore(u,c);if(o||a&&browser.ie){if(c.style.position!="absolute"){c.style.position="absolute"}c.style.top=(document.body.scrollTop||document.documentElement.scrollTop)-f+r+"px"}else{if(browser.ie7Compat&&h){h=false;c.style.left=domUtils.getXY(c).x-document.documentElement.getBoundingClientRect().left+2+"px"}if(c.style.position!="fixed"){c.style.position="fixed";c.style.top=r+"px";(t=="absolute"||t=="relative")&&parseFloat(i)&&(c.style.left=e.x+"px")}}}function g(){h=true;if(u.parentNode){u.parentNode.removeChild(u)}c.style.cssText=d}function v(){var e=m(n.container);var t=n.options.toolbarTopOffset||0;if(e.top<0&&e.bottom-c.offsetHeight>t){p()}else{g()}}var b=utils.defer(function(){v()},browser.ie?200:100,true);n.addListener("destroy",function(){domUtils.un(window,["scroll","resize"],v);n.removeListener("keydown",b)});n.addListener("ready",function(){if(s(n)){if(!n.ui){return}m=i.getClientRect;c=n.ui.getDom("toolbarbox");f=m(c).top;d=c.style.cssText;u.style.height=c.offsetHeight+"px";if(o){l()}domUtils.on(window,["scroll","resize"],v);n.addListener("keydown",b);n.addListener("beforefullscreenchange",function(e,t){if(t){g()}});n.addListener("fullscreenchanged",function(e,t){if(!t){v()}});n.addListener("sourcemodechanged",function(e,t){setTimeout(function(){v()},0)});n.addListener("clearDoc",function(){setTimeout(function(){v()},0)})}})};UE.plugins["video"]=function(){var c=this;function f(e,t,i,n,r,o,a){e=utils.unhtmlForUrl(e);r=utils.unhtml(r);o=utils.unhtml(o);t=parseInt(t,10)||0;i=parseInt(i,10)||0;var s;switch(a){case"image":s="<img "+(n?'id="'+n+'"':"")+' width="'+t+'" height="'+i+'" _url="'+e+'" class="'+o.replace(/\bvideo-js\b/,"")+'"'+' src="'+c.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" style="background:url('+c.options.UEDITOR_HOME_URL+"themes/default/images/videologo.gif) no-repeat center center; border:1px solid gray;"+(r?"float:"+r+";":"")+'" />';break;case"embed":s='<embed type="application/x-shockwave-flash" class="'+o+'" pluginspage="http://www.macromedia.com/go/getflashplayer"'+' src="'+utils.html(e)+'" width="'+t+'" height="'+i+'"'+(r?' style="float:'+r+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >';break;case"video":var l=e.substr(e.lastIndexOf(".")+1);if(l=="ogv")l="ogg";s="<video"+(n?' id="'+n+'"':"")+' class="'+o+' video-js" '+(r?' style="float:'+r+'"':"")+' controls preload="none" width="'+t+'" height="'+i+'" src="'+e+'" data-setup="{}">'+'<source src="'+e+'" type="video/'+l+'" /></video>';break}return s}function t(e,n){utils.each(e.getNodesByTagName(n?"img":"embed video"),function(e){var t=e.getAttr("class");if(t&&t.indexOf("edui-faked-video")!=-1){var i=f(n?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",t,n?"embed":"image");e.parentNode.replaceChild(UE.uNode.createElement(i),e)}if(t&&t.indexOf("edui-upload-video")!=-1){var i=f(n?e.getAttr("_url"):e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),null,e.getStyle("float")||"",t,n?"video":"image");e.parentNode.replaceChild(UE.uNode.createElement(i),e)}})}c.addOutputRule(function(e){t(e,true)});c.addInputRule(function(e){t(e)});c.commands["insertvideo"]={execCommand:function(e,t,i){t=utils.isArray(t)?t:[t];var n=[],r="tmpVedio",o;for(var a=0,s,l=t.length;a<l;a++){s=t[a];o=i=="upload"?"video-js vjs-default-skin":"edui-faked-video";n.push(f(s.url,s.width||420,s.height||280,r+a,null,o,"video"))}c.execCommand("inserthtml",n.join(""),true);var d=this.selection.getRange();for(var a=0,l=t.length;a<l;a++){var u=this.document.getElementById("tmpVedio"+a);domUtils.removeAttributes(u,"id");d.selectNode(u).select();c.execCommand("imagefloat",t[a].align)}},queryCommandState:function(){var e=c.selection.getRange().getClosedNode(),t=e&&(e.className=="edui-faked-video"||e.className.indexOf("edui-upload-video")!=-1);return t?1:0}}};(function(){var o=UE.UETable=function(e){this.table=e;this.indexTable=[];this.selectedTds=[];this.cellsRange={};this.update(e)};o.removeSelectedClass=function(e){utils.each(e,function(e){domUtils.removeClasses(e,"selectTdClass")})};o.addSelectedClass=function(e){utils.each(e,function(e){domUtils.addClass(e,"selectTdClass")})};o.isEmptyBlock=function(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty)if(dtd.$isNotEmpty.hasOwnProperty(i)){if(e.getElementsByTagName(i).length){return 0}}return 1};o.getWidth=function(e){if(!e)return 0;return parseInt(domUtils.getComputedStyle(e,"width"),10)};o.getTableCellAlignState=function(e){!utils.isArray(e)&&(e=[e]);var i={},n=["align","valign"],r=null,o=true;utils.each(e,function(t){utils.each(n,function(e){r=t.getAttribute(e);if(!i[e]&&r){i[e]=r}else if(!i[e]||r!==i[e]){o=false;return false}});return o});return o?i:null};o.getTableItemsByRange=function(e){var t=e.selection.getStart();if(t&&t.id&&t.id.indexOf("_baidu_bookmark_start_")===0&&t.nextSibling){t=t.nextSibling}var i=t&&domUtils.findParentByTagName(t,["td","th"],true),n=i&&i.parentNode,r=t&&domUtils.findParentByTagName(t,"caption",true),o=r?r.parentNode:n&&n.parentNode.parentNode;return{cell:i,tr:n,table:o,caption:r}};o.getUETableBySelected=function(e){var t=o.getTableItemsByRange(e).table;if(t&&t.ueTable&&t.ueTable.selectedTds.length){return t.ueTable}return null};o.getDefaultValue=function(e,t){var i={thin:"0px",medium:"1px",thick:"2px"},n,r,o,a;if(!t){t=e.document.createElement("table");t.insertRow(0).insertCell(0).innerHTML="xxx";e.body.appendChild(t);var s=t.getElementsByTagName("td")[0];a=domUtils.getComputedStyle(t,"border-left-width");n=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"padding-left");r=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"border-left-width");o=parseInt(i[a]||a,10);domUtils.remove(t);return{tableBorder:n,tdPadding:r,tdBorder:o}}else{s=t.getElementsByTagName("td")[0];a=domUtils.getComputedStyle(t,"border-left-width");n=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"padding-left");r=parseInt(i[a]||a,10);a=domUtils.getComputedStyle(s,"border-left-width");o=parseInt(i[a]||a,10);return{tableBorder:n,tdPadding:r,tdBorder:o}}};o.getUETable=function(e){var t=e.tagName.toLowerCase();e=t=="td"||t=="th"||t=="caption"?domUtils.findParentByTagName(e,"table",true):e;if(!e.ueTable){e.ueTable=new o(e)}return e.ueTable};o.cloneCell=function(e,t,i){if(!e||utils.isString(e)){return this.table.ownerDocument.createElement(e||"td")}var n=domUtils.hasClass(e,"selectTdClass");n&&domUtils.removeClasses(e,"selectTdClass");var r=e.cloneNode(true);if(t){r.rowSpan=r.colSpan=1}!i&&domUtils.removeAttributes(r,"width height");!i&&domUtils.removeAttributes(r,"style");r.style.borderLeftStyle="";r.style.borderTopStyle="";r.style.borderLeftColor=e.style.borderRightColor;r.style.borderLeftWidth=e.style.borderRightWidth;r.style.borderTopColor=e.style.borderBottomColor;r.style.borderTopWidth=e.style.borderBottomWidth;n&&domUtils.addClass(e,"selectTdClass");return r};o.prototype={getMaxRows:function(){var e=this.table.rows,t=1;for(var i=0,n;n=e[i];i++){var r=1;for(var o=0,a;a=n.cells[o++];){r=Math.max(a.rowSpan||1,r)}t=Math.max(r+i,t)}return t},getMaxCols:function(){var e=this.table.rows,t=0,i={};for(var n=0,r;r=e[n];n++){var o=0;for(var a=0,s;s=r.cells[a++];){o+=s.colSpan||1;if(s.rowSpan&&s.rowSpan>1){for(var l=1;l<s.rowSpan;l++){if(!i["row_"+(n+l)]){i["row_"+(n+l)]=s.colSpan||1}else{i["row_"+(n+l)]++}}}}o+=i["row_"+n]||0;t=Math.max(o,t)}return t},getCellColIndex:function(e){},getHSideCell:function(e,t){try{var i=this.getCellInfo(e),n,r;var o=this.selectedTds.length,a=this.cellsRange;if(!t&&(!o?!i.colIndex:!a.beginColIndex)||t&&(!o?i.colIndex==this.colsNum-1:a.endColIndex==this.colsNum-1))return null;n=!o?i.rowIndex:a.beginRowIndex;r=!t?!o?i.colIndex<1?0:i.colIndex-1:a.beginColIndex-1:!o?i.colIndex+1:a.endColIndex+1;return this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){c(e)}},getTabNextCell:function(e,t){var i=this.getCellInfo(e),n=t||i.rowIndex,r=i.colIndex+1+(i.colSpan-1),o;try{o=this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){try{n=n*1+1;r=0;o=this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){}}return o},getVSideCell:function(e,t,i){try{var n=this.getCellInfo(e),r,o;var a=this.selectedTds.length&&!i,s=this.cellsRange;if(!t&&n.rowIndex==0||t&&(!a?n.rowIndex+n.rowSpan>this.rowsNum-1:s.endRowIndex==this.rowsNum-1))return null;r=!t?!a?n.rowIndex-1:s.beginRowIndex-1:!a?n.rowIndex+n.rowSpan:s.endRowIndex+1;o=!a?n.colIndex:s.beginColIndex;return this.getCell(this.indexTable[r][o].rowIndex,this.indexTable[r][o].cellIndex)}catch(e){c(e)}},getSameEndPosCells:function(e,t){try{var i=t.toLowerCase()==="x",n=domUtils.getXY(e)[i?"x":"y"]+e["offset"+(i?"Width":"Height")],r=this.table.rows,o=null,a=[];for(var s=0;s<this.rowsNum;s++){o=r[s].cells;for(var l=0,d;d=o[l++];){var u=domUtils.getXY(d)[i?"x":"y"]+d["offset"+(i?"Width":"Height")];if(u>n&&i)break;if(e==d||n==u){if(d[i?"colSpan":"rowSpan"]==1){a.push(d)}if(i)break}}}return a}catch(e){c(e)}},setCellContent:function(e,t){e.innerHTML=t||(browser.ie?domUtils.fillChar:"<br />")},cloneCell:o.cloneCell,getSameStartPosXCells:function(e){try{var t=domUtils.getXY(e).x+e.offsetWidth,i=this.table.rows,n,r=[];for(var o=0;o<this.rowsNum;o++){n=i[o].cells;for(var a=0,s;s=n[a++];){var l=domUtils.getXY(s).x;if(l>t)break;if(l==t&&s.colSpan==1){r.push(s);break}}}return r}catch(e){c(e)}},update:function(e){this.table=e||this.table;this.selectedTds=[];this.cellsRange={};this.indexTable=[];var t=this.table.rows,i=this.getMaxRows(),n=i-t.length,r=this.getMaxCols();while(n--){this.table.insertRow(t.length)}this.rowsNum=i;this.colsNum=r;for(var o=0,a=t.length;o<a;o++){this.indexTable[o]=new Array(r)}for(var s=0,l;l=t[s];s++){for(var d=0,u,c=l.cells;u=c[d];d++){if(u.rowSpan>i){u.rowSpan=i}var f=d,m=u.rowSpan||1,h=u.colSpan||1;while(this.indexTable[s][f])f++;for(var p=0;p<m;p++){for(var g=0;g<h;g++){this.indexTable[s+p][f+g]={rowIndex:s,cellIndex:d,colIndex:f,rowSpan:m,colSpan:h}}}}}for(p=0;p<i;p++){for(g=0;g<r;g++){if(this.indexTable[p][g]===undefined){l=t[p];u=l.cells[l.cells.length-1];u=u?u.cloneNode(true):this.table.ownerDocument.createElement("td");this.setCellContent(u);if(u.colSpan!==1)u.colSpan=1;if(u.rowSpan!==1)u.rowSpan=1;l.appendChild(u);this.indexTable[p][g]={rowIndex:p,cellIndex:u.cellIndex,colIndex:g,rowSpan:1,colSpan:1}}}}var v=domUtils.getElementsByTagName(this.table,"td"),b=[];utils.each(v,function(e){if(domUtils.hasClass(e,"selectTdClass")){b.push(e)}});if(b.length){var y=b[0],C=b[b.length-1],w=this.getCellInfo(y),N=this.getCellInfo(C);this.selectedTds=b;this.cellsRange={beginRowIndex:w.rowIndex,beginColIndex:w.colIndex,endRowIndex:N.rowIndex+N.rowSpan-1,endColIndex:N.colIndex+N.colSpan-1}}if(!domUtils.hasClass(this.table.rows[0],"firstRow")){domUtils.addClass(this.table.rows[0],"firstRow");for(var o=1;o<this.table.rows.length;o++){domUtils.removeClasses(this.table.rows[o],"firstRow")}}},getCellInfo:function(e){if(!e)return;var t=e.cellIndex,i=e.parentNode.rowIndex,n=this.indexTable[i],r=this.colsNum;for(var o=t;o<r;o++){var a=n[o];if(a.rowIndex===i&&a.cellIndex===t){return a}}},getCell:function(e,t){return e<this.rowsNum&&this.table.rows[e].cells[t]||null},deleteCell:function(e,t){t=typeof t=="number"?t:e.parentNode.rowIndex;var i=this.table.rows[t];i.deleteCell(e.cellIndex)},getCellsRange:function(e,t){function c(e,t,i,n){var r=e,o=t,a=i,s=n,l,d,u;if(e>0){for(d=t;d<n;d++){l=f.indexTable[e][d];u=l.rowIndex;if(u<e){r=Math.min(u,r)}}}if(n<f.colsNum){for(u=e;u<i;u++){l=f.indexTable[u][n];d=l.colIndex+l.colSpan-1;if(d>n){s=Math.max(d,s)}}}if(i<f.rowsNum){for(d=t;d<n;d++){l=f.indexTable[i][d];u=l.rowIndex+l.rowSpan-1;if(u>i){a=Math.max(u,a)}}}if(t>0){for(u=e;u<i;u++){l=f.indexTable[u][t];d=l.colIndex;if(d<t){o=Math.min(l.colIndex,o)}}}if(r!=e||o!=t||a!=i||s!=n){return c(r,o,a,s)}else{return{beginRowIndex:e,beginColIndex:t,endRowIndex:i,endColIndex:n}}}try{var f=this,i=f.getCellInfo(e);if(e===t){return{beginRowIndex:i.rowIndex,beginColIndex:i.colIndex,endRowIndex:i.rowIndex+i.rowSpan-1,endColIndex:i.colIndex+i.colSpan-1}}var n=f.getCellInfo(t);var r=Math.min(i.rowIndex,n.rowIndex),o=Math.min(i.colIndex,n.colIndex),a=Math.max(i.rowIndex+i.rowSpan-1,n.rowIndex+n.rowSpan-1),s=Math.max(i.colIndex+i.colSpan-1,n.colIndex+n.colSpan-1);return c(r,o,a,s)}catch(e){}},getCells:function(e){this.clearSelected();var t=e.beginRowIndex,i=e.beginColIndex,n=e.endRowIndex,r=e.endColIndex,o,a,s,l={},d=[];for(var u=t;u<=n;u++){for(var c=i;c<=r;c++){o=this.indexTable[u][c];a=o.rowIndex;s=o.colIndex;var f=a+"|"+s;if(l[f])continue;l[f]=1;if(a<u||s<c||a+o.rowSpan-1>n||s+o.colSpan-1>r){return null}d.push(this.getCell(a,o.cellIndex))}}return d},clearSelected:function(){o.removeSelectedClass(this.selectedTds);this.selectedTds=[];this.cellsRange={}},setSelected:function(e){var t=this.getCells(e);o.addSelectedClass(t);this.selectedTds=t;this.cellsRange=e},isFullRow:function(){var e=this.cellsRange;return e.endColIndex-e.beginColIndex+1==this.colsNum},isFullCol:function(){var e=this.cellsRange,t=this.table,i=t.getElementsByTagName("th"),n=e.endRowIndex-e.beginRowIndex+1;return!i.length?n==this.rowsNum:n==this.rowsNum||n==this.rowsNum-1},getNextCell:function(e,t,i){try{var n=this.getCellInfo(e),r,o;var a=this.selectedTds.length&&!i,s=this.cellsRange;if(!t&&n.rowIndex==0||t&&(!a?n.rowIndex+n.rowSpan>this.rowsNum-1:s.endRowIndex==this.rowsNum-1))return null;r=!t?!a?n.rowIndex-1:s.beginRowIndex-1:!a?n.rowIndex+n.rowSpan:s.endRowIndex+1;o=!a?n.colIndex:s.beginColIndex;return this.getCell(this.indexTable[r][o].rowIndex,this.indexTable[r][o].cellIndex)}catch(e){c(e)}},getPreviewCell:function(e,t){try{var i=this.getCellInfo(e),n,r;var o=this.selectedTds.length,a=this.cellsRange;if(!t&&(!o?!i.colIndex:!a.beginColIndex)||t&&(!o?i.rowIndex>this.colsNum-1:a.endColIndex==this.colsNum-1))return null;n=!t?!o?i.rowIndex:a.beginRowIndex:!o?i.rowIndex<1?0:i.rowIndex-1:a.beginRowIndex;r=!t?!o?i.colIndex<1?0:i.colIndex-1:a.beginColIndex-1:!o?i.colIndex:a.endColIndex+1;return this.getCell(this.indexTable[n][r].rowIndex,this.indexTable[n][r].cellIndex)}catch(e){c(e)}},moveContent:function(e,t){if(o.isEmptyBlock(t))return;if(o.isEmptyBlock(e)){e.innerHTML=t.innerHTML;return}var i=e.lastChild;if(i.nodeType==3||!dtd.$block[i.tagName]){e.appendChild(e.ownerDocument.createElement("br"))}while(i=t.firstChild){e.appendChild(i)}},mergeRight:function(e){var t=this.getCellInfo(e),i=t.colIndex+t.colSpan,n=this.indexTable[t.rowIndex][i],r=this.getCell(n.rowIndex,n.cellIndex);e.colSpan=t.colSpan+n.colSpan;e.removeAttribute("width");this.moveContent(e,r);this.deleteCell(r,n.rowIndex);this.update()},mergeDown:function(e){var t=this.getCellInfo(e),i=t.rowIndex+t.rowSpan,n=this.indexTable[i][t.colIndex],r=this.getCell(n.rowIndex,n.cellIndex);e.rowSpan=t.rowSpan+n.rowSpan;e.removeAttribute("height");this.moveContent(e,r);this.deleteCell(r,n.rowIndex);this.update()},mergeRange:function(){var e=this.cellsRange,t=this.getCell(e.beginRowIndex,this.indexTable[e.beginRowIndex][e.beginColIndex].cellIndex);if(t.tagName=="TH"&&e.endRowIndex!==e.beginRowIndex){var i=this.indexTable,n=this.getCellInfo(t);t=this.getCell(1,i[1][n.colIndex].cellIndex);e=this.getCellsRange(t,this.getCell(i[this.rowsNum-1][n.colIndex].rowIndex,i[this.rowsNum-1][n.colIndex].cellIndex))}var r=this.getCells(e);for(var o=0,a;a=r[o++];){if(a!==t){this.moveContent(t,a);this.deleteCell(a)}}t.rowSpan=e.endRowIndex-e.beginRowIndex+1;t.rowSpan>1&&t.removeAttribute("height");t.colSpan=e.endColIndex-e.beginColIndex+1;t.colSpan>1&&t.removeAttribute("width");if(t.rowSpan==this.rowsNum&&t.colSpan!=1){t.colSpan=1}if(t.colSpan==this.colsNum&&t.rowSpan!=1){var s=t.parentNode.rowIndex;if(this.table.deleteRow){for(var o=s+1,l=s+1,d=t.rowSpan;o<d;o++){this.table.deleteRow(l)}}else{for(var o=0,d=t.rowSpan-1;o<d;o++){var u=this.table.rows[s+1];u.parentNode.removeChild(u)}}t.rowSpan=1}this.update()},insertRow:function(e,t){var i=this.colsNum,n=this.table,r=n.insertRow(e),o,a=typeof t=="string"&&t.toUpperCase()=="TH";function s(e,t,i){if(e==0){var n=i.nextSibling||i.previousSibling,r=n.cells[e];if(r.tagName=="TH"){r=t.ownerDocument.createElement("th");r.appendChild(t.firstChild);i.insertBefore(r,t);domUtils.remove(t)}}else{if(t.tagName=="TH"){var o=t.ownerDocument.createElement("td");o.appendChild(t.firstChild);i.insertBefore(o,t);domUtils.remove(t)}}}if(e==0||e==this.rowsNum){for(var l=0;l<i;l++){o=this.cloneCell(t,true);this.setCellContent(o);o.getAttribute("vAlign")&&o.setAttribute("vAlign",o.getAttribute("vAlign"));r.appendChild(o);if(!a)s(l,o,r)}}else{var d=this.indexTable[e],u=0;for(l=0;l<i;l++){var c=d[l];if(c.rowIndex<e){o=this.getCell(c.rowIndex,c.cellIndex);o.rowSpan=c.rowSpan+1}else{o=this.cloneCell(t,true);this.setCellContent(o);r.appendChild(o)}if(!a)s(l,o,r)}}this.update();return r},deleteRow:function(e){var t=this.table.rows[e],i=this.indexTable[e],n=this.colsNum,r=0;for(var o=0;o<n;){var a=i[o],s=this.getCell(a.rowIndex,a.cellIndex);if(s.rowSpan>1){if(a.rowIndex==e){var l=s.cloneNode(true);l.rowSpan=s.rowSpan-1;l.innerHTML="";s.rowSpan=1;var d=e+1,u=this.table.rows[d],c,f=this.getPreviewMergedCellsNum(d,o)-r;if(f<o){c=o-f-1;domUtils.insertAfter(u.cells[c],l)}else{if(u.cells.length)u.insertBefore(l,u.cells[0])}r+=1}}o+=s.colSpan||1}var m=[],h={};for(o=0;o<n;o++){var p=i[o].rowIndex,g=i[o].cellIndex,v=p+"_"+g;if(h[v])continue;h[v]=1;s=this.getCell(p,g);m.push(s)}var b=[];utils.each(m,function(e){if(e.rowSpan==1){e.parentNode.removeChild(e)}else{b.push(e)}});utils.each(b,function(e){e.rowSpan--});t.parentNode.removeChild(t);this.update()},insertCol:function(e,t,i){var n=this.rowsNum,r=0,o,a,s=parseInt((this.table.offsetWidth-(this.colsNum+1)*20-(this.colsNum+1))/(this.colsNum+1),10),l=typeof t=="string"&&t.toUpperCase()=="TH";function d(e,t,i){if(e==0){var n=t.nextSibling||t.previousSibling;if(n.tagName=="TH"){n=t.ownerDocument.createElement("th");n.appendChild(t.firstChild);i.insertBefore(n,t);domUtils.remove(t)}}else{if(t.tagName=="TH"){var r=t.ownerDocument.createElement("td");r.appendChild(t.firstChild);i.insertBefore(r,t);domUtils.remove(t)}}}var u;if(e==0||e==this.colsNum){for(;r<n;r++){o=this.table.rows[r];u=o.cells[e==0?e:o.cells.length];a=this.cloneCell(t,true);this.setCellContent(a);a.setAttribute("vAlign",a.getAttribute("vAlign"));u&&a.setAttribute("width",u.getAttribute("width"));if(!e){o.insertBefore(a,o.cells[0])}else{domUtils.insertAfter(o.cells[o.cells.length-1],a)}if(!l)d(r,a,o)}}else{for(;r<n;r++){var c=this.indexTable[r][e];if(c.colIndex<e){a=this.getCell(c.rowIndex,c.cellIndex);a.colSpan=c.colSpan+1}else{o=this.table.rows[r];u=o.cells[c.cellIndex];a=this.cloneCell(t,true);this.setCellContent(a);a.setAttribute("vAlign",a.getAttribute("vAlign"));u&&a.setAttribute("width",u.getAttribute("width"));u?o.insertBefore(a,u):o.appendChild(a)}if(!l)d(r,a,o)}}this.update();this.updateWidth(s,i||{tdPadding:10,tdBorder:1})},updateWidth:function(t,e){var i=this.table,n=o.getWidth(i)-e.tdPadding*2-e.tdBorder+t;if(n<i.ownerDocument.body.offsetWidth){i.setAttribute("width",n);return}var r=domUtils.getElementsByTagName(this.table,"td th");utils.each(r,function(e){e.setAttribute("width",t)})},deleteCol:function(e){var t=this.indexTable,i=this.table.rows,n=this.table.getAttribute("width"),r=0,o=this.rowsNum,a={};for(var s=0;s<o;){var l=t[s],d=l[e],u=d.rowIndex+"_"+d.colIndex;if(a[u])continue;a[u]=1;var c=this.getCell(d.rowIndex,d.cellIndex);if(!r)r=c&&parseInt(c.offsetWidth/c.colSpan,10).toFixed(0);if(c.colSpan>1){c.colSpan--}else{i[s].deleteCell(d.cellIndex)}s+=d.rowSpan||1}this.table.setAttribute("width",n-r);this.update()},splitToCells:function(e){var t=this,i=this.splitToRows(e);utils.each(i,function(e){t.splitToCols(e)})},splitToRows:function(e){var t=this.getCellInfo(e),i=t.rowIndex,n=t.colIndex,r=[];e.rowSpan=1;r.push(e);for(var o=i,a=i+t.rowSpan;o<a;o++){if(o==i)continue;var s=this.table.rows[o],l=s.insertCell(n-this.getPreviewMergedCellsNum(o,n));l.colSpan=t.colSpan;this.setCellContent(l);l.setAttribute("vAlign",e.getAttribute("vAlign"));l.setAttribute("align",e.getAttribute("align"));if(e.style.cssText){l.style.cssText=e.style.cssText}r.push(l)}this.update();return r},getPreviewMergedCellsNum:function(e,t){var i=this.indexTable[e],n=0;for(var r=0;r<t;){var o=i[r].colSpan,a=i[r].rowIndex;n+=o-(a==e?1:0);r+=o}return n},splitToCols:function(e){var t=(e.offsetWidth/e.colSpan-22).toFixed(0),i=this.getCellInfo(e),n=i.rowIndex,r=i.colIndex,o=[];e.colSpan=1;e.setAttribute("width",t);o.push(e);for(var a=r,s=r+i.colSpan;a<s;a++){if(a==r)continue;var l=this.table.rows[n],d=l.insertCell(this.indexTable[n][a].cellIndex+1);d.rowSpan=i.rowSpan;this.setCellContent(d);d.setAttribute("vAlign",e.getAttribute("vAlign"));d.setAttribute("align",e.getAttribute("align"));d.setAttribute("width",t);if(e.style.cssText){d.style.cssText=e.style.cssText}if(e.tagName=="TH"){var u=e.ownerDocument.createElement("th");u.appendChild(d.firstChild);u.setAttribute("vAlign",e.getAttribute("vAlign"));u.rowSpan=d.rowSpan;l.insertBefore(u,d);domUtils.remove(d)}o.push(d)}this.update();return o},isLastCell:function(e,t,i){t=t||this.rowsNum;i=i||this.colsNum;var n=this.getCellInfo(e);return n.rowIndex+n.rowSpan==t&&n.colIndex+n.colSpan==i},getLastCell:function(e){e=e||this.table.getElementsByTagName("td");var t=this.getCellInfo(e[0]);var i=this,n=e[0],r=n.parentNode,o=0,a=0,s;utils.each(e,function(e){if(e.parentNode==r)a+=e.colSpan||1;o+=e.rowSpan*e.colSpan||1});s=o/a;utils.each(e,function(e){if(i.isLastCell(e,s,a)){n=e;return false}});return n},selectRow:function(e){var t=this.indexTable[e],i=this.getCell(t[0].rowIndex,t[0].cellIndex),n=this.getCell(t[this.colsNum-1].rowIndex,t[this.colsNum-1].cellIndex),r=this.getCellsRange(i,n);this.setSelected(r)},selectTable:function(){var e=this.table.getElementsByTagName("td"),t=this.getCellsRange(e[0],e[e.length-1]);this.setSelected(t)},setBackground:function(e,t){if(typeof t==="string"){utils.each(e,function(e){e.style.backgroundColor=t})}else if(typeof t==="object"){t=utils.extend({repeat:true,colorList:["#ddd","#fff"]},t);var i=this.getCellInfo(e[0]).rowIndex,n=0,r=t.colorList,o=function(e,t,i){return e[t]?e[t]:i?e[t%e.length]:""};for(var a=0,s;s=e[a++];){var l=this.getCellInfo(s);s.style.backgroundColor=o(r,i+n==l.rowIndex?n:++n,t.repeat)}}},removeBackground:function(e){utils.each(e,function(e){e.style.backgroundColor=""})}};function c(e){}})();(function(){var i=UE.UETable,c=function(e){return i.getTableItemsByRange(e)},a=function(e){return i.getUETableBySelected(e)},v=function(e,t){return i.getDefaultValue(e,t)},f=function(e){return i.getUETable(e)};UE.commands["inserttable"]={queryCommandState:function(){return c(this).table?-1:0},execCommand:function(e,t){function i(e,t){var i=[],n=e.numRows,r=e.numCols;for(var o=0;o<n;o++){i.push("<tr"+(o==0?' class="firstRow"':"")+">");for(var a=0;a<r;a++){i.push('<td width="'+t+'"  vAlign="'+e.tdvalign+'" >'+(browser.ie&&browser.version<11?domUtils.fillChar:"<br/>")+"</td>")}i.push("</tr>")}return"<table><tbody>"+i.join("")+"</tbody></table>"}if(!t){t=utils.extend({},{numCols:this.options.defaultCols,numRows:this.options.defaultRows,tdvalign:this.options.tdvalign})}var n=this;var r=this.selection.getRange(),o=r.startContainer,a=domUtils.findParent(o,function(e){return domUtils.isBlockElm(e)},true)||n.body;var s=v(n),l=a.offsetWidth,d=Math.floor(l/t.numCols-s.tdPadding*2-s.tdBorder);!t.tdvalign&&(t.tdvalign=n.options.tdvalign);n.execCommand("inserthtml",i(t,d))}};UE.commands["insertparagraphbeforetable"]={queryCommandState:function(){return c(this).cell?0:-1},execCommand:function(){var e=c(this).table;if(e){var t=this.document.createElement("p");t.innerHTML=browser.ie?"&nbsp;":"<br />";e.parentNode.insertBefore(t,e);this.selection.getRange().setStart(t,0).setCursor()}}};UE.commands["deletetable"]={queryCommandState:function(){var e=this.selection.getRange();return domUtils.findParentByTagName(e.startContainer,"table",true)?0:-1},execCommand:function(e,t){var i=this.selection.getRange();t=t||domUtils.findParentByTagName(i.startContainer,"table",true);if(t){var n=t.nextSibling;if(!n){n=domUtils.createElement(this.document,"p",{innerHTML:browser.ie?domUtils.fillChar:"<br/>"});t.parentNode.insertBefore(n,t)}domUtils.remove(t);i=this.selection.getRange();if(n.nodeType==3){i.setStartBefore(n)}else{i.setStart(n,0)}i.setCursor(false,true);this.fireEvent("tablehasdeleted")}}};UE.commands["cellalign"]={queryCommandState:function(){return s(this).length?0:-1},execCommand:function(e,t){var i=s(this);if(i.length){for(var n=0,r;r=i[n++];){r.setAttribute("align",t)}}}};UE.commands["cellvalign"]={queryCommandState:function(){return s(this).length?0:-1},execCommand:function(e,t){var i=s(this);if(i.length){for(var n=0,r;r=i[n++];){r.setAttribute("vAlign",t)}}}};UE.commands["insertcaption"]={queryCommandState:function(){var e=c(this).table;if(e){return e.getElementsByTagName("caption").length==0?1:-1}return-1},execCommand:function(){var e=c(this).table;if(e){var t=this.document.createElement("caption");t.innerHTML=browser.ie?domUtils.fillChar:"<br/>";e.insertBefore(t,e.firstChild);var i=this.selection.getRange();i.setStart(t,0).setCursor()}}};UE.commands["deletecaption"]={queryCommandState:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");if(t){return t.getElementsByTagName("caption").length==0?-1:1}return-1},execCommand:function(){var e=this.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,"table");if(t){domUtils.remove(t.getElementsByTagName("caption")[0]);var i=this.selection.getRange();i.setStart(t.rows[0].cells[0],0).setCursor()}}};UE.commands["inserttitle"]={queryCommandState:function(){var e=c(this).table;if(e){var t=e.rows[0];return t.cells[t.cells.length-1].tagName.toLowerCase()!="th"?0:-1}return-1},execCommand:function(){var e=c(this).table;if(e){f(e).insertRow(0,"th")}var t=e.getElementsByTagName("th")[0];this.selection.getRange().setStart(t,0).setCursor(false,true)}};UE.commands["deletetitle"]={queryCommandState:function(){var e=c(this).table;if(e){var t=e.rows[0];return t.cells[t.cells.length-1].tagName.toLowerCase()=="th"?0:-1}return-1},execCommand:function(){var e=c(this).table;if(e){domUtils.remove(e.rows[0])}var t=e.getElementsByTagName("td")[0];this.selection.getRange().setStart(t,0).setCursor(false,true)}};UE.commands["inserttitlecol"]={queryCommandState:function(){var e=c(this).table;if(e){var t=e.rows[e.rows.length-1];return t.getElementsByTagName("th").length?-1:0}return-1},execCommand:function(e){var t=c(this).table;if(t){f(t).insertCol(0,"th")}r(t,this);var i=t.getElementsByTagName("th")[0];this.selection.getRange().setStart(i,0).setCursor(false,true)}};UE.commands["deletetitlecol"]={queryCommandState:function(){var e=c(this).table;if(e){var t=e.rows[e.rows.length-1];return t.getElementsByTagName("th").length?0:-1}return-1},execCommand:function(){var e=c(this).table;if(e){for(var t=0;t<e.rows.length;t++){domUtils.remove(e.rows[t].children[0])}}r(e,this);var i=e.getElementsByTagName("td")[0];this.selection.getRange().setStart(i,0).setCursor(false,true)}};UE.commands["mergeright"]={queryCommandState:function(e){var t=c(this),i=t.table,n=t.cell;if(!i||!n)return-1;var r=f(i);if(r.selectedTds.length)return-1;var o=r.getCellInfo(n),a=o.colIndex+o.colSpan;if(a>=r.colsNum)return-1;var s=r.indexTable[o.rowIndex][a],l=i.rows[s.rowIndex].cells[s.cellIndex];if(!l||n.tagName!=l.tagName)return-1;return s.rowIndex==o.rowIndex&&s.rowSpan==o.rowSpan?0:-1},execCommand:function(e){var t=this.selection.getRange(),i=t.createBookmark(true);var n=c(this).cell,r=f(n);r.mergeRight(n);t.moveToBookmark(i).select()}};UE.commands["mergedown"]={queryCommandState:function(e){var t=c(this),i=t.table,n=t.cell;if(!i||!n)return-1;var r=f(i);if(r.selectedTds.length)return-1;var o=r.getCellInfo(n),a=o.rowIndex+o.rowSpan;if(a>=r.rowsNum)return-1;var s=r.indexTable[a][o.colIndex],l=i.rows[s.rowIndex].cells[s.cellIndex];if(!l||n.tagName!=l.tagName)return-1;return s.colIndex==o.colIndex&&s.colSpan==o.colSpan?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this).cell,n=f(i);n.mergeDown(i);e.moveToBookmark(t).select()}};UE.commands["mergecells"]={queryCommandState:function(){return a(this)?0:-1},execCommand:function(){var e=a(this);if(e&&e.selectedTds.length){var t=e.selectedTds[0];e.mergeRange();var i=this.selection.getRange();if(domUtils.isEmptyBlock(t)){i.setStart(t,0).collapse(true)}else{i.selectNodeContents(t)}i.select()}}};UE.commands["insertrow"]={queryCommandState:function(){var e=c(this),t=e.cell;return t&&(t.tagName=="TD"||t.tagName=="TH"&&e.tr!==e.table.rows[0])&&f(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this),n=i.cell,r=i.table,o=f(r),a=o.getCellInfo(n);if(!o.selectedTds.length){o.insertRow(a.rowIndex,n)}else{var s=o.cellsRange;for(var l=0,d=s.endRowIndex-s.beginRowIndex+1;l<d;l++){o.insertRow(s.beginRowIndex,n)}}e.moveToBookmark(t).select();if(r.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",r)}};UE.commands["insertrownext"]={queryCommandState:function(){var e=c(this),t=e.cell;return t&&t.tagName=="TD"&&f(e.table).rowsNum<this.options.maxRowNum?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this),n=i.cell,r=i.table,o=f(r),a=o.getCellInfo(n);if(!o.selectedTds.length){o.insertRow(a.rowIndex+a.rowSpan,n)}else{var s=o.cellsRange;for(var l=0,d=s.endRowIndex-s.beginRowIndex+1;l<d;l++){o.insertRow(s.endRowIndex+1,n)}}e.moveToBookmark(t).select();if(r.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",r)}};UE.commands["deleterow"]={queryCommandState:function(){var e=c(this);return e.cell?0:-1},execCommand:function(){var e=c(this).cell,t=f(e),i=t.cellsRange,n=t.getCellInfo(e),r=t.getVSideCell(e),o=t.getVSideCell(e,true),a=this.selection.getRange();if(utils.isEmptyObject(i)){t.deleteRow(n.rowIndex)}else{for(var s=i.beginRowIndex;s<i.endRowIndex+1;s++){t.deleteRow(i.beginRowIndex)}}var l=t.table;if(!l.getElementsByTagName("td").length){var d=l.nextSibling;domUtils.remove(l);if(d){a.setStart(d,0).setCursor(false,true)}}else{if(n.rowSpan==1||n.rowSpan==i.endRowIndex-i.beginRowIndex+1){if(o||r)a.selectNodeContents(o||r).setCursor(false,true)}else{var u=t.getCell(n.rowIndex,t.indexTable[n.rowIndex][n.colIndex].cellIndex);if(u)a.selectNodeContents(u).setCursor(false,true)}}if(l.getAttribute("interlaced")==="enabled")this.fireEvent("interlacetable",l)}};UE.commands["insertcol"]={queryCommandState:function(e){var t=c(this),i=t.cell;return i&&(i.tagName=="TD"||i.tagName=="TH"&&i!==t.tr.cells[0])&&f(t.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(e){var t=this.selection.getRange(),i=t.createBookmark(true);if(this.queryCommandState(e)==-1)return;var n=c(this).cell,r=f(n),o=r.getCellInfo(n);if(!r.selectedTds.length){r.insertCol(o.colIndex,n)}else{var a=r.cellsRange;for(var s=0,l=a.endColIndex-a.beginColIndex+1;s<l;s++){r.insertCol(a.beginColIndex,n)}}t.moveToBookmark(i).select(true)}};UE.commands["insertcolnext"]={queryCommandState:function(){var e=c(this),t=e.cell;return t&&f(e.table).colsNum<this.options.maxColNum?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this).cell,n=f(i),r=n.getCellInfo(i);if(!n.selectedTds.length){n.insertCol(r.colIndex+r.colSpan,i)}else{var o=n.cellsRange;for(var a=0,s=o.endColIndex-o.beginColIndex+1;a<s;a++){n.insertCol(o.endColIndex+1,i)}}e.moveToBookmark(t).select()}};UE.commands["deletecol"]={queryCommandState:function(){var e=c(this);return e.cell?0:-1},execCommand:function(){var e=c(this).cell,t=f(e),i=t.cellsRange,n=t.getCellInfo(e),r=t.getHSideCell(e),o=t.getHSideCell(e,true);if(utils.isEmptyObject(i)){t.deleteCol(n.colIndex)}else{for(var a=i.beginColIndex;a<i.endColIndex+1;a++){t.deleteCol(i.beginColIndex)}}var s=t.table,l=this.selection.getRange();if(!s.getElementsByTagName("td").length){var d=s.nextSibling;domUtils.remove(s);if(d){l.setStart(d,0).setCursor(false,true)}}else{if(domUtils.inDoc(e,this.document)){l.setStart(e,0).setCursor(false,true)}else{if(o&&domUtils.inDoc(o,this.document)){l.selectNodeContents(o).setCursor(false,true)}else{if(r&&domUtils.inDoc(r,this.document)){l.selectNodeContents(r).setCursor(true,true)}}}}}};UE.commands["splittocells"]={queryCommandState:function(){var e=c(this),t=e.cell;if(!t)return-1;var i=f(e.table);if(i.selectedTds.length>0)return-1;return t&&(t.colSpan>1||t.rowSpan>1)?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this).cell,n=f(i);n.splitToCells(i);e.moveToBookmark(t).select()}};UE.commands["splittorows"]={queryCommandState:function(){var e=c(this),t=e.cell;if(!t)return-1;var i=f(e.table);if(i.selectedTds.length>0)return-1;return t&&t.rowSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this).cell,n=f(i);n.splitToRows(i);e.moveToBookmark(t).select()}};UE.commands["splittocols"]={queryCommandState:function(){var e=c(this),t=e.cell;if(!t)return-1;var i=f(e.table);if(i.selectedTds.length>0)return-1;return t&&t.colSpan>1?0:-1},execCommand:function(){var e=this.selection.getRange(),t=e.createBookmark(true);var i=c(this).cell,n=f(i);n.splitToCols(i);e.moveToBookmark(t).select()}};UE.commands["adaptbytext"]=UE.commands["adaptbywindow"]={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(e){var t=c(this),i=t.table;if(i){if(e=="adaptbywindow"){r(i,this)}else{var n=domUtils.getElementsByTagName(i,"td th");utils.each(n,function(e){e.removeAttribute("width")});i.removeAttribute("width")}}}};UE.commands["averagedistributecol"]={queryCommandState:function(){var e=a(this);if(!e)return-1;return e.isFullRow()||e.isFullCol()?0:-1},execCommand:function(e){var d=this,u=a(d);function t(){var e=u.table,t,i=0,n=0,r=v(d,e);if(u.isFullRow()){i=e.offsetWidth;n=u.colsNum}else{var o=u.cellsRange.beginColIndex,a=u.cellsRange.endColIndex,s;for(var l=o;l<=a;){s=u.selectedTds[l];i+=s.offsetWidth;l+=s.colSpan;n+=1}}t=Math.ceil(i/n)-r.tdBorder*2-r.tdPadding*2;return t}function i(t){utils.each(domUtils.getElementsByTagName(u.table,"th"),function(e){e.setAttribute("width","")});var e=u.isFullRow()?domUtils.getElementsByTagName(u.table,"td"):u.selectedTds;utils.each(e,function(e){if(e.colSpan==1){e.setAttribute("width",t)}})}if(u&&u.selectedTds.length){i(t())}}};UE.commands["averagedistributerow"]={queryCommandState:function(){var e=a(this);if(!e)return-1;if(e.selectedTds&&/th/gi.test(e.selectedTds[0].tagName))return-1;return e.isFullRow()||e.isFullCol()?0:-1},execCommand:function(e){var p=this,g=a(p);function t(){var e,t,i=0,n=g.table,r=v(p,n),o=parseInt(domUtils.getComputedStyle(n.getElementsByTagName("td")[0],"padding-top"));if(g.isFullCol()){var a=domUtils.getElementsByTagName(n,"caption"),s=domUtils.getElementsByTagName(n,"th"),l,d;if(a.length>0){l=a[0].offsetHeight}if(s.length>0){d=s[0].offsetHeight}i=n.offsetHeight-(l||0)-(d||0);t=s.length==0?g.rowsNum:g.rowsNum-1}else{var u=g.cellsRange.beginRowIndex,c=g.cellsRange.endRowIndex,f=0,m=domUtils.getElementsByTagName(n,"tr");for(var h=u;h<=c;h++){i+=m[h].offsetHeight;f+=1}t=f}if(browser.ie&&browser.version<9){e=Math.ceil(i/t)}else{e=Math.ceil(i/t)-r.tdBorder*2-o*2}return e}function i(t){var e=g.isFullCol()?domUtils.getElementsByTagName(g.table,"td"):g.selectedTds;utils.each(e,function(e){if(e.rowSpan==1){e.setAttribute("height",t)}})}if(g&&g.selectedTds.length){i(t())}}};UE.commands["cellalignment"]={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(e,t){var i=this,n=a(i);if(!n){var r=i.selection.getStart(),o=r&&domUtils.findParentByTagName(r,["td","th","caption"],true);if(!/caption/gi.test(o.tagName)){domUtils.setAttributes(o,t)}else{o.style.textAlign=t.align;o.style.verticalAlign=t.vAlign}i.selection.getRange().setCursor(true)}else{utils.each(n.selectedTds,function(e){domUtils.setAttributes(e,t)})}},queryCommandValue:function(e){var t=c(this).cell;if(!t){t=s(this)[0]}if(!t){return null}else{var i=UE.UETable.getUETable(t).selectedTds;!i.length&&(i=t);return UE.UETable.getTableCellAlignState(i)}}};UE.commands["tablealignment"]={queryCommandState:function(){if(browser.ie&&browser.version<8){return-1}return c(this).table?0:-1},execCommand:function(e,t){var i=this,n=i.selection.getStart(),r=n&&domUtils.findParentByTagName(n,["table"],true);if(r){r.setAttribute("align",t)}}};UE.commands["edittable"]={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(e,t){var i=this.selection.getRange(),n=domUtils.findParentByTagName(i.startContainer,"table");if(n){var r=domUtils.getElementsByTagName(n,"td").concat(domUtils.getElementsByTagName(n,"th"),domUtils.getElementsByTagName(n,"caption"));utils.each(r,function(e){e.style.borderColor=t})}}};UE.commands["edittd"]={queryCommandState:function(){return c(this).table?0:-1},execCommand:function(e,t){var i=this,n=a(i);if(!n){var r=i.selection.getStart(),o=r&&domUtils.findParentByTagName(r,["td","th","caption"],true);if(o){o.style.backgroundColor=t}}else{utils.each(n.selectedTds,function(e){e.style.backgroundColor=t})}}};UE.commands["settablebackground"]={queryCommandState:function(){return s(this).length>1?0:-1},execCommand:function(e,t){var i,n;i=s(this);n=f(i[0]);n.setBackground(i,t)}};UE.commands["cleartablebackground"]={queryCommandState:function(){var e=s(this);if(!e.length)return-1;for(var t=0,i;i=e[t++];){if(i.style.backgroundColor!=="")return 0}return-1},execCommand:function(){var e=s(this),t=f(e[0]);t.removeBackground(e)}};UE.commands["interlacetable"]=UE.commands["uninterlacetable"]={queryCommandState:function(e){var t=c(this).table;if(!t)return-1;var i=t.getAttribute("interlaced");if(e=="interlacetable"){return i==="enabled"?-1:0}else{return!i||i==="disabled"?-1:0}},execCommand:function(e,t){var i=c(this).table;if(e=="interlacetable"){i.setAttribute("interlaced","enabled");this.fireEvent("interlacetable",i,t)}else{i.setAttribute("interlaced","disabled");this.fireEvent("uninterlacetable",i)}}};UE.commands["setbordervisible"]={queryCommandState:function(e){var t=c(this).table;if(!t)return-1;return 0},execCommand:function(){var e=c(this).table;utils.each(domUtils.getElementsByTagName(e,"td"),function(e){e.style.borderWidth="1px";e.style.borderStyle="solid"})}};function r(e,t){var i=domUtils.getElementsByTagName(e,"td th");utils.each(i,function(e){e.removeAttribute("width")});e.setAttribute("width",o(t,true,v(t,e)));var n=[];setTimeout(function(){utils.each(i,function(e){e.colSpan==1&&n.push(e.offsetWidth)});utils.each(i,function(e,t){e.colSpan==1&&e.setAttribute("width",n[t]+"")})},0)}function o(e,t,i){var n=e.body;return n.offsetWidth-(t?parseInt(domUtils.getComputedStyle(n,"margin-left"),10)*2:0)-i.tableBorder*2-(e.options.offsetWidth||0)}function s(e){var t=c(e).cell;if(t){var i=f(t);return i.selectedTds.length?i.selectedTds:[t]}else{return[]}}})();UE.plugins["table"]=function(){var d=this,e=null,t=null,c=null,l=5,f=false,o=5,a=10,m=0,h=null,p=360,T=UE.UETable,S=function(e){return T.getUETable(e)},k=function(e){return T.getUETableBySelected(e)},B=function(e,t){return T.getDefaultValue(e,t)},s=function(e){return T.removeSelectedClass(e)};function u(e){}d.ready(function(){var i=this;var n=i.selection.getText;i.selection.getText=function(){var e=k(i);if(e){var t="";utils.each(e.selectedTds,function(e){t+=e[browser.ie?"innerText":"textContent"]});return t}else{return n.call(i.selection)}}});var g=null,v=null,b="",y=false,r=null,C=false,w=null,N=null;var x=false,I=true;d.setOpt({maxColNum:20,maxRowNum:100,defaultCols:5,defaultRows:5,tdvalign:"top",cursorpath:d.options.UEDITOR_HOME_URL+"themes/default/images/cursor_",tableDragable:false,classList:["ue-table-interlace-color-single","ue-table-interlace-color-double"]});d.getUETable=S;var _={deletetable:1,inserttable:1,cellvalign:1,insertcaption:1,deletecaption:1,inserttitle:1,deletetitle:1,mergeright:1,mergedown:1,mergecells:1,insertrow:1,insertrownext:1,deleterow:1,insertcol:1,insertcolnext:1,deletecol:1,splittocells:1,splittorows:1,splittocols:1,adaptbytext:1,adaptbywindow:1,adaptbycustomer:1,insertparagraph:1,insertparagraphbeforetable:1,averagedistributecol:1,averagedistributerow:1};d.ready(function(){utils.cssRule("table",".selectTdClass{background-color:#edf5fa !important}"+"table.noBorderTable td,table.noBorderTable th,table.noBorderTable caption{border:1px dashed #ddd !important}"+"table{margin-bottom:10px;border-collapse:collapse;display:table;}"+"td,th{padding: 5px 10px;border: 1px solid #DDD;}"+"caption{border:1px dashed #DDD;border-bottom:0;padding:3px;text-align:center;}"+"th{border-top:1px solid #BBB;background-color:#F7F7F7;}"+"table tr.firstRow th{border-top-width:2px;}"+".ue-table-interlace-color-single{ background-color: #fcfcfc; } .ue-table-interlace-color-double{ background-color: #f7faff; }"+"td p{margin:0;padding:0;}",d.document);var x,U,E;d.addListener("keydown",function(e,t){var i=this;var n=t.keyCode||t.which;if(n==8){var r=k(i);if(r&&r.selectedTds.length){if(r.isFullCol()){i.execCommand("deletecol")}else if(r.isFullRow()){i.execCommand("deleterow")}else{i.fireEvent("delcells")}domUtils.preventDefault(t)}var o=domUtils.findParentByTagName(i.selection.getStart(),"caption",true),a=i.selection.getRange();if(a.collapsed&&o&&L(o)){i.fireEvent("saveScene");var s=o.parentNode;domUtils.remove(o);if(s){a.setStart(s.rows[0].cells[0],0).setCursor(false,true)}i.fireEvent("saveScene")}}if(n==46){r=k(i);if(r){i.fireEvent("saveScene");for(var l=0,d;d=r.selectedTds[l++];){domUtils.fillNode(i.document,d)}i.fireEvent("saveScene");domUtils.preventDefault(t)}}if(n==13){var u=i.selection.getRange(),o=domUtils.findParentByTagName(u.startContainer,"caption",true);if(o){var s=domUtils.findParentByTagName(o,"table");if(!u.collapsed){u.deleteContents();i.fireEvent("saveScene")}else{if(o){u.setStart(s.rows[0].cells[0],0).setCursor(false,true)}}domUtils.preventDefault(t);return}if(u.collapsed){var s=domUtils.findParentByTagName(u.startContainer,"table");if(s){var c=s.rows[0].cells[0],f=domUtils.findParentByTagName(i.selection.getStart(),["td","th"],true),m=s.previousSibling;if(c===f&&(!m||m.nodeType==1&&m.tagName=="TABLE")&&domUtils.isStartInblock(u)){var h=domUtils.findParent(i.selection.getStart(),function(e){return domUtils.isBlockElm(e)},true);if(h&&(/t(h|d)/i.test(h.tagName)||h===f.firstChild)){i.execCommand("insertparagraphbeforetable");domUtils.preventDefault(t)}}}}}if((t.ctrlKey||t.metaKey)&&t.keyCode=="67"){x=null;var r=k(i);if(r){var p=r.selectedTds;U=r.isFullCol();E=r.isFullRow();x=[[r.cloneCell(p[0],null,true)]];for(var l=1,d;d=p[l];l++){if(d.parentNode!==p[l-1].parentNode){x.push([r.cloneCell(d,null,true)])}else{x[x.length-1].push(r.cloneCell(d,null,true))}}}}});d.addListener("tablehasdeleted",function(){F(this,false,"",null);if(r)domUtils.remove(r)});d.addListener("beforepaste",function(e,t){var i=this;var n=i.selection.getRange();if(domUtils.findParentByTagName(n.startContainer,"caption",true)){var r=i.document.createElement("div");r.innerHTML=t.html;t.html=r[browser.ie9below?"innerText":"textContent"];return}var o=k(i);if(x){i.fireEvent("saveScene");var n=i.selection.getRange();var a=domUtils.findParentByTagName(n.startContainer,["td","th"],true),s,l;if(a){var d=S(a);if(E){var u=d.getCellInfo(a).rowIndex;if(a.tagName=="TH"){u++}for(var c=0,f;f=x[c++];){var m=d.insertRow(u++,"td");for(var h=0,p;p=f[h];h++){var g=m.cells[h];if(!g){g=m.insertCell(h)}g.innerHTML=p.innerHTML;p.getAttribute("width")&&g.setAttribute("width",p.getAttribute("width"));p.getAttribute("vAlign")&&g.setAttribute("vAlign",p.getAttribute("vAlign"));p.getAttribute("align")&&g.setAttribute("align",p.getAttribute("align"));p.style.cssText&&(g.style.cssText=p.style.cssText)}for(var h=0,p;p=m.cells[h];h++){if(!f[h])break;p.innerHTML=f[h].innerHTML;f[h].getAttribute("width")&&p.setAttribute("width",f[h].getAttribute("width"));f[h].getAttribute("vAlign")&&p.setAttribute("vAlign",f[h].getAttribute("vAlign"));f[h].getAttribute("align")&&p.setAttribute("align",f[h].getAttribute("align"));f[h].style.cssText&&(p.style.cssText=f[h].style.cssText)}}}else{if(U){y=d.getCellInfo(a);var v=0;for(var h=0,f=x[0],p;p=f[h++];){v+=p.colSpan||1}i.__hasEnterExecCommand=true;for(c=0;c<v;c++){i.execCommand("insertcol")}i.__hasEnterExecCommand=false;a=d.table.rows[0].cells[y.cellIndex];if(a.tagName=="TH"){a=d.table.rows[1].cells[y.cellIndex]}}for(var c=0,f;f=x[c++];){s=a;for(var h=0,p;p=f[h++];){if(a){a.innerHTML=p.innerHTML;p.getAttribute("width")&&a.setAttribute("width",p.getAttribute("width"));p.getAttribute("vAlign")&&a.setAttribute("vAlign",p.getAttribute("vAlign"));p.getAttribute("align")&&a.setAttribute("align",p.getAttribute("align"));p.style.cssText&&(a.style.cssText=p.style.cssText);l=a;a=a.nextSibling}else{var b=p.cloneNode(true);domUtils.removeAttributes(b,["class","rowSpan","colSpan"]);l.parentNode.appendChild(b)}}a=d.getNextCell(s,true,true);if(!x[c])break;if(!a){var y=d.getCellInfo(s);d.table.insertRow(d.table.rows.length);d.update();a=d.getVSideCell(s,true)}}}d.update()}else{o=i.document.createElement("table");for(var c=0,f;f=x[c++];){var m=o.insertRow(o.rows.length);for(var h=0,p;p=f[h++];){b=T.cloneCell(p,null,true);domUtils.removeAttributes(b,["class"]);m.appendChild(b)}if(h==2&&b.rowSpan>1){b.rowSpan=1}}var C=B(i),w=i.body.offsetWidth-(I?parseInt(domUtils.getComputedStyle(i.body,"margin-left"),10)*2:0)-C.tableBorder*2-(i.options.offsetWidth||0);i.execCommand("insertHTML","<table  "+(U&&E?'width="'+w+'"':"")+">"+o.innerHTML.replace(/>\s*</g,"><").replace(/\bth\b/gi,"td")+"</table>")}i.fireEvent("contentchange");i.fireEvent("saveScene");t.html="";return true}else{var r=i.document.createElement("div"),N;r.innerHTML=t.html;N=r.getElementsByTagName("table");if(domUtils.findParentByTagName(i.selection.getStart(),"table")){utils.each(N,function(e){domUtils.remove(e)});if(domUtils.findParentByTagName(i.selection.getStart(),"caption",true)){r.innerHTML=r[browser.ie?"innerText":"textContent"]}}else{utils.each(N,function(e){A(e,true);domUtils.removeAttributes(e,["style","border"]);utils.each(domUtils.getElementsByTagName(e,"td"),function(e){if(L(e)){domUtils.fillNode(i.document,e)}A(e,true)})})}t.html=r.innerHTML}});d.addListener("afterpaste",function(){utils.each(domUtils.getElementsByTagName(d.body,"table"),function(e){if(e.offsetWidth>d.body.offsetWidth){var t=B(d,e);e.style.width=d.body.offsetWidth-(I?parseInt(domUtils.getComputedStyle(d.body,"margin-left"),10)*2:0)-t.tableBorder*2-(d.options.offsetWidth||0)+"px"}})});d.addListener("blur",function(){x=null});var e;d.addListener("keydown",function(){clearTimeout(e);e=setTimeout(function(){var e=d.selection.getRange(),t=domUtils.findParentByTagName(e.startContainer,["th","td"],true);if(t){var i=t.parentNode.parentNode.parentNode;if(i.offsetWidth>i.getAttribute("width")){t.style.wordBreak="break-all"}}},100)});d.addListener("selectionchange",function(){F(d,false,"",null)});d.addListener("contentchange",function(){var d=this;he(d);if(k(d))return;var e=d.selection.getRange();var t=e.startContainer;t=domUtils.findParentByTagName(t,["td","th"],true);utils.each(domUtils.getElementsByTagName(d.document,"table"),function(e){if(d.fireEvent("excludetable",e)===true)return;e.ueTable=new T(e);e.onmouseover=function(){d.fireEvent("tablemouseover",e)};e.onmousemove=function(){d.fireEvent("tablemousemove",e);d.options.tableDragable&&D(true,this,d);utils.defer(function(){d.fireEvent("contentchange",50)},true)};e.onmouseout=function(){d.fireEvent("tablemouseout",e);F(d,false,"",null);he(d)};e.onclick=function(e){e=d.window.event||e;var t=R(e.target||e.srcElement);if(!t)return;var i=S(t),n=i.table,r=i.getCellInfo(t),o,a=d.selection.getRange();if(P(n,t,e,true)){var s=i.getCell(i.indexTable[i.rowsNum-1][r.colIndex].rowIndex,i.indexTable[i.rowsNum-1][r.colIndex].cellIndex);if(e.shiftKey&&i.selectedTds.length){if(i.selectedTds[0]!==s){o=i.getCellsRange(i.selectedTds[0],s);i.setSelected(o)}else{a&&a.selectNodeContents(s).select()}}else{if(t!==s){o=i.getCellsRange(t,s);i.setSelected(o)}else{a&&a.selectNodeContents(s).select()}}return}if(P(n,t,e)){var l=i.getCell(i.indexTable[r.rowIndex][i.colsNum-1].rowIndex,i.indexTable[r.rowIndex][i.colsNum-1].cellIndex);if(e.shiftKey&&i.selectedTds.length){if(i.selectedTds[0]!==l){o=i.getCellsRange(i.selectedTds[0],l);i.setSelected(o)}else{a&&a.selectNodeContents(l).select()}}else{if(t!==l){o=i.getCellsRange(t,l);i.setSelected(o)}else{a&&a.selectNodeContents(l).select()}}}}});ge(d,true)});domUtils.on(d.document,"mousemove",n);domUtils.on(d.document,"mouseout",function(e){var t=e.target||e.srcElement;if(t.tagName=="TABLE"){F(d,false,"",null)}});d.addListener("interlacetable",function(e,t,i){if(!t)return;var n=this,r=t.rows,o=r.length,a=function(e,t,i){return e[t]?e[t]:i?e[t%e.length]:""};for(var s=0;s<o;s++){r[s].className=a(i||n.options.classList,s,true)}});d.addListener("uninterlacetable",function(e,t){if(!t)return;var i=this,n=t.rows,r=i.options.classList,o=n.length;for(var a=0;a<o;a++){domUtils.removeClasses(n[a],r)}});d.addListener("mousedown",W);d.addListener("mouseup",ee);domUtils.on(d.body,"dragstart",function(e){ee.call(d,"dragstart",e)});d.addOutputRule(function(e){utils.each(e.getNodesByTagName("div"),function(e){if(e.getAttr("id")=="ue_tableDragLine"){e.parentNode.removeChild(e)}})});var a=0;d.addListener("mousedown",function(){a=0});d.addListener("tabkeydown",function(){var e=this.selection.getRange(),t=e.getCommonAncestor(true,true),i=domUtils.findParentByTagName(t,"table");if(i){if(domUtils.findParentByTagName(t,"caption",true)){var n=domUtils.getElementsByTagName(i,"th td");if(n&&n.length){e.setStart(n[0],0).setCursor(false,true)}}else{var n=domUtils.findParentByTagName(t,["td","th"],true),r=S(n);a=n.rowSpan>1?a:r.getCellInfo(n).rowIndex;var o=r.getTabNextCell(n,a);if(o){if(L(o)){e.setStart(o,0).setCursor(false,true)}else{e.selectNodeContents(o).select()}}else{d.fireEvent("saveScene");d.__hasEnterExecCommand=true;this.execCommand("insertrownext");d.__hasEnterExecCommand=false;e=this.selection.getRange();e.setStart(i.rows[i.rows.length-1].cells[0],0).setCursor();d.fireEvent("saveScene")}}return true}});browser.ie&&d.addListener("selectionchange",function(){F(this,false,"",null)});d.addListener("keydown",function(e,t){var i=this;var n=t.keyCode||t.which;if(n==8||n==46){return}var r=!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey;r&&s(domUtils.getElementsByTagName(i.body,"td"));var o=k(i);if(!o)return;r&&o.clearSelected()});d.addListener("beforegetcontent",function(){ge(this,false);browser.ie&&utils.each(this.document.getElementsByTagName("caption"),function(e){if(domUtils.isEmptyNode(e)){e.innerHTML="&nbsp;"}})});d.addListener("aftergetcontent",function(){ge(this,true)});d.addListener("getAllHtml",function(){s(d.document.getElementsByTagName("td"))});d.addListener("fullscreenchanged",function(e,t){if(!t){var o=this.body.offsetWidth/document.body.offsetWidth,i=domUtils.getElementsByTagName(this.body,"table");utils.each(i,function(e){if(e.offsetWidth<d.body.offsetWidth)return false;var t=domUtils.getElementsByTagName(e,"td"),i=[];utils.each(t,function(e){i.push(e.offsetWidth)});for(var n=0,r;r=t[n];n++){r.setAttribute("width",Math.floor(i[n]*o))}e.setAttribute("width",Math.floor(ve(d,I,B(d))))})}});var p=d.execCommand;d.execCommand=function(e,t){var i=this,n=arguments;e=e.toLowerCase();var r=k(i),o,a=new dom.Range(i.document),s=i.commands[e]||UE.commands[e],l;if(!s)return;if(r&&!_[e]&&!s.notNeedUndo&&!i.__hasEnterExecCommand){i.__hasEnterExecCommand=true;i.fireEvent("beforeexeccommand",e);o=r.selectedTds;var d=-2,u=-2,c,f;for(var m=0,h;h=o[m];m++){if(L(h)){a.setStart(h,0).setCursor(false,true)}else{a.selectNode(h).select(true)}f=i.queryCommandState(e);c=i.queryCommandValue(e);if(f!=-1){if(d!==f||u!==c){i._ignoreContentChange=true;l=p.apply(i,arguments);i._ignoreContentChange=false}d=i.queryCommandState(e);u=i.queryCommandValue(e);if(domUtils.isEmptyBlock(h)){domUtils.fillNode(i.document,h)}}}a.setStart(o[0],0).shrinkBoundary(true).setCursor(false,true);i.fireEvent("contentchange");i.fireEvent("afterexeccommand",e);i.__hasEnterExecCommand=false;i._selectionChange()}else{l=p.apply(i,arguments)}return l}});function A(e,t){i(e,"width",true);i(e,"height",true)}function i(e,t,i){if(e.style[t]){i&&e.setAttribute(t,parseInt(e.style[t],10));e.style[t]=""}}function R(e){if(e.tagName=="TD"||e.tagName=="TH")return e;var t;if(t=domUtils.findParentByTagName(e,"td",true)||domUtils.findParentByTagName(e,"th",true))return t;return null}function L(e){var t=new RegExp(domUtils.fillChar,"g");if(e[browser.ie?"innerText":"textContent"].replace(/^\s*$/,"").replace(t,"").length>0){return 0}for(var i in dtd.$isNotEmpty){if(e.getElementsByTagName(i).length){return 0}}return 1}function U(e){if(e.pageX||e.pageY){return{x:e.pageX,y:e.pageY}}return{x:e.clientX+d.document.body.scrollLeft-d.document.body.clientLeft,y:e.clientY+d.document.body.scrollTop-d.document.body.clientTop}}function n(e){if(oe()){return}try{var t=R(e.target||e.srcElement),i;if(f){d.body.style.webkitUserSelect="none";if(Math.abs(h.x-e.clientX)>a||Math.abs(h.y-e.clientY)>a){J();f=false;m=0;Q(e)}}if(b&&N){m=0;d.body.style.webkitUserSelect="none";d.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();i=U(e);F(d,true,b,i,t);if(b=="h"){w.style.left=M(N,e)+"px"}else if(b=="v"){w.style.top=H(N,e)+"px"}return}if(t){if(d.fireEvent("excludetable",t)===true)return;i=U(e);var n=z(t,i),r=domUtils.findParentByTagName(t,"table",true);if(P(r,t,e,true)){if(d.fireEvent("excludetable",r)===true)return;d.body.style.cursor="url("+d.options.cursorpath+"h.png),pointer"}else if(P(r,t,e)){if(d.fireEvent("excludetable",r)===true)return;d.body.style.cursor="url("+d.options.cursorpath+"v.png),pointer"}else{d.body.style.cursor="text";var o=t;if(/\d/.test(n)){n=n.replace(/\d/,"");t=S(t).getPreviewCell(t,n=="v")}F(d,t?!!n:false,t?n:"",i,t)}}else{D(false,r,d)}}catch(e){u(e)}}var E;function D(e,t,i){if(!e){if(C)return;E=setTimeout(function(){!C&&r&&r.parentNode&&r.parentNode.removeChild(r)},2e3)}else{O(t,i)}}function O(o,a){var e=domUtils.getXY(o),t=o.ownerDocument;if(r&&r.parentNode)return r;r=t.createElement("div");r.contentEditable=false;r.innerHTML="";r.style.cssText="width:15px;height:15px;background-image:url("+a.options.UEDITOR_HOME_URL+"dialogs/table/dragicon.png);position: absolute;cursor:move;top:"+(e.y-15)+"px;left:"+e.x+"px;";domUtils.unSelectable(r);r.onmouseover=function(e){C=true};r.onmouseout=function(e){C=false};domUtils.on(r,"click",function(e,t){i(t,this)});domUtils.on(r,"dblclick",function(e,t){n(t)});domUtils.on(r,"dragstart",function(e,t){domUtils.preventDefault(t)});var s;function i(e,t){clearTimeout(s);s=setTimeout(function(){a.fireEvent("tableClicked",o,t)},300)}function n(e){clearTimeout(s);var t=S(o),i=o.rows[0].cells[0],n=t.getLastCell(),r=t.getCellsRange(i,n);a.selection.getRange().setStart(i,0).setCursor(false,true);t.setSelected(r)}t.body.appendChild(r)}function P(e,t,i,n){var r=U(i),o=z(t,r);if(n){var a=e.getElementsByTagName("caption")[0],s=a?a.offsetHeight:0;return o=="v1"&&r.y-domUtils.getXY(e).y-s<8}else{return o=="h1"&&r.x-domUtils.getXY(e).x<8}}function M(e,t){var i=S(e);if(i){var n=i.getSameEndPosCells(e,"x")[0],r=i.getSameStartPosXCells(e)[0],o=U(t).x,a=(n?domUtils.getXY(n).x:domUtils.getXY(i.table).x)+20,s=r?domUtils.getXY(r).x+r.offsetWidth-20:d.body.offsetWidth+5||parseInt(domUtils.getComputedStyle(d.body,"width"),10);a+=l;s-=l;return o<a?a:o>s?s:o}}function H(e,t){try{var i=domUtils.getXY(e).y,n=U(t).y;return n<i?i:n}catch(e){u(e)}}function F(e,t,i,n,r){try{e.body.style.cursor=i=="h"?"col-resize":i=="v"?"row-resize":"text";if(browser.ie){if(i&&!x&&!k(e)){me(e,e.document);pe(i,r)}else{he(e)}}y=t}catch(e){u(e)}}function $(){var e="_UETableResizeLine",t=this.document.getElementById(e);if(!t){t=this.document.createElement("div");t.id=e;t.contnetEditable=false;t.setAttribute("unselectable","on");var i={width:2*o+1+"px",position:"absolute","z-index":1e5,cursor:"col-resize",background:"red",display:"none"};t.onmouseout=function(){this.style.display="none"};utils.extend(t.style,i);this.document.body.appendChild(t)}return t}function q(e,t){var i=$.call(this),n=t.table,r={top:domUtils.getXY(n).y+"px",left:domUtils.getXY(e).x+e.offsetWidth-o+"px",display:"block",height:n.offsetHeight+"px"};utils.extend(i.style,r)}function V(e){var t=S(e);q.call(this,e,t)}function z(e,t){var i=domUtils.getXY(e);if(!i){return""}if(i.x+e.offsetWidth-t.x<o){return"h"}if(t.x-i.x<o){return"h1"}if(i.y+e.offsetHeight-t.y<o){return"v"}if(t.y-i.y<o){return"v1"}return""}function W(e,t){if(oe()){return}h={x:t.clientX,y:t.clientY};if(t.button==2){var i=k(d),n=false;if(i){var r=be(d,t);utils.each(i.selectedTds,function(e){if(e===r){n=true}});if(!n){s(domUtils.getElementsByTagName(d.body,"th td"));i.clearSelected()}else{r=i.selectedTds[0];setTimeout(function(){d.selection.getRange().setStart(r,0).setCursor(false,true)},0)}}}else{Y(t)}}function j(){e&&clearTimeout(e);e=null}function X(e){m=0;e=e||d.window.event;var t=R(e.target||e.srcElement);if(t){var i;if(i=z(t,U(e))){he(d);if(i=="h1"){i="h";if(P(domUtils.findParentByTagName(t,"table"),t,e)){d.execCommand("adaptbywindow")}else{t=S(t).getPreviewCell(t);if(t){var n=d.selection.getRange();n.selectNodeContents(t).setCursor(true,true)}}}if(i=="h"){var r=S(t),o=r.table,a=se(t,o,true);a=G(a,"left");r.width=r.offsetWidth;var s=[],l=[];utils.each(a,function(e){s.push(e.offsetWidth)});utils.each(a,function(e){e.removeAttribute("width")});window.setTimeout(function(){var n=true;utils.each(a,function(e,t){var i=e.offsetWidth;if(i>s[t]){n=false;return false}l.push(i)});var i=n?l:s;utils.each(a,function(e,t){e.width=i[t]-fe()})},0)}}}}function Y(e){s(domUtils.getElementsByTagName(d.body,"td th"));utils.each(d.document.getElementsByTagName("table"),function(e){e.ueTable=null});g=be(d,e);if(!g)return;var t=domUtils.findParentByTagName(g,"table",true);ut=S(t);ut&&ut.clearSelected();if(!y){d.document.body.style.webkitUserSelect="";x=true;d.addListener("mouseover",te)}else{K(e)}}function K(e){if(browser.ie){e=Z(e)}J();f=true;t=setTimeout(function(){Q(e)},p)}function G(e,t){var i=[],n=null;for(var r=0,o=e.length;r<o;r++){n=e[r][t];if(n){i.push(n)}}return i}function J(){t&&clearTimeout(t);t=null}function Z(e){var t=["pageX","pageY","clientX","clientY","srcElement","target"],i={};if(e){for(var n=0,r,o;r=t[n];n++){o=e[r];o&&(i[r]=o)}}return i}function Q(e){f=false;g=e.target||e.srcElement;if(!g)return;var t=z(g,U(e));if(/\d/.test(t)){t=t.replace(/\d/,"");g=S(g).getPreviewCell(g,t=="v")}he(d);me(d,d.document);d.fireEvent("saveScene");pe(t,g);x=true;b=t;N=g}function ee(e,t){if(oe()){return}J();f=false;if(y){m=++m%3;h={x:t.clientX,y:t.clientY};c=setTimeout(function(){m>0&&m--},p);if(m===2){m=0;X(t);return}}if(t.button==2)return;var i=this;var n=i.selection.getRange(),r=domUtils.findParentByTagName(n.startContainer,"table",true),o=domUtils.findParentByTagName(n.endContainer,"table",true);if(r||o){if(r===o){r=domUtils.findParentByTagName(n.startContainer,["td","th","caption"],true);o=domUtils.findParentByTagName(n.endContainer,["td","th","caption"],true);if(r!==o){i.selection.clearRange()}}else{i.selection.clearRange()}}x=false;i.document.body.style.webkitUserSelect="";if(b&&N){i.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();m=0;w=i.document.getElementById("ue_tableDragLine");if(w){var a=domUtils.getXY(N),s=domUtils.getXY(w);switch(b){case"h":re(N,s.x-a.x);break;case"v":ae(N,s.y-a.y-N.offsetHeight);break;default:}b="";N=null;he(i);i.fireEvent("saveScene");return}}if(!g){var l=domUtils.findParentByTagName(t.target||t.srcElement,"td",true);if(!l)l=domUtils.findParentByTagName(t.target||t.srcElement,"th",true);if(l&&(l.tagName=="TD"||l.tagName=="TH")){if(i.fireEvent("excludetable",l)===true)return;n=new dom.Range(i.document);n.setStart(l,0).setCursor(false,true)}}else{var d=S(g),u=d?d.selectedTds[0]:null;if(u){n=new dom.Range(i.document);if(domUtils.isEmptyBlock(u)){n.setStart(u,0).setCursor(false,true)}else{n.selectNodeContents(u).shrinkBoundary().setCursor(false,true)}}else{n=i.selection.getRange().shrinkBoundary();if(!n.collapsed){var r=domUtils.findParentByTagName(n.startContainer,["td","th"],true),o=domUtils.findParentByTagName(n.endContainer,["td","th"],true);if(r&&!o||!r&&o||r&&o&&r!==o){n.setCursor(false,true)}}}g=null;i.removeListener("mouseover",te)}i._selectionChange(250,t)}function te(e,t){if(oe()){return}var i=this,n=t.target||t.srcElement;v=domUtils.findParentByTagName(n,"td",true)||domUtils.findParentByTagName(n,"th",true);if(g&&v&&(g.tagName=="TD"&&v.tagName=="TD"||g.tagName=="TH"&&v.tagName=="TH")&&domUtils.findParentByTagName(g,"table")==domUtils.findParentByTagName(v,"table")){var r=S(v);if(g!=v){i.document.body.style.webkitUserSelect="none";i.selection.getNative()[browser.ie9below?"empty":"removeAllRanges"]();var o=r.getCellsRange(g,v);r.setSelected(o)}else{i.document.body.style.webkitUserSelect="";r.clearSelected()}}t.preventDefault?t.preventDefault():t.returnValue=false}function ie(e,t,i){var n=parseInt(domUtils.getComputedStyle(e,"line-height"),10),r=i+t;t=r<n?n:r;if(e.style.height)e.style.height="";e.rowSpan==1?e.setAttribute("height",t):e.removeAttribute&&e.removeAttribute("height")}function ne(e){if(!e)return 0;return parseInt(domUtils.getComputedStyle(e,"width"),10)}function re(e,t){var i=S(e);if(i){var n=i.table,r=se(e,n);n.style.width="";n.removeAttribute("width");t=de(t,e,r);if(e.nextSibling){var o=0;utils.each(r,function(e){e.left.width=+e.left.width+t;e.right&&(e.right.width=+e.right.width-t)})}else{utils.each(r,function(e){e.left.width-=-t})}}}function oe(){return d.body.contentEditable==="false"}function ae(e,t){if(Math.abs(t)<10)return;var i=S(e);if(i){var n=i.getSameEndPosCells(e,"y"),r=n[0]?n[0].offsetHeight:0;for(var o=0,a;a=n[o++];){ie(a,t,r)}}}function se(e,t,n){if(!t){t=domUtils.findParentByTagName(e,"table")}if(!t){return null}var i=domUtils.getNodeIndex(e),r=e,o=t.rows,a=0;while(r){if(r.nodeType===1){a+=r.colSpan||1}r=r.previousSibling}r=null;var s=[];utils.each(o,function(e){var t=e.cells,i=0;utils.each(t,function(e){i+=e.colSpan||1;if(i===a){s.push({left:e,right:e.nextSibling||null});return false}else if(i>a){if(n){s.push({left:e})}return false}})});return s}function le(e){var t=Number.MAX_VALUE;for(var i=0,n;n=e[i];i++){t=Math.min(t,n.width||ue(n))}return t}function de(i,e,t){i-=fe();if(i<0){return 0}i-=ue(e);var n=i<0?"left":"right";i=Math.abs(i);utils.each(t,function(e){var t=e[n];if(t){i=Math.min(i,ue(t)-l)}});i=i<0?0:i;return n==="left"?-i:i}function ue(e){var t=0,i=0,t=e.offsetWidth-fe();if(!e.nextSibling){t-=ce(e)}t=t<0?0:t;try{e.width=t}catch(e){}return t}function ce(e){tab=domUtils.findParentByTagName(e,"table",false);if(tab.offsetVal===undefined){var t=e.previousSibling;if(t){tab.offsetVal=e.offsetWidth-t.offsetWidth===T.borderWidth?T.borderWidth:0}else{tab.offsetVal=0}}return tab.offsetVal}function fe(){if(T.tabcellSpace===undefined){var e=null,t=d.document.createElement("table"),i=d.document.createElement("tbody"),n=d.document.createElement("tr"),r=d.document.createElement("td"),o=null;r.style.cssText="border: 0;";r.width=1;n.appendChild(r);n.appendChild(o=r.cloneNode(false));i.appendChild(n);t.appendChild(i);t.style.cssText="visibility: hidden;";d.body.appendChild(t);T.paddingSpace=r.offsetWidth-1;var a=t.offsetWidth;r.style.cssText="";o.style.cssText="";T.borderWidth=(t.offsetWidth-a)/3;T.tabcellSpace=T.paddingSpace+T.borderWidth;d.body.removeChild(t)}fe=function(){return T.tabcellSpace};return T.tabcellSpace}function me(e,t){if(x)return;w=e.document.createElement("div");domUtils.setAttributes(w,{id:"ue_tableDragLine",unselectable:"on",contenteditable:false,onresizestart:"return false",ondragstart:"return false",onselectstart:"return false",style:"background-color:blue;position:absolute;padding:0;margin:0;background-image:none;border:0px none;opacity:0;filter:alpha(opacity=0)"});e.body.appendChild(w)}function he(e){if(x)return;var t;while(t=e.document.getElementById("ue_tableDragLine")){domUtils.remove(t)}}function pe(e,t){if(!t)return;var i=domUtils.findParentByTagName(t,"table"),n=i.getElementsByTagName("caption"),r=i.offsetWidth,o=i.offsetHeight-(n.length>0?n[0].offsetHeight:0),a=domUtils.getXY(i),s=domUtils.getXY(t),l;switch(e){case"h":l="height:"+o+"px;top:"+(a.y+(n.length>0?n[0].offsetHeight:0))+"px;left:"+(s.x+t.offsetWidth);w.style.cssText=l+"px;position: absolute;display:block;background-color:blue;width:1px;border:0; color:blue;opacity:.3;filter:alpha(opacity=30)";break;case"v":l="width:"+r+"px;left:"+a.x+"px;top:"+(s.y+t.offsetHeight);w.style.cssText=l+"px;overflow:hidden;position: absolute;display:block;background-color:blue;height:1px;border:0;color:blue;opacity:.2;filter:alpha(opacity=20)";break;default:}}function ge(e,t){var i=domUtils.getElementsByTagName(e.body,"table"),n;for(var r=0,o;o=i[r++];){var a=domUtils.getElementsByTagName(o,"td");if(a[0]){if(t){n=a[0].style.borderColor.replace(/\s/g,"");if(/(#ffffff)|(rgb\(255,255,255\))/gi.test(n))domUtils.addClass(o,"noBorderTable")}else{domUtils.removeClasses(o,"noBorderTable")}}}}function ve(e,t,i){var n=e.body;return n.offsetWidth-(t?parseInt(domUtils.getComputedStyle(n,"margin-left"),10)*2:0)-i.tableBorder*2-(e.options.offsetWidth||0)}function be(e,t){var i=domUtils.findParentByTagName(t.target||t.srcElement,["td","th"],true),n=null;if(!i){return null}n=z(i,U(t));if(!i){return null}if(n==="h1"&&i.previousSibling){var r=domUtils.getXY(i),o=i.offsetWidth;if(Math.abs(r.x+o-t.clientX)>o/3){i=i.previousSibling}}else if(n==="v1"&&i.parentNode.previousSibling){var r=domUtils.getXY(i),a=i.offsetHeight;if(Math.abs(r.y+a-t.clientY)>a/3){i=i.parentNode.previousSibling.firstChild}}return i&&!(e.fireEvent("excludetable",i)===true)?i:null}};UE.UETable.prototype.sortTable=function(n,r){var e=this.table,t=e.rows,i=[],o=t[0].cells[0].tagName==="TH",a=0;if(this.selectedTds.length){var s=this.cellsRange,l=s.endRowIndex+1;for(var d=s.beginRowIndex;d<l;d++){i[d]=t[d]}i.splice(0,s.beginRowIndex);a=s.endRowIndex+1===this.rowsNum?0:s.endRowIndex+1}else{for(var d=0,l=t.length;d<l;d++){i[d]=t[d]}}var u={reversecurrent:function(e,t){return 1},orderbyasc:function(e,t){var i=e.innerText||e.textContent,n=t.innerText||t.textContent;return i.localeCompare(n)},reversebyasc:function(e,t){var i=e.innerHTML,n=t.innerHTML;return n.localeCompare(i)},orderbynum:function(e,t){var i=e[browser.ie?"innerText":"textContent"].match(/\d+/),n=t[browser.ie?"innerText":"textContent"].match(/\d+/);if(i)i=+i[0];if(n)n=+n[0];return(i||0)-(n||0)},reversebynum:function(e,t){var i=e[browser.ie?"innerText":"textContent"].match(/\d+/),n=t[browser.ie?"innerText":"textContent"].match(/\d+/);if(i)i=+i[0];if(n)n=+n[0];return(n||0)-(i||0)}};e.setAttribute("data-sort-type",r&&typeof r==="string"&&u[r]?r:"");o&&i.splice(0,1);i=utils.sort(i,function(e,t){var i;if(r&&typeof r==="function"){i=r.call(this,e.cells[n],t.cells[n])}else if(r&&typeof r==="number"){i=1}else if(r&&typeof r==="string"&&u[r]){i=u[r].call(this,e.cells[n],t.cells[n])}else{i=u["orderbyasc"].call(this,e.cells[n],t.cells[n])}return i});var c=e.ownerDocument.createDocumentFragment();for(var f=0,l=i.length;f<l;f++){c.appendChild(i[f])}var m=e.getElementsByTagName("tbody")[0];if(!a){m.appendChild(c)}else{m.insertBefore(c,t[a-s.endRowIndex+s.beginRowIndex-1])}};UE.plugins["tablesort"]=function(){var e=this,t=UE.UETable,d=function(e){return t.getUETable(e)},u=function(e){return t.getTableItemsByRange(e)};e.ready(function(){utils.cssRule("tablesort","table.sortEnabled tr.firstRow th,table.sortEnabled tr.firstRow td{padding-right:20px;background-repeat: no-repeat;background-position: center right;"+"   background-image:url("+e.options.themePath+e.options.theme+"/images/sortable.png);}",e.document);e.addListener("afterexeccommand",function(e,t){if(t=="mergeright"||t=="mergedown"||t=="mergecells"){this.execCommand("disablesort")}})});UE.commands["sorttable"]={queryCommandState:function(){var e=this,t=u(e);if(!t.cell)return-1;var i=t.table,n=i.getElementsByTagName("td");for(var r=0,o;o=n[r++];){if(o.rowSpan!=1||o.colSpan!=1)return-1}return 0},execCommand:function(e,t){var i=this,n=i.selection.getRange(),r=n.createBookmark(true),o=u(i),a=o.cell,s=d(o.table),l=s.getCellInfo(a);s.sortTable(l.cellIndex,t);n.moveToBookmark(r);try{n.select()}catch(e){}}};UE.commands["enablesort"]=UE.commands["disablesort"]={queryCommandState:function(e){var t=u(this).table;if(t&&e=="enablesort"){var i=domUtils.getElementsByTagName(t,"th td");for(var n=0;n<i.length;n++){if(i[n].getAttribute("colspan")>1||i[n].getAttribute("rowspan")>1)return-1}}return!t?-1:e=="enablesort"^t.getAttribute("data-sort")!="sortEnabled"?-1:0},execCommand:function(e){var t=u(this).table;t.setAttribute("data-sort",e=="enablesort"?"sortEnabled":"sortDisabled");e=="enablesort"?domUtils.addClass(t,"sortEnabled"):domUtils.removeClasses(t,"sortEnabled")}}};UE.plugins["contextmenu"]=function(){var d=this;d.setOpt("enableContextMenu",true);if(d.getOpt("enableContextMenu")===false){return}var u=d.getLang("contextMenu"),c,f=d.options.contextMenu||[{label:u["selectall"],cmdName:"selectall"},{label:u.cleardoc,cmdName:"cleardoc",exec:function(){if(confirm(u.confirmclear)){this.execCommand("cleardoc")}}},"-",{label:u.unlink,cmdName:"unlink"},"-",{group:u.paragraph,icon:"justifyjustify",subMenu:[{label:u.justifyleft,cmdName:"justify",value:"left"},{label:u.justifyright,cmdName:"justify",value:"right"},{label:u.justifycenter,cmdName:"justify",value:"center"},{label:u.justifyjustify,cmdName:"justify",value:"justify"}]},"-",{group:u.table,icon:"table",subMenu:[{label:u.inserttable,cmdName:"inserttable"},{label:u.deletetable,cmdName:"deletetable"},"-",{label:u.deleterow,cmdName:"deleterow"},{label:u.deletecol,cmdName:"deletecol"},{label:u.insertcol,cmdName:"insertcol"},{label:u.insertcolnext,cmdName:"insertcolnext"},{label:u.insertrow,cmdName:"insertrow"},{label:u.insertrownext,cmdName:"insertrownext"},"-",{label:u.insertcaption,cmdName:"insertcaption"},{label:u.deletecaption,cmdName:"deletecaption"},{label:u.inserttitle,cmdName:"inserttitle"},{label:u.deletetitle,cmdName:"deletetitle"},{label:u.inserttitlecol,cmdName:"inserttitlecol"},{label:u.deletetitlecol,cmdName:"deletetitlecol"},"-",{label:u.mergecells,cmdName:"mergecells"},{label:u.mergeright,cmdName:"mergeright"},{label:u.mergedown,cmdName:"mergedown"},"-",{label:u.splittorows,cmdName:"splittorows"},{label:u.splittocols,cmdName:"splittocols"},{label:u.splittocells,cmdName:"splittocells"},"-",{label:u.averageDiseRow,cmdName:"averagedistributerow"},{label:u.averageDisCol,cmdName:"averagedistributecol"},"-",{label:u.edittd,cmdName:"edittd",exec:function(){if(UE.ui["edittd"]){new UE.ui["edittd"](this)}this.getDialog("edittd").open()}},{label:u.edittable,cmdName:"edittable",exec:function(){if(UE.ui["edittable"]){new UE.ui["edittable"](this)}this.getDialog("edittable").open()}},{label:u.setbordervisible,cmdName:"setbordervisible"}]},{group:u.tablesort,icon:"tablesort",subMenu:[{label:u.enablesort,cmdName:"enablesort"},{label:u.disablesort,cmdName:"disablesort"},"-",{label:u.reversecurrent,cmdName:"sorttable",value:"reversecurrent"},{label:u.orderbyasc,cmdName:"sorttable",value:"orderbyasc"},{label:u.reversebyasc,cmdName:"sorttable",value:"reversebyasc"},{label:u.orderbynum,cmdName:"sorttable",value:"orderbynum"},{label:u.reversebynum,cmdName:"sorttable",value:"reversebynum"}]},{group:u.borderbk,icon:"borderBack",subMenu:[{label:u.setcolor,cmdName:"interlacetable",exec:function(){this.execCommand("interlacetable")}},{label:u.unsetcolor,cmdName:"uninterlacetable",exec:function(){this.execCommand("uninterlacetable")}},{label:u.setbackground,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#bbb","#ccc"]})}},{label:u.unsetbackground,cmdName:"cleartablebackground",exec:function(){this.execCommand("cleartablebackground")}},{label:u.redandblue,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["red","blue"]})}},{label:u.threecolorgradient,cmdName:"settablebackground",exec:function(){this.execCommand("settablebackground",{repeat:true,colorList:["#aaa","#bbb","#ccc"]})}}]},{group:u.aligntd,icon:"aligntd",subMenu:[{cmdName:"cellalignment",value:{align:"left",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"top"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"middle"}},{cmdName:"cellalignment",value:{align:"left",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"center",vAlign:"bottom"}},{cmdName:"cellalignment",value:{align:"right",vAlign:"bottom"}}]},{group:u.aligntable,icon:"aligntable",subMenu:[{cmdName:"tablealignment",className:"left",label:u.tableleft,value:"left"},{cmdName:"tablealignment",className:"center",label:u.tablecenter,value:"center"},{cmdName:"tablealignment",className:"right",label:u.tableright,value:"right"}]},"-",{label:u.insertparagraphbefore,cmdName:"insertparagraph",value:true},{label:u.insertparagraphafter,cmdName:"insertparagraph"},{label:u["copy"],cmdName:"copy"},{label:u["paste"],cmdName:"paste"}];if(!f.length){return}var m=UE.ui.uiUtils;d.addListener("contextmenu",function(e,t){var i=m.getViewportOffsetByEvent(t);d.fireEvent("beforeselectionchange");if(c){c.destroy()}for(var n=0,r,o=[];r=f[n];n++){var a;(function(e){if(e=="-"){if((a=o[o.length-1])&&a!=="-"){o.push("-")}}else if(e.hasOwnProperty("group")){for(var t=0,i,n=[];i=e.subMenu[t];t++){(function(e){if(e=="-"){if((a=n[n.length-1])&&a!=="-"){n.push("-")}else{n.splice(n.length-1)}}else{if((d.commands[e.cmdName]||UE.commands[e.cmdName]||e.query)&&(e.query?e.query():d.queryCommandState(e.cmdName))>-1){n.push({label:e.label||d.getLang("contextMenu."+e.cmdName+(e.value||""))||"",className:"edui-for-"+e.cmdName+(e.className?" edui-for-"+e.cmdName+"-"+e.className:""),onclick:e.exec?function(){e.exec.call(d)}:function(){d.execCommand(e.cmdName,e.value)}})}}})(i)}if(n.length){function r(){switch(e.icon){case"table":return d.getLang("contextMenu.table");case"justifyjustify":return d.getLang("contextMenu.paragraph");case"aligntd":return d.getLang("contextMenu.aligntd");case"aligntable":return d.getLang("contextMenu.aligntable");case"tablesort":return u.tablesort;case"borderBack":return u.borderbk;default:return""}}o.push({label:r(),className:"edui-for-"+e.icon,subMenu:{items:n,editor:d}})}}else{if((d.commands[e.cmdName]||UE.commands[e.cmdName]||e.query)&&(e.query?e.query.call(d):d.queryCommandState(e.cmdName))>-1){o.push({label:e.label||d.getLang("contextMenu."+e.cmdName),className:"edui-for-"+(e.icon?e.icon:e.cmdName+(e.value||"")),onclick:e.exec?function(){e.exec.call(d)}:function(){d.execCommand(e.cmdName,e.value)}})}}})(r)}if(o[o.length-1]=="-"){o.pop()}c=new UE.ui.Menu({items:o,className:"edui-contextmenu",editor:d});c.render();c.showAt(i);d.fireEvent("aftershowcontextmenu",c);domUtils.preventDefault(t);if(browser.ie){var s;try{s=d.selection.getNative().createRange()}catch(e){return}if(s.item){var l=new dom.Range(d.document);l.selectNode(s.item(0)).select(true,true)}}});d.addListener("aftershowcontextmenu",function(e,t){if(d.zeroclipboard){var i=t.items;for(var n in i){if(i[n].className=="edui-for-copy"){d.zeroclipboard.clip(i[n].getDom())}}}})};UE.plugins["shortcutmenu"]=function(){var e=this,a,s=e.options.shortcutMenu||[];if(!s.length){return}e.addListener("contextmenu mouseup",function(t,e){var i=this,n={type:t,target:e.target||e.srcElement,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY};setTimeout(function(){var e=i.selection.getRange();if(e.collapsed===false||t=="contextmenu"){if(!a){a=new baidu.editor.ui.ShortCutMenu({editor:i,items:s,theme:i.options.theme,className:"edui-shortcutmenu"});a.render();i.fireEvent("afterrendershortcutmenu",a)}a.show(n,!!UE.plugins["contextmenu"])}});if(t=="contextmenu"){domUtils.preventDefault(e);if(browser.ie9below){var r;try{r=i.selection.getNative().createRange()}catch(e){return}if(r.item){var o=new dom.Range(i.document);o.selectNode(r.item(0)).select(true,true)}}}});e.addListener("keydown",function(e){if(e=="keydown"){a&&!a.isHidden&&a.hide()}})};UE.plugins["basestyle"]=function(){var e={bold:["strong","b"],italic:["em","i"],subscript:["sub"],superscript:["sup"]},a=function(e,t){return domUtils.filterNodeList(e.selection.getStartElementPath(),t)},s=this;s.addshortcutkey({Bold:"ctrl+66",Italic:"ctrl+73",Underline:"ctrl+85"});s.addInputRule(function(e){utils.each(e.getNodesByTagName("b i"),function(e){switch(e.tagName){case"b":e.tagName="strong";break;case"i":e.tagName="em"}})});for(var t in e){(function(e,o){s.commands[e]={execCommand:function(e){var t=s.selection.getRange(),i=a(this,o);if(t.collapsed){if(i){var n=s.document.createTextNode("");t.insertNode(n).removeInlineStyle(o);t.setStartBefore(n);domUtils.remove(n)}else{var r=t.document.createElement(o[0]);if(e=="superscript"||e=="subscript"){n=s.document.createTextNode("");t.insertNode(n).removeInlineStyle(["sub","sup"]).setStartBefore(n).collapse(true)}t.insertNode(r).setStart(r,0)}t.collapse(true)}else{if(e=="superscript"||e=="subscript"){if(!i||i.tagName.toLowerCase()!=e){t.removeInlineStyle(["sub","sup"])}}i?t.removeInlineStyle(o):t.applyInlineStyle(o[0])}t.select()},queryCommandState:function(){return a(this,o)?1:0}}})(t,e[t])}};UE.plugins["elementpath"]=function(){var o,a,r=this;r.setOpt("elementPathEnabled",true);if(!r.options.elementPathEnabled){return}r.commands["elementpath"]={execCommand:function(e,t){var i=a[t],n=r.selection.getRange();o=t*1;n.selectNode(i).select()},queryCommandValue:function(){var e=[].concat(this.selection.getStartElementPath()).reverse(),t=[];a=e;for(var i=0,n;n=e[i];i++){if(n.nodeType==3){continue}var r=n.tagName.toLowerCase();if(r=="img"&&n.getAttribute("anchorname")){r="anchor"}t[i]=r;if(o==i){o=-1;break}}return t}}};UE.plugins["formatmatch"]=function(){var d=this,u=[],c,f=0;d.addListener("reset",function(){u=[];f=0});function m(e,t){if(browser.webkit){var i=t.target.tagName=="IMG"?t.target:null}function n(e){if(s){e.selectNode(s)}return e.applyInlineStyle(u[u.length-1].tagName,null,u)}d.undoManger&&d.undoManger.save();var r=d.selection.getRange(),o=i||r.getClosedNode();if(c&&o&&o.tagName=="IMG"){o.style.cssText+=";float:"+(c.style.cssFloat||c.style.styleFloat||"none")+";display:"+(c.style.display||"inline");c=null}else{if(!c){var a=r.collapsed;if(a){var s=d.document.createTextNode("match");r.insertNode(s).select()}d.__hasEnterExecCommand=true;var l=d.options.removeFormatAttributes;d.options.removeFormatAttributes="";d.execCommand("removeformat");d.options.removeFormatAttributes=l;d.__hasEnterExecCommand=false;r=d.selection.getRange();if(u.length){n(r)}if(s){r.setStartBefore(s).collapse(true)}r.select();s&&domUtils.remove(s)}}d.undoManger&&d.undoManger.save();d.removeListener("mouseup",m);f=0}d.commands["formatmatch"]={execCommand:function(e){if(f){f=0;u=[];d.removeListener("mouseup",m);return}var t=d.selection.getRange();c=t.getClosedNode();if(!c||c.tagName!="IMG"){t.collapse(true).shrinkBoundary();var i=t.startContainer;u=domUtils.findParents(i,true,function(e){return!domUtils.isBlockElm(e)&&e.nodeType==1});for(var n=0,r;r=u[n];n++){if(r.tagName=="A"){u.splice(n,1);break}}}d.addListener("mouseup",m);f=1},queryCommandState:function(){return f},notNeedUndo:1}};UE.plugin.register("searchreplace",function(){var o=this;var s={table:1,tbody:1,tr:1,ol:1,ul:1};function l(e,t,i){var n=t.searchStr;if(t.dir==-1){e=e.split("").reverse().join("");n=n.split("").reverse().join("");i=e.length-i}var r=new RegExp(n,"g"+(t.casesensitive?"":"i")),o;while(o=r.exec(e)){if(o.index>=i){return t.dir==-1?e.length-o.index-t.searchStr.length:o.index}}return-1}function c(e,t,i){var n,r,o=i.all||i.dir==1?"getNextDomNode":"getPreDomNode";if(domUtils.isBody(e)){e=e.firstChild}var a=1;while(e){n=e.nodeType==3?e.nodeValue:e[browser.ie?"innerText":"textContent"];r=l(n,i,t);a=0;if(r!=-1){return{node:e,index:r}}e=domUtils[o](e);while(e&&s[e.nodeName.toLowerCase()]){e=domUtils[o](e,true)}if(e){t=i.dir==-1?(e.nodeType==3?e.nodeValue:e[browser.ie?"innerText":"textContent"]).length:0}}}function f(e,t,i){var n=0,r=e.firstChild,o=0,a;while(r){if(r.nodeType==3){o=r.nodeValue.replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length;n+=o;if(n>=t){return{node:r,index:o-(n-t)}}}else if(!dtd.$empty[r.tagName]){o=r[browser.ie?"innerText":"textContent"].replace(/(^[\t\r\n]+)|([\t\r\n]+$)/,"").length;n+=o;if(n>=t){a=f(r,o-(n-t),i);if(a){return a}}}r=domUtils.getNextDomNode(r)}}function a(e,t){var i=e.selection.getRange(),n,r=t.searchStr,o=e.document.createElement("span");o.innerHTML="$$ueditor_searchreplace_key$$";i.shrinkBoundary(true);if(!i.collapsed){i.select();var a=e.selection.getText();if(new RegExp("^"+t.searchStr+"$",t.casesensitive?"":"i").test(a)){if(t.replaceStr!=undefined){m(i,t.replaceStr);i.select();return true}else{i.collapse(t.dir==-1)}}}i.insertNode(o);i.enlargeToBlockElm(true);n=i.startContainer;var s=n[browser.ie?"innerText":"textContent"].indexOf("$$ueditor_searchreplace_key$$");i.setStartBefore(o);domUtils.remove(o);var l=c(n,s,t);if(l){var d=f(l.node,l.index,r);var u=f(l.node,l.index+r.length,r);i.setStart(d.node,d.index).setEnd(u.node,u.index);if(t.replaceStr!==undefined){m(i,t.replaceStr)}i.select();return true}else{i.setCursor()}}function m(e,t){t=o.document.createTextNode(t);e.deleteContents().insertNode(t)}return{commands:{searchreplace:{execCommand:function(e,t){utils.extend(t,{all:false,casesensitive:false,dir:1},true);var i=0;if(t.all){var n=o.selection.getRange(),r=o.body.firstChild;if(r&&r.nodeType==1){n.setStart(r,0);n.shrinkBoundary(true)}else if(r.nodeType==3){n.setStartBefore(r)}n.collapse(true).select(true);if(t.replaceStr!==undefined){o.fireEvent("saveScene")}while(a(this,t)){i++}if(i){o.fireEvent("saveScene")}}else{if(t.replaceStr!==undefined){o.fireEvent("saveScene")}if(a(this,t)){i++}if(i){o.fireEvent("saveScene")}}return i},notNeedUndo:1}}}});UE.plugins["customstyle"]=function(){var a=this;a.setOpt({customstyle:[{tag:"h1",name:"tc",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:center;margin:0 0 20px 0;"},{tag:"h1",name:"tl",style:"font-size:32px;font-weight:bold;border-bottom:#ccc 2px solid;padding:0 4px 0 0;text-align:left;margin:0 0 10px 0;"},{tag:"span",name:"im",style:"font-size:16px;font-style:italic;font-weight:bold;line-height:18px;"},{tag:"span",name:"hi",style:"font-size:16px;font-style:italic;font-weight:bold;color:rgb(51, 153, 204);line-height:18px;"}]});a.commands["customstyle"]={execCommand:function(e,t){var i=this,n=t.tag,r=domUtils.findParent(i.selection.getStart(),function(e){return e.getAttribute("label")},true),o,a,s={};for(var l in t){if(t[l]!==undefined)s[l]=t[l]}delete s.tag;if(r&&r.getAttribute("label")==t.label){o=this.selection.getRange();a=o.createBookmark();if(o.collapsed){if(dtd.$block[r.tagName]){var d=i.document.createElement("p");d.className="ueditor-p";domUtils.moveChild(r,d);r.parentNode.insertBefore(d,r);domUtils.remove(r)}else{domUtils.remove(r,true)}}else{var u=domUtils.getCommonAncestor(a.start,a.end),c=domUtils.getElementsByTagName(u,n);if(new RegExp(n,"i").test(u.tagName)){c.push(u)}for(var f=0,m;m=c[f++];){if(m.getAttribute("label")==t.label){var h=domUtils.getPosition(m,a.start),p=domUtils.getPosition(m,a.end);if((h&domUtils.POSITION_FOLLOWING||h&domUtils.POSITION_CONTAINS)&&(p&domUtils.POSITION_PRECEDING||p&domUtils.POSITION_CONTAINS))if(dtd.$block[n]){var d=i.document.createElement("p");d.className="ueditor-p";domUtils.moveChild(m,d);m.parentNode.insertBefore(d,m)}domUtils.remove(m,true)}}r=domUtils.findParent(u,function(e){return e.getAttribute("label")==t.label},true);if(r){domUtils.remove(r,true)}}o.moveToBookmark(a).select()}else{if(dtd.$block[n]){this.execCommand("paragraph",n,s,"customstyle");o=i.selection.getRange();if(!o.collapsed){o.collapse();r=domUtils.findParent(i.selection.getStart(),function(e){return e.getAttribute("label")==t.label},true);var g=i.document.createElement("p");g.className="ueditor-p";domUtils.insertAfter(r,g);domUtils.fillNode(i.document,g);o.setStart(g,0).setCursor()}}else{o=i.selection.getRange();if(o.collapsed){r=i.document.createElement(n);domUtils.setAttributes(r,s);o.insertNode(r).setStart(r,0).setCursor();return}a=o.createBookmark();o.applyInlineStyle(n,s).moveToBookmark(a).select()}}},queryCommandValue:function(){var e=domUtils.filterNodeList(this.selection.getStartElementPath(),function(e){return e.getAttribute("label")});return e?e.getAttribute("label"):""}};a.addListener("keyup",function(e,t){var i=t.keyCode||t.which;if(i==32||i==13){var n=a.selection.getRange();if(n.collapsed){var r=domUtils.findParent(a.selection.getStart(),function(e){return e.getAttribute("label")},true);if(r&&dtd.$block[r.tagName]&&domUtils.isEmptyNode(r)){var o=a.document.createElement("p");o.className="ueditor-p";domUtils.insertAfter(r,o);domUtils.fillNode(a.document,o);domUtils.remove(r);n.setStart(o,0).setCursor()}}}})};UE.plugins["catchremoteimage"]=function(){var me=this,ajax=UE.ajax;if(me.options.catchRemoteImageEnable===undefined)return;me.setOpt({catchRemoteImageEnable:false});me.addListener("afterpaste",function(){me.fireEvent("catchRemoteImage")});me.addListener("catchRemoteImage",function(){var catcherLocalDomain=me.getOpt("catcherLocalDomain"),catcherActionUrl=me.getActionUrl(me.getOpt("catcherActionName")),catcherUrlPrefix=me.getOpt("catcherUrlPrefix"),catcherFieldName=me.getOpt("catcherFieldName");var remoteImages=[],imgs=domUtils.getElementsByTagName(me.document,"img"),test=function(e,t){if(e.indexOf(location.host)!=-1||/(^\.)|(^\/)/.test(e)){return true}if(t){for(var i=0,n;n=t[i++];){if(e.indexOf(n)!==-1){return true}}}return false};for(var i=0,ci;ci=imgs[i++];){if(ci.getAttribute("word_img")){continue}var src=ci.getAttribute("_src")||ci.src||"";if(/^(https?|ftp):/i.test(src)&&!test(src,catcherLocalDomain)){remoteImages.push(src)}}if(remoteImages.length){catchremoteimage(remoteImages,{success:function(r){try{var info=r.state!==undefined?r:eval("("+r.responseText+")")}catch(e){return}var i,j,ci,cj,oldSrc,newSrc,list=info.list;for(i=0;ci=imgs[i++];){oldSrc=ci.getAttribute("_src")||ci.src||"";for(j=0;cj=list[j++];){if(oldSrc==cj.source&&cj.state=="SUCCESS"){newSrc=catcherUrlPrefix+cj.url;domUtils.setAttributes(ci,{src:newSrc,_src:newSrc});break}}}me.fireEvent("catchremotesuccess")},error:function(){me.fireEvent("catchremoteerror")}})}function catchremoteimage(e,t){var i=utils.serializeParam(me.queryCommandValue("serverparam"))||"",n=utils.formatUrl(catcherActionUrl+(catcherActionUrl.indexOf("?")==-1?"?":"&")+i),r=utils.isCrossDomainUrl(n),o={method:"POST",dataType:r?"jsonp":"",timeout:6e4,onsuccess:t["success"],onerror:t["error"]};o[catcherFieldName]=e;ajax.request(n,o)}})};UE.plugin.register("snapscreen",function(){var me=this;var snapplugin;function getLocation(e){var t,i=document.createElement("a"),n=utils.serializeParam(me.queryCommandValue("serverparam"))||"";i.href=e;if(browser.ie){i.href=i.href}t=i.search;if(n){t=t+(t.indexOf("?")==-1?"?":"&")+n;t=t.replace(/[&]+/gi,"&")}return{port:i.port,hostname:i.hostname,path:i.pathname+t||+i.hash}}return{commands:{snapscreen:{execCommand:function(cmd){var url,local,res;var lang=me.getLang("snapScreen_plugin");if(!snapplugin){var container=me.container;var doc=me.container.ownerDocument||me.container.document;snapplugin=doc.createElement("object");try{snapplugin.type="application/x-pluginbaidusnap"}catch(e){return}snapplugin.style.cssText="position:absolute;left:-9999px;width:0;height:0;";snapplugin.setAttribute("width","0");snapplugin.setAttribute("height","0");container.appendChild(snapplugin)}function onSuccess(rs){try{rs=eval("("+rs+")");if(rs.state=="SUCCESS"){var opt=me.options;me.execCommand("insertimage",{src:opt.snapscreenUrlPrefix+rs.url,_src:opt.snapscreenUrlPrefix+rs.url,alt:rs.title||"",floatStyle:opt.snapscreenImgAlign})}else{alert(rs.state)}}catch(e){alert(lang.callBackErrorMsg)}}url=me.getActionUrl(me.getOpt("snapscreenActionName"));local=getLocation(url);setTimeout(function(){try{res=snapplugin.saveSnapshot(local.hostname,local.path,local.port)}catch(e){me.ui._dialogs["snapscreenDialog"].open();return}onSuccess(res)},50)},queryCommandState:function(){return navigator.userAgent.indexOf("Windows",0)!=-1?0:-1}}}}});UE.commands["insertparagraph"]={execCommand:function(e,t){var i=this,n=i.selection.getRange(),r=n.startContainer,o;while(r){if(domUtils.isBody(r)){break}o=r;r=r.parentNode}if(o){var a=i.document.createElement("p");a.className="ueditor-p";if(t){o.parentNode.insertBefore(a,o)}else{o.parentNode.insertBefore(a,o.nextSibling)}domUtils.fillNode(i.document,a);n.setStart(a,0).setCursor(false,true)}}};UE.plugin.register("webapp",function(){var i=this;function r(e,t){return!t?'<img title="'+e.title+'" width="'+e.width+'" height="'+e.height+'"'+' src="'+i.options.UEDITOR_HOME_URL+'themes/default/images/spacer.gif" _logo_url="'+e.logo+'" style="background:url('+e.logo+') no-repeat center center; border:1px solid gray;" class="edui-faked-webapp" _url="'+e.url+'" '+(e.align&&!e.cssfloat?'align="'+e.align+'"':"")+(e.cssfloat?'style="float:'+e.cssfloat+'"':"")+"/>":'<iframe class="edui-faked-webapp" title="'+e.title+'" '+(e.align&&!e.cssfloat?'align="'+e.align+'"':"")+(e.cssfloat?'style="float:'+e.cssfloat+'"':"")+'width="'+e.width+'" height="'+e.height+'"  scrolling="no" frameborder="0" src="'+e.url+'" logo_url = "'+e.logo+'"></iframe>'}return{outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){var t;if(e.getAttr("class")=="edui-faked-webapp"){t=r({title:e.getAttr("title"),width:e.getAttr("width"),height:e.getAttr("height"),align:e.getAttr("align"),cssfloat:e.getStyle("float"),url:e.getAttr("_url"),logo:e.getAttr("_logo_url")},true);var i=UE.uNode.createElement(t);e.parentNode.replaceChild(i,e)}})},inputRule:function(e){utils.each(e.getNodesByTagName("iframe"),function(e){if(e.getAttr("class")=="edui-faked-webapp"){var t=UE.uNode.createElement(r({title:e.getAttr("title"),width:e.getAttr("width"),height:e.getAttr("height"),align:e.getAttr("align"),cssfloat:e.getStyle("float"),url:e.getAttr("src"),logo:e.getAttr("logo_url")}));e.parentNode.replaceChild(t,e)}})},commands:{webapp:{execCommand:function(e,t){var i=this,n=r(utils.extend(t,{align:"none"}),false);i.execCommand("inserthtml",n)},queryCommandState:function(){var e=this,t=e.selection.getRange().getClosedNode(),i=t&&t.className=="edui-faked-webapp";return i?1:0}}}}});UE.plugins["template"]=function(){UE.commands["template"]={execCommand:function(e,t){t.html&&this.execCommand("inserthtml",t.html)}};this.addListener("click",function(e,t){var i=t.target||t.srcElement,n=this.selection.getRange();var r=domUtils.findParent(i,function(e){if(e.className&&domUtils.hasClass(e,"ue_t")){return e}},true);r&&n.selectNode(r).shrinkBoundary().select()});this.addListener("keydown",function(e,t){var i=this.selection.getRange();if(!i.collapsed){if(!t.ctrlKey&&!t.metaKey&&!t.shiftKey&&!t.altKey){var n=domUtils.findParent(i.startContainer,function(e){if(e.className&&domUtils.hasClass(e,"ue_t")){return e}},true);if(n){domUtils.removeClasses(n,["ue_t"])}}}})};UE.plugin.register("music",function(){var a=this;function o(e,t,i,n,r,o){return!o?"<img "+(n&&!r?'align="'+n+'"':"")+(r?'style="float:'+r+'"':"")+' width="'+t+'" height="'+i+'" _url="'+e+'" class="edui-faked-music"'+' src="'+a.options.langPath+a.options.lang+'/images/music.png" />':'<embed type="application/x-shockwave-flash" class="edui-faked-music" pluginspage="http://www.macromedia.com/go/getflashplayer"'+' src="'+e+'" width="'+t+'" height="'+i+'" '+(n&&!r?'align="'+n+'"':"")+(r?'style="float:'+r+'"':"")+' wmode="transparent" play="true" loop="false" menu="false" allowscriptaccess="never" allowfullscreen="true" >'}return{outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){var t;if(e.getAttr("class")=="edui-faked-music"){var i=e.getStyle("float");var n=e.getAttr("align");t=o(e.getAttr("_url"),e.getAttr("width"),e.getAttr("height"),n,i,true);var r=UE.uNode.createElement(t);e.parentNode.replaceChild(r,e)}})},inputRule:function(e){utils.each(e.getNodesByTagName("embed"),function(e){if(e.getAttr("class")=="edui-faked-music"){var t=e.getStyle("float");var i=e.getAttr("align");html=o(e.getAttr("src"),e.getAttr("width"),e.getAttr("height"),i,t,false);var n=UE.uNode.createElement(html);e.parentNode.replaceChild(n,e)}})},commands:{music:{execCommand:function(e,t){var i=this,n=o(t.url,t.width||400,t.height||95,"none",false);i.execCommand("inserthtml",n)},queryCommandState:function(){var e=this,t=e.selection.getRange().getClosedNode(),i=t&&t.className=="edui-faked-music";return i?1:0}}}}});UE.plugin.register("autoupload",function(){function a(e,t){var o=t;var i,a,n,r,s,l,d,u,c=/image\/\w+/i.test(e.type)?"image":"file",f="loading_"+(+new Date).toString(36);i=o.getOpt(c+"FieldName");a=o.getOpt(c+"UrlPrefix");n=o.getOpt(c+"MaxSize");r=o.getOpt(c+"AllowFiles");s=o.getActionUrl(o.getOpt(c+"ActionName"));d=function(e){var t=o.document.getElementById(f);t&&domUtils.remove(t);o.fireEvent("showmessage",{id:f,content:e,type:"error",timeout:4e3})};if(c=="image"){l='<img class="loadingclass" id="'+f+'" src="'+o.options.themePath+o.options.theme+'/images/spacer.gif" title="'+(o.getLang("autoupload.loading")||"")+'" >';u=function(e){var t=a+e.url,i=o.document.getElementById(f);if(i){i.setAttribute("src",t);i.setAttribute("_src",t);i.setAttribute("title",e.title||"");i.setAttribute("alt",e.original||"");i.removeAttribute("id");domUtils.removeClasses(i,"loadingclass")}}}else{l='<p class="ueditor-p">'+'<img class="loadingclass" id="'+f+'" src="'+o.options.themePath+o.options.theme+'/images/spacer.gif" title="'+(o.getLang("autoupload.loading")||"")+'" >'+"</p>";u=function(e){var t=a+e.url,i=o.document.getElementById(f);var n=o.selection.getRange(),r=n.createBookmark();n.selectNode(i).select();o.execCommand("insertfile",{url:t});n.moveToBookmark(r).select()}}o.execCommand("inserthtml",l);if(!o.getOpt(c+"ActionName")){d(o.getLang("autoupload.errorLoadConfig"));return}if(e.size>n){d(o.getLang("autoupload.exceedSizeError"));return}var m=e.name?e.name.substr(e.name.lastIndexOf(".")):"";if(m&&c!="image"||r&&(r.join("")+".").indexOf(m.toLowerCase()+".")==-1){d(o.getLang("autoupload.exceedTypeError"));return}var h=new XMLHttpRequest,p=new FormData,g=utils.serializeParam(o.queryCommandValue("serverparam"))||"",v=utils.formatUrl(s+(s.indexOf("?")==-1?"?":"&")+g);p.append(i,e,e.name||"blob."+e.type.substr("image/".length));p.append("type","ajax");h.open("post",v,true);h.setRequestHeader("X-Requested-With","XMLHttpRequest");h.addEventListener("load",function(e){try{var t=new Function("return "+utils.trim(e.target.response))();if(t.state=="SUCCESS"&&t.url){u(t)}else{d(t.state)}}catch(e){d(o.getLang("autoupload.loadError"))}});h.send(p)}function s(e){return e.clipboardData&&e.clipboardData.items&&e.clipboardData.items.length==1&&/^image\//.test(e.clipboardData.items[0].type)?e.clipboardData.items:null}function l(e){return e.dataTransfer&&e.dataTransfer.files?e.dataTransfer.files:null}return{outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}});utils.each(e.getNodesByTagName("p"),function(e){if(/\bloadpara\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}})},bindEvents:{ready:function(e){var o=this;if(window.FormData&&window.FileReader){domUtils.on(o.body,"paste drop",function(e){var t=false,i;i=e.type=="paste"?s(e):l(e);if(i){var n=i.length,r;while(n--){r=i[n];if(r.getAsFile)r=r.getAsFile();if(r&&r.size>0){a(r,o);t=true}}t&&e.preventDefault()}});domUtils.on(o.body,"dragover",function(e){if(e.dataTransfer.types[0]=="Files"){e.preventDefault()}});utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-left:1px;height: 22px;width: 22px;}\n"+".loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;"+"}",this.document)}}}}});UE.plugin.register("autosave",function(){var i=this,n=new Date,r=20,o=null;function e(e){var t;if(new Date-n<r){return}if(!e.hasContents()){o&&i.removePreferences(o);return}n=new Date;e._saveFlag=null;t=i.body.innerHTML;if(e.fireEvent("beforeautosave",{content:t})===false){return}i.setPreferences(o,t);e.fireEvent("afterautosave",{content:t})}return{defaultOptions:{saveInterval:500},bindEvents:{ready:function(){var e="-drafts-data",t=null;if(i.key){t=i.key+e}else{t=(i.container.parentNode.id||"ue-common")+e}o=(location.protocol+location.host+location.pathname).replace(/[.:\/]/g,"_")+t},contentchange:function(){if(!i.getOpt("enableAutoSave")){return}if(!o){return}if(i._saveFlag){window.clearTimeout(i._saveFlag)}if(i.options.saveInterval>0){i._saveFlag=window.setTimeout(function(){e(i)},i.options.saveInterval)}else{e(i)}}},commands:{clearlocaldata:{execCommand:function(e,t){if(o&&i.getPreferences(o)){i.removePreferences(o)}},notNeedUndo:true,ignoreContentChange:true},getlocaldata:{execCommand:function(e,t){return o?i.getPreferences(o)||"":""},notNeedUndo:true,ignoreContentChange:true},drafts:{execCommand:function(e,t){if(o){i.body.innerHTML=i.getPreferences(o)||'<p class="ueditor-p">'+domUtils.fillHtml+"</p>";i.focus(true)}},queryCommandState:function(){return o?i.getPreferences(o)===null?-1:0:-1},notNeedUndo:true,ignoreContentChange:true}}}});UE.plugin.register("charts",function(){var a=this;return{bindEvents:{chartserror:function(){}},commands:{charts:{execCommand:function(e,t){var i=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",true),n=[],r={};if(!i){return false}if(!s(i)){a.fireEvent("chartserror");return false}r.title=t.title||"";r.subTitle=t.subTitle||"";r.xTitle=t.xTitle||"";r.yTitle=t.yTitle||"";r.suffix=t.suffix||"";r.tip=t.tip||"";r.dataFormat=t.tableDataFormat||"";r.chartType=t.chartType||0;for(var o in r){if(!r.hasOwnProperty(o)){continue}n.push(o+":"+r[o])}i.setAttribute("data-chart",n.join(";"));domUtils.addClass(i,"edui-charts-table")},queryCommandState:function(e,t){var i=domUtils.findParentByTagName(this.selection.getRange().startContainer,"table",true);return i&&s(i)?0:-1}}},inputRule:function(e){utils.each(e.getNodesByTagName("table"),function(e){if(e.getAttr("data-chart")!==undefined){e.setAttr("style")}})},outputRule:function(e){utils.each(e.getNodesByTagName("table"),function(e){if(e.getAttr("data-chart")!==undefined){e.setAttr("style","display: none;")}})}};function s(e){var t=null,i=0;if(e.rows.length<2){return false}if(e.rows[0].cells.length<2){return false}t=e.rows[0].cells;i=t.length;for(var n=0,r;r=t[n];n++){if(r.tagName.toLowerCase()!=="th"){return false}}for(var n=1,o;o=e.rows[n];n++){if(o.cells.length!=i){return false}if(o.cells[0].tagName.toLowerCase()!=="th"){return false}for(var a=1,r;r=o.cells[a];a++){var s=utils.trim(r.innerText||r.textContent||"");s=s.replace(new RegExp(UE.dom.domUtils.fillChar,"g"),"").replace(/^\s+|\s+$/g,"");if(!/^\d*\.?\d+$/.test(s)){return false}}}return true}});UE.plugin.register("section",function(){function i(e){this.tag="";this.level=-1,this.dom=null;this.nextSection=null;this.previousSection=null;this.parentSection=null;this.startAddress=[];this.endAddress=[];this.children=[]}function p(e){var t=new i;return utils.extend(t,e)}function f(e,t){var i=t;for(var n=0;n<e.length;n++){if(!i.childNodes)return null;i=i.childNodes[e[n]]}return i}var n=this;return{bindMultiEvents:{type:"aftersetcontent afterscencerestore",handler:function(){n.fireEvent("updateSections")}},bindEvents:{ready:function(){n.fireEvent("updateSections");domUtils.on(n.body,"drop paste",function(){n.fireEvent("updateSections")})},afterexeccommand:function(e,t){if(t=="paragraph"){n.fireEvent("updateSections")}},keyup:function(e,t){var i=this,n=i.selection.getRange();if(n.collapsed!=true){i.fireEvent("updateSections")}else{var r=t.keyCode||t.which;if(r==13||r==8||r==46){i.fireEvent("updateSections")}}}},commands:{getsections:{execCommand:function(e,t){var i=t||["h1","h2","h3","h4","h5","h6"];for(var n=0;n<i.length;n++){if(typeof i[n]=="string"){i[n]=function(t){return function(e){return e.tagName==t.toUpperCase()}}(i[n])}else if(typeof i[n]!="function"){i[n]=function(e){return null}}}function c(e){for(var t=0;t<i.length;t++){if(i[t](e))return t}return-1}var f=this,r=p({level:-1,title:"root"}),m=r;function h(e,t){var i,n=null,r,o,a=e.childNodes;for(var s=0,l=a.length;s<l;s++){o=a[s];i=c(o);if(i>=0){var d=f.selection.getRange().selectNode(o).createAddress(true).startAddress,u=p({tag:o.tagName,title:o.innerText||o.textContent||"",level:i,dom:o,startAddress:utils.clone(d,[]),endAddress:utils.clone(d,[]),children:[]});m.nextSection=u;u.previousSection=m;r=m;while(i<=r.level){r=r.parentSection}u.parentSection=r;r.children.push(u);n=m=u}else{o.nodeType===1&&h(o,t);n&&n.endAddress[n.endAddress.length-1]++}}}h(f.body,r);return r},notNeedUndo:true},movesection:{execCommand:function(e,t,i,n){var r=this,o,a;if(!t||!i||i.level==-1)return;o=n?i.endAddress:i.startAddress;a=f(o,r.body);if(!o||!a||c(t.startAddress,t.endAddress,o))return;var s=f(t.startAddress,r.body),l=f(t.endAddress,r.body),d,u;if(n){d=l;while(d&&!(domUtils.getPosition(s,d)&domUtils.POSITION_FOLLOWING)){u=d.previousSibling;domUtils.insertAfter(a,d);if(d==s)break;d=u}}else{d=s;while(d&&!(domUtils.getPosition(d,l)&domUtils.POSITION_FOLLOWING)){u=d.nextSibling;a.parentNode.insertBefore(d,a);if(d==l)break;d=u}}r.fireEvent("updateSections");function c(e,t,i){var n=false,r=false;for(var o=0;o<e.length;o++){if(o>=i.length)break;if(i[o]>e[o]){n=true;break}else if(i[o]<e[o]){break}}for(var o=0;o<t.length;o++){if(o>=i.length)break;if(i[o]<e[o]){r=true;break}else if(i[o]>e[o]){break}}return n&&r}}},deletesection:{execCommand:function(e,t,i){var n=this;if(!t)return;function r(e){var t=n.body;for(var i=0;i<e.length;i++){if(!t.childNodes)return null;t=t.childNodes[e[i]]}return t}var o=r(t.startAddress),a=r(t.endAddress),s=o,l;if(!i){while(s&&domUtils.inDoc(a,n.document)&&!(domUtils.getPosition(s,a)&domUtils.POSITION_FOLLOWING)){l=s.nextSibling;domUtils.remove(s);s=l}}else{domUtils.remove(s)}n.fireEvent("updateSections")}},selectsection:{execCommand:function(e,t){if(!t&&!t.dom)return false;var i=this,n=i.selection.getRange(),r={startAddress:utils.clone(t.startAddress,[]),endAddress:utils.clone(t.endAddress,[])};r.endAddress[r.endAddress.length-1]++;n.moveToAddress(r).select().scrollToView();return true},notNeedUndo:true},scrolltosection:{execCommand:function(e,t){if(!t&&!t.dom)return false;var i=this,n=i.selection.getRange(),r={startAddress:t.startAddress,endAddress:t.endAddress};r.endAddress[r.endAddress.length-1]++;n.moveToAddress(r).scrollToView();return true},notNeedUndo:true}}}});UE.plugin.register("simpleupload",function(){var f=this,m=false,i;function n(){var o=i.offsetWidth||20,a=i.offsetHeight||20,s=document.createElement("iframe"),l="display:block;width:"+o+"px;height:"+a+"px;overflow:hidden;border:0;margin:0;padding:0;position:absolute;top:0;left:0;filter:alpha(opacity=0);-moz-opacity:0;-khtml-opacity: 0;opacity: 0;cursor:pointer;";domUtils.on(s,"load",function(){var e=(+new Date).toString(36),t,i,n;i=s.contentDocument||s.contentWindow.document;n=i.body;t=i.createElement("div");t.innerHTML='<form id="edui_form_'+e+'" target="edui_iframe_'+e+'" method="POST" enctype="multipart/form-data" action="'+f.getOpt("serverUrl")+'" '+'style="'+l+'">'+'<input id="edui_input_'+e+'" type="file" accept="image/*" name="'+f.options.imageFieldName+'" '+'style="'+l+'">'+"</form>"+'<iframe id="edui_iframe_'+e+'" name="edui_iframe_'+e+'" style="display:none;width:0;height:0;border:0;margin:0;padding:0;position:absolute;"></iframe>';t.className="edui-"+f.options.theme;t.id=f.ui.id+"_iframeupload";n.style.cssText=l;n.style.width=o+"px";n.style.height=a+"px";n.appendChild(t);if(n.parentNode){n.parentNode.style.width=o+"px";n.parentNode.style.height=o+"px"}var d=i.getElementById("edui_form_"+e);var u=i.getElementById("edui_input_"+e);var c=i.getElementById("edui_iframe_"+e);domUtils.on(u,"change",function(){if(!u.value)return;var o="loading_"+(+new Date).toString(36);var e=f.getActionUrl(f.getOpt("imageActionName"));var t=f.getOpt("imageAllowFiles");f.focus();f.execCommand("inserthtml",'<img class="loadingclass" id="'+o+'" src="'+f.options.themePath+f.options.theme+'/images/spacer.gif" title="'+(f.getLang("simpleupload.loading")||"")+'" >');/!* 判断后端配置是否没有加载成功 *!/;if(!f.getOpt("imageActionName")){errorHandler(f.getLang("autoupload.errorLoadConfig"));return}var i=u.value,n=i?i.substr(i.lastIndexOf(".")):"";if(!n||t&&(t.join("")+".").indexOf(n.toLowerCase()+".")==-1){l(f.getLang("simpleupload.exceedTypeError"));return}var r=utils.serializeParam(f.queryCommandValue("serverparam"))||"";var a=utils.formatUrl(e+(e.indexOf("?")==-1?"?":"&")+r);var s=new FormData;s.append("upfile",d[0].files[0]);$.ajax({url:a,type:"POST",cache:false,data:s,processData:false,contentType:false,success:function(e){e=JSON.parse(e);var t,i,n=(c.contentDocument||c.contentWindow.document).body,r=n.innerText||n.textContent||"";t=f.options.imageUrlPrefix+e.url;if(e.state=="SUCCESS"&&e.url){i=f.document.getElementById(o);i.setAttribute("src",t);i.setAttribute("_src",t);i.setAttribute("title",e.title||"");i.setAttribute("alt",e.original||"");i.removeAttribute("id");domUtils.removeClasses(i,"loadingclass")}else{l&&l(e.state)}d.reset()}});function l(e){if(o){var t=f.document.getElementById(o);t&&domUtils.remove(t);f.fireEvent("showmessage",{id:o,content:e,type:"error",timeout:4e3})}}});var r;f.addListener("selectionchange",function(){clearTimeout(r);r=setTimeout(function(){var e=f.queryCommandState("simpleupload");if(e==-1){u.disabled="disabled"}else{u.disabled=false}},400)});m=true});s.style.cssText=l;i.appendChild(s)}return{bindEvents:{ready:function(){utils.cssRule("loading",".loadingclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loading.gif') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;}\n"+".loaderrorclass{display:inline-block;cursor:default;background: url('"+this.options.themePath+this.options.theme+"/images/loaderror.png') no-repeat center center transparent;border:1px solid #cccccc;margin-right:1px;height: 22px;width: 22px;"+"}",this.document)},simpleuploadbtnready:function(e,t){i=t;f.afterConfigReady(n)}},outputRule:function(e){utils.each(e.getNodesByTagName("img"),function(e){if(/\b(loaderrorclass)|(bloaderrorclass)\b/.test(e.getAttr("class"))){e.parentNode.removeChild(e)}})},commands:{simpleupload:{queryCommandState:function(){return m?0:-1}}}}});UE.plugin.register("serverparam",function(){var e=this,n={};return{commands:{serverparam:{execCommand:function(e,t,i){if(t===undefined||t===null){n={}}else if(utils.isString(t)){if(i===undefined||i===null){delete n[t]}else{n[t]=i}}else if(utils.isObject(t)){utils.extend(n,t,true)}else if(utils.isFunction(t)){utils.extend(n,t(),true)}},queryCommandValue:function(){return n||{}}}}}});UE.plugin.register("insertfile",function(){var d=this;function u(e){var t=e.substr(e.lastIndexOf(".")+1).toLowerCase(),i={rar:"icon_rar.gif",zip:"icon_rar.gif",tar:"icon_rar.gif",gz:"icon_rar.gif",bz2:"icon_rar.gif",doc:"icon_doc.gif",docx:"icon_doc.gif",pdf:"icon_pdf.gif",mp3:"icon_mp3.gif",xls:"icon_xls.gif",chm:"icon_chm.gif",ppt:"icon_ppt.gif",pptx:"icon_ppt.gif",avi:"icon_mv.gif",rmvb:"icon_mv.gif",wmv:"icon_mv.gif",flv:"icon_mv.gif",swf:"icon_mv.gif",rm:"icon_mv.gif",exe:"icon_exe.gif",psd:"icon_psd.gif",txt:"icon_txt.gif",jpg:"icon_jpg.gif",png:"icon_jpg.gif",jpeg:"icon_jpg.gif",gif:"icon_jpg.gif",ico:"icon_jpg.gif",bmp:"icon_jpg.gif"};return i[t]?i[t]:i["txt"]}return{commands:{insertfile:{execCommand:function(e,t){t=utils.isArray(t)?t:[t];var i,n,r,o,a="",s=d.getOpt("UEDITOR_HOME_URL"),l=s+(s.substr(s.length-1)=="/"?"":"/")+"dialogs/attachment/fileTypeImages/";for(i=0;i<t.length;i++){n=t[i];r=l+u(n.url);o=n.title||n.url.substr(n.url.lastIndexOf("/")+1);a+='<p style="line-height: 16px;">'+'<img style="vertical-align: middle; margin-right: 2px;" src="'+r+'" _src="'+r+'" />'+'<a style="font-size:12px; color:#0066cc;" href="'+n.url+'" title="'+o+'">'+o+"</a>"+"</p>"}d.execCommand("insertHtml",a)}}}}});UE.plugins.xssFilter=function(){var e=UEDITOR_CONFIG;var r=e.whitList;function n(i){var n=i.tagName;var e=i.attrs;if(!r.hasOwnProperty(n)){i.parentNode.removeChild(i);return false}UE.utils.each(e,function(e,t){if(r[n].indexOf(t)===-1){i.setAttr(t)}})}if(r&&e.xssFilterRules){this.options.filterRules=function(){var i={};UE.utils.each(r,function(e,t){i[t]=function(e){return n(e)}});return i}()}var i=[];UE.utils.each(r,function(e,t){i.push(t)});if(r&&e.inputXssFilter){this.addInputRule(function(e){e.traversal(function(e){if(e.type!=="element"){return false}n(e)})})}if(r&&e.outputXssFilter){this.addOutputRule(function(e){e.traversal(function(e){if(e.type!=="element"){return false}n(e)})})}};var baidu=baidu||{};baidu.editor=baidu.editor||{};UE.ui=baidu.editor.ui={};(function(){var o=baidu.editor.browser,a=baidu.editor.dom.domUtils;var i="$EDITORUI";var n=window[i]={};var t="ID"+i;var r=0;var s=baidu.editor.ui.uiUtils={uid:function(e){return e?e[t]||(e[t]=++r):++r},hook:function(r,e){var o;if(r&&r._callbacks){o=r}else{o=function(){var e;if(r){e=r.apply(this,arguments)}var t=o._callbacks;var i=t.length;while(i--){var n=t[i].apply(this,arguments);if(e===undefined){e=n}}return e};o._callbacks=[]}o._callbacks.push(e);return o},createElementByHtml:function(e){var t=document.createElement("div");t.innerHTML=e;t=t.firstChild;t.parentNode.removeChild(t);return t},getViewportElement:function(){return o.ie&&o.quirks?document.body:document.documentElement},getClientRect:function(e){var t;try{t=e.getBoundingClientRect()}catch(e){t={left:0,top:0,height:0,width:0}}var i={left:Math.round(t.left),top:Math.round(t.top),height:Math.round(t.bottom-t.top),width:Math.round(t.right-t.left)};var n;while((n=e.ownerDocument)!==document&&(e=a.getWindow(n).frameElement)){t=e.getBoundingClientRect();i.left+=t.left;i.top+=t.top}i.bottom=i.top+i.height;i.right=i.left+i.width;return i},getViewportRect:function(){var e=s.getViewportElement();var t=(window.innerWidth||e.clientWidth)|0;var i=(window.innerHeight||e.clientHeight)|0;return{left:0,top:0,height:i,width:t,bottom:i,right:t}},setViewportOffset:function(e,t){var i;var n=s.getFixedLayer();if(e.parentNode===n){e.style.left=t.left+"px";e.style.top=t.top+"px"}else{a.setViewportOffset(e,t)}},getEventOffset:function(e){var t=e.target||e.srcElement;var i=s.getClientRect(t);var n=s.getViewportOffsetByEvent(e);return{left:n.left-i.left,top:n.top-i.top}},getViewportOffsetByEvent:function(e){var t=e.target||e.srcElement;var i=a.getWindow(t).frameElement;var n={left:e.clientX,top:e.clientY};if(i&&t.ownerDocument!==document){var r=s.getClientRect(i);n.left+=r.left;n.top+=r.top}return n},setGlobal:function(e,t){n[e]=t;return i+'["'+e+'"]'},unsetGlobal:function(e){delete n[e]},copyAttributes:function(e,t){var i=t.attributes;var n=i.length;while(n--){var r=i[n];if(r.nodeName!="style"&&r.nodeName!="class"&&(!o.ie||r.specified)){e.setAttribute(r.nodeName,r.nodeValue)}}if(t.className){a.addClass(e,t.className)}if(t.style.cssText){e.style.cssText+=";"+t.style.cssText}},removeStyle:function(e,t){if(e.style.removeProperty){e.style.removeProperty(t)}else if(e.style.removeAttribute){e.style.removeAttribute(t)}else throw""},contains:function(e,t){return e&&t&&(e===t?false:e.contains?e.contains(t):e.compareDocumentPosition(t)&16)},startDrag:function(e,n,t){var t=t||document;var r=e.clientX;var o=e.clientY;function i(e){var t=e.clientX-r;var i=e.clientY-o;n.ondragmove(t,i,e);if(e.stopPropagation){e.stopPropagation()}else{e.cancelBubble=true}}if(t.addEventListener){function a(e){t.removeEventListener("mousemove",i,true);t.removeEventListener("mouseup",a,true);window.removeEventListener("mouseup",a,true);n.ondragstop()}t.addEventListener("mousemove",i,true);t.addEventListener("mouseup",a,true);window.addEventListener("mouseup",a,true);e.preventDefault()}else{var s=e.srcElement;s.setCapture();function l(){s.releaseCapture();s.detachEvent("onmousemove",i);s.detachEvent("onmouseup",l);s.detachEvent("onlosecaptrue",l);n.ondragstop()}s.attachEvent("onmousemove",i);s.attachEvent("onmouseup",l);s.attachEvent("onlosecaptrue",l);e.returnValue=false}n.ondragstart()},getFixedLayer:function(){var e=document.getElementById("edui_fixedlayer");if(e==null){e=document.createElement("div");e.id="edui_fixedlayer";document.body.appendChild(e);if(o.ie&&o.version<=8){e.style.position="absolute";d();setTimeout(l)}else{e.style.position="fixed"}e.style.left="0";e.style.top="0";e.style.width="0";e.style.height="0"}return e},makeUnselectable:function(e){if(o.opera||o.ie&&o.version<9){e.unselectable="on";if(e.hasChildNodes()){for(var t=0;t<e.childNodes.length;t++){if(e.childNodes[t].nodeType==1){s.makeUnselectable(e.childNodes[t])}}}}else{if(e.style.MozUserSelect!==undefined){e.style.MozUserSelect="none"}else if(e.style.WebkitUserSelect!==undefined){e.style.WebkitUserSelect="none"}else if(e.style.KhtmlUserSelect!==undefined){e.style.KhtmlUserSelect="none"}}}};function l(){var e=document.getElementById("edui_fixedlayer");s.setViewportOffset(e,{left:0,top:0})}function d(e){a.on(window,"scroll",l);a.on(window,"resize",baidu.editor.utils.defer(l,0,true))}})();(function(){var e=baidu.editor.utils,d=baidu.editor.ui.uiUtils,t=baidu.editor.EventBase,i=baidu.editor.ui.UIBase=function(){};i.prototype={className:"",uiName:"",initOptions:function(e){var t=this;for(var i in e){t[i]=e[i]}this.id=this.id||"edui"+d.uid()},initUIBase:function(){this._globalKey=e.unhtml(d.setGlobal(this.id,this))},render:function(e){var t=this.renderHtml();var i=d.createElementByHtml(t);var n=domUtils.getElementsByTagName(i,"*");var r="edui-"+(this.theme||this.editor.options.theme);var o=document.getElementById("edui_fixedlayer");for(var a=0,s;s=n[a++];){domUtils.addClass(s,r)}domUtils.addClass(i,r);if(o){o.className="";domUtils.addClass(o,r)}var l=this.getDom();if(l!=null){l.parentNode.replaceChild(i,l);d.copyAttributes(i,l)}else{if(typeof e=="string"){e=document.getElementById(e)}e=e||d.getFixedLayer();domUtils.addClass(e,r);e.appendChild(i)}this.postRender()},getDom:function(e){if(!e){return document.getElementById(this.id)}else{return document.getElementById(this.id+"_"+e)}},postRender:function(){this.fireEvent("postrender")},getHtmlTpl:function(){return""},formatHtml:function(e){var t="edui-"+this.uiName;return e.replace(/##/g,this.id).replace(/%%-/g,this.uiName?t+"-":"").replace(/%%/g,(this.uiName?t:"")+" "+this.className).replace(/\$\$/g,this._globalKey)},renderHtml:function(){return this.formatHtml(this.getHtmlTpl())},dispose:function(){var e=this.getDom();if(e)baidu.editor.dom.domUtils.remove(e);d.unsetGlobal(this.id)}};e.inherits(i,t)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Separator=function(e){this.initOptions(e);this.initSeparator()};i.prototype={uiName:"separator",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-box %%"></div>'}};e.inherits(i,t)})();(function(){var e=baidu.editor.utils,t=baidu.editor.dom.domUtils,i=baidu.editor.ui.UIBase,n=baidu.editor.ui.uiUtils;var r=baidu.editor.ui.Mask=function(e){this.initOptions(e);this.initUIBase()};r.prototype={getHtmlTpl:function(){return'<div id="##" class="edui-mask %%" onclick="return $$._onClick(event, this);" onmousedown="return $$._onMouseDown(event, this);"></div>'},postRender:function(){var e=this;t.on(window,"resize",function(){setTimeout(function(){if(!e.isHidden()){e._fill()}})})},show:function(e){this._fill();this.getDom().style.display="";this.getDom().style.zIndex=e},hide:function(){this.getDom().style.display="none";this.getDom().style.zIndex=""},isHidden:function(){return this.getDom().style.display=="none"},_onMouseDown:function(){return false},_onClick:function(e,t){this.fireEvent("click",e,t)},_fill:function(){var e=this.getDom();var t=n.getViewportRect();e.style.width=t.width+"px";e.style.height=t.height+"px"}};e.inherits(r,i)})();(function(){var e=baidu.editor.utils,u=baidu.editor.ui.uiUtils,c=baidu.editor.dom.domUtils,a=baidu.editor.ui.UIBase,t=baidu.editor.ui.Popup=function(e){this.initOptions(e);this.initPopup()};var r=[];function i(e,t){for(var i=0;i<r.length;i++){var n=r[i];if(!n.isHidden()){if(n.queryAutoHide(t)!==false){if(e&&/scroll/gi.test(e.type)&&n.className=="edui-wordpastepop")return;n.hide()}}}if(r.length)n.editor.fireEvent("afterhidepop")}t.postHide=i;var f=["edui-anchor-topleft","edui-anchor-topright","edui-anchor-bottomleft","edui-anchor-bottomright"];t.prototype={SHADOW_RADIUS:5,content:null,_hidden:false,autoRender:true,canSideLeft:true,canSideUp:true,initPopup:function(){this.initUIBase();r.push(this)},getHtmlTpl:function(){return'<div id="##" class="edui-popup %%" onmousedown="return false;">'+' <div id="##_body" class="edui-popup-body">'+' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe>'+' <div class="edui-shadow"></div>'+' <div id="##_content" class="edui-popup-content">'+this.getContentHtmlTpl()+"  </div>"+" </div>"+"</div>"},getContentHtmlTpl:function(){if(this.content){if(typeof this.content=="string"){return this.content}return this.content.renderHtml()}else{return""}},_UIBase_postRender:a.prototype.postRender,postRender:function(){if(this.content instanceof a){this.content.postRender()}if(this.captureWheel&&!this.captured){this.captured=true;var e=(document.documentElement.clientHeight||document.body.clientHeight)-80,t=this.getDom().offsetHeight,i=u.getClientRect(this.combox.getDom()).top,n=this.getDom("content"),r=this.getDom("body").getElementsByTagName("iframe"),o=this;r.length&&(r=r[0]);while(i+t>e){t-=30}n.style.height=t+"px";r&&(r.style.height=t+"px");if(window.XMLHttpRequest){c.on(n,"onmousewheel"in document.body?"mousewheel":"DOMMouseScroll",function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}if(e.wheelDelta){n.scrollTop-=e.wheelDelta/120*60}else{n.scrollTop-=e.detail/-3*60}})}else{c.on(this.getDom(),"mousewheel",function(e){e.returnValue=false;o.getDom("content").scrollTop-=e.wheelDelta/120*60})}}this.fireEvent("postRenderAfter");this.hide(true);this._UIBase_postRender()},_doAutoRender:function(){if(!this.getDom()&&this.autoRender){this.render()}},mesureSize:function(){var e=this.getDom("content");return u.getClientRect(e)},fitSize:function(){if(this.captureWheel&&this.sized){return this.__size}this.sized=true;var e=this.getDom("body");e.style.width="";e.style.height="";var t=this.mesureSize();if(this.captureWheel){e.style.width=-(-20-t.width)+"px";var i=parseInt(this.getDom("content").style.height,10);!window.isNaN(i)&&(t.height=i)}else{e.style.width=t.width+"px"}e.style.height=t.height+"px";this.__size=t;this.captureWheel&&(this.getDom("content").style.overflow="auto");return t},showAnchor:function(e,t){this.showAnchorRect(u.getClientRect(e),t)},showAnchorRect:function(e,t,i){this._doAutoRender();var n=u.getViewportRect();this.getDom().style.visibility="hidden";this._show();var r=this.fitSize();var o,a,s,l;if(t){o=this.canSideLeft&&(e.right+r.width>n.right&&e.left>r.width);a=this.canSideUp&&(e.top+r.height>n.bottom&&e.bottom>r.height);s=o?e.left-r.width:e.right;l=a?e.bottom-r.height:e.top}else{o=this.canSideLeft&&(e.right+r.width>n.right&&e.left>r.width);a=this.canSideUp&&(e.top+r.height>n.bottom&&e.bottom>r.height);s=o?e.right-r.width:e.left;l=a?e.top-r.height:e.bottom}var d=this.getDom();u.setViewportOffset(d,{left:s,top:l});c.removeClasses(d,f);d.className+=" "+f[(a?1:0)*2+(o?1:0)];if(this.editor){d.style.zIndex=this.editor.container.style.zIndex*1+10;baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=d.style.zIndex-1}this.getDom().style.visibility="visible"},showAt:function(e){var t=e.left;var i=e.top;var n={left:t,top:i,right:t,bottom:i,height:0,width:0};this.showAnchorRect(n,false,true)},_show:function(){if(this._hidden){var e=this.getDom();e.style.display="";this._hidden=false;this.fireEvent("show")}},isHidden:function(){return this._hidden},show:function(){this._doAutoRender();this._show()},hide:function(e){if(!this._hidden&&this.getDom()){this.getDom().style.display="none";this._hidden=true;if(!e){this.fireEvent("hide")}}},queryAutoHide:function(e){return!e||!u.contains(this.getDom(),e)}};e.inherits(t,a);c.on(document,"mousedown",function(e){var t=e.target||e.srcElement;i(e,t)});c.on(window,"scroll",function(e,t){i(e,t)})})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.ColorPicker=function(e){this.initOptions(e);this.noColorText=this.noColorText||this.editor.getLang("clearColor");this.initUIBase()};i.prototype={getHtmlTpl:function(){return n(this.noColorText,this.editor)},_onTableClick:function(e){var t=e.target||e.srcElement;var i=t.getAttribute("data-color");if(i){this.fireEvent("pickcolor",i)}},_onTableOver:function(e){var t=e.target||e.srcElement;var i=t.getAttribute("data-color");if(i){this.getDom("preview").style.backgroundColor=i}},_onTableOut:function(){this.getDom("preview").style.backgroundColor=""},_onPickNoColor:function(){this.fireEvent("picknocolor")}};e.inherits(i,t);var r=("ffffff,000000,eeece1,1f497d,4f81bd,c0504d,9bbb59,8064a2,4bacc6,f79646,"+"f2f2f2,7f7f7f,ddd9c3,c6d9f0,dbe5f1,f2dcdb,ebf1dd,e5e0ec,dbeef3,fdeada,"+"d8d8d8,595959,c4bd97,8db3e2,b8cce4,e5b9b7,d7e3bc,ccc1d9,b7dde8,fbd5b5,"+"bfbfbf,3f3f3f,938953,548dd4,95b3d7,d99694,c3d69b,b2a2c7,92cddc,fac08f,"+"a5a5a5,262626,494429,17365d,366092,953734,76923c,5f497a,31859b,e36c09,"+"7f7f7f,0c0c0c,1d1b10,0f243e,244061,632423,4f6128,3f3151,205867,974806,"+"c00000,ff0000,ffc000,ffff00,92d050,00b050,00b0f0,0070c0,002060,7030a0,").split(",");function n(e,t){var i='<div id="##" class="edui-colorpicker %%">'+'<div class="edui-colorpicker-topbar edui-clearfix">'+'<div unselectable="on" id="##_preview" class="edui-colorpicker-preview"></div>'+'<div unselectable="on" class="edui-colorpicker-nocolor" onclick="$$._onPickNoColor(event, this);">'+e+"</div>"+"</div>"+'<table  class="edui-box" style="border-collapse: collapse;" onmouseover="$$._onTableOver(event, this);" onmouseout="$$._onTableOut(event, this);" onclick="return $$._onTableClick(event, this);" cellspacing="0" cellpadding="0">'+'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;padding-top: 2px"><td colspan="10">'+t.getLang("themeColor")+"</td> </tr>"+'<tr class="edui-colorpicker-tablefirstrow" >';for(var n=0;n<r.length;n++){if(n&&n%10===0){i+="</tr>"+(n==60?'<tr style="border-bottom: 1px solid #ddd;font-size: 13px;line-height: 25px;color:#39C;"><td colspan="10">'+t.getLang("standardColor")+"</td></tr>":"")+"<tr"+(n==60?' class="edui-colorpicker-tablefirstrow"':"")+">"}i+=n<70?'<td style="padding: 0 2px;"><a hidefocus title="'+r[n]+'" onclick="return false;" href="javascript:" unselectable="on" class="edui-box edui-colorpicker-colorcell"'+' data-color="#'+r[n]+'"'+' style="background-color:#'+r[n]+";border:solid #ccc;"+(n<10||n>=60?"border-width:1px;":n>=10&&n<20?"border-width:1px 1px 0 1px;":"border-width:0 1px 0 1px;")+'"'+"></a></td>":""}i+="</tr></table></div>";return i}})();(function(){var e=baidu.editor.utils,s=baidu.editor.ui.uiUtils,t=baidu.editor.ui.UIBase;var i=baidu.editor.ui.TablePicker=function(e){this.initOptions(e);this.initTablePicker()};i.prototype={defaultNumRows:10,defaultNumCols:10,maxNumRows:20,maxNumCols:20,numRows:10,numCols:10,lengthOfCellSide:22,initTablePicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this;return'<div id="##" class="edui-tablepicker %%">'+'<div class="edui-tablepicker-body">'+'<div class="edui-infoarea">'+'<span id="##_label" class="edui-label"></span>'+"</div>"+'<div class="edui-pickarea"'+' onmousemove="$$._onMouseMove(event, this);"'+' onmouseover="$$._onMouseOver(event, this);"'+' onmouseout="$$._onMouseOut(event, this);"'+' onclick="$$._onClick(event, this);"'+">"+'<div id="##_overlay" class="edui-overlay"></div>'+"</div>"+"</div>"+"</div>"},_UIBase_render:t.prototype.render,render:function(e){this._UIBase_render(e);this.getDom("label").innerHTML="0"+this.editor.getLang("t_row")+" x 0"+this.editor.getLang("t_col")},_track:function(e,t){var i=this.getDom("overlay").style;var n=this.lengthOfCellSide;i.width=e*n+"px";i.height=t*n+"px";var r=this.getDom("label");r.innerHTML=e+this.editor.getLang("t_col")+" x "+t+this.editor.getLang("t_row");this.numCols=e;this.numRows=t},_onMouseOver:function(e,t){var i=e.relatedTarget||e.fromElement;if(!s.contains(t,i)&&t!==i){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility=""}},_onMouseOut:function(e,t){var i=e.relatedTarget||e.toElement;if(!s.contains(t,i)&&t!==i){this.getDom("label").innerHTML="0"+this.editor.getLang("t_col")+" x 0"+this.editor.getLang("t_row");this.getDom("overlay").style.visibility="hidden"}},_onMouseMove:function(e,t){var i=this.getDom("overlay").style;var n=s.getEventOffset(e);var r=this.lengthOfCellSide;var o=Math.ceil(n.left/r);var a=Math.ceil(n.top/r);this._track(o,a)},_onClick:function(){this.fireEvent("picktable",this.numCols,this.numRows)}};e.inherits(i,t)})();(function(){var e=baidu.editor.browser,t=baidu.editor.dom.domUtils,n=baidu.editor.ui.uiUtils;var i='onmousedown="$$.Stateful_onMouseDown(event, this);"'+' onmouseup="$$.Stateful_onMouseUp(event, this);"'+(e.ie?' onmouseenter="$$.Stateful_onMouseEnter(event, this);"'+' onmouseleave="$$.Stateful_onMouseLeave(event, this);"':' onmouseover="$$.Stateful_onMouseOver(event, this);"'+' onmouseout="$$.Stateful_onMouseOut(event, this);"');baidu.editor.ui.Stateful={alwalysHoverable:false,target:null,Stateful_init:function(){this._Stateful_dGetHtmlTpl=this.getHtmlTpl;this.getHtmlTpl=this.Stateful_getHtmlTpl},Stateful_getHtmlTpl:function(){var e=this._Stateful_dGetHtmlTpl();return e.replace(/stateful/g,function(){return i})},Stateful_onMouseEnter:function(e,t){this.target=t;if(!this.isDisabled()||this.alwalysHoverable){this.addState("hover");this.fireEvent("over")}},Stateful_onMouseLeave:function(e,t){if(!this.isDisabled()||this.alwalysHoverable){this.removeState("hover");this.removeState("active");this.fireEvent("out")}},Stateful_onMouseOver:function(e,t){var i=e.relatedTarget;if(!n.contains(t,i)&&t!==i){this.Stateful_onMouseEnter(e,t)}},Stateful_onMouseOut:function(e,t){var i=e.relatedTarget;if(!n.contains(t,i)&&t!==i){this.Stateful_onMouseLeave(e,t)}},Stateful_onMouseDown:function(e,t){if(!this.isDisabled()){this.addState("active")}},Stateful_onMouseUp:function(e,t){if(!this.isDisabled()){this.removeState("active")}},Stateful_postRender:function(){if(this.disabled&&!this.hasState("disabled")){this.addState("disabled")}},hasState:function(e){return t.hasClass(this.getStateDom(),"edui-state-"+e)},addState:function(e){if(!this.hasState(e)){this.getStateDom().className+=" edui-state-"+e}},removeState:function(e){if(this.hasState(e)){t.removeClasses(this.getStateDom(),["edui-state-"+e])}},getStateDom:function(){return this.getDom("state")},isChecked:function(){return this.hasState("checked")},setChecked:function(e){if(!this.isDisabled()&&e){this.addState("checked")}else{this.removeState("checked")}},isDisabled:function(){return this.hasState("disabled")},setDisabled:function(e){if(e){this.removeState("hover");this.removeState("checked");this.removeState("active");this.addState("disabled")}else{this.removeState("disabled")}}}})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Stateful,n=baidu.editor.ui.Button=function(e){if(e.name){var t=e.name;var i=e.cssRules;if(!e.className){e.className="edui-for-"+t}e.cssRules=".edui-default  .edui-for-"+t+" .edui-icon {"+i+"}"}this.initOptions(e);this.initButton()};n.prototype={uiName:"button",label:"",title:"",showIcon:true,showText:true,cssRules:"",initButton:function(){this.initUIBase();this.Stateful_init();if(this.cssRules){e.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}},getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+'<div id="##_state" stateful>'+'<div class="%%-wrap"><div id="##_body" unselectable="on" '+(this.title?'title="'+this.title+'"':"")+' class="%%-body" onmousedown="return $$._onMouseDown(event, this);" onclick="return $$._onClick(event, this);">'+(this.showIcon?'<div class="edui-box edui-icon"></div>':"")+(this.showText?'<div class="edui-box edui-label">'+this.label+"</div>":"")+"</div>"+"</div>"+"</div></div>"},postRender:function(){this.Stateful_postRender();this.setDisabled(this.disabled)},_onMouseDown:function(e){var t=e.target||e.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object"){return false}},_onClick:function(){if(!this.isDisabled()){this.fireEvent("click")}},setTitle:function(e){var t=this.getDom("label");t.innerHTML=e}};e.inherits(n,t);e.extend(n.prototype,i)})();(function(){var t=baidu.editor.utils,i=baidu.editor.ui.uiUtils,e=baidu.editor.dom.domUtils,n=baidu.editor.ui.UIBase,r=baidu.editor.ui.Stateful,o=baidu.editor.ui.SplitButton=function(e){this.initOptions(e);this.initSplitButton()};o.prototype={popup:null,uiName:"splitbutton",title:"",initSplitButton:function(){this.initUIBase();this.Stateful_init();var e=this;if(this.popup!=null){var t=this.popup;this.popup=null;this.setPopup(t)}},_UIBase_postRender:n.prototype.postRender,postRender:function(){this.Stateful_postRender();this._UIBase_postRender()},setPopup:function(e){if(this.popup===e)return;if(this.popup!=null){this.popup.dispose()}e.addListener("show",t.bind(this._onPopupShow,this));e.addListener("hide",t.bind(this._onPopupHide,this));e.addListener("postrender",t.bind(function(){e.getDom("body").appendChild(i.createElementByHtml('<div id="'+this.popup.id+'_bordereraser" class="edui-bordereraser edui-background" style="width:'+(i.getClientRect(this.getDom()).width+20)+'px"></div>'));e.getDom().className+=" "+this.className},this));this.popup=e},_onPopupShow:function(){this.addState("opened")},_onPopupHide:function(){this.removeState("opened")},getHtmlTpl:function(){return'<div id="##" class="edui-box %%">'+"<div "+(this.title?'title="'+this.title+'"':"")+' id="##_state" stateful><div class="%%-body">'+'<div id="##_button_body" class="edui-box edui-button-body" onclick="$$._onButtonClick(event, this);">'+'<div class="edui-box edui-icon"></div>'+"</div>"+'<div class="edui-box edui-splitborder"></div>'+'<div class="edui-box edui-arrow" onclick="$$._onArrowClick();"></div>'+"</div></div></div>"},showPopup:function(){var e=i.getClientRect(this.getDom());e.top-=this.popup.SHADOW_RADIUS;e.height+=this.popup.SHADOW_RADIUS;this.popup.showAnchorRect(e)},_onArrowClick:function(e,t){if(!this.isDisabled()){this.showPopup()}},_onButtonClick:function(){if(!this.isDisabled()){this.fireEvent("buttonclick")}}};t.inherits(o,n);t.extend(o.prototype,r,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.ColorPicker,r=baidu.editor.ui.Popup,i=baidu.editor.ui.SplitButton,o=baidu.editor.ui.ColorButton=function(e){this.initOptions(e);this.initColorButton()};o.prototype={initColorButton:function(){var i=this;this.popup=new r({content:new n({noColorText:i.editor.getLang("clearColor"),editor:i.editor,onpickcolor:function(e,t){i._onPickColor(t)},onpicknocolor:function(e,t){i._onPickNoColor(t)}}),editor:i.editor});this.initSplitButton()},_SplitButton_postRender:i.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.getDom("button_body").appendChild(t.createElementByHtml('<div id="'+this.id+'_colorlump" class="edui-colorlump"></div>'));this.getDom().className+=" edui-colorbutton"},setColor:function(e){this.getDom("colorlump").style.backgroundColor=e;this.color=e},_onPickColor:function(e){if(this.fireEvent("pickcolor",e)!==false){this.setColor(e);this.popup.hide()}},_onPickNoColor:function(e){if(this.fireEvent("picknocolor")!==false){this.popup.hide()}}};e.inherits(o,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,i=baidu.editor.ui.TablePicker,n=baidu.editor.ui.SplitButton,r=baidu.editor.ui.TableButton=function(e){this.initOptions(e);this.initTableButton()};r.prototype={initTableButton:function(){var n=this;this.popup=new t({content:new i({editor:n.editor,onpicktable:function(e,t,i){n._onPickTable(t,i)}}),editor:n.editor});this.initSplitButton()},_onPickTable:function(e,t){if(this.fireEvent("picktable",e,t)!==false){this.popup.hide()}}};e.inherits(r,n)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase;var i=baidu.editor.ui.AutoTypeSetPicker=function(e){this.initOptions(e);this.initAutoTypeSetPicker()};i.prototype={initAutoTypeSetPicker:function(){this.initUIBase()},getHtmlTpl:function(){var e=this.editor,t=e.options.autotypeset,i=e.getLang("autoTypeSet");var n="textAlignValue"+e.uid,r="imageBlockLineValue"+e.uid,o="symbolConverValue"+e.uid;return'<div id="##" class="edui-autotypesetpicker %%">'+'<div class="edui-autotypesetpicker-body">'+"<table >"+'<tr><td nowrap><input type="checkbox" name="mergeEmptyline" '+(t["mergeEmptyline"]?"checked":"")+">"+i.mergeLine+'</td><td colspan="2"><input type="checkbox" name="removeEmptyline" '+(t["removeEmptyline"]?"checked":"")+">"+i.delLine+"</td></tr>"+'<tr><td nowrap><input type="checkbox" name="removeClass" '+(t["removeClass"]?"checked":"")+">"+i.removeFormat+'</td><td colspan="2"><input type="checkbox" name="indent" '+(t["indent"]?"checked":"")+">"+i.indent+"</td></tr>"+"<tr>"+'<td nowrap><input type="checkbox" name="textAlign" '+(t["textAlign"]?"checked":"")+">"+i.alignment+"</td>"+'<td colspan="2" id="'+n+'">'+'<input type="radio" name="'+n+'" value="left" '+(t["textAlign"]&&t["textAlign"]=="left"?"checked":"")+">"+e.getLang("justifyleft")+'<input type="radio" name="'+n+'" value="center" '+(t["textAlign"]&&t["textAlign"]=="center"?"checked":"")+">"+e.getLang("justifycenter")+'<input type="radio" name="'+n+'" value="right" '+(t["textAlign"]&&t["textAlign"]=="right"?"checked":"")+">"+e.getLang("justifyright")+"</td>"+"</tr>"+"<tr>"+'<td nowrap><input type="checkbox" name="imageBlockLine" '+(t["imageBlockLine"]?"checked":"")+">"+i.imageFloat+"</td>"+'<td nowrap id="'+r+'">'+'<input type="radio" name="'+r+'" value="none" '+(t["imageBlockLine"]&&t["imageBlockLine"]=="none"?"checked":"")+">"+e.getLang("default")+'<input type="radio" name="'+r+'" value="left" '+(t["imageBlockLine"]&&t["imageBlockLine"]=="left"?"checked":"")+">"+e.getLang("justifyleft")+'<input type="radio" name="'+r+'" value="center" '+(t["imageBlockLine"]&&t["imageBlockLine"]=="center"?"checked":"")+">"+e.getLang("justifycenter")+'<input type="radio" name="'+r+'" value="right" '+(t["imageBlockLine"]&&t["imageBlockLine"]=="right"?"checked":"")+">"+e.getLang("justifyright")+"</td>"+"</tr>"+'<tr><td nowrap><input type="checkbox" name="clearFontSize" '+(t["clearFontSize"]?"checked":"")+">"+i.removeFontsize+'</td><td colspan="2"><input type="checkbox" name="clearFontFamily" '+(t["clearFontFamily"]?"checked":"")+">"+i.removeFontFamily+"</td></tr>"+'<tr><td nowrap colspan="3"><input type="checkbox" name="removeEmptyNode" '+(t["removeEmptyNode"]?"checked":"")+">"+i.removeHtml+"</td></tr>"+'<tr><td nowrap colspan="3"><input type="checkbox" name="pasteFilter" '+(t["pasteFilter"]?"checked":"")+">"+i.pasteFilter+"</td></tr>"+"<tr>"+'<td nowrap><input type="checkbox" name="symbolConver" '+(t["bdc2sb"]||t["tobdc"]?"checked":"")+">"+i.symbol+"</td>"+'<td id="'+o+'">'+'<input type="radio" name="bdc" value="bdc2sb" '+(t["bdc2sb"]?"checked":"")+">"+i.bdc2sb+'<input type="radio" name="bdc" value="tobdc" '+(t["tobdc"]?"checked":"")+">"+i.tobdc+""+"</td>"+'<td nowrap align="right"><button >'+i.run+"</button></td>"+"</tr>"+"</table>"+"</div>"+"</div>"},_UIBase_render:t.prototype.render};e.inherits(i,t)})();(function(){var g=baidu.editor.utils,e=baidu.editor.ui.Popup,t=baidu.editor.ui.AutoTypeSetPicker,i=baidu.editor.ui.SplitButton,n=baidu.editor.ui.AutoTypeSetButton=function(e){this.initOptions(e);this.initAutoTypeSetButton()};function c(e){var t={},i=e.getDom(),n=e.editor.uid,r=null,o=null,a=domUtils.getElementsByTagName(i,"input");for(var s=a.length-1,l;l=a[s--];){r=l.getAttribute("type");if(r=="checkbox"){o=l.getAttribute("name");t[o]&&delete t[o];if(l.checked){var d=document.getElementById(o+"Value"+n);if(d){if(/input/gi.test(d.tagName)){t[o]=d.value}else{var u=d.getElementsByTagName("input");for(var c=u.length-1,f;f=u[c--];){if(f.checked){t[o]=f.value;break}}}}else{t[o]=true}}else{t[o]=false}}else{t[l.getAttribute("value")]=l.checked}}var m=domUtils.getElementsByTagName(i,"select");for(var s=0,h;h=m[s++];){var p=h.getAttribute("name");t[p]=t[p]?h.value:""}g.extend(e.editor.options.autotypeset,t);e.editor.setPreferences("autotypeset",t)}n.prototype={initAutoTypeSetButton:function(){var u=this;this.popup=new e({content:new t({editor:u.editor}),editor:u.editor,hide:function(){if(!this._hidden&&this.getDom()){c(this);this.getDom().style.display="none";this._hidden=true;this.fireEvent("hide")}}});var i=0;this.popup.addListener("postRenderAfter",function(){var d=this;if(i)return;var e=this.getDom(),t=e.getElementsByTagName("button")[0];t.onclick=function(){c(d);u.editor.execCommand("autotypeset");d.hide()};domUtils.on(e,"click",function(e){var t=e.target||e.srcElement,i=u.editor.uid;if(t&&t.tagName=="INPUT"){if(t.name=="imageBlockLine"||t.name=="textAlign"||t.name=="symbolConver"){var n=t.checked,r=document.getElementById(t.name+"Value"+i),o=r.getElementsByTagName("input"),a={imageBlockLine:"none",textAlign:"left",symbolConver:"tobdc"};for(var s=0;s<o.length;s++){if(n){if(o[s].value==a[t.name]){o[s].checked="checked"}}else{o[s].checked=false}}}if(t.name=="imageBlockLineValue"+i||t.name=="textAlignValue"+i||t.name=="bdc"){var l=t.parentNode.previousSibling.getElementsByTagName("input");l&&(l[0].checked=true)}c(d)}});i=1});this.initSplitButton()}};g.inherits(n,i)})();(function(){var e=baidu.editor.utils,i=baidu.editor.ui.Popup,t=baidu.editor.ui.Stateful,n=baidu.editor.ui.UIBase;var r=baidu.editor.ui.CellAlignPicker=function(e){this.initOptions(e);this.initSelected();this.initCellAlignPicker()};r.prototype={initSelected:function(){var e={valign:{top:0,middle:1,bottom:2},align:{left:0,center:1,right:2},count:3},t=-1;if(this.selected){this.selectedIndex=e.valign[this.selected.valign]*e.count+e.align[this.selected.align]}},initCellAlignPicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){var e=["left","center","right"],t=9,i=null,n=-1,r=[];for(var o=0;o<t;o++){i=this.selectedIndex===o?' class="edui-cellalign-selected" ':"";n=o%3;n===0&&r.push("<tr>");r.push('<td index="'+o+'" '+i+' stateful><div class="edui-icon edui-'+e[n]+'"></div></td>');n===2&&r.push("</tr>")}return'<div id="##" class="edui-cellalignpicker %%">'+'<div class="edui-cellalignpicker-body">'+'<table onclick="$$._onClick(event);">'+r.join("")+"</table>"+"</div>"+"</div>"},getStateDom:function(){return this.target},_onClick:function(e){var t=e.target||e.srcElement;if(/icon/.test(t.className)){this.items[t.parentNode.getAttribute("index")].onclick();i.postHide(e)}},_UIBase_render:n.prototype.render};e.inherits(r,n);e.extend(r.prototype,t,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Stateful,r=baidu.editor.ui.uiUtils,i=baidu.editor.ui.UIBase;var n=baidu.editor.ui.PastePicker=function(e){this.initOptions(e);this.initPastePicker()};n.prototype={initPastePicker:function(){this.initUIBase();this.Stateful_init()},getHtmlTpl:function(){return'<div class="edui-pasteicon" onclick="$$._onClick(this)"></div>'+'<div class="edui-pastecontainer">'+'<div class="edui-title">'+this.editor.getLang("pasteOpt")+"</div>"+'<div class="edui-button">'+'<div title="'+this.editor.getLang("pasteSourceFormat")+'" onclick="$$.format(false)" stateful>'+'<div class="edui-richtxticon"></div></div>'+'<div title="'+this.editor.getLang("tagFormat")+'" onclick="$$.format(2)" stateful>'+'<div class="edui-tagicon"></div></div>'+'<div title="'+this.editor.getLang("pasteTextFormat")+'" onclick="$$.format(true)" stateful>'+'<div class="edui-plaintxticon"></div></div>'+"</div>"+"</div>"+"</div>"},getStateDom:function(){return this.target},format:function(e){this.editor.ui._isTransfer=true;this.editor.fireEvent("pasteTransfer",e)},_onClick:function(e){var t=domUtils.getNextDomNode(e),i=r.getViewportRect().height,n=r.getClientRect(t);if(n.top+n.height>i)t.style.top=-n.height-e.offsetHeight+"px";else t.style.top="";if(/hidden/gi.test(domUtils.getComputedStyle(t,"visibility"))){t.style.visibility="visible";domUtils.addClass(e,"edui-state-opened")}else{t.style.visibility="hidden";domUtils.removeClasses(e,"edui-state-opened")}},_UIBase_render:i.prototype.render};e.inherits(n,i);e.extend(n.prototype,t,true)})();(function(){var e=baidu.editor.utils,i=baidu.editor.ui.uiUtils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Toolbar=function(e){this.initOptions(e);this.initToolbar()};n.prototype={items:null,initToolbar:function(){this.items=this.items||[];this.initUIBase()},add:function(e,t){if(t===undefined){this.items.push(e)}else{this.items.splice(t,0,e)}},getHtmlTpl:function(){var e=[];for(var t=0;t<this.items.length;t++){e[t]=this.items[t].renderHtml()}return'<div id="##" class="edui-toolbar %%" onselectstart="return false;" onmousedown="return $$._onMouseDown(event, this);">'+e.join("")+"</div>"},postRender:function(){var e=this.getDom();for(var t=0;t<this.items.length;t++){this.items[t].postRender()}i.makeUnselectable(e)},_onMouseDown:function(e){var t=e.target||e.srcElement,i=t&&t.tagName&&t.tagName.toLowerCase();if(i=="input"||i=="object"||i=="object"){return false}}};e.inherits(n,t)})();(function(){var e=baidu.editor.utils,i=baidu.editor.dom.domUtils,r=baidu.editor.ui.uiUtils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Popup,o=baidu.editor.ui.Stateful,a=baidu.editor.ui.CellAlignPicker,s=baidu.editor.ui.Menu=function(e){this.initOptions(e);this.initMenu()};var l={renderHtml:function(){return'<div class="edui-menuitem edui-menuseparator"><div class="edui-menuseparator-inner"></div></div>'},postRender:function(){},queryAutoHide:function(){return true}};s.prototype={items:null,uiName:"menu",initMenu:function(){this.items=this.items||[];this.initPopup();this.initItems()},initItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];if(t=="-"){this.items[e]=this.getSeparator()}else if(!(t instanceof d)){t.editor=this.editor;t.theme=this.editor.options.theme;this.items[e]=this.createItem(t)}}},getSeparator:function(){return l},createItem:function(e){e.menu=this;return new d(e)},_Popup_getContentHtmlTpl:n.prototype.getContentHtmlTpl,getContentHtmlTpl:function(){if(this.items.length==0){return this._Popup_getContentHtmlTpl()}var e=[];for(var t=0;t<this.items.length;t++){var i=this.items[t];e[t]=i.renderHtml()}return'<div class="%%-body">'+e.join("")+"</div>"},_Popup_postRender:n.prototype.postRender,postRender:function(){var n=this;for(var e=0;e<this.items.length;e++){var t=this.items[e];t.ownerMenu=this;t.postRender()}i.on(this.getDom(),"mouseover",function(e){e=e||event;var t=e.relatedTarget||e.fromElement;var i=n.getDom();if(!r.contains(i,t)&&i!==t){n.fireEvent("over")}});this._Popup_postRender()},queryAutoHide:function(e){if(e){if(r.contains(this.getDom(),e)){return false}for(var t=0;t<this.items.length;t++){var i=this.items[t];if(i.queryAutoHide(e)===false){return false}}}},clearItems:function(){for(var e=0;e<this.items.length;e++){var t=this.items[e];clearTimeout(t._showingTimer);clearTimeout(t._closingTimer);if(t.subMenu){t.subMenu.destroy()}}this.items=[]},destroy:function(){if(this.getDom()){i.remove(this.getDom())}this.clearItems()},dispose:function(){this.destroy()}};e.inherits(s,n);var d=baidu.editor.ui.MenuItem=function(e){this.initOptions(e);this.initUIBase();this.Stateful_init();if(this.subMenu&&!(this.subMenu instanceof s)){if(e.className&&e.className.indexOf("aligntd")!=-1){var t=this;this.subMenu.selected=this.editor.queryCommandValue("cellalignment");this.subMenu=new n({content:new a(this.subMenu),parentMenu:t,editor:t.editor,destroy:function(){if(this.getDom()){i.remove(this.getDom())}}});this.subMenu.addListener("postRenderAfter",function(){i.on(this.getDom(),"mouseover",function(){t.addState("opened")})})}else{this.subMenu=new s(this.subMenu)}}};d.prototype={label:"",subMenu:null,ownerMenu:null,uiName:"menuitem",alwalysHoverable:true,getHtmlTpl:function(){return'<div id="##" class="%%" stateful onclick="$$._onClick(event, this);">'+'<div class="%%-body">'+this.renderLabelHtml()+"</div>"+"</div>"},postRender:function(){var i=this;this.addListener("over",function(){i.ownerMenu.fireEvent("submenuover",i);if(i.subMenu){i.delayShowSubMenu()}});if(this.subMenu){this.getDom().className+=" edui-hassubmenu";this.subMenu.render();this.addListener("out",function(){i.delayHideSubMenu()});this.subMenu.addListener("over",function(){clearTimeout(i._closingTimer);i._closingTimer=null;i.addState("opened")});this.ownerMenu.addListener("hide",function(){i.hideSubMenu()});this.ownerMenu.addListener("submenuover",function(e,t){if(t!==i){i.delayHideSubMenu()}});this.subMenu._bakQueryAutoHide=this.subMenu.queryAutoHide;this.subMenu.queryAutoHide=function(e){if(e&&r.contains(i.getDom(),e)){return false}return this._bakQueryAutoHide(e)}}this.getDom().style.tabIndex="-1";r.makeUnselectable(this.getDom());this.Stateful_postRender()},delayShowSubMenu:function(){var e=this;if(!e.isDisabled()){e.addState("opened");clearTimeout(e._showingTimer);clearTimeout(e._closingTimer);e._closingTimer=null;e._showingTimer=setTimeout(function(){e.showSubMenu()},250)}},delayHideSubMenu:function(){var e=this;if(!e.isDisabled()){e.removeState("opened");clearTimeout(e._showingTimer);if(!e._closingTimer){e._closingTimer=setTimeout(function(){if(!e.hasState("opened")){e.hideSubMenu()}e._closingTimer=null},400)}}},renderLabelHtml:function(){return'<div class="edui-arrow"></div>'+'<div class="edui-box edui-icon"></div>'+'<div class="edui-box edui-label %%-label">'+(this.label||"")+"</div>"},getStateDom:function(){return this.getDom()},queryAutoHide:function(e){if(this.subMenu&&this.hasState("opened")){return this.subMenu.queryAutoHide(e)}},_onClick:function(e,t){if(this.hasState("disabled"))return;if(this.fireEvent("click",e,t)!==false){if(this.subMenu){this.showSubMenu()}else{n.postHide(e)}}},showSubMenu:function(){var e=r.getClientRect(this.getDom());e.right-=5;e.left+=2;e.width-=7;e.top-=4;e.bottom+=4;e.height+=8;this.subMenu.showAnchorRect(e,true,true)},hideSubMenu:function(){this.subMenu.hide()}};e.inherits(d,t);e.extend(d.prototype,o,true)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.uiUtils,n=baidu.editor.ui.Menu,i=baidu.editor.ui.SplitButton,r=baidu.editor.ui.Combox=function(e){this.initOptions(e);this.initCombox()};r.prototype={uiName:"combox",onbuttonclick:function(){this.showPopup()},initCombox:function(){var e=this;this.items=this.items||[];for(var t=0;t<this.items.length;t++){var i=this.items[t];i.uiName="listitem";i.index=t;i.onclick=function(){e.selectByIndex(this.index)}}this.popup=new n({items:this.items,uiName:"list",editor:this.editor,captureWheel:true,combox:this});this.initSplitButton()},_SplitButton_postRender:i.prototype.postRender,postRender:function(){this._SplitButton_postRender();this.setLabel(this.label||"");this.setValue(this.initValue||"")},showPopup:function(){var e=t.getClientRect(this.getDom());e.top+=1;e.bottom-=1;e.height-=2;this.popup.showAnchorRect(e)},getValue:function(){return this.value},setValue:function(e){var t=this.indexByValue(e);if(t!=-1){this.selectedIndex=t;this.setLabel(this.items[t].label);this.value=this.items[t].value}else{this.selectedIndex=-1;this.setLabel(this.getLabelForUnknowValue(e));this.value=e}},setLabel:function(e){this.getDom("button_body").innerHTML=e;this.label=e},getLabelForUnknowValue:function(e){return e},indexByValue:function(e){for(var t=0;t<this.items.length;t++){if(e==this.items[t].value){return t}}return-1},getItem:function(e){return this.items[e]},selectByIndex:function(e){if(e<this.items.length&&this.fireEvent("select",e)!==false){this.selectedIndex=e;this.value=this.items[e].value;this.setLabel(this.items[e].label)}}};e.inherits(r,i)})();(function(){var n=baidu.editor.utils,u=baidu.editor.dom.domUtils,c=baidu.editor.ui.uiUtils,r=baidu.editor.ui.Mask,e=baidu.editor.ui.UIBase,o=baidu.editor.ui.Button,t=baidu.editor.ui.Dialog=function(e){if(e.name){var t=e.name;var i=e.cssRules;if(!e.className){e.className="edui-for-"+t}if(i){e.cssRules=".edui-default .edui-for-"+t+" .edui-dialog-content  {"+i+"}"}}this.initOptions(n.extend({autoReset:true,draggable:true,onok:function(){},oncancel:function(){},onclose:function(e,t){return t?this.onok():this.oncancel()},holdScroll:false},e));this.initDialog()};var a;var s;var l;t.prototype={draggable:false,uiName:"dialog",initDialog:function(){var e=this,t=this.editor.options.theme;if(this.cssRules){n.cssRule("edui-customize-"+this.name+"-style",this.cssRules)}this.initUIBase();this.modalMask=a||(a=new r({className:"edui-dialog-modalmask",theme:t,onclick:function(){l&&l.close(false)}}));this.dragMask=s||(s=new r({className:"edui-dialog-dragmask",theme:t}));this.closeButton=new o({className:"edui-dialog-closebutton",title:e.closeDialog,theme:t,onclick:function(){e.close(false)}});this.fullscreen&&this.initResizeEvent();if(this.buttons){for(var i=0;i<this.buttons.length;i++){if(!(this.buttons[i]instanceof o)){this.buttons[i]=new o(n.extend(this.buttons[i],{editor:this.editor},true))}}}},initResizeEvent:function(){var o=this;u.on(window,"resize",function(){if(o._hidden||o._hidden===undefined){return}if(o.__resizeTimer){window.clearTimeout(o.__resizeTimer)}o.__resizeTimer=window.setTimeout(function(){o.__resizeTimer=null;var e=o.getDom(),t=o.getDom("content"),i=UE.ui.uiUtils.getClientRect(e),n=UE.ui.uiUtils.getClientRect(t),r=c.getViewportRect();t.style.width=r.width-i.width+n.width+"px";t.style.height=r.height-i.height+n.height+"px";e.style.width=r.width+"px";e.style.height=r.height+"px";o.fireEvent("resize")},100)})},fitSize:function(){var e=this.getDom("body");var t=this.mesureSize();e.style.width=t.width+"px";e.style.height=t.height+"px";return t},safeSetOffset:function(e){var t=this;var i=t.getDom();var n=c.getViewportRect();var r=c.getClientRect(i);var o=e.left;if(o+r.width>n.right){o=n.right-r.width}var a=e.top;if(a+r.height>n.bottom){a=n.bottom-r.height}i.style.left=Math.max(o,0)+"px";i.style.top=Math.max(a,0)+"px"},showAtCenter:function(){var e=c.getViewportRect();if(!this.fullscreen){this.getDom().style.display="";var t=this.fitSize();var i=this.getDom("titlebar").offsetHeight|0;var n=e.width/2-t.width/2;var r=e.height/2-(t.height-i)/2-i;var o=this.getDom();this.safeSetOffset({left:Math.max(n|0,0),top:Math.max(r|0,0)});if(!u.hasClass(o,"edui-state-centered")){o.className+=" edui-state-centered"}}else{var a=this.getDom(),s=this.getDom("content");a.style.display="block";var l=UE.ui.uiUtils.getClientRect(a),d=UE.ui.uiUtils.getClientRect(s);a.style.left="-100000px";s.style.width=e.width-l.width+d.width+"px";s.style.height=e.height-l.height+d.height+"px";a.style.width=e.width+"px";a.style.height=e.height+"px";a.style.left=0;this._originalContext={html:{overflowX:document.documentElement.style.overflowX,overflowY:document.documentElement.style.overflowY},body:{overflowX:document.body.style.overflowX,overflowY:document.body.style.overflowY}};document.documentElement.style.overflowX="hidden";document.documentElement.style.overflowY="hidden";document.body.style.overflowX="hidden";document.body.style.overflowY="hidden"}this._show()},getContentHtml:function(){var e="";if(typeof this.content=="string"){e=this.content}else if(this.iframeUrl){e='<span id="'+this.id+'_contmask" class="dialogcontmask"></span><iframe id="'+this.id+'_iframe" class="%%-iframe" height="100%" width="100%" frameborder="0" src="'+this.iframeUrl+'"></iframe>'}return e},getHtmlTpl:function(){var e="";if(this.buttons){var t=[];for(var i=0;i<this.buttons.length;i++){t[i]=this.buttons[i].renderHtml()}e='<div class="%%-foot">'+'<div id="##_buttons" class="%%-buttons">'+t.join("")+"</div>"+"</div>"}return'<div id="##" class="%%"><div '+(!this.fullscreen?'class="%%"':'class="%%-wrap edui-dialog-fullscreen-flag"')+'><div id="##_body" class="%%-body">'+'<div class="%%-shadow"></div>'+'<div id="##_titlebar" class="%%-titlebar">'+'<div class="%%-draghandle" onmousedown="$$._onTitlebarMouseDown(event, this);">'+'<span class="%%-caption">'+(this.title||"")+"</span>"+"</div>"+this.closeButton.renderHtml()+"</div>"+'<div id="##_content" class="%%-content">'+(this.autoReset?"":this.getContentHtml())+"</div>"+e+"</div></div></div>"},postRender:function(){if(!this.modalMask.getDom()){this.modalMask.render();this.modalMask.hide()}if(!this.dragMask.getDom()){this.dragMask.render();this.dragMask.hide()}var e=this;this.addListener("show",function(){e.modalMask.show(this.getDom().style.zIndex-2)});this.addListener("hide",function(){e.modalMask.hide()});if(this.buttons){for(var t=0;t<this.buttons.length;t++){this.buttons[t].postRender()}}u.on(window,"resize",function(){setTimeout(function(){if(!e.isHidden()){e.safeSetOffset(c.getClientRect(e.getDom()))}})});this._hide()},mesureSize:function(){var e=this.getDom("body");var t=c.getClientRect(this.getDom("content")).width;var i=e.style;i.width=t;return c.getClientRect(e)},_onTitlebarMouseDown:function(e,t){if(this.draggable){var r;var i=c.getViewportRect();var o=this;c.startDrag(e,{ondragstart:function(){r=c.getClientRect(o.getDom());o.getDom("contmask").style.visibility="visible";o.dragMask.show(o.getDom().style.zIndex-1)},ondragmove:function(e,t){var i=r.left+e;var n=r.top+t;o.safeSetOffset({left:i,top:n})},ondragstop:function(){o.getDom("contmask").style.visibility="hidden";u.removeClasses(o.getDom(),["edui-state-centered"]);o.dragMask.hide()}})}},reset:function(){this.getDom("content").innerHTML=this.getContentHtml();this.fireEvent("dialogafterreset")},_show:function(){if(this._hidden){this.getDom().style.display="";this.editor.container.style.zIndex&&(this.getDom().style.zIndex=this.editor.container.style.zIndex*1+10);this._hidden=false;this.fireEvent("show");baidu.editor.ui.uiUtils.getFixedLayer().style.zIndex=this.getDom().style.zIndex-4}},isHidden:function(){return this._hidden},_hide:function(){if(!this._hidden){var e=this.getDom();e.style.display="none";e.style.zIndex="";e.style.width="";e.style.height="";this._hidden=true;this.fireEvent("hide")}},open:function(){if(this.autoReset){try{this.reset()}catch(e){this.render();this.open()}}this.showAtCenter();if(this.iframeUrl){try{this.getDom("iframe").focus()}catch(e){}}l=this},_onCloseButtonClick:function(e,t){this.close(false)},close:function(e){if(this.fireEvent("close",e)!==false){if(this.fullscreen){document.documentElement.style.overflowX=this._originalContext.html.overflowX;document.documentElement.style.overflowY=this._originalContext.html.overflowY;document.body.style.overflowX=this._originalContext.body.overflowX;document.body.style.overflowY=this._originalContext.body.overflowY;delete this._originalContext}this._hide();var t=this.getDom("content");var i=this.getDom("iframe");if(t&&i){var n=i.contentDocument||i.contentWindow.document;n&&(n.body.innerHTML="");u.remove(t)}}}};n.inherits(t,e)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Menu,i=baidu.editor.ui.SplitButton,n=baidu.editor.ui.MenuButton=function(e){this.initOptions(e);this.initMenuButton()};n.prototype={initMenuButton:function(){var i=this;this.uiName="menubutton";this.popup=new t({items:i.items,className:i.className,editor:i.editor});this.popup.addListener("show",function(){var e=this;for(var t=0;t<e.items.length;t++){e.items[t].removeState("checked");if(e.items[t].value==i._value){e.items[t].addState("checked");this.value=i._value}}});this.initSplitButton()},setValue:function(e){this._value=e}};e.inherits(n,i)})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.Popup,i=baidu.editor.ui.SplitButton,n=baidu.editor.ui.MultiMenuPop=function(e){this.initOptions(e);this.initMultiMenu()};n.prototype={initMultiMenu:function(){var e=this;this.popup=new t({content:"",editor:e.editor,iframe_rendered:false,onshow:function(){if(!this.iframe_rendered){this.iframe_rendered=true;this.getDom("content").innerHTML='<iframe id="'+e.id+'_iframe" src="'+e.iframeUrl+'" frameborder="0"></iframe>';e.editor.container.style.zIndex&&(this.getDom().style.zIndex=e.editor.container.style.zIndex*1+1)}}});this.onbuttonclick=function(){this.showPopup()};this.initSplitButton()}};e.inherits(n,i)})();(function(){var n=baidu.editor.ui,e=n.UIBase,d=n.uiUtils,r=baidu.editor.utils,u=baidu.editor.dom.domUtils;var o=[],c,a=false;var t=n.ShortCutMenu=function(e){this.initOptions(e);this.initShortCutMenu()};t.postHide=i;t.prototype={isHidden:true,SPACE:5,initShortCutMenu:function(){this.items=this.items||[];this.initUIBase();this.initItems();this.initEvent();o.push(this)},initEvent:function(){var d=this,e=d.editor.document;u.on(e,"mousemove",function(e){if(d.isHidden===false){if(d.getSubMenuMark()||d.eventType=="contextmenu")return;var t=true,i=d.getDom(),n=i.offsetWidth,r=i.offsetHeight,o=n/2+d.SPACE,a=r/2,s=Math.abs(e.screenX-d.left),l=Math.abs(e.screenY-d.top);clearTimeout(c);c=setTimeout(function(){if(l>0&&l<a){d.setOpacity(i,"1")}else if(l>a&&l<a+70){d.setOpacity(i,"0.5");t=false}else if(l>a+70&&l<a+140){d.hide()}if(t&&s>0&&s<o){d.setOpacity(i,"1")}else if(s>o&&s<o+70){d.setOpacity(i,"0.5")}else if(s>o+70&&s<o+140){d.hide()}})}});if(browser.chrome){u.on(e,"mouseout",function(e){var t=e.relatedTarget||e.toElement;if(t==null||t.tagName=="HTML"){d.hide()}})}d.editor.addListener("afterhidepop",function(){if(!d.isHidden){a=true}})},initItems:function(){if(r.isArray(this.items)){for(var e=0,t=this.items.length;e<t;e++){var i=this.items[e].toLowerCase();if(n[i]){this.items[e]=new n[i](this.editor);this.items[e].className+=" edui-shortcutsubmenu "}}}},setOpacity:function(e,t){if(browser.ie&&browser.version<9){e.style.filter="alpha(opacity = "+parseFloat(t)*100+");"}else{e.style.opacity=t}},getSubMenuMark:function(){a=false;var e=d.getFixedLayer();var t=u.getElementsByTagName(e,"div",function(e){return u.hasClass(e,"edui-shortcutsubmenu edui-popup")});for(var i=0,n;n=t[i++];){if(n.style.display!="none"){a=true}}return a},show:function(e,t){var i=this,n={},r=this.getDom(),o=d.getFixedLayer();function a(e){if(e.left<0){e.left=0}if(e.top<0){e.top=0}r.style.cssText="position:absolute;left:"+e.left+"px;top:"+e.top+"px;"}function s(e){if(!e.tagName){e=e.getDom()}n.left=parseInt(e.style.left);n.top=parseInt(e.style.top);n.top-=r.offsetHeight+15;a(n)}i.eventType=e.type;r.style.cssText="display:block;left:-9999px";if(e.type=="contextmenu"&&t){var l=u.getElementsByTagName(o,"div","edui-contextmenu")[0];if(l){s(l)}else{i.editor.addListener("aftershowcontextmenu",function(e,t){s(t)})}}else{n=d.getViewportOffsetByEvent(e);n.top-=r.offsetHeight+i.SPACE;n.left+=i.SPACE+20;a(n);i.setOpacity(r,.2)}i.isHidden=false;i.left=e.screenX+r.offsetWidth/2-i.SPACE;i.top=e.screenY-r.offsetHeight/2-i.SPACE;if(i.editor){r.style.zIndex=i.editor.container.style.zIndex*1+10;o.style.zIndex=r.style.zIndex-1}},hide:function(){if(this.getDom()){this.getDom().style.display="none"}this.isHidden=true},postRender:function(){if(r.isArray(this.items)){for(var e=0,t;t=this.items[e++];){t.postRender()}}},getHtmlTpl:function(){var e;if(r.isArray(this.items)){e=[];for(var t=0;t<this.items.length;t++){e[t]=this.items[t].renderHtml()}e=e.join("")}else{e=this.items}return'<div id="##" class="%% edui-toolbar" data-src="shortcutmenu" onmousedown="return false;" onselectstart="return false;" >'+e+"</div>"}};r.inherits(t,e);function i(e){var t=e.target||e.srcElement,i=u.findParent(t,function(e){return u.hasClass(e,"edui-shortcutmenu")||u.hasClass(e,"edui-popup")},true);if(!i){for(var n=0,r;r=o[n++];){r.hide()}}}u.on(document,"mousedown",function(e){i(e)});u.on(window,"scroll",function(e){i(e)})})();(function(){var e=baidu.editor.utils,t=baidu.editor.ui.UIBase,i=baidu.editor.ui.Breakline=function(e){this.initOptions(e);this.initSeparator()};i.prototype={uiName:"Breakline",initSeparator:function(){this.initUIBase()},getHtmlTpl:function(){return"<br/>"}};e.inherits(i,t)})();(function(){var e=baidu.editor.utils,i=baidu.editor.dom.domUtils,t=baidu.editor.ui.UIBase,n=baidu.editor.ui.Message=function(e){this.initOptions(e);this.initMessage()};n.prototype={initMessage:function(){this.initUIBase()},getHtmlTpl:function(){return'<div id="##" class="edui-message %%">'+' <div id="##_closer" class="edui-message-closer">×</div>'+' <div id="##_body" class="edui-message-body edui-message-type-info">'+' <iframe style="position:absolute;z-index:-1;left:0;top:0;background-color: transparent;" frameborder="0" width="100%" height="100%" src="about:blank"></iframe>'+' <div class="edui-shadow"></div>'+' <div id="##_content" class="edui-message-content">'+"  </div>"+" </div>"+"</div>"},reset:function(e){var t=this;if(!e.keepshow){clearTimeout(this.timer);t.timer=setTimeout(function(){t.hide()},e.timeout||4e3)}e.content!==undefined&&t.setContent(e.content);e.type!==undefined&&t.setType(e.type);t.show()},postRender:function(){var e=this,t=this.getDom("closer");t&&i.on(t,"click",function(){e.hide()})},setContent:function(e){this.getDom("content").innerHTML=e},setType:function(e){e=e||"info";var t=this.getDom("body");t.className=t.className.replace(/edui-message-type-[\w-]+/,"edui-message-type-"+e)},getContent:function(){return this.getDom("content").innerHTML},getType:function(){var e=this.getDom("body").match(/edui-message-type-([\w-]+)/);return e?e[1]:""},show:function(){this.getDom().style.display="block"},hide:function(){var e=this.getDom();if(e){e.style.display="none";e.parentNode&&e.parentNode.removeChild(e)}}};e.inherits(n,t)})();(function(){var l=baidu.editor.utils;var d=baidu.editor.ui;var t=d.Dialog;d.buttons={};d.Dialog=function(e){var n=new t(e);n.addListener("hide",function(){if(n.editor){var e=n.editor;try{if(browser.gecko){var t=e.window.scrollY,i=e.window.scrollX;e.body.focus();e.window.scrollTo(i,t)}else{e.focus()}}catch(e){}}});return n};var s={anchor:"~/dialogs/anchor/anchor.html",insertimage:"~/dialogs/image/image.html",link:"~/dialogs/link/link.html",spechars:"~/dialogs/spechars/spechars.html",searchreplace:"~/dialogs/searchreplace/searchreplace.html",map:"~/dialogs/map/map.html",gmap:"~/dialogs/gmap/gmap.html",insertvideo:"~/dialogs/video/video.html",help:"~/dialogs/help/help.html",preview:"~/dialogs/preview/preview.html",emotion:"~/dialogs/emotion/emotion.html",wordimage:"~/dialogs/wordimage/wordimage.html",attachment:"~/dialogs/attachment/attachment.html",insertframe:"~/dialogs/insertframe/insertframe.html",edittip:"~/dialogs/table/edittip.html",edittable:"~/dialogs/table/edittable.html",edittd:"~/dialogs/table/edittd.html",webapp:"~/dialogs/webapp/webapp.html",snapscreen:"~/dialogs/snapscreen/snapscreen.html",scrawl:"~/dialogs/scrawl/scrawl.html",music:"~/dialogs/music/music.html",template:"~/dialogs/template/template.html",background:"~/dialogs/background/background.html",charts:"~/dialogs/charts/charts.html"};var e=["undo","redo","formatmatch","bold","italic","underline","fontborder","touppercase","tolowercase","strikethrough","subscript","superscript","source","indent","outdent","blockquote","pasteplain","pagebreak","selectall","print","horizontal","gapfilling","removeformat","time","date","unlink","insertparagraphbeforetable","insertrow","insertcol","mergeright","mergedown","deleterow","deletecol","splittorows","splittocols","splittocells","mergecells","deletetable","drafts","kityformula","custombtn","complexformulas"];for(var i=0,n;n=e[i++];){n=n.toLowerCase();d[n]=function(a){return function(r){var o=new d.Button({className:"edui-for-"+a,title:r.options.labelMap[a]||r.getLang("labelMap."+a)||"",onclick:function(){r.execCommand(a)},theme:r.options.theme,showText:false});d.buttons[a]=o;r.addListener("selectionchange",function(e,t,i){var n=r.queryCommandState(a);if(n==-1){o.setDisabled(true);o.setChecked(false)}else{if(!i){o.setDisabled(false);o.setChecked(n)}}});return o}}(n)}d.cleardoc=function(e){var t=new d.Button({className:"edui-for-cleardoc",title:e.options.labelMap.cleardoc||e.getLang("labelMap.cleardoc")||"",theme:e.options.theme,onclick:function(){if(confirm(e.getLang("confirmClear"))){e.execCommand("cleardoc")}}});d.buttons["cleardoc"]=t;e.addListener("selectionchange",function(){t.setDisabled(e.queryCommandState("cleardoc")==-1)});return t};var r={justify:["left","right","center","justify"],imagefloat:["none","left","center","right"],directionality:["ltr","rtl"]};for(var o in r){(function(a,e){for(var t=0,i;i=e[t++];){(function(o){d[a.replace("float","")+o]=function(n){var r=new d.Button({className:"edui-for-"+a.replace("float","")+o,title:n.options.labelMap[a.replace("float","")+o]||n.getLang("labelMap."+a.replace("float","")+o)||"",theme:n.options.theme,onclick:function(){n.execCommand(a,o)}});d.buttons[a]=r;n.addListener("selectionchange",function(e,t,i){r.setDisabled(n.queryCommandState(a)==-1);r.setChecked(n.queryCommandValue(a)==o&&!i)});return r}})(i)}})(o,r[o])}for(var i=0,n;n=["backcolor","forecolor"][i++];){d[n]=function(n){return function(i){var e=new d.ColorButton({className:"edui-for-"+n,color:"default",title:i.options.labelMap[n]||i.getLang("labelMap."+n)||"",editor:i,onpickcolor:function(e,t){i.execCommand(n,t)},onpicknocolor:function(){i.execCommand(n,"default");this.setColor("transparent");this.color="default"},onbuttonclick:function(){i.execCommand(n,this.color)}});d.buttons[n]=e;i.addListener("selectionchange",function(){e.setDisabled(i.queryCommandState(n)==-1)});return e}}(n)}var a={noOk:["searchreplace","help","spechars","webapp","preview"],ok:["attachment","anchor","link","insertimage","map","gmap","insertframe","wordimage","insertvideo","insertframe","edittip","edittable","edittd","scrawl","template","music","background","charts"]};for(var o in a){(function(a,e){for(var t=0,i;i=e[t++];){if(browser.opera&&i==="searchreplace"){continue}(function(o){d[o]=function(i,e,t){e=e||(i.options.iframeUrlMap||{})[o]||s[o];t=i.options.labelMap[o]||i.getLang("labelMap."+o)||"";var n;if(e){n=new d.Dialog(l.extend({iframeUrl:i.ui.mapUrl(e),editor:i,className:"edui-for-"+o,title:t,holdScroll:o==="insertimage",fullscreen:/charts|preview/.test(o),closeDialog:i.getLang("closeDialog")},a=="ok"?{buttons:[{className:"edui-okbutton",label:i.getLang("ok"),editor:i,onclick:function(){n.close(true)}},{className:"edui-cancelbutton",label:i.getLang("cancel"),editor:i,onclick:function(){n.close(false)}}]}:{}));i.ui._dialogs[o+"Dialog"]=n}var r=new d.Button({className:"edui-for-"+o,title:t,onclick:function(){if(n){switch(o){case"wordimage":var e=i.execCommand("wordimage");if(e&&e.length){n.render();n.open()}break;case"scrawl":if(i.queryCommandState("scrawl")!=-1){n.render();n.open()}break;default:n.render();n.open()}}},theme:i.options.theme,disabled:o=="scrawl"&&i.queryCommandState("scrawl")==-1||o=="charts"});d.buttons[o]=r;i.addListener("selectionchange",function(){var e={edittable:1};if(o in e)return;var t=i.queryCommandState(o);if(r.getDom()){r.setDisabled(t==-1);r.setChecked(t)}});return r}})(i.toLowerCase())}})(o,a[o])}d.snapscreen=function(e,t,i){i=e.options.labelMap["snapscreen"]||e.getLang("labelMap.snapscreen")||"";var n=new d.Button({className:"edui-for-snapscreen",title:i,onclick:function(){e.execCommand("snapscreen")},theme:e.options.theme});d.buttons["snapscreen"]=n;t=t||(e.options.iframeUrlMap||{})["snapscreen"]||s["snapscreen"];if(t){var r=new d.Dialog({iframeUrl:e.ui.mapUrl(t),editor:e,className:"edui-for-snapscreen",title:i,buttons:[{className:"edui-okbutton",label:e.getLang("ok"),editor:e,onclick:function(){r.close(true)}},{className:"edui-cancelbutton",label:e.getLang("cancel"),editor:e,onclick:function(){r.close(false)}}]});r.render();e.ui._dialogs["snapscreenDialog"]=r}e.addListener("selectionchange",function(){n.setDisabled(e.queryCommandState("snapscreen")==-1)});return n};d.insertcode=function(o,e,a){e=o.options["insertcode"]||[];a=o.options.labelMap["insertcode"]||o.getLang("labelMap.insertcode")||"";var i=[];l.each(e,function(e,t){i.push({label:e,value:t,theme:o.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" >'+(this.label||"")+"</div>"}})});var s=new d.Combox({editor:o,items:i,onselect:function(e,t){o.execCommand("insertcode",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:a,initValue:a,className:"edui-for-insertcode",indexByValue:function(e){if(e){for(var t=0,i;i=this.items[t];t++){if(i.value.indexOf(e)!=-1)return t}}return-1}});d.buttons["insertcode"]=s;o.addListener("selectionchange",function(e,t,i){if(!i){var n=o.queryCommandState("insertcode");if(n==-1){s.setDisabled(true)}else{s.setDisabled(false);var r=o.queryCommandValue("insertcode");if(!r){s.setValue(a);return}r&&(r=r.replace(/['"]/g,"").split(",")[0]);s.setValue(r)}}});return s};d.fontfamily=function(o,e,t){e=o.options["fontfamily"]||[];t=o.options.labelMap["fontfamily"]||o.getLang("labelMap.fontfamily")||"";if(!e.length)return;for(var i=0,n,r=[];n=e[i];i++){var a=o.getLang("fontfamily")[n.name]||"";(function(e,t){r.push({label:e,value:t,theme:o.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="font-family:'+l.unhtml(this.value)+'">'+(this.label||"")+"</div>"}})})(n.label||a,n.val)}var s=new d.Combox({editor:o,items:r,onselect:function(e,t){o.execCommand("FontFamily",this.items[t].value)},onbuttonclick:function(){this.showPopup()},title:t,initValue:t,className:"edui-for-fontfamily",indexByValue:function(e){if(e){for(var t=0,i;i=this.items[t];t++){if(i.value.indexOf(e)!=-1)return t}}return-1}});d.buttons["fontfamily"]=s;o.addListener("selectionchange",function(e,t,i){if(!i){var n=o.queryCommandState("FontFamily");if(n==-1){s.setDisabled(true)}else{s.setDisabled(false);var r=o.queryCommandValue("FontFamily");r&&(r=r.replace(/['"]/g,"").split(",")[0]);s.setValue(r)}}});return s};d.fontsize=function(r,e,t){t=r.options.labelMap["fontsize"]||r.getLang("labelMap.fontsize")||"";e=e||r.options["fontsize"]||[];if(!e.length)return;var i=[];for(var n=0;n<e.length;n++){var o=e[n]+"px";i.push({label:o,value:o,theme:r.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label" style="line-height:1;font-size:'+this.value+'">'+(this.label||"")+"</div>"}})}var a=new d.Combox({editor:r,items:i,title:t,initValue:t,onselect:function(e,t){r.execCommand("FontSize",this.items[t].value)},onbuttonclick:function(){this.showPopup()},className:"edui-for-fontsize"});d.buttons["fontsize"]=a;r.addListener("selectionchange",function(e,t,i){if(!i){var n=r.queryCommandState("FontSize");if(n==-1){a.setDisabled(true)}else{a.setDisabled(false);a.setValue(r.queryCommandValue("FontSize"))}}});return a};d.paragraph=function(a,e,t){t=a.options.labelMap["paragraph"]||a.getLang("labelMap.paragraph")||"";e=a.options["paragraph"]||[];if(l.isEmptyObject(e))return;var i=[];for(var n in e){i.push({value:n,label:e[n]||a.getLang("paragraph")[n],theme:a.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label"><span class="edui-for-'+this.value+'">'+(this.label||"")+"</span></div>"}})}var s=new d.Combox({editor:a,items:i,title:t,initValue:t,className:"edui-for-paragraph",onselect:function(e,t){a.execCommand("Paragraph",this.items[t].value)},onbuttonclick:function(){this.showPopup()}});d.buttons["paragraph"]=s;a.addListener("selectionchange",function(e,t,i){if(!i){var n=a.queryCommandState("Paragraph");if(n==-1){s.setDisabled(true)}else{s.setDisabled(false);var r=a.queryCommandValue("Paragraph");var o=s.indexByValue(r);if(o!=-1){s.setValue(r)}else{s.setValue(s.initValue)}}}});return s};d.customstyle=function(a){var e=a.options["customstyle"]||[],t=a.options.labelMap["customstyle"]||a.getLang("labelMap.customstyle")||"";if(!e.length)return;var i=a.getLang("customstyle");for(var n=0,r=[],o;o=e[n++];){(function(e){var t={};t.label=e.label?e.label:i[e.name];t.style=e.style;t.className=e.className;t.tag=e.tag;r.push({label:t.label,value:t,theme:a.options.theme,renderLabelHtml:function(){return'<div class="edui-label %%-label">'+"<"+t.tag+" "+(t.className?' class="'+t.className+'"':"")+(t.style?' style="'+t.style+'"':"")+">"+t.label+"</"+t.tag+">"+"</div>"}})})(o)}var s=new d.Combox({editor:a,items:r,title:t,initValue:t,className:"edui-for-customstyle",onselect:function(e,t){a.execCommand("customstyle",this.items[t].value)},onbuttonclick:function(){this.showPopup()},indexByValue:function(e){for(var t=0,i;i=this.items[t++];){if(i.label==e){return t-1}}return-1}});d.buttons["customstyle"]=s;a.addListener("selectionchange",function(e,t,i){if(!i){var n=a.queryCommandState("customstyle");if(n==-1){s.setDisabled(true)}else{s.setDisabled(false);var r=a.queryCommandValue("customstyle");var o=s.indexByValue(r);if(o!=-1){s.setValue(r)}else{s.setValue(s.initValue)}}}});return s};d.inserttable=function(n,e,t){t=n.options.labelMap["inserttable"]||n.getLang("labelMap.inserttable")||"";var i=new d.TableButton({editor:n,title:t,className:"edui-for-inserttable",onpicktable:function(e,t,i){n.execCommand("InsertTable",{numRows:i,numCols:t,border:1})},onbuttonclick:function(){this.showPopup()}});d.buttons["inserttable"]=i;n.addListener("selectionchange",function(){i.setDisabled(n.queryCommandState("inserttable")==-1)});return i};d.lineheight=function(i){var e=i.options.lineheight||[];if(!e.length)return;for(var t=0,n,r=[];n=e[t++];){r.push({label:n,value:n,theme:i.options.theme,onclick:function(){i.execCommand("lineheight",this.value)}})}var o=new d.MenuButton({editor:i,className:"edui-for-lineheight",title:i.options.labelMap["lineheight"]||i.getLang("labelMap.lineheight")||"",items:r,onbuttonclick:function(){var e=i.queryCommandValue("LineHeight")||this.value;i.execCommand("LineHeight",e)}});d.buttons["lineheight"]=o;i.addListener("selectionchange",function(){var e=i.queryCommandState("LineHeight");if(e==-1){o.setDisabled(true)}else{o.setDisabled(false);var t=i.queryCommandValue("LineHeight");t&&o.setValue((t+"").replace(/cm/,""));o.setChecked(e)}});return o};var u=["top","bottom"];for(var c=0,f;f=u[c++];){(function(a){d["rowspacing"+a]=function(i){var e=i.options["rowspacing"+a]||[];if(!e.length)return null;for(var t=0,n,r=[];n=e[t++];){r.push({label:n,value:n,theme:i.options.theme,onclick:function(){i.execCommand("rowspacing",this.value,a)}})}var o=new d.MenuButton({editor:i,className:"edui-for-rowspacing"+a,title:i.options.labelMap["rowspacing"+a]||i.getLang("labelMap.rowspacing"+a)||"",items:r,onbuttonclick:function(){var e=i.queryCommandValue("rowspacing",a)||this.value;i.execCommand("rowspacing",e,a)}});d.buttons[a]=o;i.addListener("selectionchange",function(){var e=i.queryCommandState("rowspacing",a);if(e==-1){o.setDisabled(true)}else{o.setDisabled(false);var t=i.queryCommandValue("rowspacing",a);t&&o.setValue((t+"").replace(/%/,""));o.setChecked(e)}});return o}})(f)}var m=["insertorderedlist","insertunorderedlist"];for(var h=0,p;p=m[h++];){(function(a){d[a]=function(i){var e=i.options[a],t=function(){i.execCommand(a,this.value)},n=[];for(var r in e){n.push({label:e[r]||i.getLang()[a][r]||"",value:r,theme:i.options.theme,onclick:t})}var o=new d.MenuButton({editor:i,className:"edui-for-"+a,title:i.getLang("labelMap."+a)||"",items:n,onbuttonclick:function(){var e=i.queryCommandValue(a)||this.value;i.execCommand(a,e)}});d.buttons[a]=o;i.addListener("selectionchange",function(){var e=i.queryCommandState(a);if(e==-1){o.setDisabled(true)}else{o.setDisabled(false);var t=i.queryCommandValue(a);o.setValue(t);o.setChecked(e)}});return o}})(p)}d.fullscreen=function(t,e){e=t.options.labelMap["fullscreen"]||t.getLang("labelMap.fullscreen")||"";var i=new d.Button({className:"edui-for-fullscreen",title:e,theme:t.options.theme,onclick:function(){if(t.ui){t.ui.setFullScreen(!t.ui.isFullScreen())}this.setChecked(t.ui.isFullScreen())}});d.buttons["fullscreen"]=i;t.addListener("selectionchange",function(){var e=t.queryCommandState("fullscreen");i.setDisabled(e==-1);i.setChecked(t.ui.isFullScreen())});return i};d["emotion"]=function(e,t){var i="emotion";var n=new d.MultiMenuPop({title:e.options.labelMap[i]||e.getLang("labelMap."+i+"")||"",editor:e,className:"edui-for-"+i,iframeUrl:e.ui.mapUrl(t||(e.options.iframeUrlMap||{})[i]||s[i])});d.buttons[i]=n;e.addListener("selectionchange",function(){n.setDisabled(e.queryCommandState(i)==-1)});return n};d.autotypeset=function(e){var t=new d.AutoTypeSetButton({editor:e,title:e.options.labelMap["autotypeset"]||e.getLang("labelMap.autotypeset")||"",className:"edui-for-autotypeset",onbuttonclick:function(){e.execCommand("autotypeset")}});d.buttons["autotypeset"]=t;e.addListener("selectionchange",function(){t.setDisabled(e.queryCommandState("autotypeset")==-1)});return t};d["simpleupload"]=function(r){var o="simpleupload",a=new d.Button({className:"edui-for-"+o,title:r.options.labelMap[o]||r.getLang("labelMap."+o)||"",onclick:function(){},theme:r.options.theme,showText:false});d.buttons[o]=a;r.addListener("ready",function(){var e=a.getDom("body"),t=e.children[0];r.fireEvent("simpleuploadbtnready",t)});r.addListener("selectionchange",function(e,t,i){var n=r.queryCommandState(o);if(n==-1){a.setDisabled(true);a.setChecked(false)}else{if(!i){a.setDisabled(false);a.setChecked(n)}}});return a}})();(function(){var c=baidu.editor.utils,t=baidu.editor.ui.uiUtils,o=baidu.editor.ui.UIBase,w=baidu.editor.dom.domUtils;var a=[];function f(e){this.initOptions(e);this.initEditorUI()}f.prototype={uiName:"editor",initEditorUI:function(){this.editor.ui=this;this._dialogs={};this.initUIBase();this._initToolbars();var u=this.editor,t=this;u.addListener("ready",function(){u.getDialog=function(e){return u.ui._dialogs[e+"Dialog"]};w.on(u.window,"scroll",function(e){baidu.editor.ui.Popup.postHide(e)});u.ui._actualFrameWidth=u.options.initialFrameWidth;UE.browser.ie&&UE.browser.version===6&&u.container.ownerDocument.execCommand("BackgroundImageCache",false,true);if(u.options.elementPathEnabled){u.ui.getDom("elementpath").innerHTML='<div class="edui-editor-breadcrumb">'+u.getLang("elementPathTip")+":</div>"}if(u.options.wordCount){function e(){i(u,t);w.un(u.document,"click",arguments.callee)}w.on(u.document,"click",e);u.ui.getDom("wordcount").innerHTML=u.getLang("wordCountTip")}u.ui._scale();if(u.options.scaleEnabled){if(u.autoHeightEnabled){u.disableAutoHeight()}t.enableScale()}else{t.disableScale()}if(!u.options.elementPathEnabled&&!u.options.wordCount&&!u.options.scaleEnabled){u.ui.getDom("elementpath").style.display="none";u.ui.getDom("wordcount").style.display="none";u.ui.getDom("scale").style.display="none"}if(!u.selection.isFocus())return;u.fireEvent("selectionchange",false,true)});u.addListener("mousedown",function(e,t){var i=t.target||t.srcElement;baidu.editor.ui.Popup.postHide(t,i);baidu.editor.ui.ShortCutMenu.postHide(t)});u.addListener("delcells",function(){if(UE.ui["edittip"]){new UE.ui["edittip"](u)}u.getDialog("edittip").open()});var n,r=false,e;u.addListener("afterpaste",function(){if(u.queryCommandState("pasteplain"))return;if(baidu.editor.ui.PastePicker){n=new baidu.editor.ui.Popup({content:new baidu.editor.ui.PastePicker({editor:u}),editor:u,className:"edui-wordpastepop"});n.render()}r=true});u.addListener("afterinserthtml",function(){clearTimeout(e);e=setTimeout(function(){if(n&&(r||u.ui._isTransfer)){if(n.isHidden()){var e=w.createElement(u.document,"span",{style:"line-height:0px;",innerHTML:"\ufeff"}),t=u.selection.getRange();t.insertNode(e);var i=getDomNode(e,"firstChild","previousSibling");i&&n.showAnchor(i.nodeType==3?i.parentNode:i);w.remove(e)}else{n.show()}delete u.ui._isTransfer;r=false}},200)});u.addListener("contextmenu",function(e,t){baidu.editor.ui.Popup.postHide(t)});u.addListener("keydown",function(e,t){if(n)n.dispose(t);var i=t.keyCode||t.which;if(t.altKey&&i==90){UE.ui.buttons["fullscreen"].onclick()}});u.addListener("wordcount",function(e){i(this,t)});function i(e,t){e.setOpt({wordCount:true,maximumWords:1e4,wordCountMsg:e.options.wordCountMsg||e.getLang("wordCountMsg"),wordOverFlowMsg:e.options.wordOverFlowMsg||e.getLang("wordOverFlowMsg")});var i=e.options,n=i.maximumWords,r=i.wordCountMsg,o=i.wordOverFlowMsg,a=t.getDom("wordcount");if(!i.wordCount){return}var s=e.getContentLength(true);if(s>n){a.innerHTML=o;e.fireEvent("wordcountoverflow")}else{a.innerHTML=r.replace("{#leave}",n-s).replace("{#count}",s)}}u.addListener("selectionchange",function(){if(u.options.elementPathEnabled){t[(u.queryCommandState("elementpath")==-1?"dis":"en")+"ableElementPath"]()}if(u.options.scaleEnabled){t[(u.queryCommandState("scale")==-1?"dis":"en")+"ableScale"]()}});var c=new baidu.editor.ui.Popup({editor:u,content:"",className:"edui-bubble",_onEditButtonClick:function(){this.hide();u.ui._dialogs.linkDialog.open()},_onImgEditButtonClick:function(e){this.hide();u.ui._dialogs[e]&&u.ui._dialogs[e].open()},_onImgSetFloat:function(e){this.hide();u.execCommand("imagefloat",e)},_setIframeAlign:function(e){var t=c.anchorEl;var i=t.cloneNode(true);switch(e){case-2:i.setAttribute("align","");break;case-1:i.setAttribute("align","left");break;case 1:i.setAttribute("align","right");break}t.parentNode.insertBefore(i,t);w.remove(t);c.anchorEl=i;c.showAnchor(c.anchorEl)},_updateIframe:function(){var e=u._iframe=c.anchorEl;if(w.hasClass(e,"ueditor_baidumap")){u.selection.getRange().selectNode(e).select();u.ui._dialogs.mapDialog.open();c.hide()}else{u.ui._dialogs.insertframeDialog.open();c.hide()}},_onRemoveButtonClick:function(e){u.execCommand(e);this.hide()},queryAutoHide:function(e){if(e&&e.ownerDocument==u.document){if(e.tagName.toLowerCase()=="img"||w.findParentByTagName(e,"a",true)){return e!==c.anchorEl}}return baidu.editor.ui.Popup.prototype.queryAutoHide.call(this,e)}});c.render();if(u.options.imagePopup){u.addListener("mouseover",function(e,t){t=t||window.event;var i=t.target||t.srcElement;if(u.ui._dialogs.insertframeDialog&&/iframe/gi.test(i.tagName)){var n=c.formatHtml("<nobr>"+u.getLang("property")+': <span onclick=$$._setIframeAlign(-2) class="edui-clickable">'+u.getLang("default")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(-1) class="edui-clickable">'+u.getLang("justifyleft")+'</span>&nbsp;&nbsp;<span onclick=$$._setIframeAlign(1) class="edui-clickable">'+u.getLang("justifyright")+"</span>&nbsp;&nbsp;"+' <span onclick="$$._updateIframe( this);" class="edui-clickable">'+u.getLang("modify")+"</span></nobr>");if(n){c.getDom("content").innerHTML=n;c.anchorEl=i;c.showAnchor(c.anchorEl)}else{c.hide()}}});u.addListener("selectionchange",function(e,t){if(!t)return;var i="",n="",r=u.selection.getRange().getClosedNode(),o=u.ui._dialogs;if(r&&r.tagName=="IMG"){var a="insertimageDialog";if(r.className.indexOf("edui-faked-video")!=-1||r.className.indexOf("edui-upload-video")!=-1){a="insertvideoDialog"}if(r.className.indexOf("edui-faked-webapp")!=-1){a="webappDialog"}if(r.src.indexOf("http://api.map.baidu.com")!=-1){a="mapDialog"}if(r.className.indexOf("edui-faked-music")!=-1){a="musicDialog"}if(r.src.indexOf("http://maps.google.com/maps/api/staticmap")!=-1){a="gmapDialog"}if(r.getAttribute("anchorname")){a="anchorDialog";i=c.formatHtml("<nobr>"+u.getLang("property")+': <span onclick=$$._onImgEditButtonClick("anchorDialog") class="edui-clickable">'+u.getLang("modify")+"</span>&nbsp;&nbsp;"+"<span onclick=$$._onRemoveButtonClick('anchor') class=\"edui-clickable\">"+u.getLang("delete")+"</span></nobr>")}if(r.getAttribute("word_img")){u.word_img=[r.getAttribute("word_img")];a="wordimageDialog"}if(w.hasClass(r,"loadingclass")||w.hasClass(r,"loaderrorclass")){a=""}if(!o[a]){return}n="<nobr>"+u.getLang("property")+": "+'<span onclick=$$._onImgSetFloat("none") class="edui-clickable">'+u.getLang("default")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("left") class="edui-clickable">'+u.getLang("justifyleft")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("right") class="edui-clickable">'+u.getLang("justifyright")+"</span>&nbsp;&nbsp;"+'<span onclick=$$._onImgSetFloat("center") class="edui-clickable">'+u.getLang("justifycenter")+"</span>&nbsp;&nbsp;"+"<span onclick=\"$$._onImgEditButtonClick('"+a+'\');" class="edui-clickable">'+u.getLang("modify")+"</span></nobr>";!i&&(i=c.formatHtml(n))}if(u.ui._dialogs.linkDialog){var s=u.queryCommandValue("link");var l;if(s&&(l=s.getAttribute("_href")||s.getAttribute("href",2))){var d=l;if(l.length>30){d=l.substring(0,20)+"..."}if(i){i+='<div style="height:5px;"></div>'}i+=c.formatHtml("<nobr>"+u.getLang("anthorMsg")+': <a target="_blank" href="'+l+'" title="'+l+'" >'+d+"</a>"+' <span class="edui-clickable" onclick="$$._onEditButtonClick();">'+u.getLang("modify")+"</span>"+' <span class="edui-clickable" onclick="$$._onRemoveButtonClick(\'unlink\');"> '+u.getLang("clear")+"</span></nobr>");c.showAnchor(s)}}if(i){c.getDom("content").innerHTML=i;c.anchorEl=r||s;c.showAnchor(c.anchorEl)}else{c.hide()}})}},_initToolbars:function(){var r=this.editor;var e=this.toolbars||[];var t=[];for(var i=0;i<e.length;i++){var n=e[i];var o=new baidu.editor.ui.Toolbar({theme:r.options.theme});for(var a=0;a<n.length;a++){var s=n[a];var l=null;if(typeof s=="string"){s=s.toLowerCase();if(s=="|"){s="Separator"}if(s=="||"){s="Breakline"}if(baidu.editor.ui[s]){l=new baidu.editor.ui[s](r)}if(s=="fullscreen"){if(t&&t[0]){t[0].items.splice(0,0,l)}else{l&&o.items.splice(0,0,l)}continue}}else{l=s}if(l&&l.id){o.add(l)}}t[i]=o}c.each(UE._customizeUI,function(e,t){var i,n;if(e.id&&e.id!=r.key){return false}i=e.execFn.call(r,r,t);if(i){n=e.index;if(n===undefined){n=o.items.length}o.add(i,n)}});this.toolbars=t},getHtmlTpl:function(){return'<div id="##" class="%%">'+'<div id="##_toolbarbox" class="%%-toolbarbox">'+(this.toolbars.length?'<div id="##_toolbarboxouter" class="%%-toolbarboxouter"><div class="%%-toolbarboxinner">'+this.renderToolbarBoxHtml()+"</div></div>":"")+'<div id="##_toolbarmsg" class="%%-toolbarmsg" style="display:none;">'+'<div id = "##_upload_dialog" class="%%-toolbarmsg-upload" onclick="$$.showWordImageDialog();">'+this.editor.getLang("clickToUpload")+"</div>"+'<div class="%%-toolbarmsg-close" onclick="$$.hideToolbarMsg();">x</div>'+'<div id="##_toolbarmsg_label" class="%%-toolbarmsg-label"></div>'+'<div style="height:0;overflow:hidden;clear:both;"></div>'+"</div>"+'<div id="##_message_holder" class="%%-messageholder"></div>'+"</div>"+'<div id="##_iframeholder" class="%%-iframeholder">'+"</div>"+'<div id="##_bottombar" class="%%-bottomContainer"><table><tr>'+'<td id="##_elementpath" class="%%-bottombar"></td>'+'<td id="##_wordcount" class="%%-wordcount"></td>'+'<td id="##_scale" class="%%-scale"><div class="%%-icon"></div></td>'+"</tr></table></div>"+'<div id="##_scalelayer"></div>'+"</div>"},showWordImageDialog:function(){this._dialogs["wordimageDialog"].open()},renderToolbarBoxHtml:function(){var e=[];for(var t=0;t<this.toolbars.length;t++){e.push(this.toolbars[t].renderHtml())}return e.join("")},setFullScreen:function(e){var t=this.editor,i=t.container.parentNode.parentNode;if(this._fullscreen!=e){this._fullscreen=e;this.editor.fireEvent("beforefullscreenchange",e);if(baidu.editor.browser.gecko){var n=t.selection.getRange().createBookmark()}if(e){while(i.tagName!="BODY"){var r=baidu.editor.dom.domUtils.getComputedStyle(i,"position");a.push(r);i.style.position="static";i=i.parentNode}this._bakHtmlOverflow=document.documentElement.style.overflow;this._bakBodyOverflow=document.body.style.overflow;this._bakAutoHeight=this.editor.autoHeightEnabled;this._bakScrollTop=Math.max(document.documentElement.scrollTop,document.body.scrollTop);this._bakEditorContaninerWidth=t.iframe.parentNode.offsetWidth;if(this._bakAutoHeight){t.autoHeightEnabled=false;this.editor.disableAutoHeight()}document.documentElement.style.overflow="hidden";window.scrollTo(0,window.scrollY);this._bakCssText=this.getDom().style.cssText;this._bakCssText1=this.getDom("iframeholder").style.cssText;t.iframe.parentNode.style.width="";this._updateFullScreen()}else{while(i.tagName!="BODY"){i.style.position=a.shift();i=i.parentNode}this.getDom().style.cssText=this._bakCssText;this.getDom("iframeholder").style.cssText=this._bakCssText1;if(this._bakAutoHeight){t.autoHeightEnabled=true;this.editor.enableAutoHeight()}document.documentElement.style.overflow=this._bakHtmlOverflow;document.body.style.overflow=this._bakBodyOverflow;t.iframe.parentNode.style.width=this._bakEditorContaninerWidth+"px";window.scrollTo(0,this._bakScrollTop)}if(browser.gecko&&t.body.contentEditable==="true"){var o=document.createElement("input");document.body.appendChild(o);t.body.contentEditable=false;setTimeout(function(){o.focus();setTimeout(function(){t.body.contentEditable=true;t.fireEvent("fullscreenchanged",e);t.selection.getRange().moveToBookmark(n).select(true);baidu.editor.dom.domUtils.remove(o);e&&window.scroll(0,0)},0)},0)}if(t.body.contentEditable==="true"){this.editor.fireEvent("fullscreenchanged",e);this.triggerLayout()}}},_updateFullScreen:function(){if(this._fullscreen){var e=t.getViewportRect();this.getDom().style.cssText="border:0;position:absolute;left:0;top:"+(this.editor.options.topOffset||0)+"px;width:"+e.width+"px;height:"+e.height+"px;z-index:"+(this.getDom().style.zIndex*1+100);t.setViewportOffset(this.getDom(),{left:0,top:this.editor.options.topOffset||0});this.editor.setHeight(e.height-this.getDom("toolbarbox").offsetHeight-this.getDom("bottombar").offsetHeight-(this.editor.options.topOffset||0),true);if(browser.gecko){try{window.onresize()}catch(e){}}}},_updateElementPath:function(){var e=this.getDom("elementpath"),t;if(this.elementPathEnabled&&(t=this.editor.queryCommandValue("elementpath"))){var i=[];for(var n=0,r;r=t[n];n++){i[n]=this.formatHtml('<span unselectable="on" onclick="$$.editor.execCommand(&quot;elementpath&quot;, &quot;'+n+'&quot;);">'+r+"</span>")}e.innerHTML='<div class="edui-editor-breadcrumb" onmousedown="return false;">'+this.editor.getLang("elementPathTip")+": "+i.join(" &gt; ")+"</div>"}else{e.style.display="none"}},disableElementPath:function(){var e=this.getDom("elementpath");e.innerHTML="";e.style.display="none";this.elementPathEnabled=false},enableElementPath:function(){var e=this.getDom("elementpath");e.style.display="";this.elementPathEnabled=true;this._updateElementPath()},_scale:function(){var i=document,e=this.editor,t=e.container,n=e.document,r=this.getDom("toolbarbox"),o=this.getDom("bottombar"),a=this.getDom("scale"),s=this.getDom("scalelayer");var l=false,d=null,u=0,c=e.options.minFrameWidth,f=0,m=0,h=0,p=0;function g(){d=w.getXY(t);if(!u){u=e.options.minFrameHeight+r.offsetHeight+o.offsetHeight}s.style.cssText="position:absolute;left:0;display:;top:0;background-color:#41ABFF;opacity:0.4;filter: Alpha(opacity=40);width:"+t.offsetWidth+"px;height:"+t.offsetHeight+"px;z-index:"+(e.options.zIndex+1);w.on(i,"mousemove",b);w.on(n,"mouseup",y);w.on(i,"mouseup",y)}var v=this;this.editor.addListener("fullscreenchanged",function(e,t){if(t){v.disableScale()}else{if(v.editor.options.scaleEnabled){v.enableScale();var i=v.editor.document.createElement("span");v.editor.body.appendChild(i);v.editor.body.style.height=Math.max(w.getXY(i).y,v.editor.iframe.offsetHeight-20)+"px";w.remove(i)}}});function b(e){C();var t=e||window.event;f=t.pageX||i.documentElement.scrollLeft+t.clientX;m=t.pageY||i.documentElement.scrollTop+t.clientY;h=f-d.x;p=m-d.y;if(h>=c){l=true;s.style.width=h+"px"}if(p>=u){l=true;s.style.height=p+"px"}}function y(){if(l){l=false;e.ui._actualFrameWidth=s.offsetWidth-2;t.style.width=e.ui._actualFrameWidth+"px";e.setHeight(s.offsetHeight-o.offsetHeight-r.offsetHeight-2,true)}if(s){s.style.display="none"}C();w.un(i,"mousemove",b);w.un(n,"mouseup",y);w.un(i,"mouseup",y)}function C(){if(browser.ie)i.selection.clear();else window.getSelection().removeAllRanges()}this.enableScale=function(){if(e.queryCommandState("source")==1)return;a.style.display="";this.scaleEnabled=true;w.on(a,"mousedown",g)};this.disableScale=function(){a.style.display="none";this.scaleEnabled=false;w.un(a,"mousedown",g)}},isFullScreen:function(){return this._fullscreen},postRender:function(){o.prototype.postRender.call(this);for(var e=0;e<this.toolbars.length;e++){this.toolbars[e].postRender()}var t=this;var i,n=baidu.editor.dom.domUtils,r=function(){clearTimeout(i);i=setTimeout(function(){t._updateFullScreen()})};n.on(window,"resize",r);t.addListener("destroy",function(){n.un(window,"resize",r);clearTimeout(i)})},showToolbarMsg:function(e,t){this.getDom("toolbarmsg_label").innerHTML=e;this.getDom("toolbarmsg").style.display="";if(!t){var i=this.getDom("upload_dialog");i.style.display="none"}},hideToolbarMsg:function(){this.getDom("toolbarmsg").style.display="none"},mapUrl:function(e){return e?e.replace("~/",this.editor.options.UEDITOR_HOME_URL||""):""},triggerLayout:function(){var e=this.getDom();if(e.style.zoom=="1"){e.style.zoom="100%"}else{e.style.zoom="1"}}};c.inherits(f,baidu.editor.ui.UIBase);var n={};UE.ui.Editor=function(e){var d=new UE.Editor(e);d.options.editor=d;c.loadFile(document,{href:d.options.themePath+d.options.theme+"/css/ueditor.css",tag:"link",type:"text/css",rel:"stylesheet"});var u=d.render;d.render=function(l){if(l.constructor===String){d.key=l;n[l]=d}c.domReady(function(){d.langIsReady?e():d.addListener("langReady",e);function e(){d.setOpt({labelMap:d.options.labelMap||d.getLang("labelMap")});new f(d.options);if(l){if(l.constructor===String){l=document.getElementById(l)}l&&l.getAttribute("name")&&(d.options.textarea=l.getAttribute("name"));if(l&&/script|textarea/gi.test(l.tagName)){var e=document.createElement("div");l.parentNode.insertBefore(e,l);var t=l.value||l.innerHTML;d.options.initialContent=/^[\t\r\n ]*$/.test(t)?d.options.initialContent:t.replace(/>[\n\r\t]+([ ]{4})+/g,">").replace(/[\n\r\t]+([ ]{4})+</g,"<").replace(/>[\n\r\t]+</g,"><");l.className&&(e.className=l.className);l.style.cssText&&(e.style.cssText=l.style.cssText);if(/textarea/i.test(l.tagName)){d.textarea=l;d.textarea.style.display="none"}else{l.parentNode.removeChild(l)}if(l.id){e.id=l.id;w.removeAttributes(l,"id")}l=e;l.innerHTML=""}}w.addClass(l,"edui-"+d.options.theme);d.ui.render(l);var i=d.options;d.container=d.ui.getDom();var n=w.findParents(l,true);var r=[];for(var o=0,a;a=n[o];o++){r[o]=a.style.display;a.style.display="block"}if(i.initialFrameWidth){i.minFrameWidth=i.initialFrameWidth}else{i.minFrameWidth=i.initialFrameWidth=l.offsetWidth;var s=l.style.width;if(/%$/.test(s)){i.initialFrameWidth=s}}if(i.initialFrameHeight){i.minFrameHeight=i.initialFrameHeight}else{i.initialFrameHeight=i.minFrameHeight=l.offsetHeight}for(var o=0,a;a=n[o];o++){a.style.display=r[o]}if(l.style.height){l.style.height=""}d.container.style.width=i.initialFrameWidth+(/%$/.test(i.initialFrameWidth)?"":"px");d.container.style.zIndex=i.zIndex;u.call(d,d.ui.getDom("iframeholder"));d.fireEvent("afteruiready")}})};return d};UE.getEditor=function(e,t){var i=n[e];if(!i){i=n[e]=new UE.ui.Editor(t);i.render(e)}return i};UE.delEditor=function(e){var t;if(t=n[e]){t.key&&t.destroy();delete n[e]}};UE.registerUI=function(e,t,i,n){c.each(e.split(/\s+/),function(e){UE._customizeUI[e]={id:n,execFn:t,index:i}})}})();UE.registerUI("message",function(e){var t=baidu.editor.ui;var r=t.Message;var o;var a=[];var s=e;s.addListener("ready",function(){o=document.getElementById(s.ui.id+"_message_holder");l();setTimeout(function(){l()},500)});s.addListener("showmessage",function(e,t){t=utils.isString(t)?{content:t}:t;var i=new r({timeout:t.timeout,type:t.type,content:t.content,keepshow:t.keepshow,editor:s}),n=t.id||"msg_"+(+new Date).toString(36);i.render(o);a[n]=i;i.reset(t);l();return n});s.addListener("updatemessage",function(e,t,i){i=utils.isString(i)?{content:i}:i;var n=a[t];n.render(o);n&&n.reset(i)});s.addListener("hidemessage",function(e,t){var i=a[t];i&&i.hide()});function l(){var e=s.ui.getDom("toolbarbox");if(e){o.style.top=e.offsetHeight+3+"px"}o.style.zIndex=Math.max(s.options.zIndex,s.iframe.style.zIndex)+1}});UE.registerUI("autosave",function(e){var t=null,i=null;e.on("afterautosave",function(){clearTimeout(t);t=setTimeout(function(){if(i){e.trigger("hidemessage",i)}i=e.trigger("showmessage",{content:e.getLang("autosave.success"),timeout:2e3})},2e3)})})})();